"use strict";(self.webpackChunkLKovariHome=self.webpackChunkLKovariHome||[]).push([[626],{2090:(ts,Ot,$)=>{$.d(Ot,{BH:()=>Re,G6:()=>Wt,L:()=>Ce,LL:()=>Fe,Pz:()=>P,Sg:()=>xr,UG:()=>F,ZB:()=>re,ZR:()=>ke,aH:()=>_t,b$:()=>vn,eu:()=>ns,hl:()=>Bn,jU:()=>Xe,m9:()=>bn,ne:()=>on,pd:()=>Rr,r3:()=>it,ru:()=>nt,tV:()=>z,uI:()=>Ct,vZ:()=>Pt,w1:()=>er,xO:()=>ss,xb:()=>Nr,z$:()=>Te,zd:()=>pn});const X=function(E){const I=[];let T=0;for(let M=0;M<E.length;M++){let k=E.charCodeAt(M);k<128?I[T++]=k:k<2048?(I[T++]=k>>6|192,I[T++]=63&k|128):55296==(64512&k)&&M+1<E.length&&56320==(64512&E.charCodeAt(M+1))?(k=65536+((1023&k)<<10)+(1023&E.charCodeAt(++M)),I[T++]=k>>18|240,I[T++]=k>>12&63|128,I[T++]=k>>6&63|128,I[T++]=63&k|128):(I[T++]=k>>12|224,I[T++]=k>>6&63|128,I[T++]=63&k|128)}return I},Je={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(E,I){if(!Array.isArray(E))throw Error("encodeByteArray takes an array as a parameter");this.init_();const T=I?this.byteToCharMapWebSafe_:this.byteToCharMap_,M=[];for(let k=0;k<E.length;k+=3){const ee=E[k],ue=k+1<E.length,Oe=ue?E[k+1]:0,It=k+2<E.length,st=It?E[k+2]:0;let ln=(15&Oe)<<2|st>>6,Sn=63&st;It||(Sn=64,ue||(ln=64)),M.push(T[ee>>2],T[(3&ee)<<4|Oe>>4],T[ln],T[Sn])}return M.join("")},encodeString(E,I){return this.HAS_NATIVE_SUPPORT&&!I?btoa(E):this.encodeByteArray(X(E),I)},decodeString(E,I){return this.HAS_NATIVE_SUPPORT&&!I?atob(E):function(E){const I=[];let T=0,M=0;for(;T<E.length;){const k=E[T++];if(k<128)I[M++]=String.fromCharCode(k);else if(k>191&&k<224){const ee=E[T++];I[M++]=String.fromCharCode((31&k)<<6|63&ee)}else if(k>239&&k<365){const It=((7&k)<<18|(63&E[T++])<<12|(63&E[T++])<<6|63&E[T++])-65536;I[M++]=String.fromCharCode(55296+(It>>10)),I[M++]=String.fromCharCode(56320+(1023&It))}else{const ee=E[T++],ue=E[T++];I[M++]=String.fromCharCode((15&k)<<12|(63&ee)<<6|63&ue)}}return I.join("")}(this.decodeStringToByteArray(E,I))},decodeStringToByteArray(E,I){this.init_();const T=I?this.charToByteMapWebSafe_:this.charToByteMap_,M=[];for(let k=0;k<E.length;){const ee=T[E.charAt(k++)],Oe=k<E.length?T[E.charAt(k)]:0;++k;const st=k<E.length?T[E.charAt(k)]:64;++k;const be=k<E.length?T[E.charAt(k)]:64;if(++k,null==ee||null==Oe||null==st||null==be)throw new Be;M.push(ee<<2|Oe>>4),64!==st&&(M.push(Oe<<4&240|st>>2),64!==be&&M.push(st<<6&192|be))}return M},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let E=0;E<this.ENCODED_VALS.length;E++)this.byteToCharMap_[E]=this.ENCODED_VALS.charAt(E),this.charToByteMap_[this.byteToCharMap_[E]]=E,this.byteToCharMapWebSafe_[E]=this.ENCODED_VALS_WEBSAFE.charAt(E),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[E]]=E,E>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(E)]=E,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(E)]=E)}}};class Be extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ce=function(E){return function(E){const I=X(E);return Je.encodeByteArray(I,!0)}(E).replace(/\./g,"")},z=function(E){try{return Je.decodeString(E,!0)}catch(I){console.error("base64Decode failed: ",I)}return null};function re(E,I){if(!(I instanceof Object))return I;switch(I.constructor){case Date:return new Date(I.getTime());case Object:void 0===E&&(E={});break;case Array:E=[];break;default:return I}for(const T in I)!I.hasOwnProperty(T)||!ae(T)||(E[T]=re(E[T],I[T]));return E}function ae(E){return"__proto__"!==E}const Ee=()=>{try{return function Me(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const E=process.env.__FIREBASE_DEFAULTS__;return E?JSON.parse(E):void 0})()||(()=>{if(typeof document>"u")return;let E;try{E=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const I=E&&z(E[1]);return I&&JSON.parse(I)})()}catch(E){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${E}`)}},_t=()=>{var E;return null===(E=Ee())||void 0===E?void 0:E.config},P=E=>{var I;return null===(I=Ee())||void 0===I?void 0:I[`_${E}`]};class Re{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((I,T)=>{this.resolve=I,this.reject=T})}wrapCallback(I){return(T,M)=>{T?this.reject(T):this.resolve(M),"function"==typeof I&&(this.promise.catch(()=>{}),1===I.length?I(T):I(T,M))}}}function xr(E,I){if(E.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const M=I||"demo-project",k=E.iat||0,ee=E.sub||E.user_id;if(!ee)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const ue=Object.assign({iss:`https://securetoken.google.com/${M}`,aud:M,iat:k,exp:k+3600,auth_time:k,sub:ee,user_id:ee,firebase:{sign_in_provider:"custom",identities:{}}},E);return[Ce(JSON.stringify({alg:"none",type:"JWT"})),Ce(JSON.stringify(ue)),""].join(".")}function Te(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Ct(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Te())}function F(){var E;const I=null===(E=Ee())||void 0===E?void 0:E.forceEnvironment;if("node"===I)return!0;if("browser"===I)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch{return!1}}function Xe(){return"object"==typeof self&&self.self===self}function nt(){const E="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof E&&void 0!==E.id}function vn(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function er(){const E=Te();return E.indexOf("MSIE ")>=0||E.indexOf("Trident/")>=0}function Wt(){return!F()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Bn(){try{return"object"==typeof indexedDB}catch{return!1}}function ns(){return new Promise((E,I)=>{try{let T=!0;const M="validate-browser-context-for-indexeddb-analytics-module",k=self.indexedDB.open(M);k.onsuccess=()=>{k.result.close(),T||self.indexedDB.deleteDatabase(M),E(!0)},k.onupgradeneeded=()=>{T=!1},k.onerror=()=>{var ee;I((null===(ee=k.error)||void 0===ee?void 0:ee.message)||"")}}catch(T){I(T)}})}class ke extends Error{constructor(I,T,M){super(T),this.code=I,this.customData=M,this.name="FirebaseError",Object.setPrototypeOf(this,ke.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Fe.prototype.create)}}class Fe{constructor(I,T,M){this.service=I,this.serviceName=T,this.errors=M}create(I,...T){const M=T[0]||{},k=`${this.service}/${I}`,ee=this.errors[I],ue=ee?function sn(E,I){return E.replace(Or,(T,M)=>{const k=I[M];return null!=k?String(k):`<${M}?>`})}(ee,M):"Error";return new ke(k,`${this.serviceName}: ${ue} (${k}).`,M)}}const Or=/\{\$([^}]+)}/g;function it(E,I){return Object.prototype.hasOwnProperty.call(E,I)}function Nr(E){for(const I in E)if(Object.prototype.hasOwnProperty.call(E,I))return!1;return!0}function Pt(E,I){if(E===I)return!0;const T=Object.keys(E),M=Object.keys(I);for(const k of T){if(!M.includes(k))return!1;const ee=E[k],ue=I[k];if(En(ee)&&En(ue)){if(!Pt(ee,ue))return!1}else if(ee!==ue)return!1}for(const k of M)if(!T.includes(k))return!1;return!0}function En(E){return null!==E&&"object"==typeof E}function ss(E){const I=[];for(const[T,M]of Object.entries(E))Array.isArray(M)?M.forEach(k=>{I.push(encodeURIComponent(T)+"="+encodeURIComponent(k))}):I.push(encodeURIComponent(T)+"="+encodeURIComponent(M));return I.length?"&"+I.join("&"):""}function pn(E){const I={};return E.replace(/^\?/,"").split("&").forEach(M=>{if(M){const[k,ee]=M.split("=");I[decodeURIComponent(k)]=decodeURIComponent(ee)}}),I}function Rr(E){const I=E.indexOf("?");if(!I)return"";const T=E.indexOf("#",I);return E.substring(I,T>0?T:void 0)}function on(E,I){const T=new vt(E,I);return T.subscribe.bind(T)}class vt{constructor(I,T){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=T,this.task.then(()=>{I(this)}).catch(M=>{this.error(M)})}next(I){this.forEachObserver(T=>{T.next(I)})}error(I){this.forEachObserver(T=>{T.error(I)}),this.close(I)}complete(){this.forEachObserver(I=>{I.complete()}),this.close()}subscribe(I,T,M){let k;if(void 0===I&&void 0===T&&void 0===M)throw new Error("Missing Observer.");k=function rr(E,I){if("object"!=typeof E||null===E)return!1;for(const T of I)if(T in E&&"function"==typeof E[T])return!0;return!1}(I,["next","error","complete"])?I:{next:I,error:T,complete:M},void 0===k.next&&(k.next=ir),void 0===k.error&&(k.error=ir),void 0===k.complete&&(k.complete=ir);const ee=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?k.error(this.finalError):k.complete()}catch{}}),this.observers.push(k),ee}unsubscribeOne(I){void 0===this.observers||void 0===this.observers[I]||(delete this.observers[I],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(I){if(!this.finalized)for(let T=0;T<this.observers.length;T++)this.sendOne(T,I)}sendOne(I,T){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[I])try{T(this.observers[I])}catch(M){typeof console<"u"&&console.error&&console.error(M)}})}close(I){this.finalized||(this.finalized=!0,void 0!==I&&(this.finalError=I),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ir(){}function bn(E){return E&&E._delegate?E._delegate:E}},1626:(ts,Ot,$)=>{$.r(Ot),$.d(Ot,{DigitsModule:()=>Rw});var v=$(4755),ne=$(3439),R=$(387);let X=(()=>{var n;class e{}return(n=e).OPERATOR_REV="\xab",n.OPERATOR_ADD="+",n.OPERATOR_SUB="-",n.OPERATOR_MUL="\xd7",n.OPERATOR_DIV="/",e})();class ht{constructor(e,t,r,i){this.id=e,this.selected=t,this.disabled=r,this.value=i}}class Je{constructor(){this.operands=[]}}class Be{static evaluate(e,t,r){var i=Number.MIN_VALUE;switch(r){case X.OPERATOR_ADD:i=e+t;break;case X.OPERATOR_SUB:i=e>=t?e-t:Number.MIN_VALUE;break;case X.OPERATOR_DIV:i=e%t==0?e/t:Number.MIN_VALUE;break;case X.OPERATOR_MUL:i=e*t}return i}static cloneGameParameters(e){let t=new Je;return t.result=e.result,e.operands.forEach(r=>{let i=new ht(r.id,!1,!1,-1);Object.assign(i,r),t.operands.push(i)}),t}}class Dt{constructor(){this.numbers=[]}generateNumber(e,t){let r=Math.floor(e+Math.random()*(t-e+1));for(;this.numbers.indexOf(r)>=0;)r=Math.floor(e+Math.random()*(t-e+1));this.numbers.push(r)}getGeneratedNumbers(){return this.numbers}clearGeneratedNumbers(){this.numbers=[]}}class Ce{generateNumber(e,t){return Math.floor(e+Math.random()*(t-e+1))}choiceRandomOperation(){let e=this.generateNumber(0,4),t=X.OPERATOR_ADD;switch(e){case 0:t=X.OPERATOR_ADD;break;case 1:t=X.OPERATOR_SUB;break;case 2:t=X.OPERATOR_MUL;break;case 0:t=X.OPERATOR_DIV}return t}checkExecuteDivision(e,t){return e%t==0}checkExecuteSubstraction(e,t){return e>t}removeOperandByIndex(e,t){let r=t;return e<t&&(r=t-1),this.operands.splice(e,1),r}calculateResult(e){let t=this.operands.length,r=0,i=0,s=this.generateNumber(3,5),a=Number.MIN_VALUE;for(;i<s&&e.length>1;){let h=this.choiceRandomOperation(),d=this.generateNumber(0,t-1);for(a===Number.MIN_VALUE&&(a=this.generateNumber(0,t-1));a===d;)d=this.generateNumber(0,t-1);switch(h){case X.OPERATOR_ADD:e[a]=Be.evaluate(e[a],e[d],h),a=this.removeOperandByIndex(d,a),--t,++i;break;case X.OPERATOR_SUB:if(!this.checkExecuteSubstraction(e[a],e[d]))continue;e[a]=Be.evaluate(e[a],e[d],h),a=this.removeOperandByIndex(d,a),--t,++i;break;case X.OPERATOR_MUL:e[a]=Be.evaluate(e[a],e[d],h),a=this.removeOperandByIndex(d,a),--t,++i;break;case X.OPERATOR_DIV:if(!this.checkExecuteDivision(e[a],e[d]))continue;e[a]=Be.evaluate(e[a],e[d],h),a=this.removeOperandByIndex(d,a),--t,++i}}return r=e[a],r}generateGameParameter(e){let t=new Dt;switch(e){case 0:t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(5,10),t.generateNumber(10,25);break;case 1:t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(5,10),t.generateNumber(10,15),t.generateNumber(10,25);break;case 2:t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(5,10),t.generateNumber(5,15),t.generateNumber(10,20),t.generateNumber(10,25);break;case 3:t.generateNumber(1,5),t.generateNumber(5,10),t.generateNumber(5,15),t.generateNumber(10,15),t.generateNumber(10,20),t.generateNumber(10,25);break;case 4:t.generateNumber(1,10),t.generateNumber(5,10),t.generateNumber(5,15),t.generateNumber(10,15),t.generateNumber(10,25),t.generateNumber(10,25)}let r=t.getGeneratedNumbers();r=r.sort((y,_)=>y-_);let i=new Array(r[0],r[1],r[2],r[3],r[4],r[5]);this.operands=new Array(r[0],r[1],r[2],r[3],r[4],r[5]),t.clearGeneratedNumbers();let s=0,a=0;switch(e){case 0:s=30,a=100;break;case 1:s=50,a=150;break;case 2:s=100,a=200;break;case 3:s=300,a=400;break;case 4:s=400,a=550}let h=this.calculateResult(this.operands);for(;s>h||h>a;)this.operands=new Array(r[0],r[1],r[2],r[3],r[4],r[5]),h=this.calculateResult(this.operands);let d=new Je;d.result=h;let m=0;return i.forEach(y=>{let _=new ht(m,!1,!1,y);d.operands.push(_),++m}),d}generateStageNumbers(){let e=new Array;for(let t=0;t<5;t++){let r=this.generateGameParameter(t);r.stageIndex=t,e.push(r)}return e=e.sort((t,r)=>t.result-r.result),e}}class z{cookieData2Text(){return JSON.stringify(this)}text2CookieData(e){return JSON.parse(e)}}var f=$(2223);let re=(()=>{var n;class e{constructor(r,i){this.document=r,this.platformId=i,this.documentIsAccessible=(0,v.NF)(this.platformId)}static getCookieRegExp(r){const i=r.replace(/([\[\]\{\}\(\)\|\=\;\+\?\,\.\*\^\$])/gi,"\\$1");return new RegExp("(?:^"+i+"|;\\s*"+i+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(r){try{return decodeURIComponent(r)}catch{return r}}check(r){return!!this.documentIsAccessible&&(r=encodeURIComponent(r),e.getCookieRegExp(r).test(this.document.cookie))}get(r){if(this.documentIsAccessible&&this.check(r)){r=encodeURIComponent(r);const s=e.getCookieRegExp(r).exec(this.document.cookie);return s[1]?e.safeDecodeURIComponent(s[1]):""}return""}getAll(){if(!this.documentIsAccessible)return{};const r={},i=this.document;return i.cookie&&""!==i.cookie&&i.cookie.split(";").forEach(s=>{const[a,h]=s.split("=");r[e.safeDecodeURIComponent(a.replace(/^ /,""))]=e.safeDecodeURIComponent(h)}),r}set(r,i,s,a,h,d,m){if(!this.documentIsAccessible)return;if("number"==typeof s||s instanceof Date||a||h||d||m)return void this.set(r,i,{expires:s,path:a,domain:h,secure:d,sameSite:m||"Lax"});let y=encodeURIComponent(r)+"="+encodeURIComponent(i)+";";const _=s||{};_.expires&&(y+="number"==typeof _.expires?"expires="+new Date((new Date).getTime()+1e3*_.expires*60*60*24).toUTCString()+";":"expires="+_.expires.toUTCString()+";"),_.path&&(y+="path="+_.path+";"),_.domain&&(y+="domain="+_.domain+";"),!1===_.secure&&"None"===_.sameSite&&(_.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${r} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),_.secure&&(y+="secure;"),_.sameSite||(_.sameSite="Lax"),y+="sameSite="+_.sameSite+";",this.document.cookie=y}delete(r,i,s,a,h="Lax"){this.documentIsAccessible&&this.set(r,"",{expires:new Date("Thu, 01 Jan 1970 00:00:01 GMT"),path:i,domain:s,secure:a,sameSite:h})}deleteAll(r,i,s,a="Lax"){if(!this.documentIsAccessible)return;const h=this.getAll();for(const d in h)h.hasOwnProperty(d)&&this.delete(d,r,i,s,a)}}return(n=e).\u0275fac=function(r){return new(r||n)(f.LFG(v.K0),f.LFG(f.Lbi))},n.\u0275prov=f.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var ae=$(4004);class Me{constructor(){this.stages=[]}}class Nt{constructor(){this.operands=[]}}const Ge=new f.OlP("WindowToken",typeof window<"u"&&window.document?{providedIn:"root",factory:()=>window}:{providedIn:"root",factory:()=>{}});var ye=$(7579);let Ee=(()=>{class n{constructor(t,r,i){this.ngZone=t,this.document=r,this.window=i,this.copySubject=new ye.x,this.copyResponse$=this.copySubject.asObservable(),this.config={}}configure(t){this.config=t}copy(t){if(!this.isSupported||!t)return this.pushCopyResponse({isSuccess:!1,content:t});const r=this.copyFromContent(t);return this.pushCopyResponse(r?{content:t,isSuccess:r}:{isSuccess:!1,content:t})}get isSupported(){return!!this.document.queryCommandSupported&&!!this.document.queryCommandSupported("copy")&&!!this.window}isTargetValid(t){if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement){if(t.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');return!0}throw new Error("Target should be input or textarea")}copyFromInputElement(t,r=!0){try{this.selectTarget(t);const i=this.copyText();return this.clearSelection(r?t:void 0,this.window),i&&this.isCopySuccessInIE11()}catch{return!1}}isCopySuccessInIE11(){const t=this.window.clipboardData;return!(t&&t.getData&&!t.getData("Text"))}copyFromContent(t,r=this.document.body){if(this.tempTextArea&&!r.contains(this.tempTextArea)&&this.destroy(this.tempTextArea.parentElement||void 0),!this.tempTextArea){this.tempTextArea=this.createTempTextArea(this.document,this.window);try{r.appendChild(this.tempTextArea)}catch{throw new Error("Container should be a Dom element")}}this.tempTextArea.value=t;const i=this.copyFromInputElement(this.tempTextArea,!1);return this.config.cleanUpAfterCopy&&this.destroy(this.tempTextArea.parentElement||void 0),i}destroy(t=this.document.body){this.tempTextArea&&(t.removeChild(this.tempTextArea),this.tempTextArea=void 0)}selectTarget(t){return t.select(),t.setSelectionRange(0,t.value.length),t.value.length}copyText(){return this.document.execCommand("copy")}clearSelection(t,r){t&&t.focus(),r.getSelection()?.removeAllRanges()}createTempTextArea(t,r){const i="rtl"===t.documentElement.getAttribute("dir");let s;return s=t.createElement("textarea"),s.style.fontSize="12pt",s.style.border="0",s.style.padding="0",s.style.margin="0",s.style.position="absolute",s.style[i?"right":"left"]="-9999px",s.style.top=(r.pageYOffset||t.documentElement.scrollTop)+"px",s.setAttribute("readonly",""),s}pushCopyResponse(t){this.copySubject.observers.length>0&&this.ngZone.run(()=>{this.copySubject.next(t)})}pushCopyReponse(t){this.pushCopyResponse(t)}}return n.\u0275fac=function(t){return new(t||n)(f.LFG(f.R0b),f.LFG(v.K0),f.LFG(Ge,8))},n.\u0275prov=f.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),_t=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=f.oAB({type:n}),n.\u0275inj=f.cJS({imports:[v.ez]}),n})();var P=$(1180),Re=$(7212);(0,Re.registerVersion)("firebase","9.23.0","app");var Ct=$(4408),Xe=$(7565);const vn=new class nt extends Xe.v{}(class F extends Ct.o{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,r=0){return null!=r&&r>0||null==r&&this.delay>0?super.requestAsyncId(e,t,r):(e.flush(this),0)}});var er=$(4986),In=$(8505),kr=$(9468),Wt=$(5363);const Bn=new f.GfV("ANGULARFIRE2_VERSION");class ke{constructor(){return((n,e)=>{const t=(0,Re.getApps)(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(a=>{r.includes(a)||r.push(a)})}),r})(Fe)}}const Fe="app-check";function sn(){}class Or{constructor(e,t=vn){(0,P.Z)(this,"zone",void 0),(0,P.Z)(this,"delegate",void 0),this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){const i=this.zone;return this.delegate.schedule(function(a){i.runGuarded(()=>{e.apply(this,[a])})},t,r)}}class tr{constructor(e){(0,P.Z)(this,"zone",void 0),(0,P.Z)(this,"task",null),this.zone=e}call(e,t){const r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",sn,{},sn,sn)),t.pipe((0,In.b)({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{null!=this.task&&"scheduled"===this.task.state&&(this.task.invoke(),this.task=null)},10)}}let Qt=(()=>{var n;class e{constructor(r){(0,P.Z)(this,"ngZone",void 0),(0,P.Z)(this,"outsideAngular",void 0),(0,P.Z)(this,"insideAngular",void 0),this.ngZone=r,this.outsideAngular=r.runOutsideAngular(()=>new Or(Zone.current)),this.insideAngular=r.run(()=>new Or(Zone.current,er.z)),globalThis.\u0275AngularFireScheduler||=this}}return n=e,(0,P.Z)(e,"\u0275fac",function(r){return new(r||n)(f.LFG(f.R0b))}),(0,P.Z)(e,"\u0275prov",f.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})),e})();function it(n){return function co(n){return function(t){return(t=t.lift(new tr(n.ngZone))).pipe((0,kr.R)(n.outsideAngular),(0,Wt.Q)(n.insideAngular))}}(function Rt(){const n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error("Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using\nprovideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).");return n}())(n)}var Pt=$(6101);Pt.Z.registerVersion("firebase","9.23.0","app-compat");const ss=["ngOnDestroy"];class Mt{constructor(e){return e}}const on=new f.OlP("angularfire2.app.options"),vt=new f.OlP("angularfire2.app.name");function nr(n,e,t){const i="object"==typeof t&&t||{};i.name=i.name||"string"==typeof t&&t||"[DEFAULT]";const a=Pt.Z.apps.filter(h=>h&&h.name===i.name)[0]||e.runOutsideAngular(()=>Pt.Z.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(a.options)){const h=!!module.hot;rr("error",`${a.name} Firebase App already initialized with different options${h?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Mt(a)}const rr=(n,...e)=>{(0,f.X6Q)()&&typeof console<"u"&&console[n](...e)},ir={provide:Mt,useFactory:nr,deps:[on,f.R0b,[new f.FiY,vt]]};let os=(()=>{var n;class e{static initializeApp(r,i){return{ngModule:e,providers:[{provide:on,useValue:r},{provide:vt,useValue:i}]}}constructor(r){Pt.Z.registerVersion("angularfire",Bn.full,"core"),Pt.Z.registerVersion("angularfire",Bn.full,"app-compat"),Pt.Z.registerVersion("angular",f.q4F.full,r.toString())}}return n=e,(0,P.Z)(e,"\u0275fac",function(r){return new(r||n)(f.LFG(f.Lbi))}),(0,P.Z)(e,"\u0275mod",f.oAB({type:n})),(0,P.Z)(e,"\u0275inj",f.cJS({providers:[ir]})),e})();function an(n,e,t,r,i){const[,s,a]=globalThis.\u0275AngularfireInstanceCache.find(h=>h[0]===n)||[];if(s)return function mi(n,e){try{return n.toString()===e.toString()}catch{return n===e}}(i,a)||(Pr("error",`${e} was already initialized on the ${t} Firebase App with different settings.${cn?" You may need to reload as Firebase is not HMR aware.":""}`),Pr("warn",{is:i,was:a})),s;{const h=r();return globalThis.\u0275AngularfireInstanceCache.push([n,h,i]),h}}const cn=typeof module<"u"&&!!module.hot,Pr=(n,...e)=>{(0,f.X6Q)()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[],$(8463);var Tn=$(9646),gi=$(9751),un=$(8996),zn=$(6451),et=$(3900),zt=$(6063);class as extends ye.x{constructor(e=1/0,t=1/0,r=zt.l){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:r,_infiniteTimeWindow:i,_timestampProvider:s,_windowTime:a}=this;t||(r.push(e),!i&&r.push(s.now()+a)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:r,_buffer:i}=this,s=i.slice();for(let a=0;a<s.length&&!e.closed;a+=r?1:2)e.next(s[a]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:r,_infiniteTimeWindow:i}=this,s=(i?1:2)*e;if(e<1/0&&s<r.length&&r.splice(0,r.length-s),!i){const a=t.now();let h=0;for(let d=1;d<r.length&&r[d]<=a;d+=2)h=d;h&&r.splice(0,h+1)}}}var xt=$(3099);function cs(n,e,t){let r,i=!1;return n&&"object"==typeof n?({bufferSize:r=1/0,windowTime:e=1/0,refCount:i=!1,scheduler:t}=n):r=n??1/0,(0,xt.B)({connector:()=>new as(r,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}var bn=$(590),E=$(576);function I(n,e){return(0,E.m)(e)?(0,et.w)(()=>n,e):(0,et.w)(()=>n)}var T=$(9300);const k=new f.OlP("angularfire2.auth.use-emulator"),ee=new f.OlP("angularfire2.auth.settings"),ue=new f.OlP("angularfire2.auth.tenant-id"),Oe=new f.OlP("angularfire2.auth.langugage-code"),It=new f.OlP("angularfire2.auth.use-device-language"),st=new f.OlP("angularfire.auth.persistence"),dt=(n,e,t,r,i,s,a,h)=>an(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const d=e.runOutsideAngular(()=>n.auth());if(t&&d.useEmulator(...t),r&&(d.tenantId=r),d.languageCode=i,s&&d.useDeviceLanguage(),a)for(const[m,y]of Object.entries(a))d.settings[m]=y;return h&&d.setPersistence(h),d},[t,r,i,s,a,h]);let be=(()=>{var n;class e{constructor(r,i,s,a,h,d,m,y,_,S,N,Z){(0,P.Z)(this,"authState",void 0),(0,P.Z)(this,"idToken",void 0),(0,P.Z)(this,"user",void 0),(0,P.Z)(this,"idTokenResult",void 0),(0,P.Z)(this,"credential",void 0);const K=new ye.x,H=(0,Tn.of)(void 0).pipe((0,Wt.Q)(h.outsideAngular),(0,et.w)(()=>a.runOutsideAngular(()=>Promise.resolve().then($.bind($,8463)))),(0,ae.U)(()=>nr(r,a,i)),(0,ae.U)(oe=>dt(oe,a,d,y,_,S,m,N)),cs({bufferSize:1,refCount:!1}));if((0,v.PM)(s))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,Tn.of)(null);else{H.pipe((0,bn.P)()).subscribe();const oe=H.pipe((0,et.w)(pe=>pe.getRedirectResult().then(Ae=>Ae,()=>null)),it,cs({bufferSize:1,refCount:!1})),ve=H.pipe((0,et.w)(pe=>new gi.y(Ae=>({unsubscribe:a.runOutsideAngular(()=>pe.onAuthStateChanged(Ie=>Ae.next(Ie),Ie=>Ae.error(Ie),()=>Ae.complete()))})))),fe=H.pipe((0,et.w)(pe=>new gi.y(Ae=>({unsubscribe:a.runOutsideAngular(()=>pe.onIdTokenChanged(Ie=>Ae.next(Ie),Ie=>Ae.error(Ie),()=>Ae.complete()))}))));this.authState=oe.pipe(I(ve),(0,kr.R)(h.outsideAngular),(0,Wt.Q)(h.insideAngular)),this.user=oe.pipe(I(fe),(0,kr.R)(h.outsideAngular),(0,Wt.Q)(h.insideAngular)),this.idToken=this.user.pipe((0,et.w)(pe=>pe?(0,un.D)(pe.getIdToken()):(0,Tn.of)(null))),this.idTokenResult=this.user.pipe((0,et.w)(pe=>pe?(0,un.D)(pe.getIdTokenResult()):(0,Tn.of)(null))),this.credential=(0,zn.T)(oe,K,this.authState.pipe((0,T.h)(pe=>!pe))).pipe((0,ae.U)(pe=>pe?.user?pe:null),(0,kr.R)(h.outsideAngular),(0,Wt.Q)(h.insideAngular))}return((n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(ss.indexOf(s)>-1)return()=>{};const a=e.toPromise().then(h=>{const d=h?.[s];return"function"==typeof d?d.bind(h):d?.then?d.then(m=>t.run(()=>m)):t.run(()=>d)});return new Proxy(()=>{},{get:(h,d)=>a[d],apply:(h,d,m)=>a.then(y=>{const _=y?.(...m);return r?.spy?.apply&&r.spy.apply(s,m,_),_})})})}))(this,H,a,{spy:{apply:(oe,ve,fe)=>{(oe.startsWith("signIn")||oe.startsWith("createUser"))&&fe.then(pe=>K.next(pe))}}})}}return n=e,(0,P.Z)(e,"\u0275fac",function(r){return new(r||n)(f.LFG(on),f.LFG(vt,8),f.LFG(f.Lbi),f.LFG(f.R0b),f.LFG(Qt),f.LFG(k,8),f.LFG(ee,8),f.LFG(ue,8),f.LFG(Oe,8),f.LFG(It,8),f.LFG(st,8),f.LFG(ke,8))}),(0,P.Z)(e,"\u0275prov",f.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"})),e})();var Sn=$(8675),Mr=$(4482),$a=$(5403);function D(){return(0,Mr.e)((n,e)=>{let t,r=!1;n.subscribe((0,$a.x)(e,i=>{const s=t;t=i,r&&e.next([s,i]),r=!0}))})}var q,A=$(5026),B=$(1884),b=$(5861),ce=$(4859),de=$(1877),se=$(2090),wt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Pe={},sr=sr||{},he=wt||self;function uo(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function us(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Cn="closure_uid_"+(1e9*Math.random()>>>0),Ka=0;function bh(n,e,t){return n.call.apply(n.bind,arguments)}function Sh(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function _e(n,e,t){return(_e=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?bh:Sh).apply(null,arguments)}function ls(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function ft(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var a=Array(arguments.length-2),h=2;h<arguments.length;h++)a[h-2]=arguments[h];return e.prototype[i].apply(r,a)}}function or(){this.s=this.s,this.o=this.o}or.prototype.s=!1,or.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function Ru(n){Object.prototype.hasOwnProperty.call(n,Cn)&&n[Cn]||(n[Cn]=++Ka)}(this)},or.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Ha=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Wa(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Qa(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(uo(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let a=0;a<s;a++)n[i+a]=r[a]}else n.push(r)}}function At(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}At.prototype.h=function(){this.defaultPrevented=!0};var yi=function(){if(!he.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{he.addEventListener("test",()=>{},e),he.removeEventListener("test",()=>{},e)}catch{}return n}();function _i(n){return/^[\s\xa0]*$/.test(n)}function vi(){var n=he.navigator;return n&&(n=n.userAgent)?n:""}function mn(n){return-1!=vi().indexOf(n)}function hs(n){return hs[" "](n),n}hs[" "]=function(){};var ds,n,Ya=mn("Opera"),ar=mn("Trident")||mn("MSIE"),lo=mn("Edge"),Ii=lo||ar,ho=mn("Gecko")&&!(-1!=vi().toLowerCase().indexOf("webkit")&&!mn("Edge"))&&!(mn("Trident")||mn("MSIE"))&&!mn("Edge"),xh=-1!=vi().toLowerCase().indexOf("webkit")&&!mn("Edge");function fo(){var n=he.document;return n?n.documentMode:void 0}e:{var fs="",ps=(n=vi(),ho?/rv:([^\);]+)(\)|;)/.exec(n):lo?/Edge\/([\d\.]+)/.exec(n):ar?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):xh?/WebKit\/(\S+)/.exec(n):Ya?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(ps&&(fs=ps?ps[1]:""),ar){var ms=fo();if(null!=ms&&ms>parseFloat(fs)){ds=String(ms);break e}}ds=fs}var Ah=he.document&&ar&&(fo()||parseInt(ds,10))||void 0;function Lr(n,e){if(At.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(ho){e:{try{hs(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:kh[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Lr.$.h.call(this)}}ft(Lr,At);var kh={2:"touch",3:"pen",4:"mouse"};Lr.prototype.h=function(){Lr.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Fr="closure_listenable_"+(1e6*Math.random()|0),gs=0;function Zn(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++gs,this.fa=this.ia=!1}function wi(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Xa(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function Mu(n){const e={};for(const t in n)e[t]=n[t];return e}const mo="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Lu(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<mo.length;s++)t=mo[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Ei(n){this.src=n,this.g={},this.h=0}function ec(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=Ha(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(wi(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function ys(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}Ei.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var a=ys(n,e,r,i);return-1<a?(e=n[a],t||(e.ia=!1)):((e=new Zn(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var tc="closure_lm_"+(1e6*Math.random()|0),nc={};function go(n,e,t,r,i){if(r&&r.once)return Fu(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)go(n,e[s],t,r,i);return null}return t=_o(t),n&&n[Fr]?n.O(e,t,us(r)?!!r.capture:!!r,i):cr(n,e,t,!1,r,i)}function cr(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var a=us(i)?!!i.capture:!!i,h=ur(n);if(h||(n[tc]=h=new Ei(n)),(t=h.add(e,t,r,a,s)).proxy)return t;if(r=function Oh(){const e=Gn;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)yi||(i=a),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(yo(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function Fu(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Fu(n,e[s],t,r,i);return null}return t=_o(t),n&&n[Fr]?n.P(e,t,us(r)?!!r.capture:!!r,i):cr(n,e,t,!0,r,i)}function Ti(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Ti(n,e[s],t,r,i);else r=us(r)?!!r.capture:!!r,t=_o(t),n&&n[Fr]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=ys(s=n.g[e],t,r,i))&&(wi(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=ur(n))&&(e=n.g[e.toString()],n=-1,e&&(n=ys(e,t,r,i)),(t=-1<n?e[n]:null)&&Uu(t))}function Uu(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[Fr])ec(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(yo(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=ur(e))?(ec(t,n),0==t.h&&(t.src=null,e[tc]=null)):wi(n)}}}function yo(n){return n in nc?nc[n]:nc[n]="on"+n}function Gn(n,e){if(n.fa)n=!0;else{e=new Lr(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Uu(n),n=t.call(r,e)}return n}function ur(n){return(n=n[tc])instanceof Ei?n:null}var lr="__closure_events_fn_"+(1e9*Math.random()>>>0);function _o(n){return"function"==typeof n?n:(n[lr]||(n[lr]=function(e){return n.handleEvent(e)}),n[lr])}function ot(){or.call(this),this.i=new Ei(this),this.S=this,this.J=null}function pt(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new At(e,n);else if(e instanceof At)e.target=e.target||n;else{var i=e;Lu(e=new At(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var a=e.g=t[s];i=vo(a,r,!0,e)&&i}if(i=vo(a=e.g=n,r,!0,e)&&i,i=vo(a,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=vo(a=e.g=t[s],r,!1,e)&&i}function vo(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var a=e[s];if(a&&!a.fa&&a.capture==t){var h=a.listener,d=a.la||a.src;a.ia&&ec(n.i,a),i=!1!==h.call(d,r)&&i}}return i&&!r.defaultPrevented}ft(ot,or),ot.prototype[Fr]=!0,ot.prototype.removeEventListener=function(n,e,t,r){Ti(this,n,e,t,r)},ot.prototype.N=function(){if(ot.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)wi(t[r]);delete n.g[e],n.h--}}this.J=null},ot.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},ot.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var hr=he.JSON.stringify;function Io(){var n=bi;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var _s=new class Dh{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new rc,n=>n.reset());class rc{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function hn(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function Bu(n){he.setTimeout(()=>{throw n},0)}let vs,Ur=!1,bi=new class Vu{constructor(){this.h=this.g=null}add(e,t){const r=_s.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},ic=()=>{const n=he.Promise.resolve(void 0);vs=()=>{n.then(zu)}};var zu=()=>{for(var n;n=Io();){try{n.h.call(n.g)}catch(t){Bu(t)}var e=_s;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Ur=!1};function wo(n,e){ot.call(this),this.h=n||1,this.g=e||he,this.j=_e(this.qb,this),this.l=Date.now()}function Is(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function ws(n,e,t){if("function"==typeof n)t&&(n=_e(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=_e(n.handleEvent,n)}return 2147483647<Number(e)?-1:he.setTimeout(n,e||0)}function Eo(n){n.g=ws(()=>{n.g=null,n.i&&(n.i=!1,Eo(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}ft(wo,ot),(q=wo.prototype).ga=!1,q.T=null,q.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),pt(this,"tick"),this.ga&&(Is(this),this.start()))}},q.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},q.N=function(){wo.$.N.call(this),Is(this),delete this.g};class To extends or{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Eo(this)}N(){super.N(),this.g&&(he.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Vr(n){or.call(this),this.h=n,this.g={}}ft(Vr,or);var sc=[];function bo(n,e,t,r){Array.isArray(t)||(t&&(sc[0]=t.toString()),t=sc);for(var i=0;i<t.length;i++){var s=go(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function oc(n){Xa(n.g,function(e,t){this.g.hasOwnProperty(t)&&Uu(e)},n),n.g={}}function Si(){this.g=!0}function Br(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Zu(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return hr(t)}catch{return e}}(n,t)+(r?" "+r:"")})}Vr.prototype.N=function(){Vr.$.N.call(this),oc(this)},Vr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Si.prototype.Ea=function(){this.g=!1},Si.prototype.info=function(){};var qn={},Gu=null;function Ci(){return Gu=Gu||new ot}function qu(n){At.call(this,qn.Ta,n)}function zr(n){const e=Ci();pt(e,new qu(e))}function xi(n,e){At.call(this,qn.STAT_EVENT,n),this.stat=e}function Et(n){const e=Ci();pt(e,new xi(e,n))}function Co(n,e){At.call(this,qn.Ua,n),this.size=e}function An(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return he.setTimeout(function(){n()},e)}qn.Ta="serverreachability",ft(qu,At),qn.STAT_EVENT="statevent",ft(xi,At),qn.Ua="timingevent",ft(Co,At);var xo={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Ao={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function uc(){}function ju(){}uc.prototype.h=null;var lc,Zr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Oo(){At.call(this,"d")}function Es(){At.call(this,"c")}function Ai(){}function Ts(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Vr(this),this.P=Nh,this.V=new wo(n=Ii?125:void 0),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Do}function Do(){this.i=null,this.g="",this.h=!1}ft(Oo,At),ft(Es,At),ft(Ai,uc),Ai.prototype.g=function(){return new XMLHttpRequest},Ai.prototype.i=function(){return{}},lc=new Ai;var Nh=45e3,hc={},ki={};function dc(n,e,t){n.L=1,n.v=Fo(kn(e)),n.s=t,n.S=!0,$u(n,null)}function $u(n,e){n.G=Date.now(),bs(n),n.A=kn(n.v);var t=n.A,r=n.W;Array.isArray(r)||(r=[String(r)]),Bh(t.i,"t",r),n.C=0,t=n.l.J,n.h=new Do,n.g=Ho(n.l,t?e:null,!n.s),0<n.O&&(n.M=new To(_e(n.Pa,n,n.g),n.O)),bo(n.U,n.g,"readystatechange",n.nb),e=n.I?Mu(n.I):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.A,n.u,n.s,e)):(n.u="GET",n.g.ha(n.A,n.u,null,e)),zr(),function So(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var a="",h=s.split("&"),d=0;d<h.length;d++){var m=h[d].split("=");if(1<m.length){var y=m[0];m=m[1];var _=y.split("_");a=2<=_.length&&"type"==_[1]?a+(y+"=")+m+"&":a+(y+"=redacted&")}}else a=null;else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+a})}(n.j,n.u,n.A,n.m,n.W,n.s)}function No(n){return!!n.g&&"GET"==n.u&&2!=n.L&&n.l.Ha}function Ku(n,e,t){let i,r=!0;for(;!n.J&&n.C<t.length;){if(i=fc(n,t),i==ki){4==e&&(n.o=4,Et(14),r=!1),Br(n.j,n.m,null,"[Incomplete Response]");break}if(i==hc){n.o=4,Et(15),Br(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}Br(n.j,n.m,i,null),Ss(n,i)}No(n)&&i!=ki&&i!=hc&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,Et(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Ec(e),e.M=!0,Et(11))):(Br(n.j,n.m,t,"[Invalid Chunked Response]"),qr(n),Gr(n))}function fc(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?ki:(t=Number(e.substring(t,r)),isNaN(t)?hc:(r+=1)+t>e.length?ki:(e=e.slice(r,r+t),n.C=r+t,e))}function bs(n){n.Y=Date.now()+n.P,Ro(n,n.P)}function Ro(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=An(_e(n.lb,n),e)}function Po(n){n.B&&(he.clearTimeout(n.B),n.B=null)}function Gr(n){0==n.l.H||n.J||al(n.l,n)}function qr(n){Po(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,Is(n.V),oc(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Ss(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||gc(t.i,n)))if(!n.K&&gc(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;Ko(t),Pi(t)}wc(t),Et(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=An(_e(t.ib,t),6e3));if(1>=Zh(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Qr(t,11)}else if((n.K||t.g==n)&&Ko(t),!_i(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let m=i[e];if(t.V=m[0],m=m[1],2==t.H)if("c"==m[0]){t.K=m[1],t.pa=m[2];const y=m[3];null!=y&&(t.ra=y,t.l.info("VER="+t.ra));const _=m[4];null!=_&&(t.Ga=_,t.l.info("SVER="+t.Ga));const S=m[5];null!=S&&"number"==typeof S&&0<S&&(t.L=r=1.5*S,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const N=n.g;if(N){const Z=N.g?N.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Z){var s=r.i;s.g||-1==Z.indexOf("spdy")&&-1==Z.indexOf("quic")&&-1==Z.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(yc(s,s.h),s.h=null))}if(r.F){const K=N.g?N.g.getResponseHeader("X-HTTP-Session-Id"):null;K&&(r.Da=K,ze(r.I,r.F,K))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var a=n;if((r=t).wa=ul(r,r.J?r.pa:null,r.Y),a.K){Vo(r.i,a);var h=a,d=r.L;d&&h.setTimeout(d),h.B&&(Po(h),bs(h)),r.g=a}else Wr(r);0<t.j.length&&Mi(t)}else"stop"!=m[0]&&"close"!=m[0]||Qr(t,7);else 3==t.H&&("stop"==m[0]||"close"==m[0]?"stop"==m[0]?Qr(t,7):$o(t):"noop"!=m[0]&&t.h&&t.h.Aa(m),t.A=0)}zr()}catch{}}function Hu(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(uo(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function pc(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(uo(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function Rh(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(uo(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(q=Ts.prototype).setTimeout=function(n){this.P=n},q.nb=function(n){n=n.target;const e=this.M;e&&3==On(n)?e.l():this.Pa(n)},q.Pa=function(n){try{if(n==this.g)e:{const y=On(this.g);var e=this.g.Ia();if(this.g.da(),!(3>y)&&(3!=y||Ii||this.g&&(this.h.h||this.g.ja()||Os(this.g)))){this.J||4!=y||7==e||zr(),Po(this);var t=this.g.da();this.ca=t;t:if(No(this)){var r=Os(this.g);n="";var i=r.length,s=4==On(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){qr(this),Gr(this);var a="";break t}this.h.i=new he.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=n,this.C=0,a=this.h.g}else a=this.g.ja();if(this.i=200==t,function ac(n,e,t,r,i,s,a){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+a})}(this.j,this.u,this.A,this.m,this.W,y,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var h,d=this.g;if((h=d.g?d.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_i(h)){var m=h;break t}}m=null}if(!(t=m)){this.i=!1,this.o=3,Et(12),qr(this),Gr(this);break e}Br(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ss(this,t)}this.S?(Ku(this,y,a),Ii&&this.i&&3==y&&(bo(this.U,this.V,"tick",this.mb),this.V.start())):(Br(this.j,this.m,a,null),Ss(this,a)),4==y&&qr(this),this.i&&!this.J&&(4==y?al(this.l,this):(this.i=!1,bs(this)))}else(function nl(n){const e={};n=(n.g&&2<=On(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(_i(n[r]))continue;var t=hn(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function xn(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<a.indexOf("Unknown SID")?(this.o=3,Et(12)):(this.o=0,Et(13)),qr(this),Gr(this)}}}catch{}},q.mb=function(){if(this.g){var n=On(this.g),e=this.g.ja();this.C<e.length&&(Po(this),Ku(this,n,e),this.i&&4!=n&&bs(this))}},q.cancel=function(){this.J=!0,qr(this)},q.lb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function cc(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.L&&(zr(),Et(17)),qr(this),this.o=2,Gr(this)):Ro(this,this.Y-n)};var Mo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function jr(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof jr){this.h=n.h,Oi(this,n.j),this.s=n.s,this.g=n.g,Lo(this,n.m),this.l=n.l;var e=n.i,t=new Uo;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),$r(this,t),this.o=n.o}else n&&(e=String(n).match(Mo))?(this.h=!1,Oi(this,e[1]||"",!0),this.s=Cs(e[2]||""),this.g=Cs(e[3]||"",!0),Lo(this,e[4]),this.l=Cs(e[5]||"",!0),$r(this,e[6]||"",!0),this.o=Cs(e[7]||"")):(this.h=!1,this.i=new Uo(null,this.h))}function kn(n){return new jr(n)}function Oi(n,e,t){n.j=t?Cs(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Lo(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function $r(n,e,t){e instanceof Uo?(n.i=e,function Hr(n,e){e&&!n.j&&(Kr(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Uh(this,r),Bh(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=xs(e,Lh)),n.i=new Uo(e,n.h))}function ze(n,e,t){n.i.set(e,t)}function Fo(n){return ze(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Cs(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function xs(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Mh),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Mh(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}jr.prototype.toString=function(){var n=[],e=this.j;e&&n.push(xs(e,Wu,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(xs(e,Wu,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(xs(t,"/"==t.charAt(0)?Zp:zp,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",xs(t,Fh)),n.join("")};var Wu=/[#\/\?@]/g,zp=/[#\?:]/g,Zp=/[#\?]/g,Lh=/[#\?@]/g,Fh=/#/g;function Uo(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Kr(n){n.g||(n.g=new Map,n.h=0,n.i&&function Ph(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Uh(n,e){Kr(n),e=dr(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Vh(n,e){return Kr(n),e=dr(n,e),n.g.has(e)}function Bh(n,e,t){Uh(n,e),0<t.length&&(n.i=null,n.g.set(dr(n,e),Wa(t)),n.h+=t.length)}function dr(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Qu(n){this.l=n||zh,n=he.PerformanceNavigationTiming?0<(n=he.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(he.g&&he.g.Ka&&he.g.Ka()&&he.g.Ka().ec),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(q=Uo.prototype).add=function(n,e){Kr(this),this.i=null,n=dr(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},q.forEach=function(n,e){Kr(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},q.ta=function(){Kr(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},q.Z=function(n){Kr(this);let e=[];if("string"==typeof n)Vh(this,n)&&(e=e.concat(this.g.get(dr(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},q.set=function(n,e){return Kr(this),this.i=null,Vh(this,n=dr(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},q.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},q.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),a=this.Z(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),n.push(i)}}return this.i=n.join("&")};var zh=10;function Yu(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Zh(n){return n.h?1:n.g?n.g.size:0}function gc(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function yc(n,e){n.g?n.g.add(e):n.h=e}function Vo(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Bo(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return Wa(n.i)}Qu.prototype.cancel=function(){if(this.i=Bo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var Gh=class{stringify(n){return he.JSON.stringify(n,void 0)}parse(n){return he.JSON.parse(n,void 0)}};function zo(){this.g=new Gh}function Ju(n,e,t){const r=t||"";try{Hu(n,function(i,s){let a=i;us(i)&&(a=hr(i)),e.push(r+s+"="+encodeURIComponent(a))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Zo(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function As(n){this.l=n.fc||null,this.j=n.ob||!1}function _c(n,e){ot.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Di,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ft(As,uc),As.prototype.g=function(){return new _c(this.l,this.j)},As.prototype.i=function(n){return function(){return n}}({}),ft(_c,ot);var Di=0;function jh(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function dn(n){n.readyState=4,n.l=null,n.j=null,n.A=null,ks(n)}function ks(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(q=_c.prototype).open=function(n,e){if(this.readyState!=Di)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,ks(this)},q.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||he).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},q.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,dn(this)),this.readyState=Di},q.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,ks(this)),this.g&&(this.readyState=3,ks(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof he.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;jh(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},q.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?dn(this):ks(this),3==this.readyState&&jh(this)}},q.Za=function(n){this.g&&(this.response=this.responseText=n,dn(this))},q.Ya=function(n){this.g&&(this.response=n,dn(this))},q.ka=function(){this.g&&dn(this)},q.setRequestHeader=function(n,e){this.v.append(n,e)},q.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},q.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(_c.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var $h=he.JSON.parse;function Ze(n){ot.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Xu,this.L=this.M=!1}ft(Ze,ot);var Xu="",rt=/^https?$/i,Kh=["POST","PUT"];function el(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Go(n),qo(n)}function Go(n){n.F||(n.F=!0,pt(n,"complete"),pt(n,"error"))}function tl(n){if(n.h&&typeof sr<"u"&&(!n.C[1]||4!=On(n)||2!=n.da()))if(n.v&&4==On(n))ws(n.La,0,n);else if(pt(n,"readystatechange"),4==On(n)){n.h=!1;try{const a=n.da();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===a){var i=String(n.I).match(Mo)[1]||null;!i&&he.self&&he.self.location&&(i=he.self.location.protocol.slice(0,-1)),r=!rt.test(i?i.toLowerCase():"")}t=r}if(t)pt(n,"complete"),pt(n,"success");else{n.m=6;try{var s=2<On(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Go(n)}}finally{qo(n)}}}function qo(n,e){if(n.g){Ic(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||pt(n,"ready");try{t.onreadystatechange=r}catch{}}}function Ic(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(he.clearTimeout(n.A),n.A=null)}function On(n){return n.g?n.g.readyState:0}function Os(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Xu:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Ni(n){let e="";return Xa(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function Ri(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Ni(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):ze(n,e,t))}function Ds(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function jo(n){this.Ga=0,this.j=[],this.l=new Si,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Ds("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Ds("baseRetryDelayMs",5e3,n),this.hb=Ds("retryDelaySeedMs",1e4,n),this.eb=Ds("forwardChannelMaxRetries",2,n),this.xa=Ds("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.dc||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Qu(n&&n.concurrentRequestLimit),this.Ja=new zo,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function $o(n){if(rl(n),3==n.H){var e=n.W++,t=kn(n.I);if(ze(t,"SID",n.K),ze(t,"RID",e),ze(t,"TYPE","terminate"),Ns(n,t),(e=new Ts(n,n.l,e)).L=2,e.v=Fo(kn(t)),t=!1,he.navigator&&he.navigator.sendBeacon)try{t=he.navigator.sendBeacon(e.v.toString(),"")}catch{}!t&&he.Image&&((new Image).src=e.v,t=!0),t||(e.g=Ho(e.l,null),e.g.ha(e.v)),e.G=Date.now(),bs(e)}cl(n)}function Pi(n){n.g&&(Ec(n),n.g.cancel(),n.g=null)}function rl(n){Pi(n),n.u&&(he.clearTimeout(n.u),n.u=null),Ko(n),n.i.cancel(),n.m&&("number"==typeof n.m&&he.clearTimeout(n.m),n.m=null)}function Mi(n){if(!Yu(n.i)&&!n.m){n.m=!0;var e=n.Na;vs||ic(),Ur||(vs(),Ur=!0),bi.add(e,n),n.C=0}}function sl(n,e){var t;t=e?e.m:n.W++;const r=kn(n.I);ze(r,"SID",n.K),ze(r,"RID",t),ze(r,"AID",n.V),Ns(n,r),n.o&&n.s&&Ri(r,n.o,n.s),t=new Ts(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=Hh(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),yc(n.i,t),dc(t,r,e)}function Ns(n,e){n.na&&Xa(n.na,function(t,r){ze(e,r,t)}),n.h&&Hu({},function(t,r){ze(e,r,t)})}function Hh(n,e,t){t=Math.min(n.j.length,t);var r=n.h?_e(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const a=["count="+t];-1==s?0<t?(s=i[0].g,a.push("ofs="+s)):s=0:a.push("ofs="+s);let h=!0;for(let d=0;d<t;d++){let m=i[d].g;const y=i[d].map;if(m-=s,0>m)s=Math.max(0,i[d].g-100),h=!1;else try{Ju(y,a,"req"+m+"_")}catch{r&&r(y)}}if(h){r=a.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function Wr(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;vs||ic(),Ur||(vs(),Ur=!0),bi.add(e,n),n.A=0}}function wc(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=An(_e(n.Ma,n),Rs(n,n.A)),n.A++,0))}function Ec(n){null!=n.B&&(he.clearTimeout(n.B),n.B=null)}function ol(n){n.g=new Ts(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=kn(n.wa);ze(e,"RID","rpc"),ze(e,"SID",n.K),ze(e,"AID",n.V),ze(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&ze(e,"TO",n.qa),ze(e,"TYPE","xmlhttp"),Ns(n,e),n.o&&n.s&&Ri(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.v=Fo(kn(e)),t.s=null,t.S=!0,$u(t,n)}function Ko(n){null!=n.v&&(he.clearTimeout(n.v),n.v=null)}function al(n,e){var t=null;if(n.g==e){Ko(n),Ec(n),n.g=null;var r=2}else{if(!gc(n.i,e))return;t=e.F,Vo(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.G;var i=n.C;pt(r=Ci(),new Co(r,t)),Mi(n)}else Wr(n);else if(3==(i=e.o)||0==i&&0<e.ca||!(1==r&&function il(n,e){return!(Zh(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=An(_e(n.Na,n,e),Rs(n,n.C)),n.C++,0)))}(n,e)||2==r&&wc(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:Qr(n,5);break;case 4:Qr(n,10);break;case 3:Qr(n,6);break;default:Qr(n,2)}}function Rs(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Qr(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=_e(n.pb,n);t||(t=new jr("//www.google.com/images/cleardot.gif"),he.location&&"http"==he.location.protocol||Oi(t,"https"),Fo(t)),function qh(n,e){const t=new Si;if(he.Image){const r=new Image;r.onload=ls(Zo,t,r,"TestLoadImage: loaded",!0,e),r.onerror=ls(Zo,t,r,"TestLoadImage: error",!1,e),r.onabort=ls(Zo,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=ls(Zo,t,r,"TestLoadImage: timeout",!1,e),he.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else Et(2);n.H=0,n.h&&n.h.za(e),cl(n),rl(n)}function cl(n){if(n.H=0,n.ma=[],n.h){const e=Bo(n.i);(0!=e.length||0!=n.j.length)&&(Qa(n.ma,e),Qa(n.ma,n.j),n.i.i.length=0,Wa(n.j),n.j.length=0),n.h.ya()}}function ul(n,e,t){var r=t instanceof jr?kn(t):new jr(t);if(""!=r.g)e&&(r.g=e+"."+r.g),Lo(r,r.m);else{var i=he.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new jr(null);r&&Oi(s,r),e&&(s.g=e),i&&Lo(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&ze(r,t,e),ze(r,"VER",n.ra),Ns(n,r),r}function Ho(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Ze(t&&n.Ha&&!n.va?new As({ob:!0}):n.va)).Oa(n.J),e}function ll(){}function Wo(){if(ar&&!(10<=Number(Ah)))throw Error("Environmental error: no available transport.")}function Yt(n,e){ot.call(this),this.g=new jo(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!_i(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!_i(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Yr(this)}function hl(n){Oo.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function dl(){Es.call(this),this.status=1}function Yr(n){this.g=n}function gn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Tc(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],a=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;a=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(a<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((s=(e=t+((a=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((i=s+((a=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function De(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(q=Ze.prototype).Oa=function(n){this.M=n},q.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():lc.g(),this.C=function ko(n){return n.h||(n.h=n.i())}(this.u?this.u:lc),this.g.onreadystatechange=_e(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void el(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=he.FormData&&n instanceof he.FormData,!(0<=Ha(Kh,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,a]of t)this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Ic(this),0<this.B&&((this.L=function vc(n){return ar&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=_e(this.ua,this)):this.A=ws(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){el(this,s)}},q.ua=function(){typeof sr<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,pt(this,"timeout"),this.abort(8))},q.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,pt(this,"complete"),pt(this,"abort"),qo(this))},q.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),qo(this,!0)),Ze.$.N.call(this)},q.La=function(){this.s||(this.G||this.v||this.l?tl(this):this.kb())},q.kb=function(){tl(this)},q.isActive=function(){return!!this.g},q.da=function(){try{return 2<On(this)?this.g.status:-1}catch{return-1}},q.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},q.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),$h(e)}},q.Ia=function(){return this.m},q.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(q=jo.prototype).ra=8,q.H=1,q.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new Ts(this,this.l,n);let s=this.s;if(this.U&&(s?(s=Mu(s),Lu(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Hh(this,i,e),ze(t=kn(this.I),"RID",n),ze(t,"CVER",22),this.F&&ze(t,"X-HTTP-Session-Id",this.F),Ns(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(Ni(s)))+"&"+e:this.o&&Ri(t,this.o,s)),yc(this.i,i),this.bb&&ze(t,"TYPE","init"),this.P?(ze(t,"$req",e),ze(t,"SID","null"),i.aa=!0,dc(i,t,null)):dc(i,t,e),this.H=2}}else 3==this.H&&(n?sl(this,n):0==this.j.length||Yu(this.i)||sl(this))},q.Ma=function(){if(this.u=null,ol(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=An(_e(this.jb,this),n)}},q.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Et(10),Pi(this),ol(this))},q.ib=function(){null!=this.v&&(this.v=null,Pi(this),wc(this),Et(19))},q.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Et(2)):(this.l.info("Failed to ping google.com"),Et(1))},q.isActive=function(){return!!this.h&&this.h.isActive(this)},(q=ll.prototype).Ba=function(){},q.Aa=function(){},q.za=function(){},q.ya=function(){},q.isActive=function(){return!0},q.Va=function(){},Wo.prototype.g=function(n,e){return new Yt(n,e)},ft(Yt,ot),Yt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Et(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=ul(n,null,n.Y),Mi(n)},Yt.prototype.close=function(){$o(this.g)},Yt.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=hr(n),n=t);e.j.push(new class{constructor(n,e){this.g=n,this.map=e}}(e.fb++,n)),3==e.H&&Mi(e)},Yt.prototype.N=function(){this.g.h=null,delete this.j,$o(this.g),delete this.g,Yt.$.N.call(this)},ft(hl,Oo),ft(dl,Es),ft(Yr,ll),Yr.prototype.Ba=function(){pt(this.g,"a")},Yr.prototype.Aa=function(n){pt(this.g,new hl(n))},Yr.prototype.za=function(n){pt(this.g,new dl)},Yr.prototype.ya=function(){pt(this.g,"b")},ft(gn,function Wh(){this.blockSize=-1}),gn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},gn.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)Tc(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){Tc(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){Tc(this,r),i=0;break}}this.h=i,this.i+=e},gn.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var Qh={};function Ps(n){return-128<=n&&128>n?function Ch(n,e){var t=Qh;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new De([0|e],0>e?-1:0)}):new De([0|n],0>n?-1:0)}function Dn(n){if(isNaN(n)||!isFinite(n))return fr;if(0>n)return tt(Dn(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=bc;return new De(e,0)}var bc=4294967296,fr=Ps(0),Li=Ps(1),Yo=Ps(16777216);function jn(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function Zt(n){return-1==n.h}function tt(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new De(t,~n.h).add(Li)}function Nn(n,e){return n.add(tt(e))}function Fi(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Ms(n,e){this.g=n,this.h=e}function Jo(n,e){if(jn(e))throw Error("division by zero");if(jn(n))return new Ms(fr,fr);if(Zt(n))return e=Jo(tt(n),e),new Ms(tt(e.g),tt(e.h));if(Zt(e))return e=Jo(n,tt(e)),new Ms(tt(e.g),e.h);if(30<n.g.length){if(Zt(n)||Zt(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Li,r=e;0>=r.X(n);)t=fl(t),r=fl(r);var i=pr(t,1),s=pr(r,1);for(r=pr(r,2),t=pr(t,2);!jn(r);){var a=s.add(r);0>=a.X(n)&&(i=i.add(t),s=a),r=pr(r,1),t=pr(t,1)}return e=Nn(n,i.R(e)),new Ms(i,e)}for(i=fr;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),a=(s=Dn(t)).R(e);Zt(a)||0<a.X(n);)a=(s=Dn(t-=r)).R(e);jn(s)&&(s=Li),i=i.add(s),n=Nn(n,a)}return new Ms(i,n)}function fl(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new De(t,n.h)}function pr(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new De(i,n.h)}(q=De.prototype).ea=function(){if(Zt(this))return-tt(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:bc+r)*e,e*=bc}return n},q.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(jn(this))return"0";if(Zt(this))return"-"+tt(this).toString(n);for(var e=Dn(Math.pow(n,6)),t=this,r="";;){var i=Jo(t,e).g,s=((0<(t=Nn(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(jn(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},q.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},q.X=function(n){return Zt(n=Nn(this,n))?-1:jn(n)?0:1},q.abs=function(){return Zt(this)?tt(this):this},q.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),a=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=a>>>16,t[i]=(a&=65535)<<16|(s&=65535)}return new De(t,-2147483648&t[t.length-1]?-1:0)},q.R=function(n){if(jn(this)||jn(n))return fr;if(Zt(this))return Zt(n)?tt(this).R(tt(n)):tt(tt(this).R(n));if(Zt(n))return tt(this.R(tt(n)));if(0>this.X(Yo)&&0>n.X(Yo))return Dn(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,a=65535&this.D(r),h=n.D(i)>>>16,d=65535&n.D(i);t[2*r+2*i]+=a*d,Fi(t,2*r+2*i),t[2*r+2*i+1]+=s*d,Fi(t,2*r+2*i+1),t[2*r+2*i+1]+=a*h,Fi(t,2*r+2*i+1),t[2*r+2*i+2]+=s*h,Fi(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new De(t,0)},q.gb=function(n){return Jo(this,n).h},q.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new De(t,this.h&n.h)},q.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new De(t,this.h|n.h)},q.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new De(t,this.h^n.h)},Wo.prototype.createWebChannel=Wo.prototype.g,Yt.prototype.send=Yt.prototype.u,Yt.prototype.open=Yt.prototype.m,Yt.prototype.close=Yt.prototype.close,xo.NO_ERROR=0,xo.TIMEOUT=8,xo.HTTP_ERROR=6,Ao.COMPLETE="complete",ju.EventType=Zr,Zr.OPEN="a",Zr.CLOSE="b",Zr.ERROR="c",Zr.MESSAGE="d",ot.prototype.listen=ot.prototype.O,Ze.prototype.listenOnce=Ze.prototype.P,Ze.prototype.getLastError=Ze.prototype.Sa,Ze.prototype.getLastErrorCode=Ze.prototype.Ia,Ze.prototype.getStatus=Ze.prototype.da,Ze.prototype.getResponseJson=Ze.prototype.Wa,Ze.prototype.getResponseText=Ze.prototype.ja,Ze.prototype.send=Ze.prototype.ha,Ze.prototype.setWithCredentials=Ze.prototype.Oa,gn.prototype.digest=gn.prototype.l,gn.prototype.reset=gn.prototype.reset,gn.prototype.update=gn.prototype.j,De.prototype.add=De.prototype.add,De.prototype.multiply=De.prototype.R,De.prototype.modulo=De.prototype.gb,De.prototype.compare=De.prototype.X,De.prototype.toNumber=De.prototype.ea,De.prototype.toString=De.prototype.toString,De.prototype.getBits=De.prototype.D,De.fromNumber=Dn,De.fromString=function Qo(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return tt(Qo(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Dn(Math.pow(e,8)),r=fr,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),a=parseInt(n.substring(i,i+s),e);8>s?(s=Dn(Math.pow(e,s)),r=r.R(s).add(Dn(a))):r=(r=r.R(t)).add(Dn(a))}return r};var pl=Pe.createWebChannelTransport=function(){return new Wo},Yh=Pe.getStatEventTarget=function(){return Ci()},Sc=Pe.ErrorCode=xo,Cc=Pe.EventType=Ao,Jh=Pe.Event=qn,Xo=Pe.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Xh=Pe.FetchXmlHttpFactory=As,Ui=Pe.WebChannel=ju,xc=Pe.XhrIo=Ze,ed=Pe.Md5=gn,Rn=Pe.Integer=De;const ml="@firebase/firestore";class mt{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}mt.UNAUTHENTICATED=new mt(null),mt.GOOGLE_CREDENTIALS=new mt("google-credentials-uid"),mt.FIRST_PARTY=new mt("first-party-uid"),mt.MOCK_USER=new mt("mock-user");let mr="9.23.0";const Pn=new de.Yd("@firebase/firestore");function Ls(){return Pn.logLevel}function V(n,...e){if(Pn.logLevel<=de.in.DEBUG){const t=e.map(Ac);Pn.debug(`Firestore (${mr}): ${n}`,...t)}}function He(n,...e){if(Pn.logLevel<=de.in.ERROR){const t=e.map(Ac);Pn.error(`Firestore (${mr}): ${n}`,...t)}}function Jt(n,...e){if(Pn.logLevel<=de.in.WARN){const t=e.map(Ac);Pn.warn(`Firestore (${mr}): ${n}`,...t)}}function Ac(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function J(n="Unexpected state"){const e=`FIRESTORE (${mr}) INTERNAL ASSERTION FAILED: `+n;throw He(e),new Error(e)}function te(n,e){n||J()}function W(n,e){return n}const O={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class L extends se.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class at{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class ea{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class rd{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(mt.UNAUTHENTICATED))}shutdown(){}}class kc{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ta{constructor(e){this.t=e,this.currentUser=mt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=m=>this.i!==i?(i=this.i,t(m)):Promise.resolve();let a=new at;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new at,e.enqueueRetryable(()=>s(this.currentUser))};const h=()=>{const m=a;e.enqueueRetryable((0,b.Z)(function*(){yield m.promise,yield s(r.currentUser)}))},d=m=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.auth.addAuthTokenListener(this.o),h()};this.t.onInit(m=>d(m)),setTimeout(()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?d(m):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new at)}},0),h()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(te("string"==typeof r.accessToken),new ea(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return te(null===e||"string"==typeof e),new mt(e)}}class Oc{constructor(e,t,r){this.h=e,this.l=t,this.m=r,this.type="FirstParty",this.user=mt.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class gl{constructor(e,t,r){this.h=e,this.l=t,this.m=r}getToken(){return Promise.resolve(new Oc(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(mt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class na{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class id{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const r=s=>{null!=s.error&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.T;return this.T=s.token,V("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.I.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.I.getImmediate({optional:!0});s?i(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(te("string"==typeof t.token),this.T=t.token,new na(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function yl(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Dc{static A(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=yl(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function le(n,e){return n<e?-1:n>e?1:0}function Jr(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function ra(n){return n+"\0"}class je{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new L(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new L(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new L(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new L(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return je.fromMillis(Date.now())}static fromDate(e){return je.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new je(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?le(this.nanoseconds,e.nanoseconds):le(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ie{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ie(e)}static min(){return new ie(new je(0,0))}static max(){return new ie(new je(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Fs{constructor(e,t,r){void 0===t?t=0:t>e.length&&J(),void 0===r?r=e.length-t:r>e.length-t&&J(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Fs.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Fs?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class we extends Fs{construct(e,t,r){return new we(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new L(O.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new we(t)}static emptyPath(){return new we([])}}const od=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class We extends Fs{construct(e,t,r){return new We(e,t,r)}static isValidIdentifier(e){return od.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),We.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new We(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new L(O.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;i<e.length;){const h=e[i];if("\\"===h){if(i+1===e.length)throw new L(O.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[i+1];if("\\"!==d&&"."!==d&&"`"!==d)throw new L(O.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else"`"===h?(a=!a,i++):"."!==h||a?(r+=h,i++):(s(),i++)}if(s(),a)throw new L(O.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new We(t)}static emptyPath(){return new We([])}}class j{constructor(e){this.path=e}static fromPath(e){return new j(we.fromString(e))}static fromName(e){return new j(we.fromString(e).popFirst(5))}static empty(){return new j(we.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===we.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return we.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new j(new we(e.slice()))}}class ia{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function Vi(n){return n.fields.find(e=>2===e.kind)}function Xr(n){return n.fields.filter(e=>2!==e.kind)}ia.UNKNOWN_ID=-1;class sa{constructor(e,t){this.fieldPath=e,this.kind=t}}class Us{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Us(0,Xt.min())}}function _l(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=ie.fromTimestamp(1e9===r?new je(t+1,0):new je(t,r));return new Xt(i,j.empty(),e)}function vl(n){return new Xt(n.readTime,n.key,-1)}class Xt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Xt(ie.min(),j.empty(),-1)}static max(){return new Xt(ie.max(),j.empty(),-1)}}function Vs(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=j.comparator(n.documentKey,e.documentKey),0!==t?t:le(n.largestBatchId,e.largestBatchId))}const Il="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class wl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function gr(n){return Nc.apply(this,arguments)}function Nc(){return Nc=(0,b.Z)(function*(n){if(n.code!==O.FAILED_PRECONDITION||n.message!==Il)throw n;V("LocalStore","Unexpectedly lost primary lease")}),Nc.apply(this,arguments)}class x{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&J(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new x((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof x?t:x.resolve(t)}catch(t){return x.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):x.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):x.reject(t)}static resolve(e){return new x((t,r)=>{t(e)})}static reject(e){return new x((t,r)=>{r(e)})}static waitFor(e){return new x((t,r)=>{let i=0,s=0,a=!1;e.forEach(h=>{++i,h.next(()=>{++s,a&&s===i&&t()},d=>r(d))}),a=!0,s===i&&t()})}static or(e){let t=x.resolve(!1);for(const r of e)t=t.next(i=>i?x.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new x((r,i)=>{const s=e.length,a=new Array(s);let h=0;for(let d=0;d<s;d++){const m=d;t(e[m]).next(y=>{a[m]=y,++h,h===s&&r(a)},y=>i(y))}})}static doWhile(e,t){return new x((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class Bs{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.v=new at,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{t.error?this.v.reject(new zs(e,t.error)):this.v.resolve()},this.transaction.onerror=r=>{const i=Rc(r.target.error);this.v.reject(new zs(e,i))}}static open(e,t,r,i){try{return new Bs(t,e.transaction(i,r))}catch(s){throw new zs(t,s)}}get R(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(V("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new ld(t)}}class yn{constructor(e,t,r){this.name=e,this.version=t,this.V=r,12.2===yn.S((0,se.z$)())&&He("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return V("SimpleDb","Removing database:",e),$n(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,se.hl)())return!1;if(yn.C())return!0;const e=(0,se.z$)(),t=yn.S(e),r=0<t&&t<10,i=yn.N(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.k)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static N(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}$(e){var t=this;return(0,b.Z)(function*(){return t.db||(V("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=a=>{r(a.target.result)},s.onblocked=()=>{i(new zs(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=a=>{const h=a.target.error;i("VersionError"===h.name?new L(O.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===h.name?new L(O.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+h):new zs(e,h))},s.onupgradeneeded=a=>{V("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',a.oldVersion),t.V.O(a.target.result,s.transaction,a.oldVersion,t.version).next(()=>{V("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.F&&(t.db.onversionchange=r=>t.F(r)),t.db})()}B(e){this.F=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,b.Z)(function*(){const a="readonly"===t;let h=0;for(;;){++h;try{s.db=yield s.$(e);const d=Bs.open(s.db,e,a?"readonly":"readwrite",r),m=i(d).next(y=>(d.P(),y)).catch(y=>(d.abort(y),x.reject(y))).toPromise();return m.catch(()=>{}),yield d.R,m}catch(d){const m=d,y="FirebaseError"!==m.name&&h<3;if(V("SimpleDb","Transaction failed with error:",m.message,"Retrying:",y),s.close(),!y)return Promise.reject(m)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class ud{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return $n(this.L.delete())}}class zs extends L{constructor(e,t){super(O.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function yr(n){return"IndexedDbTransactionError"===n.name}class ld{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(V("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(V("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),$n(r)}add(e){return V("SimpleDb","ADD",this.store.name,e,e),$n(this.store.add(e))}get(e){return $n(this.store.get(e)).next(t=>(void 0===t&&(t=null),V("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return V("SimpleDb","DELETE",this.store.name,e),$n(this.store.delete(e))}count(){return V("SimpleDb","COUNT",this.store.name),$n(this.store.count())}j(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const i=this.cursor(r),s=[];return this.W(i,(a,h)=>{s.push(h)}).next(()=>s)}{const i=this.store.getAll(r.range);return new x((s,a)=>{i.onerror=h=>{a(h.target.error)},i.onsuccess=h=>{s(h.target.result)}})}}H(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new x((i,s)=>{r.onerror=a=>{s(a.target.error)},r.onsuccess=a=>{i(a.target.result)}})}J(e,t){V("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.Y=!1;const i=this.cursor(r);return this.W(i,(s,a,h)=>h.delete())}X(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.W(i,t)}Z(e){const t=this.cursor({});return new x((r,i)=>{t.onerror=s=>{const a=Rc(s.target.error);i(a)},t.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next(h=>{h?a.continue():r()}):r()}})}W(e,t){const r=[];return new x((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const h=a.target.result;if(!h)return void i();const d=new ud(h),m=t(h.primaryKey,h.value,d);if(m instanceof x){const y=m.catch(_=>(d.done(),x.reject(_)));r.push(y)}d.isDone?i():null===d.K?h.continue():h.continue(d.K)}}).next(()=>x.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function $n(n){return new x((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=Rc(r.target.error);t(i)}})}let oa=!1;function Rc(n){const e=yn.S((0,se.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new L("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return oa||(oa=!0,setTimeout(()=>{throw r},0)),r}}return n}class Pc{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){var t=this;V("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,b.Z)(function*(){t.task=null;try{V("IndexBackiller",`Documents written: ${yield t.tt.nt()}`)}catch(r){yr(r)?V("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield gr(r)}yield t.et(6e4)}))}}class hd{constructor(e,t){this.localStore=e,this.persistence=t}nt(e=50){var t=this;return(0,b.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.st(r,e))})()}st(e,t){const r=new Set;let i=t,s=!0;return x.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(null!==a&&!r.has(a))return V("IndexBackiller",`Processing collection: ${a}`),this.it(e,a,i).next(h=>{i-=h,r.add(a)});s=!1})).next(()=>t-i)}it(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.rt(i,s)).next(h=>(V("IndexBackiller",`Updating offset: ${h}`),this.localStore.indexManager.updateCollectionGroup(e,t,h))).next(()=>a.size)}))}rt(e,t){let r=e;return t.changes.forEach((i,s)=>{const a=vl(s);Vs(a,r)>0&&(r=a)}),new Xt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Gt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ot(i),this.ut=i=>r.writeSequenceNumber(i))}ot(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ut&&this.ut(t),t}}return n.ct=-1,n})();function Zs(n){return null==n}function ei(n){return 0===n&&1/n==-1/0}function El(n){return"number"==typeof n&&Number.isInteger(n)&&!ei(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Lt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Lc(e)),e=Mc(n.get(t),e);return Lc(e)}function Mc(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Lc(n){return n+"\x01\x01"}function en(n){const e=n.length;if(te(e>=2),2===e)return te("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),we.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const a=n.indexOf("\x01",s);switch((a<0||a>t)&&J(),n.charAt(a+1)){case"\x01":const h=n.substring(s,a);let d;0===i.length?d=h:(i+=h,d=i,i=""),r.push(d);break;case"\x10":i+=n.substring(s,a),i+="\0";break;case"\x11":i+=n.substring(s,a+1);break;default:J()}s=a+2}return new we(r)}const Fc=["userId","batchId"];function Gs(n,e){return[n,Lt(e)]}function Tl(n,e,t){return[n,Lt(e),t]}const dd={},fd=["prefixPath","collectionGroup","readTime","documentId"],pd=["prefixPath","collectionGroup","documentId"],md=["collectionGroup","readTime","prefixPath","documentId"],bl=["canonicalId","targetId"],gd=["targetId","path"],Gp=["path","targetId"],ti=["collectionId","parent"],yd=["indexId","uid"],_d=["uid","sequenceNumber"],Uc=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],vd=["indexId","uid","orderedDocumentKey"],Vc=["userId","collectionPath","documentId"],Id=["userId","collectionPath","largestBatchId"],wd=["userId","collectionGroup","largestBatchId"],aa=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Ed=[...aa,"documentOverlays"],Sl=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ca=Sl,Td=[...ca,"indexConfiguration","indexState","indexEntries"];class Bc extends wl{constructor(e,t){super(),this.ht=e,this.currentSequenceNumber=t}}function gt(n,e){const t=W(n);return yn.M(t.ht,e)}function Cl(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function _r(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function zc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class Le{constructor(e,t){this.comparator=e,this.root=t||Tt.EMPTY}insert(e,t){return new Le(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Tt.BLACK,null,null))}remove(e){return new Le(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Tt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ua(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ua(this.root,e,this.comparator,!1)}getReverseIterator(){return new ua(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ua(this.root,e,this.comparator,!0)}}class ua{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Tt{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??Tt.RED,this.left=i??Tt.EMPTY,this.right=s??Tt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new Tt(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Tt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Tt.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Tt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Tt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw J();const e=this.left.check();if(e!==this.right.check())throw J();return e+(this.isRed()?0:1)}}Tt.EMPTY=null,Tt.RED=!0,Tt.BLACK=!1,Tt.EMPTY=new class{constructor(){this.size=0}get key(){throw J()}get value(){throw J()}get color(){throw J()}get left(){throw J()}get right(){throw J()}copy(n,e,t,r,i){return this}insert(n,e,t){return new Tt(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ue{constructor(e){this.comparator=e,this.data=new Le(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new la(this.data.getIterator())}getIteratorFrom(e){return new la(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Ue)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ue(this.comparator);return t.data=e,t}}class la{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Bi(n){return n.hasNext()?n.getNext():void 0}class qt{constructor(e){this.fields=e,e.sort(We.comparator)}static empty(){return new qt([])}unionWith(e){let t=new Ue(We.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new qt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Jr(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class qs extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ct{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new qs("Invalid base64 string: "+i):i}}(e);return new ct(t)}static fromUint8Array(e){const t=function(r){let i="";for(let s=0;s<r.length;++s)i+=String.fromCharCode(r[s]);return i}(e);return new ct(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return le(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ct.EMPTY_BYTE_STRING=new ct("");const Sd=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Kn(n){if(te(!!n),"string"==typeof n){let e=0;const t=Sd.exec(n);if(te(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Qe(n.seconds),nanos:Qe(n.nanos)}}function Qe(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Hn(n){return"string"==typeof n?ct.fromBase64String(n):ct.fromUint8Array(n)}function ha(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function da(n){const e=n.mapValue.fields.__previous_value__;return ha(e)?da(e):e}function Wn(n){const e=Kn(n.mapValue.fields.__local_write_time__.timestampValue);return new je(e.seconds,e.nanos)}class Cd{constructor(e,t,r,i,s,a,h,d,m){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=h,this.longPollingOptions=d,this.useFetchStreams=m}}class Qn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Qn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Qn&&e.projectId===this.projectId&&e.database===this.database}}const vr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},fa={nullValue:"NULL_VALUE"};function Ir(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ha(n)?4:Al(n)?9007199254740991:10:J()}function Mn(n,e){if(n===e)return!0;const t=Ir(n);if(t!==Ir(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Wn(n).isEqual(Wn(e));case 3:return function(r,i){if("string"==typeof r.timestampValue&&"string"==typeof i.timestampValue&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const s=Kn(r.timestampValue),a=Kn(i.timestampValue);return s.seconds===a.seconds&&s.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return i=e,Hn(n.bytesValue).isEqual(Hn(i.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,i){return Qe(r.geoPointValue.latitude)===Qe(i.geoPointValue.latitude)&&Qe(r.geoPointValue.longitude)===Qe(i.geoPointValue.longitude)}(n,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return Qe(r.integerValue)===Qe(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const s=Qe(r.doubleValue),a=Qe(i.doubleValue);return s===a?ei(s)===ei(a):isNaN(s)&&isNaN(a)}return!1}(n,e);case 9:return Jr(n.arrayValue.values||[],e.arrayValue.values||[],Mn);case 10:return function(r,i){const s=r.mapValue.fields||{},a=i.mapValue.fields||{};if(Cl(s)!==Cl(a))return!1;for(const h in s)if(s.hasOwnProperty(h)&&(void 0===a[h]||!Mn(s[h],a[h])))return!1;return!0}(n,e);default:return J()}var i}function zi(n,e){return void 0!==(n.values||[]).find(t=>Mn(t,e))}function Ln(n,e){if(n===e)return 0;const t=Ir(n),r=Ir(e);if(t!==r)return le(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return le(n.booleanValue,e.booleanValue);case 2:return function(i,s){const a=Qe(i.integerValue||i.doubleValue),h=Qe(s.integerValue||s.doubleValue);return a<h?-1:a>h?1:a===h?0:isNaN(a)?isNaN(h)?0:-1:1}(n,e);case 3:return pa(n.timestampValue,e.timestampValue);case 4:return pa(Wn(n),Wn(e));case 5:return le(n.stringValue,e.stringValue);case 6:return function(i,s){const a=Hn(i),h=Hn(s);return a.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(i,s){const a=i.split("/"),h=s.split("/");for(let d=0;d<a.length&&d<h.length;d++){const m=le(a[d],h[d]);if(0!==m)return m}return le(a.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,s){const a=le(Qe(i.latitude),Qe(s.latitude));return 0!==a?a:le(Qe(i.longitude),Qe(s.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(i,s){const a=i.values||[],h=s.values||[];for(let d=0;d<a.length&&d<h.length;++d){const m=Ln(a[d],h[d]);if(m)return m}return le(a.length,h.length)}(n.arrayValue,e.arrayValue);case 10:return function(i,s){if(i===vr.mapValue&&s===vr.mapValue)return 0;if(i===vr.mapValue)return 1;if(s===vr.mapValue)return-1;const a=i.fields||{},h=Object.keys(a),d=s.fields||{},m=Object.keys(d);h.sort(),m.sort();for(let y=0;y<h.length&&y<m.length;++y){const _=le(h[y],m[y]);if(0!==_)return _;const S=Ln(a[h[y]],d[m[y]]);if(0!==S)return S}return le(h.length,m.length)}(n.mapValue,e.mapValue);default:throw J()}}function pa(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return le(n,e);const t=Kn(n),r=Kn(e),i=le(t.seconds,r.seconds);return 0!==i?i:le(t.nanos,r.nanos)}function ni(n){return Zc(n)}function Zc(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const i=Kn(r);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Hn(n.bytesValue).toBase64():"referenceValue"in n?j.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let i="[",s=!0;for(const a of r.values||[])s?s=!1:i+=",",i+=Zc(a);return i+"]"}(n.arrayValue):"mapValue"in n?function(r){const i=Object.keys(r.fields||{}).sort();let s="{",a=!0;for(const h of i)a?a=!1:s+=",",s+=`${h}:${Zc(r.fields[h])}`;return s+"}"}(n.mapValue):J();var e}function ri(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ft(n){return!!n&&"integerValue"in n}function Yn(n){return!!n&&"arrayValue"in n}function Gc(n){return!!n&&"nullValue"in n}function xl(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Gi(n){return!!n&&"mapValue"in n}function ii(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return _r(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ii(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ii(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Al(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function kl(n){return"nullValue"in n?fa:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?ri(Qn.empty(),j.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:J()}function xd(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?ri(Qn.empty(),j.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?vr:J()}function Jn(n,e){const t=Ln(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function qc(n,e){const t=Ln(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class bt{constructor(e){this.value=e}static empty(){return new bt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Gi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ii(t)}setAll(e){let t=We.emptyPath(),r={},i=[];e.forEach((a,h)=>{if(!t.isImmediateParentOf(h)){const d=this.getFieldsMap(t);this.applyChanges(d,r,i),r={},i=[],t=h.popLast()}a?r[h.lastSegment()]=ii(a):i.push(h.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Gi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Mn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Gi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){_r(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new bt(ii(this.value))}}function Ol(n){const e=[];return _r(n.fields,(t,r)=>{const i=new We([t]);if(Gi(r)){const s=Ol(r.mapValue).fields;if(0===s.length)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new qt(e)}class qe{constructor(e,t,r,i,s,a,h){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=h}static newInvalidDocument(e){return new qe(e,0,ie.min(),ie.min(),ie.min(),bt.empty(),0)}static newFoundDocument(e,t,r,i){return new qe(e,1,t,ie.min(),r,i,0)}static newNoDocument(e,t){return new qe(e,2,t,ie.min(),ie.min(),bt.empty(),0)}static newUnknownDocument(e,t){return new qe(e,3,t,ie.min(),ie.min(),bt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ie.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=bt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=bt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ie.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof qe&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new qe(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Xn{constructor(e,t){this.position=e,this.inclusive=t}}function Ut(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],a=n.position[i];if(r=s.field.isKeyField()?j.comparator(j.fromName(a.referenceValue),t.key):Ln(a,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function ma(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Mn(n.position[t],e.position[t]))return!1;return!0}class wr{constructor(e,t="asc"){this.field=e,this.dir=t}}function Ad(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Fn{}class me extends Fn{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new o(e,t,r):"array-contains"===t?new g(e,r):"in"===t?new w(e,r):"not-in"===t?new C(e,r):"array-contains-any"===t?new U(e,r):new me(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new c(e,r):new l(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ln(t,this.value)):null!==t&&Ir(this.value)===Ir(t)&&this.matchesComparison(Ln(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return J()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Ne extends Fn{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new Ne(e,t)}matches(e){return si(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft(t=>t.isInequality());return null!==e?e.field:null}ft(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function si(n){return"and"===n.op}function jc(n){return"or"===n.op}function js(n){return Dl(n)&&si(n)}function Dl(n){for(const e of n.filters)if(e instanceof Ne)return!1;return!0}function $c(n){if(n instanceof me)return n.field.canonicalString()+n.op.toString()+ni(n.value);if(js(n))return n.filters.map(e=>$c(e)).join(",");{const e=n.filters.map(t=>$c(t)).join(",");return`${n.op}(${e})`}}function Nl(n,e){return n instanceof me?(t=n,(r=e)instanceof me&&t.op===r.op&&t.field.isEqual(r.field)&&Mn(t.value,r.value)):n instanceof Ne?function(t,r){return r instanceof Ne&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((i,s,a)=>i&&Nl(s,r.filters[a]),!0)}(n,e):void J();var t,r}function Rl(n,e){const t=n.filters.concat(e);return Ne.create(t,n.op)}function u(n){return n instanceof me?`${(e=n).field.canonicalString()} ${e.op} ${ni(e.value)}`:n instanceof Ne?function(e){return e.op.toString()+" {"+e.getFilters().map(u).join(" ,")+"}"}(n):"Filter";var e}class o extends me{constructor(e,t,r){super(e,t,r),this.key=j.fromName(r.referenceValue)}matches(e){const t=j.comparator(e.key,this.key);return this.matchesComparison(t)}}class c extends me{constructor(e,t){super(e,"in",t),this.keys=p(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class l extends me{constructor(e,t){super(e,"not-in",t),this.keys=p(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function p(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>j.fromName(r.referenceValue))}class g extends me{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Yn(t)&&zi(t.arrayValue,this.value)}}class w extends me{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&zi(this.value.arrayValue,t)}}class C extends me{constructor(e,t){super(e,"not-in",t)}matches(e){if(zi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!zi(this.value.arrayValue,t)}}class U extends me{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Yn(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>zi(this.value.arrayValue,r))}}class G{constructor(e,t=null,r=[],i=[],s=null,a=null,h=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=h,this.dt=null}}function Y(n,e=null,t=[],r=[],i=null,s=null,a=null){return new G(n,e,t,r,i,s,a)}function Q(n){const e=W(n);if(null===e.dt){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>$c(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(i=r).field.canonicalString()+i.dir;var i}).join(","),Zs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>ni(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>ni(r)).join(",")),e.dt=t}return e.dt}function Ve(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Ad(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Nl(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!ma(n.startAt,e.startAt)&&ma(n.endAt,e.endAt)}function jt(n){return j.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function oi(n,e){return n.filters.filter(t=>t instanceof me&&t.field.isEqual(e))}function Kc(n,e,t){let r=fa,i=!0;for(const s of oi(n,e)){let a=fa,h=!0;switch(s.op){case"<":case"<=":a=kl(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,h=!1;break;case"!=":case"not-in":a=fa}Jn({value:r,inclusive:i},{value:a,inclusive:h})<0&&(r=a,i=h)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const a=t.position[s];Jn({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}return{value:r,inclusive:i}}function ga(n,e,t){let r=vr,i=!0;for(const s of oi(n,e)){let a=vr,h=!0;switch(s.op){case">=":case">":a=xd(s.value),h=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,h=!1;break;case"!=":case"not-in":a=vr}qc({value:r,inclusive:i},{value:a,inclusive:h})>0&&(r=a,i=h)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const a=t.position[s];qc({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}return{value:r,inclusive:i}}class Un{constructor(e,t=null,r=[],i=[],s=null,a="F",h=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=h,this.endAt=d,this.wt=null,this._t=null}}function Hc(n,e,t,r,i,s,a,h){return new Un(n,e,t,r,i,s,a,h)}function Er(n){return new Un(n)}function Wc(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function ya(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function qi(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function _a(n){return null!==n.collectionGroup}function ai(n){const e=W(n);if(null===e.wt){e.wt=[];const t=qi(e),r=ya(e);if(null!==t&&null===r)t.isKeyField()||e.wt.push(new wr(t)),e.wt.push(new wr(We.keyField(),"asc"));else{let i=!1;for(const s of e.explicitOrderBy)e.wt.push(s),s.field.isKeyField()&&(i=!0);if(!i){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new wr(We.keyField(),s))}}}return e.wt}function St(n){const e=W(n);if(!e._t)if("F"===e.limitType)e._t=Y(e.path,e.collectionGroup,ai(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of ai(e))t.push(new wr(s.field,"desc"===s.dir?"asc":"desc"));const r=e.endAt?new Xn(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new Xn(e.startAt.position,e.startAt.inclusive):null;e._t=Y(e.path,e.collectionGroup,t,e.filters,e.limit,r,i)}return e._t}function Qc(n,e){e.getFirstInequalityField(),qi(n);const t=n.filters.concat([e]);return new Un(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Pl(n,e,t){return new Un(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Yc(n,e){return Ve(St(n),St(e))&&n.limitType===e.limitType}function qp(n){return`${Q(St(n))}|lt:${n.limitType}`}function kd(n){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(r=>u(r)).join(", ")}]`),Zs(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(r=>{return`${(i=r).field.canonicalString()} (${i.dir})`;var i}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>ni(r)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>ni(r)).join(",")),`Target(${t})`}(St(n))}; limitType=${n.limitType})`}function Jc(n,e){return e.isFoundDocument()&&function(t,r){const i=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(i):j.isDocumentKey(t.path)?t.path.isEqual(i):t.path.isImmediateParentOf(i)}(n,e)&&function(t,r){for(const i of ai(t))if(!i.field.isKeyField()&&null===r.data.field(i.field))return!1;return!0}(n,e)&&function(t,r){for(const i of t.filters)if(!i.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!function(i,s,a){const h=Ut(i,s,a);return i.inclusive?h<=0:h<0}(t.startAt,ai(t),r)||t.endAt&&!function(i,s,a){const h=Ut(i,s,a);return i.inclusive?h>=0:h>0}(t.endAt,ai(t),r)));var t,r}function jp(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function $p(n){return(e,t)=>{let r=!1;for(const i of ai(n)){const s=jy(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function jy(n,e,t){const r=n.field.isKeyField()?j.comparator(e.key,t.key):function(i,s,a){const h=s.data.field(i),d=a.data.field(i);return null!==h&&null!==d?Ln(h,d):J()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return J()}}class ci{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){_r(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return zc(this.inner)}size(){return this.innerSize}}const $y=new Le(j.comparator);function fn(){return $y}const Kp=new Le(j.comparator);function Xc(...n){let e=Kp;for(const t of n)e=e.insert(t.key,t);return e}function Hp(n){let e=Kp;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Tr(){return eu()}function Wp(){return eu()}function eu(){return new ci(n=>n.toString(),(n,e)=>n.isEqual(e))}const Ky=new Le(j.comparator),Hy=new Ue(j.comparator);function ge(...n){let e=Hy;for(const t of n)e=e.add(t);return e}const Wy=new Ue(le);function Od(){return Wy}function Qp(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ei(e)?"-0":e}}function Yp(n){return{integerValue:""+n}}function Jp(n,e){return El(e)?Yp(e):Qp(n,e)}class Ml{constructor(){this._=void 0}}function Qy(n,e,t){return n instanceof va?function(r,i){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&ha(i)&&(i=da(i)),i&&(s.fields.__previous_value__=i),{mapValue:s}}(t,e):n instanceof $s?em(n,e):n instanceof Ks?tm(n,e):function(r,i){const s=Xp(r,i),a=nm(s)+nm(r.gt);return Ft(s)&&Ft(r.gt)?Yp(a):Qp(r.serializer,a)}(n,e)}function Yy(n,e,t){return n instanceof $s?em(n,e):n instanceof Ks?tm(n,e):t}function Xp(n,e){return n instanceof Ia?Ft(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class va extends Ml{}class $s extends Ml{constructor(e){super(),this.elements=e}}function em(n,e){const t=rm(e);for(const r of n.elements)t.some(i=>Mn(i,r))||t.push(r);return{arrayValue:{values:t}}}class Ks extends Ml{constructor(e){super(),this.elements=e}}function tm(n,e){let t=rm(e);for(const r of n.elements)t=t.filter(i=>!Mn(i,r));return{arrayValue:{values:t}}}class Ia extends Ml{constructor(e,t){super(),this.serializer=e,this.gt=t}}function nm(n){return Qe(n.integerValue||n.doubleValue)}function rm(n){return Yn(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class tu{constructor(e,t){this.field=e,this.transform=t}}class Xy{constructor(e,t){this.version=e,this.transformResults=t}}class Ye{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ye}static exists(e){return new Ye(void 0,e)}static updateTime(e){return new Ye(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ll(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class Fl{}function im(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new Ea(n.key,Ye.none()):new wa(n.key,n.data,Ye.none());{const t=n.data,r=bt.empty();let i=new Ue(We.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);null===a&&s.length>1&&(s=s.popLast(),a=t.field(s)),null===a?r.delete(s):r.set(s,a),i=i.add(s)}return new ui(n.key,r,new qt(i.toArray()),Ye.none())}}function e_(n,e,t){n instanceof wa?function(r,i,s){const a=r.value.clone(),h=am(r.fieldTransforms,i,s.transformResults);a.setAll(h),i.convertToFoundDocument(s.version,a).setHasCommittedMutations()}(n,e,t):n instanceof ui?function(r,i,s){if(!Ll(r.precondition,i))return void i.convertToUnknownDocument(s.version);const a=am(r.fieldTransforms,i,s.transformResults),h=i.data;h.setAll(om(r)),h.setAll(a),i.convertToFoundDocument(s.version,h).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function nu(n,e,t,r){return n instanceof wa?function(i,s,a,h){if(!Ll(i.precondition,s))return a;const d=i.value.clone(),m=cm(i.fieldTransforms,h,s);return d.setAll(m),s.convertToFoundDocument(s.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof ui?function(i,s,a,h){if(!Ll(i.precondition,s))return a;const d=cm(i.fieldTransforms,h,s),m=s.data;return m.setAll(om(i)),m.setAll(d),s.convertToFoundDocument(s.version,m).setHasLocalMutations(),null===a?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(y=>y.field))}(n,e,t,r):(a=t,Ll(n.precondition,s=e)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):a);var s,a}function t_(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=Xp(r.transform,i||null);null!=s&&(null===t&&(t=bt.empty()),t.set(r.field,s))}return t||null}function sm(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&Jr(t,r,(i,s)=>function Jy(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof $s&&r instanceof $s||t instanceof Ks&&r instanceof Ks?Jr(t.elements,r.elements,Mn):t instanceof Ia&&r instanceof Ia?Mn(t.gt,r.gt):t instanceof va&&r instanceof va);var t,r}(i,s))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}class wa extends Fl{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ui extends Fl{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function om(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function am(n,e,t){const r=new Map;te(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],a=s.transform,h=e.data.field(s.field);r.set(s.field,Yy(a,h,t[i]))}return r}function cm(n,e,t){const r=new Map;for(const i of n){const s=i.transform,a=t.data.field(i.field);r.set(i.field,Qy(s,a,e))}return r}class Ea extends Fl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Dd extends Fl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Nd{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&e_(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=nu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=nu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Wp();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let h=this.applyToLocalView(a,s.mutatedFields);h=t.has(i.key)?null:h;const d=im(a,h);null!==d&&r.set(i.key,d),a.isValidDocument()||a.convertToNoDocument(ie.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ge())}isEqual(e){return this.batchId===e.batchId&&Jr(this.mutations,e.mutations,(t,r)=>sm(t,r))&&Jr(this.baseMutations,e.baseMutations,(t,r)=>sm(t,r))}}class Rd{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){te(e.mutations.length===r.length);let i=Ky;const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new Rd(e,t,r,i)}}class Pd{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class r_{constructor(e,t){this.count=e,this.unchangedNames=t}}var yt,xe;function um(n){switch(n){default:return J();case O.CANCELLED:case O.UNKNOWN:case O.DEADLINE_EXCEEDED:case O.RESOURCE_EXHAUSTED:case O.INTERNAL:case O.UNAVAILABLE:case O.UNAUTHENTICATED:return!1;case O.INVALID_ARGUMENT:case O.NOT_FOUND:case O.ALREADY_EXISTS:case O.PERMISSION_DENIED:case O.FAILED_PRECONDITION:case O.ABORTED:case O.OUT_OF_RANGE:case O.UNIMPLEMENTED:case O.DATA_LOSS:return!0}}function lm(n){if(void 0===n)return He("GRPC error has no .code"),O.UNKNOWN;switch(n){case yt.OK:return O.OK;case yt.CANCELLED:return O.CANCELLED;case yt.UNKNOWN:return O.UNKNOWN;case yt.DEADLINE_EXCEEDED:return O.DEADLINE_EXCEEDED;case yt.RESOURCE_EXHAUSTED:return O.RESOURCE_EXHAUSTED;case yt.INTERNAL:return O.INTERNAL;case yt.UNAVAILABLE:return O.UNAVAILABLE;case yt.UNAUTHENTICATED:return O.UNAUTHENTICATED;case yt.INVALID_ARGUMENT:return O.INVALID_ARGUMENT;case yt.NOT_FOUND:return O.NOT_FOUND;case yt.ALREADY_EXISTS:return O.ALREADY_EXISTS;case yt.PERMISSION_DENIED:return O.PERMISSION_DENIED;case yt.FAILED_PRECONDITION:return O.FAILED_PRECONDITION;case yt.ABORTED:return O.ABORTED;case yt.OUT_OF_RANGE:return O.OUT_OF_RANGE;case yt.UNIMPLEMENTED:return O.UNIMPLEMENTED;case yt.DATA_LOSS:return O.DATA_LOSS;default:return J()}}(xe=yt||(yt={}))[xe.OK=0]="OK",xe[xe.CANCELLED=1]="CANCELLED",xe[xe.UNKNOWN=2]="UNKNOWN",xe[xe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",xe[xe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",xe[xe.NOT_FOUND=5]="NOT_FOUND",xe[xe.ALREADY_EXISTS=6]="ALREADY_EXISTS",xe[xe.PERMISSION_DENIED=7]="PERMISSION_DENIED",xe[xe.UNAUTHENTICATED=16]="UNAUTHENTICATED",xe[xe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",xe[xe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",xe[xe.ABORTED=10]="ABORTED",xe[xe.OUT_OF_RANGE=11]="OUT_OF_RANGE",xe[xe.UNIMPLEMENTED=12]="UNIMPLEMENTED",xe[xe.INTERNAL=13]="INTERNAL",xe[xe.UNAVAILABLE=14]="UNAVAILABLE",xe[xe.DATA_LOSS=15]="DATA_LOSS";class Md{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Ul}static getOrCreateInstance(){return null===Ul&&(Ul=new Md),Ul}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(t=>t(e))}}let Ul=null;function hm(){return new TextEncoder}const i_=new Rn([4294967295,4294967295],0);function dm(n){const e=hm().encode(n),t=new ed;return t.update(e),new Uint8Array(t.digest())}function fm(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Rn([t,r],0),new Rn([i,s],0)]}class Ld{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ru(`Invalid padding: ${t}`);if(r<0)throw new ru(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new ru(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new ru(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=Rn.fromNumber(this.It)}Et(e,t,r){let i=e.add(t.multiply(Rn.fromNumber(r)));return 1===i.compare(i_)&&(i=new Rn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Tt).toNumber()}At(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;const t=dm(e),[r,i]=fm(t);for(let s=0;s<this.hashCount;s++){const a=this.Et(r,i,s);if(!this.At(a))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new Ld(s,i,t);return r.forEach(h=>a.insert(h)),a}insert(e){if(0===this.It)return;const t=dm(e),[r,i]=fm(t);for(let s=0;s<this.hashCount;s++){const a=this.Et(r,i,s);this.Rt(a)}}Rt(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class ru extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class iu{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,su.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new iu(ie.min(),i,new Le(le),fn(),ge())}}class su{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new su(r,t,ge(),ge(),ge())}}class Vl{constructor(e,t,r,i){this.Pt=e,this.removedTargetIds=t,this.key=r,this.bt=i}}class pm{constructor(e,t){this.targetId=e,this.Vt=t}}class mm{constructor(e,t,r=ct.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class gm{constructor(){this.St=0,this.Dt=_m(),this.Ct=ct.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=ge(),t=ge(),r=ge();return this.Dt.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:J()}}),new su(this.Ct,this.xt,e,t,r)}Ft(){this.Nt=!1,this.Dt=_m()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class s_{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=fn(),this.zt=ym(),this.Wt=new Le(le)}Ht(e){for(const t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(const t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,t=>{const r=this.Zt(t);switch(e.state){case 0:this.te(t)&&r.$t(e.resumeToken);break;case 1:r.Ut(),r.kt||r.Ft(),r.$t(e.resumeToken);break;case 2:r.Ut(),r.kt||this.removeTarget(t);break;case 3:this.te(t)&&(r.Kt(),r.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),r.$t(e.resumeToken));break;default:J()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach((r,i)=>{this.te(i)&&t(i)})}ne(e){var t;const r=e.targetId,i=e.Vt.count,s=this.se(r);if(s){const a=s.target;if(jt(a))if(0===i){const h=new j(a.path);this.Yt(r,h,qe.newNoDocument(h,ie.min()))}else te(1===i);else{const h=this.ie(r);if(h!==i){const d=this.re(e,h);0!==d&&(this.ee(r),this.Wt=this.Wt.insert(r,2===d?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null===(t=Md.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(m,y,_){var S,N,Z,K,H,oe;const ve={localCacheCount:y,existenceFilterCount:_.count},fe=_.unchangedNames;return fe&&(ve.bloomFilter={applied:0===m,hashCount:null!==(S=fe?.hashCount)&&void 0!==S?S:0,bitmapLength:null!==(K=null===(Z=null===(N=fe?.bits)||void 0===N?void 0:N.bitmap)||void 0===Z?void 0:Z.length)&&void 0!==K?K:0,padding:null!==(oe=null===(H=fe?.bits)||void 0===H?void 0:H.padding)&&void 0!==oe?oe:0}),ve}(d,h,e.Vt))}}}}re(e,t){const{unchangedNames:r,count:i}=e.Vt;if(!r||!r.bits)return 1;const{bits:{bitmap:s="",padding:a=0},hashCount:h=0}=r;let d,m;try{d=Hn(s).toUint8Array()}catch(y){if(y instanceof qs)return Jt("Decoding the base64 bloom filter in existence filter failed ("+y.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw y}try{m=new Ld(d,a,h)}catch(y){return Jt(y instanceof ru?"BloomFilter error: ":"Applying bloom filter failed: ",y),1}return 0===m.It?1:i!==t-this.oe(e.targetId,m)?2:0}oe(e,t){const r=this.Gt.getRemoteKeysForTarget(e);let i=0;return r.forEach(s=>{const a=this.Gt.ue(),h=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;t.vt(h)||(this.Yt(e,s,null),i++)}),i}ce(e){const t=new Map;this.Qt.forEach((s,a)=>{const h=this.se(a);if(h){if(s.current&&jt(h.target)){const d=new j(h.target.path);null!==this.jt.get(d)||this.ae(a,d)||this.Yt(a,d,qe.newNoDocument(d,e))}s.Mt&&(t.set(a,s.Ot()),s.Ft())}});let r=ge();this.zt.forEach((s,a)=>{let h=!0;a.forEachWhile(d=>{const m=this.se(d);return!m||"TargetPurposeLimboResolution"===m.purpose||(h=!1,!1)}),h&&(r=r.add(s))}),this.jt.forEach((s,a)=>a.setReadTime(e));const i=new iu(e,t,this.Wt,this.jt,r);return this.jt=fn(),this.zt=ym(),this.Wt=new Le(le),i}Jt(e,t){if(!this.te(e))return;const r=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,r),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,r){if(!this.te(e))return;const i=this.Zt(e);this.ae(e,t)?i.Bt(t,1):i.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),r&&(this.jt=this.jt.insert(t,r))}removeTarget(e){this.Qt.delete(e)}ie(e){const t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new gm,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new Ue(le),this.zt=this.zt.insert(e,t)),t}te(e){const t=null!==this.se(e);return t||V("WatchChangeAggregator","Detected inactive target",e),t}se(e){const t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new gm),this.Gt.getRemoteKeysForTarget(e).forEach(t=>{this.Yt(e,t,null)})}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function ym(){return new Le(j.comparator)}function _m(){return new Le(j.comparator)}const o_={asc:"ASCENDING",desc:"DESCENDING"},a_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},c_={and:"AND",or:"OR"};class u_{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Fd(n,e){return n.useProto3Json||Zs(e)?e:{value:e}}function Ta(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function vm(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function l_(n,e){return Ta(n,e.toTimestamp())}function ut(n){return te(!!n),ie.fromTimestamp(function(e){const t=Kn(e);return new je(t.seconds,t.nanos)}(n))}function Ud(n,e){return(t=n,new we(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function Im(n){const e=we.fromString(n);return te(km(e)),e}function ou(n,e){return Ud(n.databaseId,e.path)}function br(n,e){const t=Im(e);if(t.get(1)!==n.databaseId.projectId)throw new L(O.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new L(O.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new j(Em(t))}function Vd(n,e){return Ud(n.databaseId,e)}function wm(n){const e=Im(n);return 4===e.length?we.emptyPath():Em(e)}function au(n){return new we(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Em(n){return te(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Tm(n,e,t){return{name:ou(n,e),fields:t.value.mapValue.fields}}function bm(n,e,t){const r=br(n,e.name),i=ut(e.updateTime),s=e.createTime?ut(e.createTime):ie.min(),a=new bt({mapValue:{fields:e.fields}}),h=qe.newFoundDocument(r,i,s,a);return t&&h.setHasCommittedMutations(),t?h.setHasCommittedMutations():h}function cu(n,e){let t;if(e instanceof wa)t={update:Tm(n,e.key,e.value)};else if(e instanceof Ea)t={delete:ou(n,e.key)};else if(e instanceof ui)t={update:Tm(n,e.key,e.data),updateMask:__(e.fieldMask)};else{if(!(e instanceof Dd))return J();t={verify:ou(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,s){const a=s.transform;if(a instanceof va)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof $s)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ks)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Ia)return{fieldPath:s.field.canonicalString(),increment:a.gt};throw J()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:l_(n,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:J()),t;var i}function Bd(n,e){const t=e.currentDocument?void 0!==(i=e.currentDocument).updateTime?Ye.updateTime(ut(i.updateTime)):void 0!==i.exists?Ye.exists(i.exists):Ye.none():Ye.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(s,a){let h=null;"setToServerValue"in a?(te("REQUEST_TIME"===a.setToServerValue),h=new va):"appendMissingElements"in a?h=new $s(a.appendMissingElements.values||[]):"removeAllFromArray"in a?h=new Ks(a.removeAllFromArray.values||[]):"increment"in a?h=new Ia(s,a.increment):J();const d=We.fromServerFormat(a.fieldPath);return new tu(d,h)}(n,i)):[];var i;if(e.update){const i=br(n,e.update.name),s=new bt({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=new qt((e.updateMask.fieldPaths||[]).map(m=>We.fromServerFormat(m)));return new ui(i,s,a,t,r)}return new wa(i,s,t,r)}if(e.delete){const i=br(n,e.delete);return new Ea(i,t)}if(e.verify){const i=br(n,e.verify);return new Dd(i,t)}return J()}function Sm(n,e){return{documents:[Vd(n,e.path)]}}function zd(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=Vd(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Vd(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(d){if(0!==d.length)return Am(Ne.create(d,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const s=function(d){if(0!==d.length)return d.map(m=>{return{field:ji((y=m).field),direction:m_(y.dir)};var y})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const a=Fd(n,e.limit);var h,d;return null!==a&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt={before:(h=e.startAt).inclusive,values:h.position}),e.endAt&&(t.structuredQuery.endAt={before:!(d=e.endAt).inclusive,values:d.position}),t}function Cm(n){let e=wm(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){te(1===r);const y=t.from[0];y.allDescendants?i=y.collectionId:e=e.child(y.collectionId)}let s=[];t.where&&(s=function(y){const _=xm(y);return _ instanceof Ne&&js(_)?_.getFilters():[_]}(t.where));let a=[];t.orderBy&&(a=t.orderBy.map(y=>{return new wr(ba((_=y).field),function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction));var _}));let h=null;t.limit&&(h=function(y){let _;return _="object"==typeof y?y.value:y,Zs(_)?null:_}(t.limit));let d=null;var y;t.startAt&&(d=new Xn((y=t.startAt).values||[],!!y.before));let m=null;return t.endAt&&(m=function(y){return new Xn(y.values||[],!y.before)}(t.endAt)),Hc(e,i,a,s,h,"F",d,m)}function xm(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=ba(e.unaryFilter.field);return me.create(t,"==",{doubleValue:NaN});case"IS_NULL":const r=ba(e.unaryFilter.field);return me.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=ba(e.unaryFilter.field);return me.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=ba(e.unaryFilter.field);return me.create(s,"!=",{nullValue:"NULL_VALUE"});default:return J()}}(n):void 0!==n.fieldFilter?me.create(ba((e=n).fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return J()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return Ne.create(e.compositeFilter.filters.map(t=>xm(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return J()}}(e.compositeFilter.op))}(n):J();var e}function m_(n){return o_[n]}function g_(n){return a_[n]}function y_(n){return c_[n]}function ji(n){return{fieldPath:n.canonicalString()}}function ba(n){return We.fromServerFormat(n.fieldPath)}function Am(n){return n instanceof me?function(e){if("=="===e.op){if(xl(e.value))return{unaryFilter:{field:ji(e.field),op:"IS_NAN"}};if(Gc(e.value))return{unaryFilter:{field:ji(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(xl(e.value))return{unaryFilter:{field:ji(e.field),op:"IS_NOT_NAN"}};if(Gc(e.value))return{unaryFilter:{field:ji(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ji(e.field),op:g_(e.op),value:e.value}}}(n):n instanceof Ne?function(e){const t=e.getFilters().map(r=>Am(r));return 1===t.length?t[0]:{compositeFilter:{op:y_(e.op),filters:t}}}(n):J()}function __(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function km(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class li{constructor(e,t,r,i,s=ie.min(),a=ie.min(),h=ct.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=h,this.expectedCount=d}withSequenceNumber(e){return new li(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new li(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new li(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new li(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Om{constructor(e){this.fe=e}}function Dm(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Bl(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:ou(i=n.fe,(s=e).key),fields:s.data.value.mapValue.fields,updateTime:Ta(i,s.version.toTimestamp()),createTime:Ta(i,s.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Hs(e.version)};else{if(!e.isUnknownDocument())return J();r.unknownDocument={path:t.path.toArray(),version:Hs(e.version)}}var i,s;return r}function Bl(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Hs(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ws(n){const e=new je(n.seconds,n.nanoseconds);return ie.fromTimestamp(e)}function Qs(n,e){const t=(e.baseMutations||[]).map(s=>Bd(n.fe,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const r=e.mutations.map(s=>Bd(n.fe,s)),i=je.fromMillis(e.localWriteTimeMs);return new Nd(e.batchId,i,t,r)}function uu(n){const e=Ws(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?Ws(n.lastLimboFreeSnapshotVersion):ie.min();let r;var i;return void 0!==n.query.documents?(te(1===(i=n.query).documents.length),r=St(Er(wm(i.documents[0])))):r=St(Cm(n.query)),new li(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,ct.fromBase64String(n.resumeToken))}function Nm(n,e){const t=Hs(e.snapshotVersion),r=Hs(e.lastLimboFreeSnapshotVersion);let i;i=jt(e.target)?Sm(n.fe,e.target):zd(n.fe,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Q(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Zd(n){const e=Cm({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?Pl(e,e.limit,"L"):e}function Gd(n,e){return new Pd(e.largestBatchId,Bd(n.fe,e.overlayMutation))}function Rm(n,e){const t=e.path.lastSegment();return[n,Lt(e.path.popLast()),t]}function Pm(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Hs(r.readTime),documentKey:Lt(r.documentKey.path),largestBatchId:r.largestBatchId}}class I_{getBundleMetadata(e,t){return Mm(e).get(t).next(r=>{if(r)return{id:(i=r).bundleId,createTime:Ws(i.createTime),version:i.version};var i})}saveBundleMetadata(e,t){return Mm(e).put({bundleId:(r=t).id,createTime:Hs(ut(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return Lm(e).get(t).next(r=>{if(r)return{name:(i=r).name,query:Zd(i.bundledQuery),readTime:Ws(i.readTime)};var i})}saveNamedQuery(e,t){return Lm(e).put({name:(r=t).name,readTime:Hs(ut(r.readTime)),bundledQuery:r.bundledQuery});var r}}function Mm(n){return gt(n,"bundles")}function Lm(n){return gt(n,"namedQueries")}class zl{constructor(e,t){this.serializer=e,this.userId=t}static de(e,t){return new zl(e,t.uid||"")}getOverlay(e,t){return lu(e).get(Rm(this.userId,t)).next(r=>r?Gd(this.serializer,r):null)}getOverlays(e,t){const r=Tr();return x.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,a)=>{const h=new Pd(t,a);i.push(this.we(e,h))}),x.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(a=>i.add(Lt(a.getCollectionPath())));const s=[];return i.forEach(a=>{const h=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);s.push(lu(e).J("collectionPathOverlayIndex",h))}),x.waitFor(s)}getOverlaysForCollection(e,t,r){const i=Tr(),s=Lt(t),a=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return lu(e).j("collectionPathOverlayIndex",a).next(h=>{for(const d of h){const m=Gd(this.serializer,d);i.set(m.getKey(),m)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=Tr();let a;const h=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return lu(e).X({index:"collectionGroupOverlayIndex",range:h},(d,m,y)=>{const _=Gd(this.serializer,m);s.size()<i||_.largestBatchId===a?(s.set(_.getKey(),_),a=_.largestBatchId):y.done()}).next(()=>s)}we(e,t){return lu(e).put(function(r,i,s){const[a,h,d]=Rm(i,s.mutation.key);return{userId:i,collectionPath:h,documentId:d,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:cu(r.fe,s.mutation)}}(this.serializer,this.userId,t))}}function lu(n){return gt(n,"documentOverlays")}class Ys{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(Qe(e.integerValue));else if("doubleValue"in e){const r=Qe(e.doubleValue);isNaN(r)?this.ye(t,13):(this.ye(t,15),ei(r)?t.pe(0):t.pe(r))}else if("timestampValue"in e){const r=e.timestampValue;this.ye(t,20),"string"==typeof r?t.Ie(r):(t.Ie(`${r.seconds||""}`),t.pe(r.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(Hn(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.ye(t,45),t.pe(r.latitude||0),t.pe(r.longitude||0)}else"mapValue"in e?Al(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):J()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){const r=e.fields||{};this.ye(t,55);for(const i of Object.keys(r))this.Te(i,t),this.me(r[i],t)}Pe(e,t){const r=e.values||[];this.ye(t,50);for(const i of r)this.me(i,t)}ve(e,t){this.ye(t,37),j.fromName(e).path.forEach(r=>{this.ye(t,60),this.be(r,t)})}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}function w_(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Fm(n){const e=64-function(t){let r=0;for(let i=0;i<8;++i){const s=w_(255&t[i]);if(r+=s,8!==s)break}return r}(n);return Math.ceil(e/8)}Ys.Ve=new Ys;class E_{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Se(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.De(r.value),r=t.next();this.Ce()}xe(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ne(r.value),r=t.next();this.ke()}Me(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.De(r);else if(r<2048)this.De(960|r>>>6),this.De(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.De(480|r>>>12),this.De(128|63&r>>>6),this.De(128|63&r);else{const i=t.codePointAt(0);this.De(240|i>>>18),this.De(128|63&i>>>12),this.De(128|63&i>>>6),this.De(128|63&i)}}this.Ce()}$e(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ne(r);else if(r<2048)this.Ne(960|r>>>6),this.Ne(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ne(480|r>>>12),this.Ne(128|63&r>>>6),this.Ne(128|63&r);else{const i=t.codePointAt(0);this.Ne(240|i>>>18),this.Ne(128|63&i>>>12),this.Ne(128|63&i>>>6),this.Ne(128|63&i)}}this.ke()}Oe(e){const t=this.Fe(e),r=Fm(t);this.Be(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Le(e){const t=this.Fe(e),r=Fm(t);this.Be(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qe(){this.Ue(255),this.Ue(255)}Ke(){this.Ge(255),this.Ge(255)}reset(){this.position=0}seed(e){this.Be(e.length),this.buffer.set(e,this.position),this.position+=e.length}Qe(){return this.buffer.slice(0,this.position)}Fe(e){const t=function(i){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,i,!1),new Uint8Array(s.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}De(e){const t=255&e;0===t?(this.Ue(0),this.Ue(255)):255===t?(this.Ue(255),this.Ue(0)):this.Ue(t)}Ne(e){const t=255&e;0===t?(this.Ge(0),this.Ge(255)):255===t?(this.Ge(255),this.Ge(0)):this.Ge(e)}Ce(){this.Ue(0),this.Ue(1)}ke(){this.Ge(0),this.Ge(1)}Ue(e){this.Be(1),this.buffer[this.position++]=e}Ge(e){this.Be(1),this.buffer[this.position++]=~e}Be(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class T_{constructor(e){this.je=e}Ae(e){this.je.Se(e)}Ie(e){this.je.Me(e)}pe(e){this.je.Oe(e)}ge(){this.je.qe()}}class b_{constructor(e){this.je=e}Ae(e){this.je.xe(e)}Ie(e){this.je.$e(e)}pe(e){this.je.Le(e)}ge(){this.je.Ke()}}class hu{constructor(){this.je=new E_,this.ze=new T_(this.je),this.We=new b_(this.je)}seed(e){this.je.seed(e)}He(e){return 0===e?this.ze:this.We}Qe(){return this.je.Qe()}reset(){this.je.reset()}}class Js{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Je(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Js(this.indexId,this.documentKey,this.arrayValue,r)}}function $i(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=Um(n.arrayValue,e.arrayValue),0!==t?t:(t=Um(n.directionalValue,e.directionalValue),0!==t?t:j.comparator(n.documentKey,e.documentKey)))}function Um(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class S_{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ye=e.orderBy,this.Xe=[];for(const t of e.filters){const r=t;r.isInequality()?this.Ze=r:this.Xe.push(r)}}tn(e){te(e.collectionGroup===this.collectionId);const t=Vi(e);if(void 0!==t&&!this.en(t))return!1;const r=Xr(e);let i=new Set,s=0,a=0;for(;s<r.length&&this.en(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(void 0!==this.Ze){if(!i.has(this.Ze.field.canonicalString())){const h=r[s];if(!this.nn(this.Ze,h)||!this.sn(this.Ye[a++],h))return!1}++s}for(;s<r.length;++s)if(a>=this.Ye.length||!this.sn(this.Ye[a++],r[s]))return!1;return!0}en(e){for(const t of this.Xe)if(this.nn(t,e))return!0;return!1}nn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Vm(n){var e,t;if(te(n instanceof me||n instanceof Ne),n instanceof me){if(n instanceof w){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>me.create(n.field,"==",s)))||[];return Ne.create(i,"or")}return n}const r=n.filters.map(i=>Vm(i));return Ne.create(r,n.op)}function C_(n){if(0===n.getFilters().length)return[];const e=$d(Vm(n));return te(Bm(e)),qd(e)||jd(e)?[e]:e.getFilters()}function qd(n){return n instanceof me}function jd(n){return n instanceof Ne&&js(n)}function Bm(n){return qd(n)||jd(n)||function(e){if(e instanceof Ne&&jc(e)){for(const t of e.getFilters())if(!qd(t)&&!jd(t))return!1;return!0}return!1}(n)}function $d(n){if(te(n instanceof me||n instanceof Ne),n instanceof me)return n;if(1===n.filters.length)return $d(n.filters[0]);const e=n.filters.map(r=>$d(r));let t=Ne.create(e,n.op);return t=Zl(t),Bm(t)?t:(te(t instanceof Ne),te(si(t)),te(t.filters.length>1),t.filters.reduce((r,i)=>Kd(r,i)))}function Kd(n,e){let t;return te(n instanceof me||n instanceof Ne),te(e instanceof me||e instanceof Ne),t=n instanceof me?e instanceof me?Ne.create([n,e],"and"):zm(n,e):e instanceof me?zm(e,n):function(r,i){if(te(r.filters.length>0&&i.filters.length>0),si(r)&&si(i))return Rl(r,i.getFilters());const s=jc(r)?r:i,a=jc(r)?i:r,h=s.filters.map(d=>Kd(d,a));return Ne.create(h,"or")}(n,e),Zl(t)}function zm(n,e){if(si(e))return Rl(e,n.getFilters());{const t=e.filters.map(r=>Kd(n,r));return Ne.create(t,"or")}}function Zl(n){if(te(n instanceof me||n instanceof Ne),n instanceof me)return n;const e=n.getFilters();if(1===e.length)return Zl(e[0]);if(Dl(n))return n;const t=e.map(i=>Zl(i)),r=[];return t.forEach(i=>{i instanceof me?r.push(i):i instanceof Ne&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:Ne.create(r,n.op)}class x_{constructor(){this.rn=new Hd}addToCollectionParentIndex(e,t){return this.rn.add(t),x.resolve()}getCollectionParents(e,t){return x.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return x.resolve()}deleteFieldIndex(e,t){return x.resolve()}getDocumentsMatchingTarget(e,t){return x.resolve(null)}getIndexType(e,t){return x.resolve(0)}getFieldIndexes(e,t){return x.resolve([])}getNextCollectionGroupToUpdate(e){return x.resolve(null)}getMinOffset(e,t){return x.resolve(Xt.min())}getMinOffsetFromCollectionGroup(e,t){return x.resolve(Xt.min())}updateCollectionGroup(e,t,r){return x.resolve()}updateIndexEntries(e,t){return x.resolve()}}class Hd{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ue(we.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ue(we.comparator)).toArray()}}const Gl=new Uint8Array(0);class A_{constructor(e,t){this.user=e,this.databaseId=t,this.on=new Hd,this.un=new ci(r=>Q(r),(r,i)=>Ve(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.on.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.on.add(t)});const s={collectionId:r,parent:Lt(i)};return Zm(e).put(s)}return x.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[ra(t),""],!1,!0);return Zm(e).j(i).next(s=>{for(const a of s){if(a.collectionId!==t)break;r.push(en(a.parent))}return r})}addFieldIndex(e,t){const r=ql(e),i={indexId:(a=t).indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(h=>[h.fieldPath.canonicalString(),h.kind])};var a;delete i.indexId;const s=r.add(i);if(t.indexState){const a=fu(e);return s.next(h=>{a.put(Pm(h,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=ql(e),i=fu(e),s=du(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=du(e);let i=!0;const s=new Map;return x.forEach(this.cn(t),a=>this.an(e,a).next(h=>{i&&(i=!!h),s.set(a,h)})).next(()=>{if(i){let a=ge();const h=[];return x.forEach(s,(d,m)=>{var y;V("IndexedDbIndexManager",`Using index ${y=d,`id=${y.indexId}|cg=${y.collectionGroup}|f=${y.fields.map(fe=>`${fe.fieldPath}:${fe.kind}`).join(",")}`} to execute ${Q(t)}`);const _=function(fe,pe){const Ae=Vi(pe);if(void 0===Ae)return null;for(const Ie of oi(fe,Ae.fieldPath))switch(Ie.op){case"array-contains-any":return Ie.value.arrayValue.values||[];case"array-contains":return[Ie.value]}return null}(m,d),S=function(fe,pe){const Ae=new Map;for(const Ie of Xr(pe))for(const Ht of oi(fe,Ie.fieldPath))switch(Ht.op){case"==":case"in":Ae.set(Ie.fieldPath.canonicalString(),Ht.value);break;case"not-in":case"!=":return Ae.set(Ie.fieldPath.canonicalString(),Ht.value),Array.from(Ae.values())}return null}(m,d),N=function(fe,pe){const Ae=[];let Ie=!0;for(const Ht of Xr(pe)){const pi=0===Ht.kind?Kc(fe,Ht.fieldPath,fe.startAt):ga(fe,Ht.fieldPath,fe.startAt);Ae.push(pi.value),Ie&&(Ie=pi.inclusive)}return new Xn(Ae,Ie)}(m,d),Z=function(fe,pe){const Ae=[];let Ie=!0;for(const Ht of Xr(pe)){const pi=0===Ht.kind?ga(fe,Ht.fieldPath,fe.endAt):Kc(fe,Ht.fieldPath,fe.endAt);Ae.push(pi.value),Ie&&(Ie=pi.inclusive)}return new Xn(Ae,Ie)}(m,d),K=this.hn(d,m,N),H=this.hn(d,m,Z),oe=this.ln(d,m,S),ve=this.fn(d.indexId,_,K,N.inclusive,H,Z.inclusive,oe);return x.forEach(ve,fe=>r.H(fe,t.limit).next(pe=>{pe.forEach(Ae=>{const Ie=j.fromSegments(Ae.documentKey);a.has(Ie)||(a=a.add(Ie),h.push(Ie))})}))}).next(()=>h)}return x.resolve(null)})}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:C_(Ne.create(e.filters,"and")).map(r=>Y(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}fn(e,t,r,i,s,a,h){const d=(null!=t?t.length:1)*Math.max(r.length,s.length),m=d/(null!=t?t.length:1),y=[];for(let _=0;_<d;++_){const S=t?this.dn(t[_/m]):Gl,N=this.wn(e,S,r[_%m],i),Z=this._n(e,S,s[_%m],a),K=h.map(H=>this.wn(e,S,H,!0));y.push(...this.createRange(N,Z,K))}return y}wn(e,t,r,i){const s=new Js(e,j.empty(),t,r);return i?s:s.Je()}_n(e,t,r,i){const s=new Js(e,j.empty(),t,r);return i?s.Je():s}an(e,t){const r=new S_(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(const h of s)r.tn(h)&&(!a||h.fields.length>a.fields.length)&&(a=h);return a})}getIndexType(e,t){let r=2;const i=this.cn(t);return x.forEach(i,s=>this.an(e,s).next(a=>{a?0!==r&&a.fields.length<function(h){let d=new Ue(We.comparator),m=!1;for(const y of h.filters)for(const _ of y.getFlattenedFilters())_.field.isKeyField()||("array-contains"===_.op||"array-contains-any"===_.op?m=!0:d=d.add(_.field));for(const y of h.orderBy)y.field.isKeyField()||(d=d.add(y.field));return d.size+(m?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}mn(e,t){const r=new hu;for(const i of Xr(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const a=r.He(i.kind);Ys.Ve._e(s,a)}return r.Qe()}dn(e){const t=new hu;return Ys.Ve._e(e,t.He(0)),t.Qe()}gn(e,t){const r=new hu;return Ys.Ve._e(ri(this.databaseId,t),r.He(function(i){const s=Xr(i);return 0===s.length?0:s[s.length-1].kind}(e))),r.Qe()}ln(e,t,r){if(null===r)return[];let i=[];i.push(new hu);let s=0;for(const a of Xr(e)){const h=r[s++];for(const d of i)if(this.yn(t,a.fieldPath)&&Yn(h))i=this.pn(i,a,h);else{const m=d.He(a.kind);Ys.Ve._e(h,m)}}return this.In(i)}hn(e,t,r){return this.ln(e,t,r.position)}In(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Qe();return t}pn(e,t,r){const i=[...e],s=[];for(const a of r.arrayValue.values||[])for(const h of i){const d=new hu;d.seed(h.Qe()),Ys.Ve._e(a,d.He(t.kind)),s.push(d)}return s}yn(e,t){return!!e.filters.find(r=>r instanceof me&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=ql(e),i=fu(e);return(t?r.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.j()).next(s=>{const a=[];return x.forEach(s,h=>i.get([h.indexId,this.uid]).next(d=>{a.push(function(m,y){const _=y?new Us(y.sequenceNumber,new Xt(Ws(y.readTime),new j(en(y.documentKey)),y.largestBatchId)):Us.empty(),S=m.fields.map(([N,Z])=>new sa(We.fromServerFormat(N),Z));return new ia(m.indexId,m.collectionGroup,S,_)}(h,d))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:le(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=ql(e),s=fu(e);return this.Tn(e).next(a=>i.j("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(h=>x.forEach(h,d=>s.put(Pm(d.indexId,this.user,a,r)))))}updateIndexEntries(e,t){const r=new Map;return x.forEach(t,(i,s)=>{const a=r.get(i.collectionGroup);return(a?x.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(h=>(r.set(i.collectionGroup,h),x.forEach(h,d=>this.En(e,i,d).next(m=>{const y=this.An(s,d);return m.isEqual(y)?x.resolve():this.vn(e,s,d,m,y)}))))})}Rn(e,t,r,i){return du(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.gn(r,t.key),documentKey:t.key.path.toArray()})}Pn(e,t,r,i){return du(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.gn(r,t.key),t.key.path.toArray()])}En(e,t,r){const i=du(e);let s=new Ue($i);return i.X({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.gn(r,t)])},(a,h)=>{s=s.add(new Js(r.indexId,t,h.arrayValue,h.directionalValue))}).next(()=>s)}An(e,t){let r=new Ue($i);const i=this.mn(t,e);if(null==i)return r;const s=Vi(t);if(null!=s){const a=e.data.field(s.fieldPath);if(Yn(a))for(const h of a.arrayValue.values||[])r=r.add(new Js(t.indexId,e.key,this.dn(h),i))}else r=r.add(new Js(t.indexId,e.key,Gl,i));return r}vn(e,t,r,i,s){V("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(h,d,m,y,_){const S=h.getIterator(),N=d.getIterator();let Z=Bi(S),K=Bi(N);for(;Z||K;){let H=!1,oe=!1;if(Z&&K){const ve=m(Z,K);ve<0?oe=!0:ve>0&&(H=!0)}else null!=Z?oe=!0:H=!0;H?(y(K),K=Bi(N)):oe?(_(Z),Z=Bi(S)):(Z=Bi(S),K=Bi(N))}}(i,s,$i,h=>{a.push(this.Rn(e,t,r,h))},h=>{a.push(this.Pn(e,t,r,h))}),x.waitFor(a)}Tn(e){let t=1;return fu(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((a,h)=>$i(a,h)).filter((a,h,d)=>!h||0!==$i(a,d[h-1]));const i=[];i.push(e);for(const a of r){const h=$i(a,e),d=$i(a,t);if(0===h)i[0]=e.Je();else if(h>0&&d<0)i.push(a),i.push(a.Je());else if(d>0)break}i.push(t);const s=[];for(let a=0;a<i.length;a+=2){if(this.bn(i[a],i[a+1]))return[];s.push(IDBKeyRange.bound([i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Gl,[]],[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Gl,[]]))}return s}bn(e,t){return $i(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Gm)}getMinOffset(e,t){return x.mapArray(this.cn(t),r=>this.an(e,r).next(i=>i||J())).next(Gm)}}function Zm(n){return gt(n,"collectionParents")}function du(n){return gt(n,"indexEntries")}function ql(n){return gt(n,"indexConfiguration")}function fu(n){return gt(n,"indexState")}function Gm(n){te(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;Vs(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Xt(e.readTime,e.documentKey,t)}const qm={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class $t{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new $t(e,$t.DEFAULT_COLLECTION_PERCENTILE,$t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function jm(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId);let h=0;const d=r.X({range:a},(y,_,S)=>(h++,S.delete()));s.push(d.next(()=>{te(1===h)}));const m=[];for(const y of t.mutations){const _=Tl(e,y.key.path,t.batchId);s.push(i.delete(_)),m.push(y.key)}return x.waitFor(s).next(()=>m)}function jl(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw J();e=n.noDocument}return JSON.stringify(e).length}$t.DEFAULT_COLLECTION_PERCENTILE=10,$t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$t.DEFAULT=new $t(41943040,$t.DEFAULT_COLLECTION_PERCENTILE,$t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$t.DISABLED=new $t(-1,0,0);class $l{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Vn={}}static de(e,t,r,i){te(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new $l(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ki(e).X({index:"userMutationsIndex",range:r},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=Sa(e),a=Ki(e);return a.add({}).next(h=>{te("number"==typeof h);const d=new Nd(h,t,r,i),m=function(S,N,Z){const K=Z.baseMutations.map(oe=>cu(S.fe,oe)),H=Z.mutations.map(oe=>cu(S.fe,oe));return{userId:N,batchId:Z.batchId,localWriteTimeMs:Z.localWriteTime.toMillis(),baseMutations:K,mutations:H}}(this.serializer,this.userId,d),y=[];let _=new Ue((S,N)=>le(S.canonicalString(),N.canonicalString()));for(const S of i){const N=Tl(this.userId,S.key.path,h);_=_.add(S.key.path.popLast()),y.push(a.put(m)),y.push(s.put(N,dd))}return _.forEach(S=>{y.push(this.indexManager.addToCollectionParentIndex(e,S))}),e.addOnCommittedListener(()=>{this.Vn[h]=d.keys()}),x.waitFor(y).next(()=>d)})}lookupMutationBatch(e,t){return Ki(e).get(t).next(r=>r?(te(r.userId===this.userId),Qs(this.serializer,r)):null)}Sn(e,t){return this.Vn[t]?x.resolve(this.Vn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Vn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Ki(e).X({index:"userMutationsIndex",range:i},(a,h,d)=>{h.userId===this.userId&&(te(h.batchId>=r),s=Qs(this.serializer,h)),d.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Ki(e).X({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{r=s.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ki(e).j("userMutationsIndex",t).next(r=>r.map(i=>Qs(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Gs(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Sa(e).X({range:i},(a,h,d)=>{const[m,y,_]=a,S=en(y);if(m===this.userId&&t.path.isEqual(S))return Ki(e).get(_).next(N=>{if(!N)throw J();te(N.userId===this.userId),s.push(Qs(this.serializer,N))});d.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ue(le);const i=[];return t.forEach(s=>{const a=Gs(this.userId,s.path),h=IDBKeyRange.lowerBound(a),d=Sa(e).X({range:h},(m,y,_)=>{const[S,N,Z]=m,K=en(N);S===this.userId&&s.path.isEqual(K)?r=r.add(Z):_.done()});i.push(d)}),x.waitFor(i).next(()=>this.Dn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=Gs(this.userId,r),a=IDBKeyRange.lowerBound(s);let h=new Ue(le);return Sa(e).X({range:a},(d,m,y)=>{const[_,S,N]=d,Z=en(S);_===this.userId&&r.isPrefixOf(Z)?Z.length===i&&(h=h.add(N)):y.done()}).next(()=>this.Dn(e,h))}Dn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(Ki(e).get(s).next(a=>{if(null===a)throw J();te(a.userId===this.userId),r.push(Qs(this.serializer,a))}))}),x.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return jm(e.ht,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Cn(t.batchId)}),x.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Cn(e){delete this.Vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return x.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return Sa(e).X({range:r},(s,a,h)=>{if(s[0]===this.userId){const d=en(s[1]);i.push(d)}else h.done()}).next(()=>{te(0===i.length)})})}containsKey(e,t){return $m(e,this.userId,t)}xn(e){return Km(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function $m(n,e,t){const r=Gs(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let a=!1;return Sa(n).X({range:s,Y:!0},(h,d,m)=>{const[y,_,S]=h;y===e&&_===i&&(a=!0),m.done()}).next(()=>a)}function Ki(n){return gt(n,"mutations")}function Sa(n){return gt(n,"documentMutations")}function Km(n){return gt(n,"mutationQueues")}class Xs{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new Xs(0)}static Mn(){return new Xs(-1)}}class k_{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.$n(e).next(t=>{const r=new Xs(t.highestTargetId);return t.highestTargetId=r.next(),this.On(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.$n(e).next(t=>ie.fromTimestamp(new je(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.$n(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.$n(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.On(e,i)))}addTargetData(e,t){return this.Fn(e,t).next(()=>this.$n(e).next(r=>(r.targetCount+=1,this.Bn(t,r),this.On(e,r))))}updateTargetData(e,t){return this.Fn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ca(e).delete(t.targetId)).next(()=>this.$n(e)).next(r=>(te(r.targetCount>0),r.targetCount-=1,this.On(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return Ca(e).X((a,h)=>{const d=uu(h);d.sequenceNumber<=t&&null===r.get(d.targetId)&&(i++,s.push(this.removeTargetData(e,d)))}).next(()=>x.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Ca(e).X((r,i)=>{const s=uu(i);t(s)})}$n(e){return Hm(e).get("targetGlobalKey").next(t=>(te(null!==t),t))}On(e,t){return Hm(e).put("targetGlobalKey",t)}Fn(e,t){return Ca(e).put(Nm(this.serializer,t))}Bn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.$n(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Q(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return Ca(e).X({range:i,index:"queryTargetsIndex"},(a,h,d)=>{const m=uu(h);Ve(t,m.target)&&(s=m,d.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=Hi(e);return t.forEach(a=>{const h=Lt(a.path);i.push(s.put({targetId:r,path:h})),i.push(this.referenceDelegate.addReference(e,r,a))}),x.waitFor(i)}removeMatchingKeys(e,t,r){const i=Hi(e);return x.forEach(t,s=>{const a=Lt(s.path);return x.waitFor([i.delete([r,a]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=Hi(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Hi(e);let s=ge();return i.X({range:r,Y:!0},(a,h,d)=>{const m=en(a[1]),y=new j(m);s=s.add(y)}).next(()=>s)}containsKey(e,t){const r=Lt(t.path),i=IDBKeyRange.bound([r],[ra(r)],!1,!0);let s=0;return Hi(e).X({index:"documentTargetsIndex",Y:!0,range:i},([a,h],d,m)=>{0!==a&&(s++,m.done())}).next(()=>s>0)}le(e,t){return Ca(e).get(t).next(r=>r?uu(r):null)}}function Ca(n){return gt(n,"targets")}function Hm(n){return gt(n,"targetGlobal")}function Hi(n){return gt(n,"targetDocuments")}function Wm([n,e],[t,r]){const i=le(n,t);return 0===i?le(e,r):i}class O_{constructor(e){this.Ln=e,this.buffer=new Ue(Wm),this.qn=0}Un(){return++this.qn}Kn(e){const t=[e,this.Un()];if(this.buffer.size<this.Ln)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Wm(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Qm{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Qn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}Qn(e){var t=this;V("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,b.Z)(function*(){t.Gn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){yr(r)?V("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield gr(r)}yield t.Qn(3e5)}))}}class D_{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.zn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return x.resolve(Gt.ct);const r=new O_(t);return this.jn.forEachTarget(e,i=>r.Kn(i.sequenceNumber)).next(()=>this.jn.Wn(e,i=>r.Kn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector","Garbage collection skipped; disabled"),x.resolve(qm)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),qm):this.Hn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Hn(e,t){let r,i,s,a,h,d,m;const y=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(_=>(_>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),i=this.params.maximumSequenceNumbersToCollect):i=_,a=Date.now(),this.nthSequenceNumber(e,i))).next(_=>(r=_,h=Date.now(),this.removeTargets(e,r,t))).next(_=>(s=_,d=Date.now(),this.removeOrphanedDocuments(e,r))).next(_=>(m=Date.now(),Ls()<=de.in.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-y}ms\n\tDetermined least recently used ${i} in `+(h-a)+`ms\n\tRemoved ${s} targets in `+(d-h)+`ms\n\tRemoved ${_} documents in `+(m-d)+`ms\nTotal Duration: ${m-y}ms`),x.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:_})))}}class N_{constructor(e,t){this.db=e,this.garbageCollector=function Ym(n,e){return new D_(n,e)}(this,t)}zn(e){const t=this.Jn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Jn(e){let t=0;return this.Wn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Wn(e,t){return this.Yn(e,(r,i)=>t(i))}addReference(e,t,r){return Kl(e,r)}removeReference(e,t,r){return Kl(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Kl(e,t)}Xn(e,t){return function(r,i){let s=!1;return Km(r).Z(a=>$m(r,a,i).next(h=>(h&&(s=!0),x.resolve(!h)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Yn(e,(a,h)=>{if(h<=t){const d=this.Xn(e,a).next(m=>{if(!m)return s++,r.getEntry(e,a).next(()=>(r.removeEntry(a,ie.min()),Hi(e).delete([0,Lt(a.path)])))});i.push(d)}}).next(()=>x.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Kl(e,t)}Yn(e,t){const r=Hi(e);let i,s=Gt.ct;return r.X({index:"documentTargetsIndex"},([a,h],{path:d,sequenceNumber:m})=>{0===a?(s!==Gt.ct&&t(new j(en(i)),s),s=m,i=d):s=Gt.ct}).next(()=>{s!==Gt.ct&&t(new j(en(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Kl(n,e){return Hi(n).put((r=n.currentSequenceNumber,{targetId:0,path:Lt(e.path),sequenceNumber:r}));var r}class Jm{constructor(){this.changes=new ci(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,qe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?x.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class R_{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return eo(e).put(r)}removeEntry(e,t,r){return eo(e).delete(function(i,s){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Bl(s),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Zn(e,r)))}getEntry(e,t){let r=qe.newInvalidDocument(t);return eo(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(pu(t))},(i,s)=>{r=this.ts(t,s)}).next(()=>r)}es(e,t){let r={size:0,document:qe.newInvalidDocument(t)};return eo(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(pu(t))},(i,s)=>{r={document:this.ts(t,s),size:jl(s)}}).next(()=>r)}getEntries(e,t){let r=fn();return this.ns(e,t,(i,s)=>{const a=this.ts(i,s);r=r.insert(i,a)}).next(()=>r)}ss(e,t){let r=fn(),i=new Le(j.comparator);return this.ns(e,t,(s,a)=>{const h=this.ts(s,a);r=r.insert(s,h),i=i.insert(s,jl(a))}).next(()=>({documents:r,rs:i}))}ns(e,t,r){if(t.isEmpty())return x.resolve();let i=new Ue(ng);t.forEach(d=>i=i.add(d));const s=IDBKeyRange.bound(pu(i.first()),pu(i.last())),a=i.getIterator();let h=a.getNext();return eo(e).X({index:"documentKeyIndex",range:s},(d,m,y)=>{const _=j.fromSegments([...m.prefixPath,m.collectionGroup,m.documentId]);for(;h&&ng(h,_)<0;)r(h,null),h=a.getNext();h&&h.isEqual(_)&&(r(h,m),h=a.hasNext()?a.getNext():null),h?y.G(pu(h)):y.done()}).next(()=>{for(;h;)r(h,null),h=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,r,i){const s=t.path,a=[s.popLast().toArray(),s.lastSegment(),Bl(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],h=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return eo(e).j(IDBKeyRange.bound(a,h,!0)).next(d=>{let m=fn();for(const y of d){const _=this.ts(j.fromSegments(y.prefixPath.concat(y.collectionGroup,y.documentId)),y);_.isFoundDocument()&&(Jc(t,_)||i.has(_.key))&&(m=m.insert(_.key,_))}return m})}getAllFromCollectionGroup(e,t,r,i){let s=fn();const a=tg(t,r),h=tg(t,Xt.max());return eo(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,h,!0)},(d,m,y)=>{const _=this.ts(j.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);s=s.insert(_.key,_),s.size===i&&y.done()}).next(()=>s)}newChangeBuffer(e){return new P_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return eg(e).get("remoteDocumentGlobalKey").next(t=>(te(!!t),t))}Zn(e,t){return eg(e).put("remoteDocumentGlobalKey",t)}ts(e,t){if(t){const r=function v_(n,e){let t;if(e.document)t=bm(n.fe,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=j.fromSegments(e.noDocument.path),i=Ws(e.noDocument.readTime);t=qe.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return J();{const r=j.fromSegments(e.unknownDocument.path),i=Ws(e.unknownDocument.version);t=qe.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(r){const i=new je(r[0],r[1]);return ie.fromTimestamp(i)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual(ie.min()))return r}return qe.newInvalidDocument(e)}}function Xm(n){return new R_(n)}class P_ extends Jm{constructor(e,t){super(),this.os=e,this.trackRemovals=t,this.us=new ci(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new Ue((s,a)=>le(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{const h=this.us.get(s);if(t.push(this.os.removeEntry(e,s,h.readTime)),a.isValidDocument()){const d=Dm(this.os.serializer,a);i=i.add(s.path.popLast());const m=jl(d);r+=m-h.size,t.push(this.os.addEntry(e,s,d))}else if(r-=h.size,this.trackRemovals){const d=Dm(this.os.serializer,a.convertToNoDocument(ie.min()));t.push(this.os.addEntry(e,s,d))}}),i.forEach(s=>{t.push(this.os.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.os.updateMetadata(e,r)),x.waitFor(t)}getFromCache(e,t){return this.os.es(e,t).next(r=>(this.us.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.os.ss(e,t).next(({documents:r,rs:i})=>(i.forEach((s,a)=>{this.us.set(s,{size:a,readTime:r.get(s).readTime})}),r))}}function eg(n){return gt(n,"remoteDocumentGlobal")}function eo(n){return gt(n,"remoteDocumentsV14")}function pu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function tg(n,e){const t=e.documentKey.path.toArray();return[n,Bl(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function ng(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=le(t[s],r[s]),i)return i;return i=le(t.length,r.length),i||(i=le(t[t.length-2],r[r.length-2]),i||le(t[t.length-1],r[r.length-1]))}class M_{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class rg{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&nu(r.mutation,i,qt.empty(),je.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ge()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ge()){const i=Tr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=Xc();return s.forEach((h,d)=>{a=a.insert(h,d.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=Tr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ge()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,h)=>{t.set(a,h)})})}computeViews(e,t,r,i){let s=fn();const a=eu(),h=eu();return t.forEach((d,m)=>{const y=r.get(m.key);i.has(m.key)&&(void 0===y||y.mutation instanceof ui)?s=s.insert(m.key,m):void 0!==y?(a.set(m.key,y.mutation.getFieldMask()),nu(y.mutation,m,y.mutation.getFieldMask(),je.now())):a.set(m.key,qt.empty())}),this.recalculateAndSaveOverlays(e,s).next(d=>(d.forEach((m,y)=>a.set(m,y)),t.forEach((m,y)=>{var _;return h.set(m,new M_(y,null!==(_=a.get(m))&&void 0!==_?_:null))}),h))}recalculateAndSaveOverlays(e,t){const r=eu();let i=new Le((a,h)=>a-h),s=ge();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const h of a)h.keys().forEach(d=>{const m=t.get(d);if(null===m)return;let y=r.get(d)||qt.empty();y=h.applyToLocalView(m,y),r.set(d,y);const _=(i.get(h.batchId)||ge()).add(d);i=i.insert(h.batchId,_)})}).next(()=>{const a=[],h=i.getReverseIterator();for(;h.hasNext();){const d=h.getNext(),m=d.key,y=d.value,_=Wp();y.forEach(S=>{if(!s.has(S)){const N=im(t.get(S),r.get(S));null!==N&&_.set(S,N),s=s.add(S)}}),a.push(this.documentOverlayCache.saveOverlays(e,m,_))}return x.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return j.isDocumentKey((i=t).path)&&null===i.collectionGroup&&0===i.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):_a(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r);var i}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):x.resolve(Tr());let h=-1,d=s;return a.next(m=>x.forEach(m,(y,_)=>(h<_.largestBatchId&&(h=_.largestBatchId),s.get(y)?x.resolve():this.remoteDocumentCache.getEntry(e,y).next(S=>{d=d.insert(y,S)}))).next(()=>this.populateOverlays(e,m,s)).next(()=>this.computeViews(e,d,m,ge())).next(y=>({batchId:h,changes:Hp(y)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new j(t)).next(r=>{let i=Xc();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const i=t.collectionGroup;let s=Xc();return this.indexManager.getCollectionParents(e,i).next(a=>x.forEach(a,h=>{const d=(m=t,y=h.child(i),new Un(y,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt));var m,y;return this.getDocumentsMatchingCollectionQuery(e,d,r).next(m=>{m.forEach((y,_)=>{s=s.insert(y,_)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i))).next(s=>{i.forEach((h,d)=>{const m=d.getKey();null===s.get(m)&&(s=s.insert(m,qe.newInvalidDocument(m)))});let a=Xc();return s.forEach((h,d)=>{const m=i.get(h);void 0!==m&&nu(m.mutation,d,qt.empty(),je.now()),Jc(t,d)&&(a=a.insert(h,d))}),a})}}class L_{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return x.resolve(this.cs.get(t))}saveBundleMetadata(e,t){var r;return this.cs.set(t.id,{id:(r=t).id,version:r.version,createTime:ut(r.createTime)}),x.resolve()}getNamedQuery(e,t){return x.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,{name:(r=t).name,query:Zd(r.bundledQuery),readTime:ut(r.readTime)}),x.resolve();var r}}class F_{constructor(){this.overlays=new Le(j.comparator),this.ls=new Map}getOverlay(e,t){return x.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Tr();return x.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.we(e,t,s)}),x.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.ls.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.ls.delete(r)),x.resolve()}getOverlaysForCollection(e,t,r){const i=Tr(),s=t.length+1,a=new j(t.child("")),h=this.overlays.getIteratorFrom(a);for(;h.hasNext();){const d=h.getNext().value,m=d.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===s&&d.largestBatchId>r&&i.set(d.getKey(),d)}return x.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Le((m,y)=>m-y);const a=this.overlays.getIterator();for(;a.hasNext();){const m=a.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>r){let y=s.get(m.largestBatchId);null===y&&(y=Tr(),s=s.insert(m.largestBatchId,y)),y.set(m.getKey(),m)}}const h=Tr(),d=s.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((m,y)=>h.set(m,y)),!(h.size()>=i)););return x.resolve(h)}we(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const a=this.ls.get(i.largestBatchId).delete(r.key);this.ls.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Pd(t,r));let s=this.ls.get(t);void 0===s&&(s=ge(),this.ls.set(t,s)),this.ls.set(t,s.add(r.key))}}class Wd{constructor(){this.fs=new Ue(kt.ds),this.ws=new Ue(kt._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){const r=new kt(e,t);this.fs=this.fs.add(r),this.ws=this.ws.add(r)}gs(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.ys(new kt(e,t))}ps(e,t){e.forEach(r=>this.removeReference(r,t))}Is(e){const t=new j(new we([])),r=new kt(t,e),i=new kt(t,e+1),s=[];return this.ws.forEachInRange([r,i],a=>{this.ys(a),s.push(a.key)}),s}Ts(){this.fs.forEach(e=>this.ys(e))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const t=new j(new we([])),r=new kt(t,e),i=new kt(t,e+1);let s=ge();return this.ws.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new kt(e,0),r=this.fs.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class kt{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return j.comparator(e.key,t.key)||le(e.As,t.As)}static _s(e,t){return le(e.As,t.As)||j.comparator(e.key,t.key)}}class U_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new Ue(kt.ds)}checkEmpty(e){return x.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.vs;this.vs++;const a=new Nd(s,t,r,i);this.mutationQueue.push(a);for(const h of i)this.Rs=this.Rs.add(new kt(h.key,s)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return x.resolve(a)}lookupMutationBatch(e,t){return x.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.bs(t+1),s=i<0?0:i;return x.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return x.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return x.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new kt(t,0),i=new kt(t,Number.POSITIVE_INFINITY),s=[];return this.Rs.forEachInRange([r,i],a=>{const h=this.Ps(a.As);s.push(h)}),x.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ue(le);return t.forEach(i=>{const s=new kt(i,0),a=new kt(i,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([s,a],h=>{r=r.add(h.As)})}),x.resolve(this.Vs(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;j.isDocumentKey(s)||(s=s.child(""));const a=new kt(new j(s),0);let h=new Ue(le);return this.Rs.forEachWhile(d=>{const m=d.key.path;return!!r.isPrefixOf(m)&&(m.length===i&&(h=h.add(d.As)),!0)},a),x.resolve(this.Vs(h))}Vs(e){const t=[];return e.forEach(r=>{const i=this.Ps(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){te(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();let r=this.Rs;return x.forEach(t.mutations,i=>{const s=new kt(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Rs=r})}Cn(e){}containsKey(e,t){const r=new kt(t,0),i=this.Rs.firstAfterOrEqual(r);return x.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return x.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){const t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class V_{constructor(e){this.Ds=e,this.docs=new Le(j.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.Ds(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return x.resolve(r?r.document.mutableCopy():qe.newInvalidDocument(t))}getEntries(e,t){let r=fn();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():qe.newInvalidDocument(i))}),x.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=fn();const a=t.path,h=new j(a.child("")),d=this.docs.getIteratorFrom(h);for(;d.hasNext();){const{key:m,value:{document:y}}=d.getNext();if(!a.isPrefixOf(m.path))break;m.path.length>a.length+1||Vs(vl(y),r)<=0||(i.has(y.key)||Jc(t,y))&&(s=s.insert(y.key,y.mutableCopy()))}return x.resolve(s)}getAllFromCollectionGroup(e,t,r,i){J()}Cs(e,t){return x.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new B_(this)}getSize(e){return x.resolve(this.size)}}class B_ extends Jm{constructor(e){super(),this.os=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.os.addEntry(e,i)):this.os.removeEntry(r)}),x.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class z_{constructor(e){this.persistence=e,this.xs=new ci(t=>Q(t),Ve),this.lastRemoteSnapshotVersion=ie.min(),this.highestTargetId=0,this.Ns=0,this.ks=new Wd,this.targetCount=0,this.Ms=Xs.kn()}forEachTarget(e,t){return this.xs.forEach((r,i)=>t(i)),x.resolve()}getLastRemoteSnapshotVersion(e){return x.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return x.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),x.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Ns&&(this.Ns=t),x.resolve()}Fn(e){this.xs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ms=new Xs(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,x.resolve()}updateTargetData(e,t){return this.Fn(t),x.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,x.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.xs.forEach((a,h)=>{h.sequenceNumber<=t&&null===r.get(h.targetId)&&(this.xs.delete(a),s.push(this.removeMatchingKeysForTargetId(e,h.targetId)),i++)}),x.waitFor(s).next(()=>i)}getTargetCount(e){return x.resolve(this.targetCount)}getTargetData(e,t){const r=this.xs.get(t)||null;return x.resolve(r)}addMatchingKeys(e,t,r){return this.ks.gs(t,r),x.resolve()}removeMatchingKeys(e,t,r){this.ks.ps(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),x.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),x.resolve()}getMatchingKeysForTargetId(e,t){const r=this.ks.Es(t);return x.resolve(r)}containsKey(e,t){return x.resolve(this.ks.containsKey(t))}}class Qd{constructor(e,t){this.$s={},this.overlays={},this.Os=new Gt(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new z_(this),this.indexManager=new x_,this.remoteDocumentCache=new V_(r=>this.referenceDelegate.Ls(r)),this.serializer=new Om(t),this.qs=new L_(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new F_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.$s[e.toKey()];return r||(r=new U_(t,this.referenceDelegate),this.$s[e.toKey()]=r),r}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,r){V("MemoryPersistence","Starting transaction:",e);const i=new Z_(this.Os.next());return this.referenceDelegate.Us(),r(i).next(s=>this.referenceDelegate.Ks(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gs(e,t){return x.or(Object.values(this.$s).map(r=>()=>r.containsKey(e,t)))}}class Z_ extends wl{constructor(e){super(),this.currentSequenceNumber=e}}class Hl{constructor(e){this.persistence=e,this.Qs=new Wd,this.js=null}static zs(e){return new Hl(e)}get Ws(){if(this.js)return this.js;throw J()}addReference(e,t,r){return this.Qs.addReference(r,t),this.Ws.delete(r.toString()),x.resolve()}removeReference(e,t,r){return this.Qs.removeReference(r,t),this.Ws.add(r.toString()),x.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),x.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach(i=>this.Ws.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Ws.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Us(){this.js=new Set}Ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return x.forEach(this.Ws,r=>{const i=j.fromPath(r);return this.Hs(e,i).next(s=>{s||t.removeEntry(i,ie.min())})}).next(()=>(this.js=null,t.apply(e)))}updateLimboDocument(e,t){return this.Hs(e,t).next(r=>{r?this.Ws.delete(t.toString()):this.Ws.add(t.toString())})}Ls(e){return 0}Hs(e,t){return x.or([()=>x.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class G_{constructor(e){this.serializer=e}O(e,t,r,i){const s=new Bs("createOrUpgrade",t);var h;r<1&&i>=1&&(e.createObjectStore("owner"),(h=e).createObjectStore("mutationQueues",{keyPath:"userId"}),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Fc,{unique:!0}),h.createObjectStore("documentMutations"),ig(e),function(h){h.createObjectStore("remoteDocuments")}(e));let a=x.resolve();return r<3&&i>=3&&(0!==r&&(function(h){h.deleteObjectStore("targetDocuments"),h.deleteObjectStore("targets"),h.deleteObjectStore("targetGlobal")}(e),ig(e)),a=a.next(()=>function(h){const d=h.store("targetGlobal"),m={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ie.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",m)}(s))),r<4&&i>=4&&(0!==r&&(a=a.next(()=>function(h,d){return d.store("mutations").j().next(m=>{h.deleteObjectStore("mutations"),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Fc,{unique:!0});const y=d.store("mutations"),_=m.map(S=>y.put(S));return x.waitFor(_)})}(e,s))),a=a.next(()=>{!function(h){h.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(a=a.next(()=>this.Ys(s))),r<6&&i>=6&&(a=a.next(()=>(function(h){h.createObjectStore("remoteDocumentGlobal")}(e),this.Xs(s)))),r<7&&i>=7&&(a=a.next(()=>this.Zs(s))),r<8&&i>=8&&(a=a.next(()=>this.ti(e,s))),r<9&&i>=9&&(a=a.next(()=>{!function(h){h.objectStoreNames.contains("remoteDocumentChanges")&&h.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(a=a.next(()=>this.ei(s))),r<11&&i>=11&&(a=a.next(()=>{(function(h){h.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(h){h.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(a=a.next(()=>{!function(h){const d=h.createObjectStore("documentOverlays",{keyPath:Vc});d.createIndex("collectionPathOverlayIndex",Id,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",wd,{unique:!1})}(e)})),r<13&&i>=13&&(a=a.next(()=>function(h){const d=h.createObjectStore("remoteDocumentsV14",{keyPath:fd});d.createIndex("documentKeyIndex",pd),d.createIndex("collectionGroupIndex",md)}(e)).next(()=>this.ni(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(a=a.next(()=>this.si(e,s))),r<15&&i>=15&&(a=a.next(()=>function(h){h.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),h.createObjectStore("indexState",{keyPath:yd}).createIndex("sequenceNumberIndex",_d,{unique:!1}),h.createObjectStore("indexEntries",{keyPath:Uc}).createIndex("documentKeyIndex",vd,{unique:!1})}(e))),a}Xs(e){let t=0;return e.store("remoteDocuments").X((r,i)=>{t+=jl(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Ys(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.j().next(i=>x.forEach(i,s=>{const a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.j("userMutationsIndex",a).next(h=>x.forEach(h,d=>{te(d.userId===s.userId);const m=Qs(this.serializer,d);return jm(e,s.userId,m).next(()=>{})}))}))}Zs(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.X((a,h)=>{const d=new we(a),m=[0,Lt(d)];s.push(t.get(m).next(y=>y?x.resolve():t.put({targetId:0,path:Lt(d),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>x.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:ti});const r=t.store("collectionParents"),i=new Hd,s=a=>{if(i.add(a)){const h=a.lastSegment(),d=a.popLast();return r.put({collectionId:h,parent:Lt(d)})}};return t.store("remoteDocuments").X({Y:!0},(a,h)=>{const d=new we(a);return s(d.popLast())}).next(()=>t.store("documentMutations").X({Y:!0},([a,h,d],m)=>{const y=en(h);return s(y.popLast())}))}ei(e){const t=e.store("targets");return t.X((r,i)=>{const s=uu(i),a=Nm(this.serializer,s);return t.put(a)})}ni(e,t){const r=t.store("remoteDocuments"),i=[];return r.X((s,a)=>{const h=t.store("remoteDocumentsV14"),d=(m=a,m.document?new j(we.fromString(m.document.name).popFirst(5)):m.noDocument?j.fromSegments(m.noDocument.path):m.unknownDocument?j.fromSegments(m.unknownDocument.path):J()).path.toArray();var m;const y={prefixPath:d.slice(0,d.length-2),collectionGroup:d[d.length-2],documentId:d[d.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(h.put(y))}).next(()=>x.waitFor(i))}si(e,t){const r=t.store("mutations"),i=Xm(this.serializer),s=new Qd(Hl.zs,this.serializer.fe);return r.j().next(a=>{const h=new Map;return a.forEach(d=>{var m;let y=null!==(m=h.get(d.userId))&&void 0!==m?m:ge();Qs(this.serializer,d).keys().forEach(_=>y=y.add(_)),h.set(d.userId,y)}),x.forEach(h,(d,m)=>{const y=new mt(m),_=zl.de(this.serializer,y),S=s.getIndexManager(y),N=$l.de(y,this.serializer,S,s.referenceDelegate);return new rg(i,N,_,S).recalculateAndSaveOverlaysForDocumentKeys(new Bc(t,Gt.ct),d).next()})})}}function ig(n){n.createObjectStore("targetDocuments",{keyPath:gd}).createIndex("documentTargetsIndex",Gp,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",bl,{unique:!0}),n.createObjectStore("targetGlobal")}const Yd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Jd{constructor(e,t,r,i,s,a,h,d,m,y,_=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ii=s,this.window=a,this.document=h,this.ri=m,this.oi=y,this.ui=_,this.Os=null,this.Fs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.ai=null,this.hi=null,this.li=Number.NEGATIVE_INFINITY,this.fi=S=>Promise.resolve(),!Jd.D())throw new L(O.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new N_(this,i),this.di=t+"main",this.serializer=new Om(d),this.wi=new yn(this.di,this.ui,new G_(this.serializer)),this.Bs=new k_(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Xm(this.serializer),this.qs=new I_,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===y&&He("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new L(O.FAILED_PRECONDITION,Yd);return this.gi(),this.yi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Bs.getHighestSequenceNumber(e))}).then(e=>{this.Os=new Gt(e,this.ri)}).then(()=>{this.Fs=!0}).catch(e=>(this.wi&&this.wi.close(),Promise.reject(e)))}Ii(e){var t=this;return this.fi=function(){var r=(0,b.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.wi.B(function(){var t=(0,b.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ii.enqueueAndForget((0,b.Z)(function*(){t.started&&(yield t.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ql(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ti(e).next(t=>{t||(this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.fi(!1)))})}).next(()=>this.Ei(e)).next(t=>this.isPrimary&&!t?this.Ai(e).next(()=>!1):!!t&&this.vi(e).next(()=>!0))).catch(e=>{if(yr(e))return V("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return V("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ii.enqueueRetryable(()=>this.fi(e)),this.isPrimary=e})}Ti(e){return mu(e).get("owner").next(t=>x.resolve(this.Ri(t)))}Pi(e){return Ql(e).delete(this.clientId)}bi(){var e=this;return(0,b.Z)(function*(){if(e.isPrimary&&!e.Vi(e.li,18e5)){e.li=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=gt(r,"clientMetadata");return i.j().next(s=>{const a=e.Si(s,18e5),h=s.filter(d=>-1===a.indexOf(d));return x.forEach(h,d=>i.delete(d.clientId)).next(()=>h)})}).catch(()=>[]);if(e._i)for(const r of t)e._i.removeItem(e.Di(r.clientId))}})()}pi(){this.hi=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.bi()).then(()=>this.pi()))}Ri(e){return!!e&&e.ownerId===this.clientId}Ei(e){return this.oi?x.resolve(!0):mu(e).get("owner").next(t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)){if(this.Ri(t)&&this.networkEnabled)return!0;if(!this.Ri(t)){if(!t.allowTabSynchronization)throw new L(O.FAILED_PRECONDITION,Yd);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ql(e).j().next(r=>void 0===this.Si(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&V("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,b.Z)(function*(){e.Fs=!1,e.xi(),e.hi&&(e.hi.cancel(),e.hi=null),e.Ni(),e.ki(),yield e.wi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Bc(t,Gt.ct);return e.Ai(r).next(()=>e.Pi(r))}),e.wi.close(),e.Mi()})()}Si(e,t){return e.filter(r=>this.Vi(r.updateTimeMs,t)&&!this.Ci(r.clientId))}$i(){return this.runTransaction("getActiveClients","readonly",e=>Ql(e).j().next(t=>this.Si(t,18e5).map(r=>r.clientId)))}get started(){return this.Fs}getMutationQueue(e,t){return $l.de(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new A_(e,this.serializer.fe.databaseId)}getDocumentOverlayCache(e){return zl.de(this.serializer,e)}getBundleCache(){return this.qs}runTransaction(e,t,r){V("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=15===(a=this.ui)?Td:14===a?ca:13===a?Sl:12===a?Ed:11===a?aa:void J();var a;let h;return this.wi.runTransaction(e,i,s,d=>(h=new Bc(d,this.Os?this.Os.next():Gt.ct),"readwrite-primary"===t?this.Ti(h).next(m=>!!m||this.Ei(h)).next(m=>{if(!m)throw He(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.fi(!1)),new L(O.FAILED_PRECONDITION,Il);return r(h)}).next(m=>this.vi(h).next(()=>m)):this.Oi(h).next(()=>r(h)))).then(d=>(h.raiseOnCommittedEvent(),d))}Oi(e){return mu(e).get("owner").next(t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)&&!this.Ri(t)&&!(this.oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new L(O.FAILED_PRECONDITION,Yd)})}vi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return mu(e).put("owner",t)}static D(){return yn.D()}Ai(e){const t=mu(e);return t.get("owner").next(r=>this.Ri(r)?(V("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):x.resolve())}Vi(e,t){const r=Date.now();return!(e<r-t||e>r&&(He(`Detected an update time that is in the future: ${e} > ${r}`),1))}gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ai=()=>{this.ii.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.mi()))},this.document.addEventListener("visibilitychange",this.ai),this.inForeground="visible"===this.document.visibilityState)}Ni(){this.ai&&(this.document.removeEventListener("visibilitychange",this.ai),this.ai=null)}yi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const t=/(?:Version|Mobile)\/1[456]/;(0,se.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}ki(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Ci(e){var t;try{const r=null!==(null===(t=this._i)||void 0===t?void 0:t.getItem(this.Di(e)));return V("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return He("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this._i)try{this._i.setItem(this.Di(this.clientId),String(Date.now()))}catch(e){He("Failed to set zombie client id.",e)}}Mi(){if(this._i)try{this._i.removeItem(this.Di(this.clientId))}catch{}}Di(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function mu(n){return gt(n,"owner")}function Ql(n){return gt(n,"clientMetadata")}function Xd(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class ef{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Fi=r,this.Bi=i}static Li(e,t){let r=ge(),i=ge();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new ef(e,t.fromCache,r,i)}}class sg{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,r,i){return this.Ki(e,t).next(s=>s||this.Gi(e,t,i,r)).next(s=>s||this.Qi(e,t))}Ki(e,t){if(Wc(t))return x.resolve(null);let r=St(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Pl(t,null,"F"),r=St(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const a=ge(...s);return this.Ui.getDocuments(e,a).next(h=>this.indexManager.getMinOffset(e,r).next(d=>{const m=this.ji(t,h);return this.zi(t,m,a,d.readTime)?this.Ki(e,Pl(t,null,"F")):this.Wi(e,m,t,d)}))})))}Gi(e,t,r,i){return Wc(t)||i.isEqual(ie.min())?this.Qi(e,t):this.Ui.getDocuments(e,r).next(s=>{const a=this.ji(t,s);return this.zi(t,a,r,i)?this.Qi(e,t):(Ls()<=de.in.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),kd(t)),this.Wi(e,a,t,_l(i,-1)))})}ji(e,t){let r=new Ue($p(e));return t.forEach((i,s)=>{Jc(e,s)&&(r=r.add(s))}),r}zi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Qi(e,t){return Ls()<=de.in.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",kd(t)),this.Ui.getDocumentsMatchingQuery(e,t,Xt.min())}Wi(e,t,r,i){return this.Ui.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}class q_{constructor(e,t,r,i){this.persistence=e,this.Hi=t,this.serializer=i,this.Ji=new Le(le),this.Yi=new ci(s=>Q(s),Ve),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(r)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new rg(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ji))}}function og(n,e,t,r){return new q_(n,e,t,r)}function ag(n,e){return tf.apply(this,arguments)}function tf(){return tf=(0,b.Z)(function*(n,e){const t=W(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.tr(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const a=[],h=[];let d=ge();for(const m of i){a.push(m.batchId);for(const y of m.mutations)d=d.add(y.key)}for(const m of s){h.push(m.batchId);for(const y of m.mutations)d=d.add(y.key)}return t.localDocuments.getDocuments(r,d).next(m=>({er:m,removedBatchIds:a,addedBatchIds:h}))})})}),tf.apply(this,arguments)}function cg(n){const e=W(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Bs.getLastRemoteSnapshotVersion(t))}function ug(n,e,t){let r=ge(),i=ge();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=fn();return t.forEach((h,d)=>{const m=s.get(h);d.isFoundDocument()!==m.isFoundDocument()&&(i=i.add(h)),d.isNoDocument()&&d.version.isEqual(ie.min())?(e.removeEntry(h,d.readTime),a=a.insert(h,d)):!m.isValidDocument()||d.version.compareTo(m.version)>0||0===d.version.compareTo(m.version)&&m.hasPendingWrites?(e.addEntry(d),a=a.insert(h,d)):V("LocalStore","Ignoring outdated watch update for ",h,". Current version:",m.version," Watch version:",d.version)}),{nr:a,sr:i}})}function K_(n,e){const t=W(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function xa(n,e){const t=W(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Bs.getTargetData(r,e).next(s=>s?(i=s,x.resolve(i)):t.Bs.allocateTargetId(r).next(a=>(i=new li(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Bs.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.Ji.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ji=t.Ji.insert(r.targetId,r),t.Yi.set(e,r.targetId)),r})}function Aa(n,e,t){return nf.apply(this,arguments)}function nf(){return nf=(0,b.Z)(function*(n,e,t){const r=W(n),i=r.Ji.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!yr(a))throw a;V("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ji=r.Ji.remove(e),r.Yi.delete(i.target)}),nf.apply(this,arguments)}function Yl(n,e,t){const r=W(n);let i=ie.min(),s=ge();return r.persistence.runTransaction("Execute query","readonly",a=>function(h,d,m){const y=W(h),_=y.Yi.get(m);return void 0!==_?x.resolve(y.Ji.get(_)):y.Bs.getTargetData(d,m)}(r,a,St(e)).next(h=>{if(h)return i=h.lastLimboFreeSnapshotVersion,r.Bs.getMatchingKeysForTargetId(a,h.targetId).next(d=>{s=d})}).next(()=>r.Hi.getDocumentsMatchingQuery(a,e,t?i:ie.min(),t?s:ge())).next(h=>(dg(r,jp(e),h),{documents:h,ir:s})))}function lg(n,e){const t=W(n),r=W(t.Bs),i=t.Ji.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.le(s,e).next(a=>a?a.target:null))}function hg(n,e){const t=W(n),r=t.Xi.get(e)||ie.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Zi.getAllFromCollectionGroup(i,e,_l(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(dg(t,e,i),i))}function dg(n,e,t){let r=n.Xi.get(e)||ie.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.Xi.set(e,r)}function rf(){return rf=(0,b.Z)(function*(n,e,t,r){const i=W(n);let s=ge(),a=fn();for(const m of t){const y=e.rr(m.metadata.name);m.document&&(s=s.add(y));const _=e.ur(m);_.setReadTime(e.cr(m.metadata.readTime)),a=a.insert(y,_)}const h=i.Zi.newChangeBuffer({trackRemovals:!0}),d=yield xa(i,(m=r,St(Er(we.fromString(`__bundle__/docs/${m}`)))));var m;return i.persistence.runTransaction("Apply bundle documents","readwrite",m=>ug(m,h,a).next(y=>(h.apply(m),y)).next(y=>i.Bs.removeMatchingKeysForTargetId(m,d.targetId).next(()=>i.Bs.addMatchingKeys(m,s,d.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(m,y.nr,y.sr)).next(()=>y.nr)))}),rf.apply(this,arguments)}function W_(n,e){return sf.apply(this,arguments)}function sf(){return sf=(0,b.Z)(function*(n,e,t=ge()){const r=yield xa(n,St(Zd(e.bundledQuery))),i=W(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const a=ut(e.readTime);if(r.snapshotVersion.compareTo(a)>=0)return i.qs.saveNamedQuery(s,e);const h=r.withResumeToken(ct.EMPTY_BYTE_STRING,a);return i.Ji=i.Ji.insert(h.targetId,h),i.Bs.updateTargetData(s,h).next(()=>i.Bs.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.Bs.addMatchingKeys(s,t,r.targetId)).next(()=>i.qs.saveNamedQuery(s,e))})}),sf.apply(this,arguments)}function fg(n,e){return`firestore_clients_${n}_${e}`}function pg(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function of(n,e){return`firestore_targets_${n}_${e}`}class Jl{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static ar(e,t,r){const i=JSON.parse(r);let s,a="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&(a="string"==typeof i.error.message&&"string"==typeof i.error.code,a&&(s=new L(i.error.code,i.error.message))),a?new Jl(e,t,i.state,s):(He("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}hr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class gu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static ar(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new L(r.error.code,r.error.message))),s?new gu(e,r.state,i):(He("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}hr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Xl{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static ar(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=Od();for(let a=0;i&&a<r.activeTargetIds.length;++a)i=El(r.activeTargetIds[a]),s=s.add(r.activeTargetIds[a]);return i?new Xl(e,s):(He("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class af{constructor(e,t){this.clientId=e,this.onlineState=t}static ar(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new af(t.clientId,t.onlineState):(He("SharedClientState",`Failed to parse online state: ${e}`),null)}}class cf{constructor(){this.activeTargetIds=Od()}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class uf{constructor(e,t,r,i,s){this.window=e,this.ii=t,this.persistenceKey=r,this.wr=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this._r=this.mr.bind(this),this.gr=new Le(le),this.started=!1,this.yr=[];const a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.pr=fg(this.persistenceKey,this.wr),this.Ir=`firestore_sequence_number_${this.persistenceKey}`,this.gr=this.gr.insert(this.wr,new cf),this.Tr=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Er=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ar=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.vr=`firestore_online_state_${this.persistenceKey}`,this.Rr=function(h){return`firestore_bundle_loaded_v2_${h}`}(this.persistenceKey),this.window.addEventListener("storage",this._r)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,b.Z)(function*(){const t=yield e.syncEngine.$i();for(const i of t){if(i===e.wr)continue;const s=e.getItem(fg(e.persistenceKey,i));if(s){const a=Xl.ar(i,s);a&&(e.gr=e.gr.insert(a.clientId,a))}}e.Pr();const r=e.storage.getItem(e.vr);if(r){const i=e.br(r);i&&e.Vr(i)}for(const i of e.yr)e.mr(i);e.yr=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Ir,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Sr(this.gr)}isActiveQueryTarget(e){let t=!1;return this.gr.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Dr(e,"pending")}updateMutationState(e,t,r){this.Dr(e,t,r),this.Cr(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(of(this.persistenceKey,e));if(r){const i=gu.ar(e,r);i&&(t=i.state)}}return this.Nr.lr(e),this.Pr(),t}removeLocalQueryTarget(e){this.Nr.dr(e),this.Pr()}isLocalQueryTarget(e){return this.Nr.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(of(this.persistenceKey,e))}updateQueryState(e,t,r){this.kr(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Cr(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Mr(e)}notifyBundleLoaded(e){this.$r(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this._r),this.removeItem(this.pr),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return V("SharedClientState","READ",e,t),t}setItem(e,t){V("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){V("SharedClientState","REMOVE",e),this.storage.removeItem(e)}mr(e){var t=this;const r=e;if(r.storageArea===this.storage){if(V("SharedClientState","EVENT",r.key,r.newValue),r.key===this.pr)return void He("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ii.enqueueRetryable((0,b.Z)(function*(){if(t.started){if(null!==r.key)if(t.Tr.test(r.key)){if(null==r.newValue){const i=t.Or(r.key);return t.Fr(i,null)}{const i=t.Br(r.key,r.newValue);if(i)return t.Fr(i.clientId,i)}}else if(t.Er.test(r.key)){if(null!==r.newValue){const i=t.Lr(r.key,r.newValue);if(i)return t.qr(i)}}else if(t.Ar.test(r.key)){if(null!==r.newValue){const i=t.Ur(r.key,r.newValue);if(i)return t.Kr(i)}}else if(r.key===t.vr){if(null!==r.newValue){const i=t.br(r.newValue);if(i)return t.Vr(i)}}else if(r.key===t.Ir){const i=function(s){let a=Gt.ct;if(null!=s)try{const h=JSON.parse(s);te("number"==typeof h),a=h}catch(h){He("SharedClientState","Failed to read sequence number from WebStorage",h)}return a}(r.newValue);i!==Gt.ct&&t.sequenceNumberHandler(i)}else if(r.key===t.Rr){const i=t.Gr(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Qr(s)))}}else t.yr.push(r)}))}}get Nr(){return this.gr.get(this.wr)}Pr(){this.setItem(this.pr,this.Nr.hr())}Dr(e,t,r){const i=new Jl(this.currentUser,e,t,r),s=pg(this.persistenceKey,this.currentUser,e);this.setItem(s,i.hr())}Cr(e){const t=pg(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Mr(e){this.storage.setItem(this.vr,JSON.stringify({clientId:this.wr,onlineState:e}))}kr(e,t,r){const i=of(this.persistenceKey,e),s=new gu(e,t,r);this.setItem(i,s.hr())}$r(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Rr,t)}Or(e){const t=this.Tr.exec(e);return t?t[1]:null}Br(e,t){const r=this.Or(e);return Xl.ar(r,t)}Lr(e,t){const r=this.Er.exec(e),i=Number(r[1]);return Jl.ar(new mt(void 0!==r[2]?r[2]:null),i,t)}Ur(e,t){const r=this.Ar.exec(e),i=Number(r[1]);return gu.ar(i,t)}br(e){return af.ar(e)}Gr(e){return JSON.parse(e)}qr(e){var t=this;return(0,b.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.jr(e.batchId,e.state,e.error);V("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Kr(e){return this.syncEngine.zr(e.targetId,e.state,e.error)}Fr(e,t){const r=t?this.gr.insert(e,t):this.gr.remove(e),i=this.Sr(this.gr),s=this.Sr(r),a=[],h=[];return s.forEach(d=>{i.has(d)||a.push(d)}),i.forEach(d=>{s.has(d)||h.push(d)}),this.syncEngine.Wr(a,h).then(()=>{this.gr=r})}Vr(e){this.gr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Sr(e){let t=Od();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class mg{constructor(){this.Hr=new cf,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,r){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new cf,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Q_{Yr(e){}shutdown(){}}class gg{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){V("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){V("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let eh=null;function lf(){return null===eh?eh=268435456+Math.round(2147483648*Math.random()):eh++,"0x"+eh.toString(16)}const Y_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class J_{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}const Kt="WebChannelConnection";class X_ extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.mo=(e.ssl?"https":"http")+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,r,i,s){const a=lf(),h=this.To(e,t);V("RestConnection",`Sending RPC '${e}' ${a}:`,h,r);const d={};return this.Eo(d,i,s),this.Ao(e,h,d,r).then(m=>(V("RestConnection",`Received RPC '${e}' ${a}: `,m),m),m=>{throw Jt("RestConnection",`RPC '${e}' ${a} failed with error: `,m,"url: ",h,"request:",r),m})}vo(e,t,r,i,s,a){return this.Io(e,t,r,i,s)}Eo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+mr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}To(e,t){return`${this.mo}/v1/${t}:${Y_[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,r,i){const s=lf();return new Promise((a,h)=>{const d=new xc;d.setWithCredentials(!0),d.listenOnce(Cc.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Sc.NO_ERROR:const y=d.getResponseJson();V(Kt,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(y)),a(y);break;case Sc.TIMEOUT:V(Kt,`RPC '${e}' ${s} timed out`),h(new L(O.DEADLINE_EXCEEDED,"Request time out"));break;case Sc.HTTP_ERROR:const _=d.getStatus();if(V(Kt,`RPC '${e}' ${s} failed with status:`,_,"response text:",d.getResponseText()),_>0){let S=d.getResponseJson();Array.isArray(S)&&(S=S[0]);const N=S?.error;if(N&&N.status&&N.message){const Z=function(K){const H=K.toLowerCase().replace(/_/g,"-");return Object.values(O).indexOf(H)>=0?H:O.UNKNOWN}(N.status);h(new L(Z,N.message))}else h(new L(O.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new L(O.UNAVAILABLE,"Connection failed."));break;default:J()}}finally{V(Kt,`RPC '${e}' ${s} completed.`)}});const m=JSON.stringify(i);V(Kt,`RPC '${e}' ${s} sending request:`,i),d.send(t,"POST",m,r,15)})}Ro(e,t,r){const i=lf(),s=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=pl(),h=Yh(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;void 0!==m&&(d.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(d.xmlHttpFactory=new Xh({})),this.Eo(d.initMessageHeaders,t,r),d.encodeInitMessageHeaders=!0;const y=s.join("");V(Kt,`Creating RPC '${e}' stream ${i}: ${y}`,d);const _=a.createWebChannel(y,d);let S=!1,N=!1;const Z=new J_({ro:H=>{N?V(Kt,`Not sending because RPC '${e}' stream ${i} is closed:`,H):(S||(V(Kt,`Opening RPC '${e}' stream ${i} transport.`),_.open(),S=!0),V(Kt,`RPC '${e}' stream ${i} sending:`,H),_.send(H))},oo:()=>_.close()}),K=(H,oe,ve)=>{H.listen(oe,fe=>{try{ve(fe)}catch(pe){setTimeout(()=>{throw pe},0)}})};return K(_,Ui.EventType.OPEN,()=>{N||V(Kt,`RPC '${e}' stream ${i} transport opened.`)}),K(_,Ui.EventType.CLOSE,()=>{N||(N=!0,V(Kt,`RPC '${e}' stream ${i} transport closed`),Z.wo())}),K(_,Ui.EventType.ERROR,H=>{N||(N=!0,Jt(Kt,`RPC '${e}' stream ${i} transport errored:`,H),Z.wo(new L(O.UNAVAILABLE,"The operation could not be completed")))}),K(_,Ui.EventType.MESSAGE,H=>{var oe;if(!N){const ve=H.data[0];te(!!ve);const pe=ve.error||(null===(oe=ve[0])||void 0===oe?void 0:oe.error);if(pe){V(Kt,`RPC '${e}' stream ${i} received error:`,pe);const Ae=pe.status;let Ie=function(pi){const qy=yt[pi];if(void 0!==qy)return lm(qy)}(Ae),Ht=pe.message;void 0===Ie&&(Ie=O.INTERNAL,Ht="Unknown error status: "+Ae+" with message "+pe.message),N=!0,Z.wo(new L(Ie,Ht)),_.close()}else V(Kt,`RPC '${e}' stream ${i} received:`,ve),Z._o(ve)}}),K(h,Jh.STAT_EVENT,H=>{H.stat===Xo.PROXY?V(Kt,`RPC '${e}' stream ${i} detected buffering proxy`):H.stat===Xo.NOPROXY&&V(Kt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{Z.fo()},0),Z}}function yg(){return typeof window<"u"?window:null}function th(){return typeof document<"u"?document:null}function yu(n){return new u_(n,!0)}class hf{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ii=e,this.timerId=t,this.Po=r,this.bo=i,this.Vo=s,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const t=Math.floor(this.So+this.ko()),r=Math.max(0,Date.now()-this.Co),i=Math.max(0,t-r);i>0&&V("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,i,()=>(this.Co=Date.now(),e())),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class _g{constructor(e,t,r,i,s,a,h,d){this.ii=e,this.$o=r,this.Oo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=h,this.listener=d,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new hf(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}stop(){var e=this;return(0,b.Z)(function*(){e.Uo()&&(yield e.close(0))})()}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,()=>this.zo()))}Wo(e){this.Ho(),this.stream.send(e)}zo(){var e=this;return(0,b.Z)(function*(){if(e.Ko())return e.close(0)})()}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}close(e,t){var r=this;return(0,b.Z)(function*(){r.Ho(),r.Jo(),r.qo.cancel(),r.Fo++,4!==e?r.qo.reset():t&&t.code===O.RESOURCE_EXHAUSTED?(He(t.toString()),He("Using maximum backoff delay to prevent overloading the backend."),r.qo.xo()):t&&t.code===O.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Yo(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.ao(t)})()}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Fo===t&&this.Zo(r,i)},r=>{e(()=>{const i=new L(O.UNKNOWN,"Fetching auth token failed: "+r.message);return this.tu(i)})})}Zo(e,t){const r=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo(()=>{r(()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,()=>(this.Ko()&&(this.state=3),Promise.resolve())),this.listener.uo()))}),this.stream.ao(i=>{r(()=>this.tu(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Go(){var e=this;this.state=5,this.qo.No((0,b.Z)(function*(){e.state=0,e.start()}))}tu(e){return V("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget(()=>this.Fo===e?t():(V("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ev extends _g{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();const t=function d_(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(d=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===d?1:"REMOVE"===d?2:"CURRENT"===d?3:"RESET"===d?4:J(),i=e.targetChange.targetIds||[],s=function(d,m){return d.useProto3Json?(te(void 0===m||"string"==typeof m),ct.fromBase64String(m||"")):(te(void 0===m||m instanceof Uint8Array),ct.fromUint8Array(m||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,h=a&&function(d){const m=void 0===d.code?O.UNKNOWN:lm(d.code);return new L(m,d.message||"")}(a);t=new mm(r,i,s,h||null)}else if("documentChange"in e){const r=e.documentChange,i=br(n,r.document.name),s=ut(r.document.updateTime),a=r.document.createTime?ut(r.document.createTime):ie.min(),h=new bt({mapValue:{fields:r.document.fields}}),d=qe.newFoundDocument(i,s,a,h);t=new Vl(r.targetIds||[],r.removedTargetIds||[],d.key,d)}else if("documentDelete"in e){const r=e.documentDelete,i=br(n,r.document),s=r.readTime?ut(r.readTime):ie.min(),a=qe.newNoDocument(i,s);t=new Vl([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in e){const r=e.documentRemove,i=br(n,r.document);t=new Vl([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return J();{const r=e.filter,{count:i=0,unchangedNames:s}=r,a=new r_(i,s);t=new pm(r.targetId,a)}}var d;return t}(this.serializer,e),r=function(i){if(!("targetChange"in i))return ie.min();const s=i.targetChange;return s.targetIds&&s.targetIds.length?ie.min():s.readTime?ut(s.readTime):ie.min()}(e);return this.listener.nu(t,r)}su(e){const t={};t.database=au(this.serializer),t.addTarget=function(i,s){let a;const h=s.target;if(a=jt(h)?{documents:Sm(i,h)}:{query:zd(i,h)},a.targetId=s.targetId,s.resumeToken.approximateByteSize()>0){a.resumeToken=vm(i,s.resumeToken);const d=Fd(i,s.expectedCount);null!==d&&(a.expectedCount=d)}else if(s.snapshotVersion.compareTo(ie.min())>0){a.readTime=Ta(i,s.snapshotVersion.toTimestamp());const d=Fd(i,s.expectedCount);null!==d&&(a.expectedCount=d)}return a}(this.serializer,e);const r=function p_(n,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return J()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.Wo(t)}iu(e){const t={};t.database=au(this.serializer),t.removeTarget=e,this.Wo(t)}}class tv extends _g{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(te(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const t=function f_(n,e){return n&&n.length>0?(te(void 0!==e),n.map(t=>function(r,i){let s=ut(r.updateTime?r.updateTime:i);return s.isEqual(ie.min())&&(s=ut(i)),new Xy(s,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=ut(e.commitTime);return this.listener.cu(r,t)}return te(!e.writeResults||0===e.writeResults.length),this.ru=!0,this.listener.au()}hu(){const e={};e.database=au(this.serializer),this.Wo(e)}uu(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>cu(this.serializer,r))};this.Wo(t)}}class nv extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.lu=!1}fu(){if(this.lu)throw new L(O.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Io(e,t,r,i,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===O.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new L(O.UNKNOWN,i.toString())})}vo(e,t,r,i){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.vo(e,t,r,s,a,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===O.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new L(O.UNKNOWN,s.toString())})}terminate(){this.lu=!0}}class iv{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve())))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(He(t),this.mu=!1):V("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class sv{constructor(e,t,r,i,s){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=s,this.Pu.Yr(h=>{r.enqueueAndForget((0,b.Z)(function*(){var d;Wi(a)&&(V("RemoteStore","Restarting streams for network reachability change."),yield(d=(0,b.Z)(function*(m){const y=W(m);y.vu.add(4),yield ka(y),y.bu.set("Unknown"),y.vu.delete(4),yield _u(y)}),function(m){return d.apply(this,arguments)})(a))}))}),this.bu=new iv(r,i)}}function _u(n){return ff.apply(this,arguments)}function ff(){return ff=(0,b.Z)(function*(n){if(Wi(n))for(const e of n.Ru)yield e(!0)}),ff.apply(this,arguments)}function ka(n){return pf.apply(this,arguments)}function pf(){return pf=(0,b.Z)(function*(n){for(const e of n.Ru)yield e(!1)}),pf.apply(this,arguments)}function nh(n,e){const t=W(n);t.Au.has(e.targetId)||(t.Au.set(e.targetId,e),yf(t)?gf(t):Da(t).Ko()&&mf(t,e))}function vu(n,e){const t=W(n),r=Da(t);t.Au.delete(e),r.Ko()&&vg(t,e),0===t.Au.size&&(r.Ko()?r.jo():Wi(t)&&t.bu.set("Unknown"))}function mf(n,e){if(n.Vu.qt(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ie.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Da(n).su(e)}function vg(n,e){n.Vu.qt(e),Da(n).iu(e)}function gf(n){n.Vu=new s_({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),le:e=>n.Au.get(e)||null,ue:()=>n.datastore.serializer.databaseId}),Da(n).start(),n.bu.gu()}function yf(n){return Wi(n)&&!Da(n).Uo()&&n.Au.size>0}function Wi(n){return 0===W(n).vu.size}function Ig(n){n.Vu=void 0}function ov(n){return _f.apply(this,arguments)}function _f(){return _f=(0,b.Z)(function*(n){n.Au.forEach((e,t)=>{mf(n,e)})}),_f.apply(this,arguments)}function av(n,e){return vf.apply(this,arguments)}function vf(){return vf=(0,b.Z)(function*(n,e){Ig(n),yf(n)?(n.bu.Iu(e),gf(n)):n.bu.set("Unknown")}),vf.apply(this,arguments)}function cv(n,e,t){return If.apply(this,arguments)}function If(){return If=(0,b.Z)(function*(n,e,t){if(n.bu.set("Online"),e instanceof mm&&2===e.state&&e.cause)try{yield(r=(0,b.Z)(function*(i,s){const a=s.cause;for(const h of s.targetIds)i.Au.has(h)&&(yield i.remoteSyncer.rejectListen(h,a),i.Au.delete(h),i.Vu.removeTarget(h))}),function(i,s){return r.apply(this,arguments)})(n,e)}catch(r){V("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield rh(n,r)}else if(e instanceof Vl?n.Vu.Ht(e):e instanceof pm?n.Vu.ne(e):n.Vu.Xt(e),!t.isEqual(ie.min()))try{const r=yield cg(n.localStore);t.compareTo(r)>=0&&(yield function(i,s){const a=i.Vu.ce(s);return a.targetChanges.forEach((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const m=i.Au.get(d);m&&i.Au.set(d,m.withResumeToken(h.resumeToken,s))}}),a.targetMismatches.forEach((h,d)=>{const m=i.Au.get(h);if(!m)return;i.Au.set(h,m.withResumeToken(ct.EMPTY_BYTE_STRING,m.snapshotVersion)),vg(i,h);const y=new li(m.target,h,d,m.sequenceNumber);mf(i,y)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){V("RemoteStore","Failed to raise snapshot:",r),yield rh(n,r)}var r}),If.apply(this,arguments)}function rh(n,e,t){return wf.apply(this,arguments)}function wf(){return wf=(0,b.Z)(function*(n,e,t){if(!yr(e))throw e;n.vu.add(1),yield ka(n),n.bu.set("Offline"),t||(t=()=>cg(n.localStore)),n.asyncQueue.enqueueRetryable((0,b.Z)(function*(){V("RemoteStore","Retrying IndexedDB access"),yield t(),n.vu.delete(1),yield _u(n)}))}),wf.apply(this,arguments)}function wg(n,e){return e().catch(t=>rh(n,t,e))}function Oa(n){return Ef.apply(this,arguments)}function Ef(){return Ef=(0,b.Z)(function*(n){const e=W(n),t=Qi(e);let r=e.Eu.length>0?e.Eu[e.Eu.length-1].batchId:-1;for(;uv(e);)try{const i=yield K_(e.localStore,r);if(null===i){0===e.Eu.length&&t.jo();break}r=i.batchId,lv(e,i)}catch(i){yield rh(e,i)}Eg(e)&&Tg(e)}),Ef.apply(this,arguments)}function uv(n){return Wi(n)&&n.Eu.length<10}function lv(n,e){n.Eu.push(e);const t=Qi(n);t.Ko()&&t.ou&&t.uu(e.mutations)}function Eg(n){return Wi(n)&&!Qi(n).Uo()&&n.Eu.length>0}function Tg(n){Qi(n).start()}function hv(n){return Tf.apply(this,arguments)}function Tf(){return Tf=(0,b.Z)(function*(n){Qi(n).hu()}),Tf.apply(this,arguments)}function dv(n){return bf.apply(this,arguments)}function bf(){return bf=(0,b.Z)(function*(n){const e=Qi(n);for(const t of n.Eu)e.uu(t.mutations)}),bf.apply(this,arguments)}function fv(n,e,t){return Sf.apply(this,arguments)}function Sf(){return Sf=(0,b.Z)(function*(n,e,t){const r=n.Eu.shift(),i=Rd.from(r,e,t);yield wg(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Oa(n)}),Sf.apply(this,arguments)}function pv(n,e){return Cf.apply(this,arguments)}function Cf(){return Cf=(0,b.Z)(function*(n,e){var t;e&&Qi(n).ou&&(yield(t=(0,b.Z)(function*(r,i){if(um(s=i.code)&&s!==O.ABORTED){const a=r.Eu.shift();Qi(r).Qo(),yield wg(r,()=>r.remoteSyncer.rejectFailedWrite(a.batchId,i)),yield Oa(r)}var s}),function(r,i){return t.apply(this,arguments)})(n,e)),Eg(n)&&Tg(n)}),Cf.apply(this,arguments)}function bg(n,e){return xf.apply(this,arguments)}function xf(){return xf=(0,b.Z)(function*(n,e){const t=W(n);t.asyncQueue.verifyOperationInProgress(),V("RemoteStore","RemoteStore received new credentials");const r=Wi(t);t.vu.add(3),yield ka(t),r&&t.bu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.vu.delete(3),yield _u(t)}),xf.apply(this,arguments)}function Af(n,e){return kf.apply(this,arguments)}function kf(){return kf=(0,b.Z)(function*(n,e){const t=W(n);e?(t.vu.delete(2),yield _u(t)):e||(t.vu.add(2),yield ka(t),t.bu.set("Unknown"))}),kf.apply(this,arguments)}function Da(n){return n.Su||(n.Su=function(e,t,r){const i=W(e);return i.fu(),new ev(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{uo:ov.bind(null,n),ao:av.bind(null,n),nu:cv.bind(null,n)}),n.Ru.push(function(){var e=(0,b.Z)(function*(t){t?(n.Su.Qo(),yf(n)?gf(n):n.bu.set("Unknown")):(yield n.Su.stop(),Ig(n))});return function(t){return e.apply(this,arguments)}}())),n.Su}function Qi(n){return n.Du||(n.Du=function(e,t,r){const i=W(e);return i.fu(),new tv(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{uo:hv.bind(null,n),ao:pv.bind(null,n),au:dv.bind(null,n),cu:fv.bind(null,n)}),n.Ru.push(function(){var e=(0,b.Z)(function*(t){t?(n.Du.Qo(),yield Oa(n)):(yield n.Du.stop(),n.Eu.length>0&&(V("RemoteStore",`Stopping write stream with ${n.Eu.length} pending writes`),n.Eu=[]))});return function(t){return e.apply(this,arguments)}}())),n.Du}class Of{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new at,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}static createAndSchedule(e,t,r,i,s){const a=Date.now()+r,h=new Of(e,t,a,i,s);return h.start(r),h}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new L(O.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Na(n,e){if(He("AsyncQueue",`${e}: ${n}`),yr(n))return new L(O.UNAVAILABLE,`${e}: ${n}`);throw n}class Ra{constructor(e){this.comparator=e?(t,r)=>e(t,r)||j.comparator(t.key,r.key):(t,r)=>j.comparator(t.key,r.key),this.keyedMap=Xc(),this.sortedSet=new Le(this.comparator)}static emptySet(e){return new Ra(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ra)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Ra;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Sg{constructor(){this.Cu=new Le(j.comparator)}track(e){const t=e.doc.key,r=this.Cu.get(t);r?0!==e.type&&3===r.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==r.type?this.Cu=this.Cu.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.Cu=this.Cu.remove(t):1===e.type&&2===r.type?this.Cu=this.Cu.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):J():this.Cu=this.Cu.insert(t,e)}xu(){const e=[];return this.Cu.inorderTraversal((t,r)=>{e.push(r)}),e}}class Pa{constructor(e,t,r,i,s,a,h,d,m){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=h,this.excludesMetadataChanges=d,this.hasCachedResults=m}static fromInitialDocuments(e,t,r,i,s){const a=[];return t.forEach(h=>{a.push({type:0,doc:h})}),new Pa(e,t,Ra.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Yc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class mv{constructor(){this.Nu=void 0,this.listeners=[]}}class gv{constructor(){this.queries=new ci(e=>qp(e),Yc),this.onlineState="Unknown",this.ku=new Set}}function Df(n,e){return Nf.apply(this,arguments)}function Nf(){return Nf=(0,b.Z)(function*(n,e){const t=W(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new mv),i)try{s.Nu=yield t.onListen(r)}catch(a){const h=Na(a,`Initialization of query '${kd(e.query)}' failed`);return void e.onError(h)}t.queries.set(r,s),s.listeners.push(e),e.Mu(t.onlineState),s.Nu&&e.$u(s.Nu)&&Mf(t)}),Nf.apply(this,arguments)}function Rf(n,e){return Pf.apply(this,arguments)}function Pf(){return Pf=(0,b.Z)(function*(n,e){const t=W(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const a=s.listeners.indexOf(e);a>=0&&(s.listeners.splice(a,1),i=0===s.listeners.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),Pf.apply(this,arguments)}function yv(n,e){const t=W(n);let r=!1;for(const i of e){const a=t.queries.get(i.query);if(a){for(const h of a.listeners)h.$u(i)&&(r=!0);a.Nu=i}}r&&Mf(t)}function _v(n,e,t){const r=W(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function Mf(n){n.ku.forEach(e=>{e.next()})}class Lf{constructor(e,t,r){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=r||{}}$u(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new Pa(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){return!e.fromCache||(!this.options.Ku||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Uu(e){e=Pa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class vv{constructor(e,t){this.Gu=e,this.byteLength=t}Qu(){return"metadata"in this.Gu}}class Cg{constructor(e){this.serializer=e}rr(e){return br(this.serializer,e)}ur(e){return e.metadata.exists?bm(this.serializer,e.document,!1):qe.newNoDocument(this.rr(e.metadata.name),this.cr(e.metadata.readTime))}cr(e){return ut(e)}}class Iv{constructor(e,t,r){this.ju=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=xg(e)}zu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Gu.namedQuery)this.queries.push(e.Gu.namedQuery);else if(e.Gu.documentMetadata){this.documents.push({metadata:e.Gu.documentMetadata}),e.Gu.documentMetadata.exists||++t;const r=we.fromString(e.Gu.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Gu.document&&(this.documents[this.documents.length-1].document=e.Gu.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Wu(e){const t=new Map,r=new Cg(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.rr(i.metadata.name);for(const a of i.metadata.queries){const h=(t.get(a)||ge()).add(s);t.set(a,h)}}return t}complete(){var e=this;return(0,b.Z)(function*(){const t=yield function H_(n,e,t,r){return rf.apply(this,arguments)}(e.localStore,new Cg(e.serializer),e.documents,e.ju.id),r=e.Wu(e.documents);for(const i of e.queries)yield W_(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,Hu:e.collectionGroups,Ju:t}})()}}function xg(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class Ag{constructor(e){this.key=e}}class kg{constructor(e){this.key=e}}class Og{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=ge(),this.mutatedKeys=ge(),this.tc=$p(e),this.ec=new Ra(this.tc)}get nc(){return this.Yu}sc(e,t){const r=t?t.ic:new Sg,i=t?t.ec:this.ec;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,h=!1;const d="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,m="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((y,_)=>{const S=i.get(y),N=Jc(this.query,_)?_:null,Z=!!S&&this.mutatedKeys.has(S.key),K=!!N&&(N.hasLocalMutations||this.mutatedKeys.has(N.key)&&N.hasCommittedMutations);let H=!1;S&&N?S.data.isEqual(N.data)?Z!==K&&(r.track({type:3,doc:N}),H=!0):this.rc(S,N)||(r.track({type:2,doc:N}),H=!0,(d&&this.tc(N,d)>0||m&&this.tc(N,m)<0)&&(h=!0)):!S&&N?(r.track({type:0,doc:N}),H=!0):S&&!N&&(r.track({type:1,doc:S}),H=!0,(d||m)&&(h=!0)),H&&(N?(a=a.add(N),s=K?s.add(y):s.delete(y)):(a=a.delete(y),s=s.delete(y)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const y="F"===this.query.limitType?a.last():a.first();a=a.delete(y.key),s=s.delete(y.key),r.track({type:1,doc:y})}return{ec:a,ic:r,zi:h,mutatedKeys:s}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const i=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const s=e.ic.xu();s.sort((m,y)=>function(_,S){const N=Z=>{switch(Z){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return J()}};return N(_)-N(S)}(m.type,y.type)||this.tc(m.doc,y.doc)),this.oc(r);const a=t?this.uc():[],h=0===this.Zu.size&&this.current?1:0,d=h!==this.Xu;return this.Xu=h,0!==s.length||d?{snapshot:new Pa(this.query,e.ec,i,s,e.mutatedKeys,0===h,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),cc:a}:{cc:a}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new Sg,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach(t=>this.Yu=this.Yu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Yu=this.Yu.delete(t)),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=ge(),this.ec.forEach(r=>{this.ac(r.key)&&(this.Zu=this.Zu.add(r.key))});const t=[];return e.forEach(r=>{this.Zu.has(r)||t.push(new kg(r))}),this.Zu.forEach(r=>{e.has(r)||t.push(new Ag(r))}),t}hc(e){this.Yu=e.ir,this.Zu=ge();const t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return Pa.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class wv{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Ev{constructor(e){this.key=e,this.fc=!1}}class Tv{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.dc={},this.wc=new ci(h=>qp(h),Yc),this._c=new Map,this.mc=new Set,this.gc=new Le(j.comparator),this.yc=new Map,this.Ic=new Wd,this.Tc={},this.Ec=new Map,this.Ac=Xs.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}function bv(n,e){return Ff.apply(this,arguments)}function Ff(){return Ff=(0,b.Z)(function*(n,e){const t=op(n);let r,i;const s=t.wc.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.lc();else{const a=yield xa(t.localStore,St(e)),h=t.sharedClientState.addLocalQueryTarget(a.targetId);r=a.targetId,i=yield Uf(t,e,r,"current"===h,a.resumeToken),t.isPrimaryClient&&nh(t.remoteStore,a)}return i}),Ff.apply(this,arguments)}function Uf(n,e,t,r,i){return Vf.apply(this,arguments)}function Vf(){return Vf=(0,b.Z)(function*(n,e,t,r,i){n.Rc=(_,S,N)=>{return(Z=(0,b.Z)(function*(K,H,oe,ve){let fe=H.view.sc(oe);fe.zi&&(fe=yield Yl(K.localStore,H.query,!1).then(({documents:Ie})=>H.view.sc(Ie,fe)));const pe=ve&&ve.targetChanges.get(H.targetId),Ae=H.view.applyChanges(fe,K.isPrimaryClient,pe);return Wf(K,H.targetId,Ae.cc),Ae.snapshot}),function(K,H,oe,ve){return Z.apply(this,arguments)})(n,_,S,N);var Z};const s=yield Yl(n.localStore,e,!0),a=new Og(e,s.ir),h=a.sc(s.documents),d=su.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),m=a.applyChanges(h,n.isPrimaryClient,d);Wf(n,t,m.cc);const y=new wv(e,t,a);return n.wc.set(e,y),n._c.has(t)?n._c.get(t).push(e):n._c.set(t,[e]),m.snapshot}),Vf.apply(this,arguments)}function Sv(n,e){return Bf.apply(this,arguments)}function Bf(){return Bf=(0,b.Z)(function*(n,e){const t=W(n),r=t.wc.get(e),i=t._c.get(r.targetId);if(i.length>1)return t._c.set(r.targetId,i.filter(s=>!Yc(s,e))),void t.wc.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield Aa(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),vu(t.remoteStore,r.targetId),Ma(t,r.targetId)}).catch(gr))):(Ma(t,r.targetId),yield Aa(t.localStore,r.targetId,!0))}),Bf.apply(this,arguments)}function zf(){return zf=(0,b.Z)(function*(n,e,t){const r=ap(n);try{const i=yield function(s,a){const h=W(s),d=je.now(),m=a.reduce((S,N)=>S.add(N.key),ge());let y,_;return h.persistence.runTransaction("Locally write mutations","readwrite",S=>{let N=fn(),Z=ge();return h.Zi.getEntries(S,m).next(K=>{N=K,N.forEach((H,oe)=>{oe.isValidDocument()||(Z=Z.add(H))})}).next(()=>h.localDocuments.getOverlayedDocuments(S,N)).next(K=>{y=K;const H=[];for(const oe of a){const ve=t_(oe,y.get(oe.key).overlayedDocument);null!=ve&&H.push(new ui(oe.key,ve,Ol(ve.value.mapValue),Ye.exists(!0)))}return h.mutationQueue.addMutationBatch(S,d,H,a)}).next(K=>{_=K;const H=K.applyToLocalDocumentSet(y,Z);return h.documentOverlayCache.saveOverlays(S,K.batchId,H)})}).then(()=>({batchId:_.batchId,changes:Hp(y)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(s,a,h){let d=s.Tc[s.currentUser.toKey()];d||(d=new Le(le)),d=d.insert(a,h),s.Tc[s.currentUser.toKey()]=d}(r,i.batchId,t),yield hi(r,i.changes),yield Oa(r.remoteStore)}catch(i){const s=Na(i,"Failed to persist write");t.reject(s)}}),zf.apply(this,arguments)}function Dg(n,e){return Zf.apply(this,arguments)}function Zf(){return Zf=(0,b.Z)(function*(n,e){const t=W(n);try{const r=yield function $_(n,e){const t=W(n),r=e.snapshotVersion;let i=t.Ji;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.Zi.newChangeBuffer({trackRemovals:!0});i=t.Ji;const h=[];e.targetChanges.forEach((y,_)=>{const S=i.get(_);if(!S)return;h.push(t.Bs.removeMatchingKeys(s,y.removedDocuments,_).next(()=>t.Bs.addMatchingKeys(s,y.addedDocuments,_)));let N=S.withSequenceNumber(s.currentSequenceNumber);var Z,K,H;null!==e.targetMismatches.get(_)?N=N.withResumeToken(ct.EMPTY_BYTE_STRING,ie.min()).withLastLimboFreeSnapshotVersion(ie.min()):y.resumeToken.approximateByteSize()>0&&(N=N.withResumeToken(y.resumeToken,r)),i=i.insert(_,N),K=N,H=y,(0===(Z=S).resumeToken.approximateByteSize()||K.snapshotVersion.toMicroseconds()-Z.snapshotVersion.toMicroseconds()>=3e8||H.addedDocuments.size+H.modifiedDocuments.size+H.removedDocuments.size>0)&&h.push(t.Bs.updateTargetData(s,N))});let d=fn(),m=ge();if(e.documentUpdates.forEach(y=>{e.resolvedLimboDocuments.has(y)&&h.push(t.persistence.referenceDelegate.updateLimboDocument(s,y))}),h.push(ug(s,a,e.documentUpdates).next(y=>{d=y.nr,m=y.sr})),!r.isEqual(ie.min())){const y=t.Bs.getLastRemoteSnapshotVersion(s).next(_=>t.Bs.setTargetsMetadata(s,s.currentSequenceNumber,r));h.push(y)}return x.waitFor(h).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,d,m)).next(()=>d)}).then(s=>(t.Ji=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.yc.get(s);a&&(te(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.fc=!0:i.modifiedDocuments.size>0?te(a.fc):i.removedDocuments.size>0&&(te(a.fc),a.fc=!1))}),yield hi(t,r,e)}catch(r){yield gr(r)}}),Zf.apply(this,arguments)}function Ng(n,e,t){const r=W(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.wc.forEach((s,a)=>{const h=a.view.Mu(e);h.snapshot&&i.push(h.snapshot)}),function(s,a){const h=W(s);h.onlineState=a;let d=!1;h.queries.forEach((m,y)=>{for(const _ of y.listeners)_.Mu(a)&&(d=!0)}),d&&Mf(h)}(r.eventManager,e),i.length&&r.dc.nu(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function xv(n,e,t){return Gf.apply(this,arguments)}function Gf(){return Gf=(0,b.Z)(function*(n,e,t){const r=W(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.yc.get(e),s=i&&i.key;if(s){let a=new Le(j.comparator);a=a.insert(s,qe.newNoDocument(s,ie.min()));const h=ge().add(s),d=new iu(ie.min(),new Map,new Le(le),a,h);yield Dg(r,d),r.gc=r.gc.remove(s),r.yc.delete(e),Qf(r)}else yield Aa(r.localStore,e,!1).then(()=>Ma(r,e,t)).catch(gr)}),Gf.apply(this,arguments)}function Av(n,e){return qf.apply(this,arguments)}function qf(){return qf=(0,b.Z)(function*(n,e){const t=W(n),r=e.batch.batchId;try{const i=yield function j_(n,e){const t=W(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.Zi.newChangeBuffer({trackRemovals:!0});return function(a,h,d,m){const y=d.batch,_=y.keys();let S=x.resolve();return _.forEach(N=>{S=S.next(()=>m.getEntry(h,N)).next(Z=>{const K=d.docVersions.get(N);te(null!==K),Z.version.compareTo(K)<0&&(y.applyToRemoteDocument(Z,d),Z.isValidDocument()&&(Z.setReadTime(d.commitVersion),m.addEntry(Z)))})}),S.next(()=>a.mutationQueue.removeMutationBatch(h,y))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let h=ge();for(let d=0;d<a.mutationResults.length;++d)a.mutationResults[d].transformResults.length>0&&(h=h.add(a.batch.mutations[d].key));return h}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);Hf(t,r,null),Kf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield hi(t,i)}catch(i){yield gr(i)}}),qf.apply(this,arguments)}function kv(n,e,t){return jf.apply(this,arguments)}function jf(){return jf=(0,b.Z)(function*(n,e,t){const r=W(n);try{const i=yield function(s,a){const h=W(s);return h.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let m;return h.mutationQueue.lookupMutationBatch(d,a).next(y=>(te(null!==y),m=y.keys(),h.mutationQueue.removeMutationBatch(d,y))).next(()=>h.mutationQueue.performConsistencyCheck(d)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(d,m,a)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,m)).next(()=>h.localDocuments.getDocuments(d,m))})}(r.localStore,e);Hf(r,e,t),Kf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield hi(r,i)}catch(i){yield gr(i)}}),jf.apply(this,arguments)}function $f(){return $f=(0,b.Z)(function*(n,e){const t=W(n);Wi(t.remoteStore)||V("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(s){const a=W(s);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",h=>a.mutationQueue.getHighestUnacknowledgedBatchId(h))}(t.localStore);if(-1===r)return void e.resolve();const i=t.Ec.get(r)||[];i.push(e),t.Ec.set(r,i)}catch(r){const i=Na(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),$f.apply(this,arguments)}function Kf(n,e){(n.Ec.get(e)||[]).forEach(t=>{t.resolve()}),n.Ec.delete(e)}function Hf(n,e,t){const r=W(n);let i=r.Tc[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Tc[r.currentUser.toKey()]=i}}function Ma(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n._c.get(e))n.wc.delete(r),t&&n.dc.Pc(r,t);n._c.delete(e),n.isPrimaryClient&&n.Ic.Is(e).forEach(r=>{n.Ic.containsKey(r)||Rg(n,r)})}function Rg(n,e){n.mc.delete(e.path.canonicalString());const t=n.gc.get(e);null!==t&&(vu(n.remoteStore,t),n.gc=n.gc.remove(e),n.yc.delete(t),Qf(n))}function Wf(n,e,t){for(const r of t)r instanceof Ag?(n.Ic.addReference(r.key,e),Dv(n,r)):r instanceof kg?(V("SyncEngine","Document no longer in limbo: "+r.key),n.Ic.removeReference(r.key,e),n.Ic.containsKey(r.key)||Rg(n,r.key)):J()}function Dv(n,e){const t=e.key,r=t.path.canonicalString();n.gc.get(t)||n.mc.has(r)||(V("SyncEngine","New document in limbo: "+t),n.mc.add(r),Qf(n))}function Qf(n){for(;n.mc.size>0&&n.gc.size<n.maxConcurrentLimboResolutions;){const e=n.mc.values().next().value;n.mc.delete(e);const t=new j(we.fromString(e)),r=n.Ac.next();n.yc.set(r,new Ev(t)),n.gc=n.gc.insert(t,r),nh(n.remoteStore,new li(St(Er(t.path)),r,"TargetPurposeLimboResolution",Gt.ct))}}function hi(n,e,t){return Yf.apply(this,arguments)}function Yf(){return Yf=(0,b.Z)(function*(n,e,t){const r=W(n),i=[],s=[],a=[];var h;r.wc.isEmpty()||(r.wc.forEach((h,d)=>{a.push(r.Rc(d,e,t).then(m=>{if((m||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(d.targetId,m?.fromCache?"not-current":"current"),m){i.push(m);const y=ef.Li(d.targetId,m);s.push(y)}}))}),yield Promise.all(a),r.dc.nu(i),yield(h=(0,b.Z)(function*(d,m){const y=W(d);try{yield y.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>x.forEach(m,S=>x.forEach(S.Fi,N=>y.persistence.referenceDelegate.addReference(_,S.targetId,N)).next(()=>x.forEach(S.Bi,N=>y.persistence.referenceDelegate.removeReference(_,S.targetId,N)))))}catch(_){if(!yr(_))throw _;V("LocalStore","Failed to update sequence numbers: "+_)}for(const _ of m){const S=_.targetId;if(!_.fromCache){const N=y.Ji.get(S),K=N.withLastLimboFreeSnapshotVersion(N.snapshotVersion);y.Ji=y.Ji.insert(S,K)}}}),function(d,m){return h.apply(this,arguments)})(r.localStore,s))}),Yf.apply(this,arguments)}function Nv(n,e){return Jf.apply(this,arguments)}function Jf(){return Jf=(0,b.Z)(function*(n,e){const t=W(n);if(!t.currentUser.isEqual(e)){V("SyncEngine","User change. New user:",e.toKey());const r=yield ag(t.localStore,e);t.currentUser=e,(i=t).Ec.forEach(a=>{a.forEach(h=>{h.reject(new L(O.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),i.Ec.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield hi(t,r.er)}var i}),Jf.apply(this,arguments)}function Rv(n,e){const t=W(n),r=t.yc.get(e);if(r&&r.fc)return ge().add(r.key);{let i=ge();const s=t._c.get(e);if(!s)return i;for(const a of s){const h=t.wc.get(a);i=i.unionWith(h.view.nc)}return i}}function Pv(n,e){return Xf.apply(this,arguments)}function Xf(){return Xf=(0,b.Z)(function*(n,e){const t=W(n),r=yield Yl(t.localStore,e.query,!0),i=e.view.hc(r);return t.isPrimaryClient&&Wf(t,e.targetId,i.cc),i}),Xf.apply(this,arguments)}function Mv(n,e){return ep.apply(this,arguments)}function ep(){return ep=(0,b.Z)(function*(n,e){const t=W(n);return hg(t.localStore,e).then(r=>hi(t,r))}),ep.apply(this,arguments)}function Lv(n,e,t,r){return tp.apply(this,arguments)}function tp(){return tp=(0,b.Z)(function*(n,e,t,r){const i=W(n),s=yield function(a,h){const d=W(a),m=W(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",y=>m.Sn(y,h).next(_=>_?d.localDocuments.getDocuments(y,_):x.resolve(null)))}(i.localStore,e);var h;null!==s?("pending"===t?yield Oa(i.remoteStore):"acknowledged"===t||"rejected"===t?(Hf(i,e,r||null),Kf(i,e),h=e,W(W(i.localStore).mutationQueue).Cn(h)):J(),yield hi(i,s)):V("SyncEngine","Cannot apply mutation batch with id: "+e)}),tp.apply(this,arguments)}function np(){return np=(0,b.Z)(function*(n,e){const t=W(n);if(op(t),ap(t),!0===e&&!0!==t.vc){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Pg(t,r.toArray());t.vc=!0,yield Af(t.remoteStore,!0);for(const s of i)nh(t.remoteStore,s)}else if(!1===e&&!1!==t.vc){const r=[];let i=Promise.resolve();t._c.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?r.push(a):i=i.then(()=>(Ma(t,a),Aa(t.localStore,a,!0))),vu(t.remoteStore,a)}),yield i,yield Pg(t,r),function(s){const a=W(s);a.yc.forEach((h,d)=>{vu(a.remoteStore,d)}),a.Ic.Ts(),a.yc=new Map,a.gc=new Le(j.comparator)}(t),t.vc=!1,yield Af(t.remoteStore,!1)}}),np.apply(this,arguments)}function Pg(n,e,t){return rp.apply(this,arguments)}function rp(){return rp=(0,b.Z)(function*(n,e,t){const r=W(n),i=[],s=[];for(const a of e){let h;const d=r._c.get(a);if(d&&0!==d.length){h=yield xa(r.localStore,St(d[0]));for(const m of d){const y=r.wc.get(m),_=yield Pv(r,y);_.snapshot&&s.push(_.snapshot)}}else{const m=yield lg(r.localStore,a);h=yield xa(r.localStore,m),yield Uf(r,Mg(m),a,!1,h.resumeToken)}i.push(h)}return r.dc.nu(s),i}),rp.apply(this,arguments)}function Mg(n){return Hc(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Uv(n){const e=W(n);return W(W(e.localStore).persistence).$i()}function Vv(n,e,t,r){return ip.apply(this,arguments)}function ip(){return ip=(0,b.Z)(function*(n,e,t,r){const i=W(n);if(i.vc)return void V("SyncEngine","Ignoring unexpected query state notification.");const s=i._c.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const a=yield hg(i.localStore,jp(s[0])),h=iu.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,ct.EMPTY_BYTE_STRING);yield hi(i,a,h);break}case"rejected":yield Aa(i.localStore,e,!0),Ma(i,e,r);break;default:J()}}),ip.apply(this,arguments)}function Bv(n,e,t){return sp.apply(this,arguments)}function sp(){return sp=(0,b.Z)(function*(n,e,t){const r=op(n);if(r.vc){for(const i of e){if(r._c.has(i)){V("SyncEngine","Adding an already active target "+i);continue}const s=yield lg(r.localStore,i),a=yield xa(r.localStore,s);yield Uf(r,Mg(s),a.targetId,!1,a.resumeToken),nh(r.remoteStore,a)}for(const i of t)r._c.has(i)&&(yield Aa(r.localStore,i,!1).then(()=>{vu(r.remoteStore,i),Ma(r,i)}).catch(gr))}}),sp.apply(this,arguments)}function op(n){const e=W(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Dg.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Rv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=xv.bind(null,e),e.dc.nu=yv.bind(null,e.eventManager),e.dc.Pc=_v.bind(null,e.eventManager),e}function ap(n){const e=W(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Av.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=kv.bind(null,e),e}class Iu{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,b.Z)(function*(){t.serializer=yu(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return og(this.persistence,new sg,e.initialUser,this.serializer)}createPersistence(e){return new Qd(Hl.zs,this.serializer)}createSharedClientState(e){return new mg}terminate(){var e=this;return(0,b.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class cp extends Iu{constructor(e,t,r){super(),this.Vc=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,b.Z)(function*(){yield t().call(r,e),yield r.Vc.initialize(r,e),yield ap(r.Vc.syncEngine),yield Oa(r.Vc.remoteStore),yield r.persistence.Ii(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return og(this.persistence,new sg,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new Qm(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new hd(t,this.persistence);return new Pc(e.asyncQueue,r)}createPersistence(e){const t=Xd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?$t.withCacheSize(this.cacheSizeBytes):$t.DEFAULT;return new Jd(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,yg(),th(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new mg}}class Lg extends cp{constructor(e,t){super(e,t,!1),this.Vc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,b.Z)(function*(){yield t().call(r,e);const i=r.Vc.syncEngine;r.sharedClientState instanceof uf&&(r.sharedClientState.syncEngine={jr:Lv.bind(null,i),zr:Vv.bind(null,i),Wr:Bv.bind(null,i),$i:Uv.bind(null,i),Qr:Mv.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.Ii(function(){var s=(0,b.Z)(function*(a){yield function Fv(n,e){return np.apply(this,arguments)}(r.Vc.syncEngine,a),r.gcScheduler&&(a&&!r.gcScheduler.started?r.gcScheduler.start():a||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(a&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():a||r.indexBackfillerScheduler.stop())});return function(a){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=yg();if(!uf.D(t))throw new L(O.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Xd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new uf(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class La{initialize(e,t){var r=this;return(0,b.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>Ng(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=Nv.bind(null,r.syncEngine),yield Af(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new gv}createDatastore(e){const t=yu(e.databaseInfo.databaseId),r=new X_(e.databaseInfo);return new nv(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,i=e.asyncQueue,s=h=>Ng(this.syncEngine,h,0),a=gg.D()?new gg:new Q_,new sv(t,r,i,s,a);var t,r,i,s,a}createSyncEngine(e,t){return function(r,i,s,a,h,d,m){const y=new Tv(r,i,s,a,h,d);return m&&(y.vc=!0),y}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,b.Z)(function*(t){const r=W(t);V("RemoteStore","RemoteStore shutting down."),r.vu.add(5),yield ka(r),r.Pu.shutdown(),r.bu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function Fg(n,e=10240){let t=0;return{read:()=>(0,b.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,b.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class ih{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):He("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Gv{constructor(e,t){this.Cc=e,this.serializer=t,this.metadata=new at,this.buffer=new Uint8Array,this.xc=new TextDecoder("utf-8"),this.Nc().then(r=>{r&&r.Qu()?this.metadata.resolve(r.Gu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(r?.Gu)}`))},r=>this.metadata.reject(r))}close(){return this.Cc.cancel()}getMetadata(){var e=this;return(0,b.Z)(function*(){return e.metadata.promise})()}bc(){var e=this;return(0,b.Z)(function*(){return yield e.getMetadata(),e.Nc()})()}Nc(){var e=this;return(0,b.Z)(function*(){const t=yield e.kc();if(null===t)return null;const r=e.xc.decode(t),i=Number(r);isNaN(i)&&e.Mc(`length string (${r}) is not valid number`);const s=yield e.$c(i);return new vv(JSON.parse(s),t.length+i)})()}Oc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}kc(){var e=this;return(0,b.Z)(function*(){for(;e.Oc()<0&&!(yield e.Fc()););if(0===e.buffer.length)return null;const t=e.Oc();t<0&&e.Mc("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}$c(e){var t=this;return(0,b.Z)(function*(){for(;t.buffer.length<e;)(yield t.Fc())&&t.Mc("Reached the end of bundle when more is expected.");const r=t.xc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Mc(e){throw this.Cc.cancel(),new Error(`Invalid bundle format: ${e}`)}Fc(){var e=this;return(0,b.Z)(function*(){const t=yield e.Cc.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class qv{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,b.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new L(O.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(i=(0,b.Z)(function*(s,a){const h=W(s),d=au(h.serializer)+"/documents",m={documents:a.map(N=>ou(h.serializer,N))},y=yield h.vo("BatchGetDocuments",d,m,a.length),_=new Map;y.forEach(N=>{const Z=function h_(n,e){return"found"in e?function(t,r){te(!!r.found);const i=br(t,r.found.name),s=ut(r.found.updateTime),a=r.found.createTime?ut(r.found.createTime):ie.min(),h=new bt({mapValue:{fields:r.found.fields}});return qe.newFoundDocument(i,s,a,h)}(n,e):"missing"in e?function(t,r){te(!!r.missing),te(!!r.readTime);const i=br(t,r.missing),s=ut(r.readTime);return qe.newNoDocument(i,s)}(n,e):J()}(h.serializer,N);_.set(Z.key.toString(),Z)});const S=[];return a.forEach(N=>{const Z=_.get(N.toString());te(!!Z),S.push(Z)}),S}),function(s,a){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ea(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,b.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=j.fromPath(i);e.mutations.push(new Dd(s,e.precondition(s)))}),yield(r=(0,b.Z)(function*(i,s){const a=W(i),h=au(a.serializer)+"/documents",d={writes:s.map(m=>cu(a.serializer,m))};yield a.Io("Commit",h,d)}),function(i,s){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw J();t=ie.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new L(O.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ie.min())?Ye.exists(!1):Ye.updateTime(t):Ye.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ie.min()))throw new L(O.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ye.updateTime(t)}return Ye.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class jv{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Bc=r.maxAttempts,this.qo=new hf(this.asyncQueue,"transaction_retry")}run(){this.Bc-=1,this.Lc()}Lc(){var e=this;this.qo.No((0,b.Z)(function*(){const t=new qv(e.datastore),r=e.qc(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.Uc(s)}))}).catch(i=>{e.Uc(i)})}))}qc(e){try{const t=this.updateFunction(e);return!Zs(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Uc(e){this.Bc>0&&this.Kc(e)?(this.Bc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Lc(),Promise.resolve()))):this.deferred.reject(e)}Kc(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!um(t)}return!1}}class $v{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=mt.UNAUTHENTICATED,this.clientId=Dc.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var a=(0,b.Z)(function*(h){V("FirestoreClient","Received user=",h.uid),yield s.authCredentialListener(h),s.user=h});return function(h){return a.apply(this,arguments)}}()),this.appCheckCredentials.start(r,a=>(V("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}getConfiguration(){var e=this;return(0,b.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new L(O.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new at;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,b.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=Na(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function sh(n,e){return up.apply(this,arguments)}function up(){return up=(0,b.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),V("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,b.Z)(function*(s){r.isEqual(s)||(yield ag(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),up.apply(this,arguments)}function lp(n,e){return hp.apply(this,arguments)}function hp(){return hp=(0,b.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield dp(n);V("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>bg(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>bg(e.remoteStore,s)),n._onlineComponents=e}),hp.apply(this,arguments)}function Ug(n){return"FirebaseError"===n.name?n.code===O.FAILED_PRECONDITION||n.code===O.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function dp(n){return fp.apply(this,arguments)}function fp(){return fp=(0,b.Z)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V("FirestoreClient","Using user provided OfflineComponentProvider");try{yield sh(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Ug(t))throw t;Jt("Error using user provided cache. Falling back to memory cache: "+t),yield sh(n,new Iu)}}else V("FirestoreClient","Using default OfflineComponentProvider"),yield sh(n,new Iu);return n._offlineComponents}),fp.apply(this,arguments)}function oh(n){return pp.apply(this,arguments)}function pp(){return pp=(0,b.Z)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(V("FirestoreClient","Using user provided OnlineComponentProvider"),yield lp(n,n._uninitializedComponentsProvider._online)):(V("FirestoreClient","Using default OnlineComponentProvider"),yield lp(n,new La))),n._onlineComponents}),pp.apply(this,arguments)}function Vg(n){return dp(n).then(e=>e.persistence)}function ah(n){return dp(n).then(e=>e.localStore)}function Bg(n){return oh(n).then(e=>e.remoteStore)}function mp(n){return oh(n).then(e=>e.syncEngine)}function Fa(n){return gp.apply(this,arguments)}function gp(){return gp=(0,b.Z)(function*(n){const e=yield oh(n),t=e.eventManager;return t.onListen=bv.bind(null,e.syncEngine),t.onUnlisten=Sv.bind(null,e.syncEngine),t}),gp.apply(this,arguments)}function Zg(n,e,t={}){const r=new at;return n.asyncQueue.enqueueAndForget((0,b.Z)(function*(){return function(i,s,a,h,d){const m=new ih({next:_=>{s.enqueueAndForget(()=>Rf(i,y));const S=_.docs.has(a);!S&&_.fromCache?d.reject(new L(O.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&_.fromCache&&h&&"server"===h.source?d.reject(new L(O.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(_)},error:_=>d.reject(_)}),y=new Lf(Er(a.path),m,{includeMetadataChanges:!0,Ku:!0});return Df(i,y)}(yield Fa(n),n.asyncQueue,e,t,r)})),r.promise}function Gg(n,e,t={}){const r=new at;return n.asyncQueue.enqueueAndForget((0,b.Z)(function*(){return function(i,s,a,h,d){const m=new ih({next:_=>{s.enqueueAndForget(()=>Rf(i,y)),_.fromCache&&"server"===h.source?d.reject(new L(O.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(_)},error:_=>d.reject(_)}),y=new Lf(a,m,{includeMetadataChanges:!0,Ku:!0});return Df(i,y)}(yield Fa(n),n.asyncQueue,e,t,r)})),r.promise}function qg(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const jg=new Map;function yp(n,e,t){if(!t)throw new L(O.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function $g(n,e,t,r){if(!0===e&&!0===r)throw new L(O.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Kg(n){if(!j.isDocumentKey(n))throw new L(O.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Hg(n){if(j.isDocumentKey(n))throw new L(O.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ch(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":J()}function Se(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new L(O.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ch(n);throw new L(O.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Wg(n,e){if(e<=0)throw new L(O.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class Qg{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new L(O.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new L(O.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}$g("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=qg(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(i){if(void 0!==i.timeoutSeconds){if(isNaN(i.timeoutSeconds))throw new L(O.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new L(O.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new L(O.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class wu{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Qg({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new L(O.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new L(O.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Qg(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new rd;switch(t.type){case"firstParty":return new gl(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new L(O.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=jg.get(e);t&&(V("ComponentProvider","Removing Datastore"),jg.delete(e),t.terminate())}(this),Promise.resolve()}}class $e{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Sr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new $e(this.firestore,e,this._key)}}class Vt{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Vt(this.firestore,e,this._query)}}class Sr extends Vt{constructor(e,t,r){super(e,t,Er(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new $e(this.firestore,null,new j(e))}withConverter(e){return new Sr(this.firestore,e,this._path)}}function Jg(n,e,...t){if(n=(0,se.m9)(n),yp("collection","path",e),n instanceof wu){const r=we.fromString(e,...t);return Hg(r),new Sr(n,null,r)}{if(!(n instanceof $e||n instanceof Sr))throw new L(O.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(we.fromString(e,...t));return Hg(r),new Sr(n.firestore,null,r)}}function uh(n,e,...t){if(n=(0,se.m9)(n),1===arguments.length&&(e=Dc.A()),yp("doc","path",e),n instanceof wu){const r=we.fromString(e,...t);return Kg(r),new $e(n,null,new j(r))}{if(!(n instanceof $e||n instanceof Sr))throw new L(O.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(we.fromString(e,...t));return Kg(r),new $e(n.firestore,n instanceof Sr?n.converter:null,new j(r))}}function Xg(n,e){return n=(0,se.m9)(n),e=(0,se.m9)(e),(n instanceof $e||n instanceof Sr)&&(e instanceof $e||e instanceof Sr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function _p(n,e){return n=(0,se.m9)(n),e=(0,se.m9)(e),n instanceof Vt&&e instanceof Vt&&n.firestore===e.firestore&&Yc(n._query,e._query)&&n.converter===e.converter}class n0{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new hf(this,"async_queue_retry"),this.Xc=()=>{const t=th();t&&V("AsyncQueue","Visibility state changed to "+t.visibilityState),this.qo.Mo()};const e=th();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const t=th();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise(()=>{});const t=new at;return this.ta(()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qc.push(e),this.ea()))}ea(){var e=this;return(0,b.Z)(function*(){if(0!==e.Qc.length){try{yield e.Qc[0](),e.Qc.shift(),e.qo.reset()}catch(t){if(!yr(t))throw t;V("AsyncQueue","Operation failed with retryable error: "+t)}e.Qc.length>0&&e.qo.No(()=>e.ea())}})()}ta(e){const t=this.Gc.then(()=>(this.Hc=!0,e().catch(r=>{throw this.Wc=r,this.Hc=!1,He("INTERNAL UNHANDLED ERROR: ",function(s){let a=s.message||"";return s.stack&&(a=s.stack.includes(s.message)?s.stack:s.message+"\n"+s.stack),a}(r)),r}).then(r=>(this.Hc=!1,r))));return this.Gc=t,t}enqueueAfterDelay(e,t,r){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);const i=Of.createAndSchedule(this,e,t,r,s=>this.na(s));return this.zc.push(i),i}Zc(){this.Wc&&J()}verifyOperationInProgress(){}sa(){var e=this;return(0,b.Z)(function*(){let t;do{t=e.Gc,yield t}while(t!==e.Gc)})()}ia(e){for(const t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then(()=>{this.zc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.zc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()})}oa(e){this.Yc.push(e)}na(e){const t=this.zc.indexOf(e);this.zc.splice(t,1)}}function vp(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const i of["next","error","complete"])if(i in r&&"function"==typeof r[i])return!0;return!1}(n)}class r0{constructor(){this._progressObserver={},this._taskCompletionResolver=new at,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Ke extends wu{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new n0,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||ey(this),this._firestoreClient.terminate()}}function lt(n){return n._firestoreClient||ey(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function ey(n){var e,t,r;const i=n._freezeSettings(),s=(h=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Cd(n._databaseId,h,n._persistenceKey,(m=i).host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,qg(m.experimentalLongPollingOptions),m.useFetchStreams));var h,m;n._firestoreClient=new $v(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.cache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.cache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.cache.kind,_offline:i.cache._offlineComponentProvider,_online:i.cache._onlineComponentProvider})}function ty(n,e,t){const r=new at;return n.asyncQueue.enqueue((0,b.Z)(function*(){try{yield sh(n,t),yield lp(n,e),r.resolve()}catch(i){const s=i;if(!Ug(s))throw s;Jt("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function ny(n){if(n._initialized||n._terminated)throw new L(O.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Cr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Cr(ct.fromBase64String(e))}catch(t){throw new L(O.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Cr(ct.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class di{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new L(O.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new We(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class to{constructor(e){this._methodName=e}}class lh{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new L(O.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new L(O.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return le(this._lat,e._lat)||le(this._long,e._long)}}const m0=/^__.*__$/;class g0{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new ui(e,this.data,this.fieldMask,t,this.fieldTransforms):new wa(e,this.data,t,this.fieldTransforms)}}class ry{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ui(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function iy(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw J()}}class hh{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.ua(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new hh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.aa({path:r,la:!1});return i.fa(e),i}da(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.aa({path:r,la:!1});return i.ua(),i}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return ph(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(iy(this.ca)&&m0.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class y0{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||yu(e)}ya(e,t,r,i=!1){return new hh({ca:e,methodName:t,ga:r,path:We.emptyPath(),la:!1,ma:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function no(n){const e=n._freezeSettings(),t=yu(n._databaseId);return new y0(n._databaseId,!!e.ignoreUndefinedProperties,t)}function dh(n,e,t,r,i,s={}){const a=n.ya(s.merge||s.mergeFields?2:0,e,t,i);Tp("Data must be an object, but it was:",a,r);const h=ay(r,a);let d,m;if(s.merge)d=new qt(a.fieldMask),m=a.fieldTransforms;else if(s.mergeFields){const y=[];for(const _ of s.mergeFields){const S=bu(e,_,t);if(!a.contains(S))throw new L(O.INVALID_ARGUMENT,`Field '${S}' is specified in your field mask but missing from your input data.`);uy(y,S)||y.push(S)}d=new qt(y),m=a.fieldTransforms.filter(_=>d.covers(_.field))}else d=null,m=a.fieldTransforms;return new g0(new bt(h),d,m)}class Tu extends to{_toFieldTransform(e){if(2!==e.ca)throw e._a(1===e.ca?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Tu}}function sy(n,e,t){return new hh({ca:3,ga:e.settings.ga,methodName:n._methodName,la:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Ip extends to{_toFieldTransform(e){return new tu(e.path,new va)}isEqual(e){return e instanceof Ip}}class _0 extends to{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=sy(this,e,!0),r=this.pa.map(s=>ro(s,t)),i=new $s(r);return new tu(e.path,i)}isEqual(e){return this===e}}class v0 extends to{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=sy(this,e,!0),r=this.pa.map(s=>ro(s,t)),i=new Ks(r);return new tu(e.path,i)}isEqual(e){return this===e}}class I0 extends to{constructor(e,t){super(e),this.Ia=t}_toFieldTransform(e){const t=new Ia(e.serializer,Jp(e.serializer,this.Ia));return new tu(e.path,t)}isEqual(e){return this===e}}function wp(n,e,t,r){const i=n.ya(1,e,t);Tp("Data must be an object, but it was:",i,r);const s=[],a=bt.empty();_r(r,(d,m)=>{const y=fh(e,d,t);m=(0,se.m9)(m);const _=i.da(y);if(m instanceof Tu)s.push(y);else{const S=ro(m,_);null!=S&&(s.push(y),a.set(y,S))}});const h=new qt(s);return new ry(a,h,i.fieldTransforms)}function Ep(n,e,t,r,i,s){const a=n.ya(1,e,t),h=[bu(e,r,t)],d=[i];if(s.length%2!=0)throw new L(O.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let S=0;S<s.length;S+=2)h.push(bu(e,s[S])),d.push(s[S+1]);const m=[],y=bt.empty();for(let S=h.length-1;S>=0;--S)if(!uy(m,h[S])){const N=h[S];let Z=d[S];Z=(0,se.m9)(Z);const K=a.da(N);if(Z instanceof Tu)m.push(N);else{const H=ro(Z,K);null!=H&&(m.push(N),y.set(N,H))}}const _=new qt(m);return new ry(y,_,a.fieldTransforms)}function oy(n,e,t,r=!1){return ro(t,n.ya(r?4:3,e))}function ro(n,e){if(cy(n=(0,se.m9)(n)))return Tp("Unsupported field value:",e,n),ay(n,e);if(n instanceof to)return function(t,r){if(!iy(r.ca))throw r._a(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r._a(`${t._methodName}() is not currently supported inside arrays`);const i=t._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.la&&4!==e.ca)throw e._a("Nested arrays are not supported");return function(t,r){const i=[];let s=0;for(const a of t){let h=ro(a,r.wa(s));null==h&&(h={nullValue:"NULL_VALUE"}),i.push(h),s++}return{arrayValue:{values:i}}}(n,e)}return function(t,r){if(null===(t=(0,se.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Jp(r.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const i=je.fromDate(t);return{timestampValue:Ta(r.serializer,i)}}if(t instanceof je){const i=new je(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Ta(r.serializer,i)}}if(t instanceof lh)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Cr)return{bytesValue:vm(r.serializer,t._byteString)};if(t instanceof $e){const i=r.databaseId,s=t.firestore._databaseId;if(!s.isEqual(i))throw r._a(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Ud(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r._a(`Unsupported field value: ${ch(t)}`)}(n,e)}function ay(n,e){const t={};return zc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):_r(n,(r,i)=>{const s=ro(i,e.ha(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function cy(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof je||n instanceof lh||n instanceof Cr||n instanceof $e||n instanceof to)}function Tp(n,e,t){if(!cy(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=ch(t);throw e._a("an object"===r?n+" a custom object":n+" "+r)}var r}function bu(n,e,t){if((e=(0,se.m9)(e))instanceof di)return e._internalPath;if("string"==typeof e)return fh(n,e);throw ph("Field path arguments must be of type string or ",n,!1,void 0,t)}const w0=new RegExp("[~\\*/\\[\\]]");function fh(n,e,t){if(e.search(w0)>=0)throw ph(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new di(...e.split("."))._internalPath}catch{throw ph(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ph(n,e,t,r,i){const s=r&&!r.isEmpty(),a=void 0!==i;let h=`Function ${e}() called with invalid data`;t&&(h+=" (via `toFirestore()`)"),h+=". ";let d="";return(s||a)&&(d+=" (found",s&&(d+=` in field ${r}`),a&&(d+=` in document ${i}`),d+=")"),new L(O.INVALID_ARGUMENT,h+n+d)}function uy(n,e){return n.some(t=>t.isEqual(e))}class Su{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new $e(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new E0(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(mh("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class E0 extends Su{data(){return super.data()}}function mh(n,e){return"string"==typeof e?fh(n,e):e instanceof di?e._internalPath:e._delegate._internalPath}function ly(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new L(O.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class bp{}class Cu extends bp{}function Yi(n,e,...t){let r=[];e instanceof bp&&r.push(e),r=r.concat(t),function(i){const s=i.filter(h=>h instanceof Ua).length,a=i.filter(h=>h instanceof xu).length;if(s>1||s>0&&a>0)throw new L(O.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class xu extends Cu{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new xu(e,t,r)}_apply(e){const t=this._parse(e);return py(e._query,t),new Vt(e.firestore,e.converter,Qc(e._query,t))}_parse(e){const t=no(e.firestore);return function(i,s,a,h,d,m,y){let _;if(d.isKeyField()){if("array-contains"===m||"array-contains-any"===m)throw new L(O.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if("in"===m||"not-in"===m){fy(y,m);const S=[];for(const N of y)S.push(dy(h,i,N));_={arrayValue:{values:S}}}else _=dy(h,i,y)}else"in"!==m&&"not-in"!==m&&"array-contains-any"!==m||fy(y,m),_=oy(a,"where",y,"in"===m||"not-in"===m);return me.create(d,m,_)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Ua extends bp{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ua(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:Ne.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(r,i){let s=r;const a=i.getFlattenedFilters();for(const h of a)py(s,h),s=Qc(s,h)}(e._query,t),new Vt(e.firestore,e.converter,Qc(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Sp extends Cu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Sp(e,t)}_apply(e){const t=function(r,i,s){if(null!==r.startAt)throw new L(O.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new L(O.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const a=new wr(i,s);return function(h,d){if(null===ya(h)){const m=qi(h);null!==m&&my(0,m,d.field)}}(r,a),a}(e._query,this._field,this._direction);return new Vt(e.firestore,e.converter,function(r,i){const s=r.explicitOrderBy.concat([i]);return new Un(r.path,r.collectionGroup,s,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class gh extends Cu{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new gh(e,t,r)}_apply(e){return new Vt(e.firestore,e.converter,Pl(e._query,this._limit,this._limitType))}}class yh extends Cu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new yh(e,t,r)}_apply(e){const t=hy(e,this.type,this._docOrFields,this._inclusive);return new Vt(e.firestore,e.converter,(i=t,new Un((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,i,r.endAt)));var r,i}}class _h extends Cu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new _h(e,t,r)}_apply(e){const t=hy(e,this.type,this._docOrFields,this._inclusive);return new Vt(e.firestore,e.converter,(i=t,new Un((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,i)));var r,i}}function hy(n,e,t,r){if(t[0]=(0,se.m9)(t[0]),t[0]instanceof Su)return function(i,s,a,h,d){if(!h)throw new L(O.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const m=[];for(const y of ai(i))if(y.field.isKeyField())m.push(ri(s,h.key));else{const _=h.data.field(y.field);if(ha(_))throw new L(O.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+y.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===_){const S=y.field.canonicalString();throw new L(O.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${S}' (used as the orderBy) does not exist.`)}m.push(_)}return new Xn(m,d)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=no(n.firestore);return function(s,a,h,d,m,y){const _=s.explicitOrderBy;if(m.length>_.length)throw new L(O.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const S=[];for(let N=0;N<m.length;N++){const Z=m[N];if(_[N].field.isKeyField()){if("string"!=typeof Z)throw new L(O.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof Z}`);if(!_a(s)&&-1!==Z.indexOf("/"))throw new L(O.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${Z}' contains a slash.`);const K=s.path.child(we.fromString(Z));if(!j.isDocumentKey(K))throw new L(O.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${K}' is not because it contains an odd number of segments.`);const H=new j(K);S.push(ri(a,H))}else{const K=oy(h,d,Z);S.push(K)}}return new Xn(S,y)}(n._query,n.firestore._databaseId,i,e,t,r)}}function dy(n,e,t){if("string"==typeof(t=(0,se.m9)(t))){if(""===t)throw new L(O.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!_a(e)&&-1!==t.indexOf("/"))throw new L(O.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(we.fromString(t));if(!j.isDocumentKey(r))throw new L(O.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ri(n,new j(r))}if(t instanceof $e)return ri(n,t._key);throw new L(O.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ch(t)}.`)}function fy(n,e){if(!Array.isArray(n)||0===n.length)throw new L(O.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function py(n,e){if(e.isInequality()){const r=qi(n),i=e.field;if(null!==r&&!r.isEqual(i))throw new L(O.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${i.toString()}'`);const s=ya(n);null!==s&&my(0,i,s)}const t=function(r,i){for(const s of r)for(const a of s.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new L(O.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function my(n,e,t){if(!t.isEqual(e))throw new L(O.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class Cp{convertValue(e,t="none"){switch(Ir(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Qe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Hn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw J()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return _r(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new lh(Qe(e.latitude),Qe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=da(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Wn(e));default:return null}}convertTimestamp(e){const t=Kn(e);return new je(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=we.fromString(e);te(km(r));const i=new Qn(r.get(1),r.get(3)),s=new j(r.popFirst(5));return i.isEqual(t)||He(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function vh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class D0 extends Cp{constructor(e){super(),this.firestore=e}convertBytes(e){return new Cr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new $e(this.firestore,null,t)}}class io{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class fi extends Su{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Au(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(mh("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Au extends fi{data(e={}){return super.data(e)}}class Ji{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new io(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Au(this._firestore,this._userDataWriter,r.key,r,new io(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new L(O.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let s=0;return r._snapshot.docChanges.map(a=>({type:"added",doc:new Au(r._firestore,r._userDataWriter,a.doc.key,a.doc,new io(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:s++}))}{let s=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>i||3!==a.type).map(a=>{const h=new Au(r._firestore,r._userDataWriter,a.doc.key,a.doc,new io(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);let d=-1,m=-1;return 0!==a.type&&(d=s.indexOf(a.doc.key),s=s.delete(a.doc.key)),1!==a.type&&(s=s.add(a.doc),m=s.indexOf(a.doc.key)),{type:R0(a.type),doc:h,oldIndex:d,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function R0(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return J()}}function yy(n,e){return n instanceof fi&&e instanceof fi?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ji&&e instanceof Ji&&n._firestore===e._firestore&&_p(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class Xi extends Cp{constructor(e){super(),this.firestore=e}convertBytes(e){return new Cr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new $e(this.firestore,null,t)}}function _y(n,e,t){n=Se(n,$e);const r=Se(n.firestore,Ke),i=vh(n.converter,e,t);return Va(r,[dh(no(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,Ye.none())])}function vy(n,e,t,...r){n=Se(n,$e);const i=Se(n.firestore,Ke),s=no(i);let a;return a="string"==typeof(e=(0,se.m9)(e))||e instanceof di?Ep(s,"updateDoc",n._key,e,t,r):wp(s,"updateDoc",n._key,e),Va(i,[a.toMutation(n._key,Ye.exists(!0))])}function Iy(n,...e){var t,r,i;n=(0,se.m9)(n);let s={includeMetadataChanges:!1},a=0;"object"!=typeof e[a]||vp(e[a])||(s=e[a],a++);const h={includeMetadataChanges:s.includeMetadataChanges};if(vp(e[a])){const _=e[a];e[a]=null===(t=_.next)||void 0===t?void 0:t.bind(_),e[a+1]=null===(r=_.error)||void 0===r?void 0:r.bind(_),e[a+2]=null===(i=_.complete)||void 0===i?void 0:i.bind(_)}let d,m,y;if(n instanceof $e)m=Se(n.firestore,Ke),y=Er(n._key.path),d={next:_=>{e[a]&&e[a](xp(m,n,_))},error:e[a+1],complete:e[a+2]};else{const _=Se(n,Vt);m=Se(_.firestore,Ke),y=_._query;const S=new Xi(m);d={next:N=>{e[a]&&e[a](new Ji(m,S,_,N))},error:e[a+1],complete:e[a+2]},ly(n._query)}return function(_,S,N,Z){const K=new ih(Z),H=new Lf(S,K,N);return _.asyncQueue.enqueueAndForget((0,b.Z)(function*(){return Df(yield Fa(_),H)})),()=>{K.Dc(),_.asyncQueue.enqueueAndForget((0,b.Z)(function*(){return Rf(yield Fa(_),H)}))}}(lt(m),y,h,d)}function Va(n,e){return function(t,r){const i=new at;return t.asyncQueue.enqueueAndForget((0,b.Z)(function*(){return function Cv(n,e,t){return zf.apply(this,arguments)}(yield mp(t),r,i)})),i.promise}(lt(n),e)}function xp(n,e,t){const r=t.docs.get(e._key),i=new Xi(n);return new fi(n,i,e._key,r,new io(t.hasPendingWrites,t.fromCache),e.converter)}const Y0={maxAttempts:5};class wy{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=no(e)}set(e,t,r){this._verifyNotCommitted();const i=es(e,this._firestore),s=vh(i.converter,t,r),a=dh(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(a.toMutation(i._key,Ye.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=es(e,this._firestore);let a;return a="string"==typeof(t=(0,se.m9)(t))||t instanceof di?Ep(this._dataReader,"WriteBatch.update",s._key,t,r,i):wp(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,Ye.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=es(e,this._firestore);return this._mutations=this._mutations.concat(new Ea(t._key,Ye.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new L(O.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function es(n,e){if((n=(0,se.m9)(n)).firestore!==e)throw new L(O.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class J0 extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=no(e)}get(e){const t=es(e,this._firestore),r=new D0(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||1!==i.length)return J();const s=i[0];if(s.isFoundDocument())return new Su(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new Su(this._firestore,r,t._key,null,t.converter);throw J()})}set(e,t,r){const i=es(e,this._firestore),s=vh(i.converter,t,r),a=dh(this._dataReader,"Transaction.set",i._key,s,null!==i.converter,r);return this._transaction.set(i._key,a),this}update(e,t,r,...i){const s=es(e,this._firestore);let a;return a="string"==typeof(t=(0,se.m9)(t))||t instanceof di?Ep(this._dataReader,"Transaction.update",s._key,t,r,i):wp(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,a),this}delete(e){const t=es(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=es(e,this._firestore),r=new Xi(this._firestore);return super.get(e).then(i=>new fi(this._firestore,r,t._key,i._document,new io(!1,!1),t.converter))}}function Ap(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new L("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Ty(){if(typeof Uint8Array>"u")throw new L("unimplemented","Uint8Arrays are not available in this environment.")}function by(){if(!function bd(){return typeof atob<"u"}())throw new L("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){mr=Re.SDK_VERSION,(0,Re._registerComponent)(new ce.wA("firestore",(t,{instanceIdentifier:r,options:i})=>{const s=t.getProvider("app").getImmediate(),a=new Ke(new ta(t.getProvider("auth-internal")),new id(t.getProvider("app-check-internal")),function(h,d){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new L(O.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Qn(h.options.projectId,d)}(s,r),s);return i=Object.assign({useFetchStreams:e},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),(0,Re.registerVersion)(ml,"3.13.0",n),(0,Re.registerVersion)(ml,"3.13.0","esm2017")}();class ku{constructor(e){this._delegate=e}static fromBase64String(e){return by(),new ku(Cr.fromBase64String(e))}static fromUint8Array(e){return Ty(),new ku(Cr.fromUint8Array(e))}toBase64(){return by(),this._delegate.toBase64()}toUint8Array(){return Ty(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function kp(n){return function aI(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class cI{enableIndexedDbPersistence(e,t){return function o0(n,e){ny(n=Se(n,Ke));const t=lt(n);if(t._uninitializedComponentsProvider)throw new L(O.FAILED_PRECONDITION,"SDK cache is already specified.");Jt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new La;return ty(t,i,new cp(i,r.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function a0(n){ny(n=Se(n,Ke));const e=lt(n);if(e._uninitializedComponentsProvider)throw new L(O.FAILED_PRECONDITION,"SDK cache is already specified.");Jt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new La;return ty(e,r,new Lg(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function c0(n){if(n._initialized&&!n._terminated)throw new L(O.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new at;return n._queue.enqueueAndForgetEvenWhileRestricted((0,b.Z)(function*(){try{yield(t=(0,b.Z)(function*(r){if(!yn.D())return Promise.resolve();const i=r+"main";yield yn.delete(i)}),function(r){return t.apply(this,arguments)})(Xd(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Sy{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Qn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Jt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function Yg(n,e,t,r={}){var i;const s=(n=Se(n,wu))._getSettings(),a=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&Jt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let h,d;if("string"==typeof r.mockUserToken)h=r.mockUserToken,d=mt.MOCK_USER;else{h=(0,se.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new L(O.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new mt(m)}n._authCredentials=new kc(new ea(h,d))}}(this._delegate,e,t,r)}enableNetwork(){return function l0(n){return function Kv(n){return n.asyncQueue.enqueue((0,b.Z)(function*(){const e=yield Vg(n),t=yield Bg(n);return e.setNetworkEnabled(!0),function(r){const i=W(r);return i.vu.delete(0),_u(i)}(t)}))}(lt(n=Se(n,Ke)))}(this._delegate)}disableNetwork(){return function h0(n){return function Hv(n){return n.asyncQueue.enqueue((0,b.Z)(function*(){const e=yield Vg(n),t=yield Bg(n);return e.setNetworkEnabled(!1),(r=(0,b.Z)(function*(i){const s=W(i);s.vu.add(0),yield ka(s),s.bu.set("Offline")}),function(i){return r.apply(this,arguments)})(t);var r}))}(lt(n=Se(n,Ke)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,$g("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function u0(n){return function(e){const t=new at;return e.asyncQueue.enqueueAndForget((0,b.Z)(function*(){return function Ov(n,e){return $f.apply(this,arguments)}(yield mp(e),t)})),t.promise}(lt(n=Se(n,Ke)))}(this._delegate)}onSnapshotsInSync(e){return function Z0(n,e){return function Yv(n,e){const t=new ih(e);return n.asyncQueue.enqueueAndForget((0,b.Z)(function*(){return r=yield Fa(n),i=t,W(r).ku.add(i),void i.next();var r,i})),()=>{t.Dc(),n.asyncQueue.enqueueAndForget((0,b.Z)(function*(){return r=yield Fa(n),i=t,void W(r).ku.delete(i);var r,i}))}}(lt(n=Se(n,Ke)),vp(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new L("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Ba(this,Jg(this._delegate,e))}catch(t){throw tn(t,"collection()","Firestore.collection()")}}doc(e){try{return new Vn(this,uh(this._delegate,e))}catch(t){throw tn(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new nn(this,function t0(n,e){if(n=Se(n,wu),yp("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new L(O.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Vt(n,null,(t=e,new Un(we.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw tn(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function X0(n,e,t){n=Se(n,Ke);const r=Object.assign(Object.assign({},Y0),t);return function(i){if(i.maxAttempts<1)throw new L(O.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,s,a){const h=new at;return i.asyncQueue.enqueueAndForget((0,b.Z)(function*(){const d=yield function zg(n){return oh(n).then(e=>e.datastore)}(i);new jv(i.asyncQueue,d,a,s,h).run()})),h.promise}(lt(n),i=>e(new J0(n,i)),r)}(this._delegate,t=>e(new Cy(this,t)))}batch(){return lt(this._delegate),new xy(new wy(this._delegate,e=>Va(this._delegate,e)))}loadBundle(e){return function d0(n,e){const t=lt(n=Se(n,Ke)),r=new r0;return function Jv(n,e,t,r){const i=function(s,a){let h;return h="string"==typeof s?hm().encode(s):s,d=function(d,m){if(d instanceof Uint8Array)return Fg(d,m);if(d instanceof ArrayBuffer)return Fg(new Uint8Array(d),m);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(h),new Gv(d,a);var d}(t,yu(e));n.asyncQueue.enqueueAndForget((0,b.Z)(function*(){!function zv(n,e,t){const r=W(n);var i;(i=(0,b.Z)(function*(s,a,h){try{const d=yield a.getMetadata();if(yield function(S,N){const Z=W(S),K=ut(N.createTime);return Z.persistence.runTransaction("hasNewerBundle","readonly",H=>Z.qs.getBundleMetadata(H,N.id)).then(H=>!!H&&H.createTime.compareTo(K)>=0)}(s.localStore,d))return yield a.close(),h._completeWith({taskState:"Success",documentsLoaded:(S=d).totalDocuments,bytesLoaded:S.totalBytes,totalDocuments:S.totalDocuments,totalBytes:S.totalBytes}),Promise.resolve(new Set);h._updateProgress(xg(d));const m=new Iv(d,s.localStore,a.serializer);let y=yield a.bc();for(;y;){const S=yield m.zu(y);S&&h._updateProgress(S),y=yield a.bc()}const _=yield m.complete();return yield hi(s,_.Ju,void 0),yield function(S,N){const Z=W(S);return Z.persistence.runTransaction("Save bundle","readwrite",K=>Z.qs.saveBundleMetadata(K,N))}(s.localStore,d),h._completeWith(_.progress),Promise.resolve(_.Hu)}catch(d){return Jt("SyncEngine",`Loading bundle failed with ${d}`),h._failWith(d),Promise.resolve(new Set)}var S}),function(s,a,h){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield mp(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function f0(n,e){return function Xv(n,e){return n.asyncQueue.enqueue((0,b.Z)(function*(){return function(t,r){const i=W(t);return i.persistence.runTransaction("Get named query","readonly",s=>i.qs.getNamedQuery(s,r))}(yield ah(n),e)}))}(lt(n=Se(n,Ke)),e).then(t=>t?new Vt(n,null,t.query):null)}(this._delegate,e).then(t=>t?new nn(this,t):null)}}class Ih extends Cp{constructor(e){super(),this.firestore=e}convertBytes(e){return new ku(new Cr(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Vn.forKey(t,this.firestore,null)}}class Cy{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ih(e)}get(e){const t=oo(e);return this._delegate.get(t).then(r=>new Ou(this._firestore,new fi(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=oo(e);return r?(Ap("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=oo(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=oo(e);return this._delegate.delete(t),this}}class xy{constructor(e){this._delegate=e}set(e,t,r){const i=oo(e);return r?(Ap("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=oo(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=oo(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class so{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new Au(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Du(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=so.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new so(e,new Ih(e),t),i.set(t,s)),s}}so.INSTANCES=new WeakMap;class Vn{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ih(e)}static forPath(e,t,r){if(e.length%2!=0)throw new L("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Vn(t,new $e(t._delegate,r,new j(e)))}static forKey(e,t,r){return new Vn(t,new $e(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Ba(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Ba(this.firestore,Jg(this._delegate,e))}catch(t){throw tn(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,se.m9)(e))instanceof $e&&Xg(this._delegate,e)}set(e,t){t=Ap("DocumentReference.set",t);try{return t?_y(this._delegate,e,t):_y(this._delegate,e)}catch(r){throw tn(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?vy(this._delegate,e):vy(this._delegate,e,t,...r)}catch(i){throw tn(i,"updateDoc()","DocumentReference.update()")}}delete(){return function B0(n){return Va(Se(n.firestore,Ke),[new Ea(n._key,Ye.none())])}(this._delegate)}onSnapshot(...e){const t=Ay(e),r=ky(e,i=>new Ou(this.firestore,new fi(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Iy(this._delegate,t,r)}get(e){let t;return t="cache"===e?.source?function M0(n){n=Se(n,$e);const e=Se(n.firestore,Ke),t=lt(e),r=new Xi(e);return function Wv(n,e){const t=new at;return n.asyncQueue.enqueueAndForget((0,b.Z)(function*(){return(r=(0,b.Z)(function*(i,s,a){try{const h=yield function(d,m){const y=W(d);return y.persistence.runTransaction("read document","readonly",_=>y.localDocuments.getDocument(_,m))}(i,s);h.isFoundDocument()?a.resolve(h):h.isNoDocument()?a.resolve(null):a.reject(new L(O.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(h){const d=Na(h,`Failed to get document '${s} from cache`);a.reject(d)}}),function(i,s,a){return r.apply(this,arguments)})(yield ah(n),e,t);var r})),t.promise}(t,n._key).then(i=>new fi(e,r,n._key,i,new io(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===e?.source?function L0(n){n=Se(n,$e);const e=Se(n.firestore,Ke);return Zg(lt(e),n._key,{source:"server"}).then(t=>xp(e,n,t))}(this._delegate):function P0(n){n=Se(n,$e);const e=Se(n.firestore,Ke);return Zg(lt(e),n._key).then(t=>xp(e,n,t))}(this._delegate),t.then(r=>new Ou(this.firestore,new fi(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Vn(this.firestore,this._delegate.withConverter(e?so.getInstance(this.firestore,e):null))}}function tn(n,e,t){return n.message=n.message.replace(e,t),n}function Ay(n){for(const e of n)if("object"==typeof e&&!kp(e))return e;return{}}function ky(n,e){var t,r;let i;return i=kp(n[0])?n[0]:kp(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Ou{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Vn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return yy(this._delegate,e._delegate)}}class Du extends Ou{data(e){const t=this._delegate.data(e);return function nd(n,e){n||J()}(void 0!==t),t}}class nn{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ih(e)}where(e,t,r){try{return new nn(this.firestore,Yi(this._delegate,function T0(n,e,t){const r=e,i=mh("where",n);return xu._create(i,r,t)}(e,t,r)))}catch(i){throw tn(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new nn(this.firestore,Yi(this._delegate,function b0(n,e="asc"){const t=e,r=mh("orderBy",n);return Sp._create(r,t)}(e,t)))}catch(r){throw tn(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new nn(this.firestore,Yi(this._delegate,function S0(n){return Wg("limit",n),gh._create("limit",n,"F")}(e)))}catch(t){throw tn(t,"limit()","Query.limit()")}}limitToLast(e){try{return new nn(this.firestore,Yi(this._delegate,function C0(n){return Wg("limitToLast",n),gh._create("limitToLast",n,"L")}(e)))}catch(t){throw tn(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new nn(this.firestore,Yi(this._delegate,function x0(...n){return yh._create("startAt",n,!0)}(...e)))}catch(t){throw tn(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new nn(this.firestore,Yi(this._delegate,function A0(...n){return yh._create("startAfter",n,!1)}(...e)))}catch(t){throw tn(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new nn(this.firestore,Yi(this._delegate,function k0(...n){return _h._create("endBefore",n,!1)}(...e)))}catch(t){throw tn(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new nn(this.firestore,Yi(this._delegate,function O0(...n){return _h._create("endAt",n,!0)}(...e)))}catch(t){throw tn(t,"endAt()","Query.endAt()")}}isEqual(e){return _p(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function U0(n){n=Se(n,Vt);const e=Se(n.firestore,Ke),t=lt(e),r=new Xi(e);return function Qv(n,e){const t=new at;return n.asyncQueue.enqueueAndForget((0,b.Z)(function*(){return(r=(0,b.Z)(function*(i,s,a){try{const h=yield Yl(i,s,!0),d=new Og(s,h.ir),m=d.sc(h.documents),y=d.applyChanges(m,!1);a.resolve(y.snapshot)}catch(h){const d=Na(h,`Failed to execute query '${s} against cache`);a.reject(d)}}),function(i,s,a){return r.apply(this,arguments)})(yield ah(n),e,t);var r})),t.promise}(t,n._query).then(i=>new Ji(e,r,n,i))}(this._delegate):"server"===e?.source?function V0(n){n=Se(n,Vt);const e=Se(n.firestore,Ke),t=lt(e),r=new Xi(e);return Gg(t,n._query,{source:"server"}).then(i=>new Ji(e,r,n,i))}(this._delegate):function F0(n){n=Se(n,Vt);const e=Se(n.firestore,Ke),t=lt(e),r=new Xi(e);return ly(n._query),Gg(t,n._query).then(i=>new Ji(e,r,n,i))}(this._delegate),t.then(r=>new Op(this.firestore,new Ji(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=Ay(e),r=ky(e,i=>new Op(this.firestore,new Ji(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Iy(this._delegate,t,r)}withConverter(e){return new nn(this.firestore,this._delegate.withConverter(e?so.getInstance(this.firestore,e):null))}}class lI{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Du(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Op{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new nn(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Du(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new lI(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Du(this._firestore,r))})}isEqual(e){return yy(this._delegate,e._delegate)}}class Ba extends nn{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Vn(this.firestore,e):null}doc(e){try{return new Vn(this.firestore,void 0===e?uh(this._delegate):uh(this._delegate,e))}catch(t){throw tn(t,"doc()","CollectionReference.doc()")}}add(e){return function z0(n,e){const t=Se(n.firestore,Ke),r=uh(n),i=vh(n.converter,e);return Va(t,[dh(no(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,Ye.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Vn(this.firestore,t))}isEqual(e){return Xg(this._delegate,e._delegate)}withConverter(e){return new Ba(this.firestore,this._delegate.withConverter(e?so.getInstance(this.firestore,e):null))}}function oo(n){return Se(n,$e)}class Dp{constructor(...e){this._delegate=new di(...e)}static documentId(){return new Dp(We.keyField().canonicalString())}isEqual(e){return(e=(0,se.m9)(e))instanceof di&&this._delegate._internalPath.isEqual(e._internalPath)}}class ao{constructor(e){this._delegate=e}static serverTimestamp(){const e=function tI(){return new Ip("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new ao(e)}static delete(){const e=function eI(){return new Tu("deleteField")}();return e._methodName="FieldValue.delete",new ao(e)}static arrayUnion(...e){const t=function nI(...n){return new _0("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new ao(t)}static arrayRemove(...e){const t=function rI(...n){return new v0("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new ao(t)}static increment(e){const t=function iI(n){return new I0("increment",n)}(e);return t._methodName="FieldValue.increment",new ao(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const hI={Firestore:Sy,GeoPoint:lh,Timestamp:je,Blob:ku,Transaction:Cy,WriteBatch:xy,DocumentReference:Vn,DocumentSnapshot:Ou,Query:nn,QueryDocumentSnapshot:Du,QuerySnapshot:Op,CollectionReference:Ba,FieldPath:Dp,FieldValue:ao,setLogLevel:function uI(n){!function td(n){Pn.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};function Oy(n,e){return function pI(n,e=er.z){return new gi.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}(n,e)}function Np(n,e){return Oy(n,e).pipe((0,ae.U)(t=>({payload:t,type:"query"})))}!function fI(n){(function dI(n,e){n.INTERNAL.registerComponent(new ce.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},hI)))})(n,(e,t)=>new Sy(e,t,new cI)),n.registerVersion("@firebase/firestore-compat","0.3.12")}(Pt.Z);class Dy{constructor(e,t){(0,P.Z)(this,"ref",void 0),(0,P.Z)(this,"afs",void 0),this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:i,query:s}=Fy(r,t);return new Py(i,s,this.afs)}snapshotChanges(){return function mI(n,e){return Oy(n,e).pipe((0,Sn.O)(void 0),D(),(0,ae.U)(t=>{const[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(it)}valueChanges(e={}){return this.snapshotChanges().pipe((0,ae.U)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,un.D)(this.ref.get(e)).pipe(it)}}function wh(n,e){return Np(n,e).pipe((0,Sn.O)(void 0),D(),(0,ae.U)(t=>{const[r,i]=t,s=i.payload.docChanges(),a=s.map(h=>({type:h.type,payload:h}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((h,d)=>{const m=s.find(_=>_.doc.ref.isEqual(h.ref)),y=r?.payload.docs.find(_=>_.ref.isEqual(h.ref));m&&JSON.stringify(m.doc.metadata)===JSON.stringify(h.metadata)||!m&&y&&JSON.stringify(y.metadata)===JSON.stringify(h.metadata)||a.push({type:"modified",payload:{oldIndex:d,newIndex:d,type:"modified",doc:h}})}),a}))}function Ny(n,e,t){return wh(n,t).pipe((0,A.R)((r,i)=>function gI(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function yI(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return Rp(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return Rp(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Rp(n,e.oldIndex,1)}return n}(n,r))}),n}(r,i.map(s=>s.payload),e),[]),(0,B.x)(),(0,ae.U)(r=>r.map(i=>({type:i.type,payload:i}))))}function Rp(n,e,t,...r){const i=n.slice();return i.splice(e,t,...r),i}function Ry(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}class Py{constructor(e,t,r){(0,P.Z)(this,"ref",void 0),(0,P.Z)(this,"query",void 0),(0,P.Z)(this,"afs",void 0),this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=wh(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,ae.U)(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,Sn.O)(void 0),D(),(0,T.h)(([r,i])=>i.length>0||!r),(0,ae.U)(([,r])=>r),it)}auditTrail(e){return this.stateChanges(e).pipe((0,A.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Ry(e);return Ny(this.query,t,this.afs.schedulers.outsideAngular).pipe(it)}valueChanges(e={}){return Np(this.query,this.afs.schedulers.outsideAngular).pipe((0,ae.U)(t=>t.payload.docs.map(r=>e.idField?{...r.data(),[e.idField]:r.id}:r.data())),it)}get(e){return(0,un.D)(this.query.get(e)).pipe(it)}add(e){return this.ref.add(e)}doc(e){return new Dy(this.ref.doc(e),this.afs)}}class _I{constructor(e,t){(0,P.Z)(this,"query",void 0),(0,P.Z)(this,"afs",void 0),this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?wh(this.query,this.afs.schedulers.outsideAngular).pipe((0,ae.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,T.h)(t=>t.length>0),it):wh(this.query,this.afs.schedulers.outsideAngular).pipe(it)}auditTrail(e){return this.stateChanges(e).pipe((0,A.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Ry(e);return Ny(this.query,t,this.afs.schedulers.outsideAngular).pipe(it)}valueChanges(e={}){return Np(this.query,this.afs.schedulers.outsideAngular).pipe((0,ae.U)(r=>r.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),it)}get(e){return(0,un.D)(this.query.get(e)).pipe(it)}}const My=new f.OlP("angularfire2.enableFirestorePersistence"),Ly=new f.OlP("angularfire2.firestore.persistenceSettings"),vI=new f.OlP("angularfire2.firestore.settings"),II=new f.OlP("angularfire2.firestore.use-emulator");function Fy(n,e=(t=>t)){return{query:e(n),ref:n}}let Uy=(()=>{var n;class e{constructor(r,i,s,a,h,d,m,y,_,S,N,Z,K,H,oe,ve,fe){(0,P.Z)(this,"schedulers",void 0),(0,P.Z)(this,"firestore",void 0),(0,P.Z)(this,"persistenceEnabled$",void 0),this.schedulers=m;const pe=nr(r,d,i),Ae=_;S&&dt(pe,d,N,K,H,oe,Z,ve),[this.firestore,this.persistenceEnabled$]=an(`${pe.name}.firestore`,"AngularFirestore",pe.name,()=>{const Ie=d.runOutsideAngular(()=>pe.firestore());if(a&&Ie.settings(a),Ae&&Ie.useEmulator(...Ae),s&&!(0,v.PM)(h)){const Ht=()=>{try{return(0,un.D)(Ie.enablePersistence(y||void 0).then(()=>!0,()=>!1))}catch(pi){return typeof console<"u"&&console.warn(pi),(0,Tn.of)(!1)}};return[Ie,d.runOutsideAngular(Ht)]}return[Ie,(0,Tn.of)(!1)]},[a,Ae,s])}collection(r,i){let s;s="string"==typeof r?this.firestore.collection(r):r;const{ref:a,query:h}=Fy(s,i),d=this.schedulers.ngZone.run(()=>a);return new Py(d,h,this)}collectionGroup(r,i){const s=i||(h=>h),a=this.firestore.collectionGroup(r);return new _I(s(a),this)}doc(r){let i;i="string"==typeof r?this.firestore.doc(r):r;const s=this.schedulers.ngZone.run(()=>i);return new Dy(s,this)}createId(){return this.firestore.collection("_").doc().id}}return n=e,(0,P.Z)(e,"\u0275fac",function(r){return new(r||n)(f.LFG(on),f.LFG(vt,8),f.LFG(My,8),f.LFG(vI,8),f.LFG(f.Lbi),f.LFG(f.R0b),f.LFG(Qt),f.LFG(Ly,8),f.LFG(II,8),f.LFG(be,8),f.LFG(k,8),f.LFG(ee,8),f.LFG(ue,8),f.LFG(Oe,8),f.LFG(It,8),f.LFG(st,8),f.LFG(ke,8))}),(0,P.Z)(e,"\u0275prov",f.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"})),e})(),wI=(()=>{var n;class e{constructor(){Pt.Z.registerVersion("angularfire",Bn.full,"fst-compat")}static enablePersistence(r){return{ngModule:e,providers:[{provide:My,useValue:!0},{provide:Ly,useValue:r}]}}}return n=e,(0,P.Z)(e,"\u0275fac",function(r){return new(r||n)}),(0,P.Z)(e,"\u0275mod",f.oAB({type:n})),(0,P.Z)(e,"\u0275inj",f.cJS({providers:[Uy]})),e})(),Vy=(()=>{var n;class e{constructor(r){this.db=r,this.dbPath="/puzzledata",this.puzzleDataRef=this.db.collection(this.dbPath)}getAll(){return this.puzzleDataRef}create(r){return this.puzzleDataRef.add({...r})}update(r,i){return this.puzzleDataRef.doc(r).update(i)}delete(r){return this.puzzleDataRef.doc(r).delete()}}return(n=e).\u0275fac=function(r){return new(r||n)(f.LFG(Uy))},n.\u0275prov=f.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var Nu=$(7423),Pp=$(568),_n=$(1591),Eh=$(7594);let Mp=(()=>{var n;class e extends Eh.s{}return n=e,(0,P.Z)(e,"\u0275fac",function(){let t;return function(i){return(t||(t=f.n5z(n)))(i||n)}}()),(0,P.Z)(e,"\u0275cmp",f.Xpm({type:n,selectors:[["CheckIcon"]],standalone:!0,features:[f.qOj,f.jDz],decls:2,vars:5,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M4.86199 11.5948C4.78717 11.5923 4.71366 11.5745 4.64596 11.5426C4.57826 11.5107 4.51779 11.4652 4.46827 11.4091L0.753985 7.69483C0.683167 7.64891 0.623706 7.58751 0.580092 7.51525C0.536478 7.44299 0.509851 7.36177 0.502221 7.27771C0.49459 7.19366 0.506156 7.10897 0.536046 7.03004C0.565935 6.95111 0.613367 6.88 0.674759 6.82208C0.736151 6.76416 0.8099 6.72095 0.890436 6.69571C0.970973 6.67046 1.05619 6.66385 1.13966 6.67635C1.22313 6.68886 1.30266 6.72017 1.37226 6.76792C1.44186 6.81567 1.4997 6.8786 1.54141 6.95197L4.86199 10.2503L12.6397 2.49483C12.7444 2.42694 12.8689 2.39617 12.9932 2.40745C13.1174 2.41873 13.2343 2.47141 13.3251 2.55705C13.4159 2.64268 13.4753 2.75632 13.4938 2.87973C13.5123 3.00315 13.4888 3.1292 13.4271 3.23768L5.2557 11.4091C5.20618 11.4652 5.14571 11.5107 5.07801 11.5426C5.01031 11.5745 4.9368 11.5923 4.86199 11.5948Z","fill","currentColor"]],template:function(r,i){1&r&&(f.O4$(),f.TgZ(0,"svg",0),f._UZ(1,"path",1),f.qZA()),2&r&&(f.Tol(i.getClassNames()),f.uIk("aria-label",i.ariaLabel)("aria-hidden",i.ariaHidden)("role",i.role))},encapsulation:2})),e})(),Lp=(()=>{var n;class e extends Eh.s{}return n=e,(0,P.Z)(e,"\u0275fac",function(){let t;return function(i){return(t||(t=f.n5z(n)))(i||n)}}()),(0,P.Z)(e,"\u0275cmp",f.Xpm({type:n,selectors:[["InfoCircleIcon"]],standalone:!0,features:[f.qOj,f.jDz],decls:6,vars:5,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["clip-path","url(#clip0_408_21102)"],["fill-rule","evenodd","clip-rule","evenodd","d","M3.11101 12.8203C4.26215 13.5895 5.61553 14 7 14C8.85652 14 10.637 13.2625 11.9497 11.9497C13.2625 10.637 14 8.85652 14 7C14 5.61553 13.5895 4.26215 12.8203 3.11101C12.0511 1.95987 10.9579 1.06266 9.67879 0.532846C8.3997 0.00303296 6.99224 -0.13559 5.63437 0.134506C4.2765 0.404603 3.02922 1.07129 2.05026 2.05026C1.07129 3.02922 0.404603 4.2765 0.134506 5.63437C-0.13559 6.99224 0.00303296 8.3997 0.532846 9.67879C1.06266 10.9579 1.95987 12.0511 3.11101 12.8203ZM3.75918 2.14976C4.71846 1.50879 5.84628 1.16667 7 1.16667C8.5471 1.16667 10.0308 1.78125 11.1248 2.87521C12.2188 3.96918 12.8333 5.45291 12.8333 7C12.8333 8.15373 12.4912 9.28154 11.8502 10.2408C11.2093 11.2001 10.2982 11.9478 9.23232 12.3893C8.16642 12.8308 6.99353 12.9463 5.86198 12.7212C4.73042 12.4962 3.69102 11.9406 2.87521 11.1248C2.05941 10.309 1.50384 9.26958 1.27876 8.13803C1.05367 7.00647 1.16919 5.83358 1.61071 4.76768C2.05222 3.70178 2.79989 2.79074 3.75918 2.14976ZM7.00002 4.8611C6.84594 4.85908 6.69873 4.79698 6.58977 4.68801C6.48081 4.57905 6.4187 4.43185 6.41669 4.27776V3.88888C6.41669 3.73417 6.47815 3.58579 6.58754 3.4764C6.69694 3.367 6.84531 3.30554 7.00002 3.30554C7.15473 3.30554 7.3031 3.367 7.4125 3.4764C7.52189 3.58579 7.58335 3.73417 7.58335 3.88888V4.27776C7.58134 4.43185 7.51923 4.57905 7.41027 4.68801C7.30131 4.79698 7.1541 4.85908 7.00002 4.8611ZM7.00002 10.6945C6.84594 10.6925 6.69873 10.6304 6.58977 10.5214C6.48081 10.4124 6.4187 10.2652 6.41669 10.1111V6.22225C6.41669 6.06754 6.47815 5.91917 6.58754 5.80977C6.69694 5.70037 6.84531 5.63892 7.00002 5.63892C7.15473 5.63892 7.3031 5.70037 7.4125 5.80977C7.52189 5.91917 7.58335 6.06754 7.58335 6.22225V10.1111C7.58134 10.2652 7.51923 10.4124 7.41027 10.5214C7.30131 10.6304 7.1541 10.6925 7.00002 10.6945Z","fill","currentColor"],["id","clip0_408_21102"],["width","14","height","14","fill","white"]],template:function(r,i){1&r&&(f.O4$(),f.TgZ(0,"svg",0)(1,"g",1),f._UZ(2,"path",2),f.qZA(),f.TgZ(3,"defs")(4,"clipPath",3),f._UZ(5,"rect",4),f.qZA()()()),2&r&&(f.Tol(i.getClassNames()),f.uIk("aria-label",i.ariaLabel)("aria-hidden",i.ariaHidden)("role",i.role))},encapsulation:2})),e})(),Fp=(()=>{var n;class e extends Eh.s{}return n=e,(0,P.Z)(e,"\u0275fac",function(){let t;return function(i){return(t||(t=f.n5z(n)))(i||n)}}()),(0,P.Z)(e,"\u0275cmp",f.Xpm({type:n,selectors:[["TimesCircleIcon"]],standalone:!0,features:[f.qOj,f.jDz],decls:6,vars:5,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["clip-path","url(#clip0_334_13179)"],["fill-rule","evenodd","clip-rule","evenodd","d","M7 14C5.61553 14 4.26215 13.5895 3.11101 12.8203C1.95987 12.0511 1.06266 10.9579 0.532846 9.67879C0.00303296 8.3997 -0.13559 6.99224 0.134506 5.63437C0.404603 4.2765 1.07129 3.02922 2.05026 2.05026C3.02922 1.07129 4.2765 0.404603 5.63437 0.134506C6.99224 -0.13559 8.3997 0.00303296 9.67879 0.532846C10.9579 1.06266 12.0511 1.95987 12.8203 3.11101C13.5895 4.26215 14 5.61553 14 7C14 8.85652 13.2625 10.637 11.9497 11.9497C10.637 13.2625 8.85652 14 7 14ZM7 1.16667C5.84628 1.16667 4.71846 1.50879 3.75918 2.14976C2.79989 2.79074 2.05222 3.70178 1.61071 4.76768C1.16919 5.83358 1.05367 7.00647 1.27876 8.13803C1.50384 9.26958 2.05941 10.309 2.87521 11.1248C3.69102 11.9406 4.73042 12.4962 5.86198 12.7212C6.99353 12.9463 8.16642 12.8308 9.23232 12.3893C10.2982 11.9478 11.2093 11.2001 11.8502 10.2408C12.4912 9.28154 12.8333 8.15373 12.8333 7C12.8333 5.45291 12.2188 3.96918 11.1248 2.87521C10.0308 1.78125 8.5471 1.16667 7 1.16667ZM4.66662 9.91668C4.58998 9.91704 4.51404 9.90209 4.44325 9.87271C4.37246 9.84333 4.30826 9.8001 4.2544 9.74557C4.14516 9.6362 4.0838 9.48793 4.0838 9.33335C4.0838 9.17876 4.14516 9.0305 4.2544 8.92113L6.17553 7L4.25443 5.07891C4.15139 4.96832 4.09529 4.82207 4.09796 4.67094C4.10063 4.51982 4.16185 4.37563 4.26872 4.26876C4.3756 4.16188 4.51979 4.10066 4.67091 4.09799C4.82204 4.09532 4.96829 4.15142 5.07887 4.25446L6.99997 6.17556L8.92106 4.25446C9.03164 4.15142 9.1779 4.09532 9.32903 4.09799C9.48015 4.10066 9.62434 4.16188 9.73121 4.26876C9.83809 4.37563 9.89931 4.51982 9.90198 4.67094C9.90464 4.82207 9.84855 4.96832 9.74551 5.07891L7.82441 7L9.74554 8.92113C9.85478 9.0305 9.91614 9.17876 9.91614 9.33335C9.91614 9.48793 9.85478 9.6362 9.74554 9.74557C9.69168 9.8001 9.62748 9.84333 9.55669 9.87271C9.4859 9.90209 9.40996 9.91704 9.33332 9.91668C9.25668 9.91704 9.18073 9.90209 9.10995 9.87271C9.03916 9.84333 8.97495 9.8001 8.9211 9.74557L6.99997 7.82444L5.07884 9.74557C5.02499 9.8001 4.96078 9.84333 4.88999 9.87271C4.81921 9.90209 4.74326 9.91704 4.66662 9.91668Z","fill","currentColor"],["id","clip0_334_13179"],["width","14","height","14","fill","white"]],template:function(r,i){1&r&&(f.O4$(),f.TgZ(0,"svg",0)(1,"g",1),f._UZ(2,"path",2),f.qZA(),f.TgZ(3,"defs")(4,"clipPath",3),f._UZ(5,"rect",4),f.qZA()()()),2&r&&(f.Tol(i.getClassNames()),f.uIk("aria-label",i.ariaLabel)("aria-hidden",i.ariaHidden)("role",i.role))},encapsulation:2})),e})(),Up=(()=>{var n;class e extends Eh.s{}return n=e,(0,P.Z)(e,"\u0275fac",function(){let t;return function(i){return(t||(t=f.n5z(n)))(i||n)}}()),(0,P.Z)(e,"\u0275cmp",f.Xpm({type:n,selectors:[["ExclamationTriangleIcon"]],standalone:!0,features:[f.qOj,f.jDz],decls:8,vars:5,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["clip-path","url(#clip0_323_12417)"],["d","M13.4018 13.1893H0.598161C0.49329 13.189 0.390283 13.1615 0.299143 13.1097C0.208003 13.0578 0.131826 12.9832 0.0780112 12.8932C0.0268539 12.8015 0 12.6982 0 12.5931C0 12.4881 0.0268539 12.3848 0.0780112 12.293L6.47985 1.08982C6.53679 1.00399 6.61408 0.933574 6.70484 0.884867C6.7956 0.836159 6.897 0.810669 7 0.810669C7.103 0.810669 7.2044 0.836159 7.29516 0.884867C7.38592 0.933574 7.46321 1.00399 7.52015 1.08982L13.922 12.293C13.9731 12.3848 14 12.4881 14 12.5931C14 12.6982 13.9731 12.8015 13.922 12.8932C13.8682 12.9832 13.792 13.0578 13.7009 13.1097C13.6097 13.1615 13.5067 13.189 13.4018 13.1893ZM1.63046 11.989H12.3695L7 2.59425L1.63046 11.989Z","fill","currentColor"],["d","M6.99996 8.78801C6.84143 8.78594 6.68997 8.72204 6.57787 8.60993C6.46576 8.49782 6.40186 8.34637 6.39979 8.18784V5.38703C6.39979 5.22786 6.46302 5.0752 6.57557 4.96265C6.68813 4.85009 6.84078 4.78686 6.99996 4.78686C7.15914 4.78686 7.31179 4.85009 7.42435 4.96265C7.5369 5.0752 7.60013 5.22786 7.60013 5.38703V8.18784C7.59806 8.34637 7.53416 8.49782 7.42205 8.60993C7.30995 8.72204 7.15849 8.78594 6.99996 8.78801Z","fill","currentColor"],["d","M6.99996 11.1887C6.84143 11.1866 6.68997 11.1227 6.57787 11.0106C6.46576 10.8985 6.40186 10.7471 6.39979 10.5885V10.1884C6.39979 10.0292 6.46302 9.87658 6.57557 9.76403C6.68813 9.65147 6.84078 9.58824 6.99996 9.58824C7.15914 9.58824 7.31179 9.65147 7.42435 9.76403C7.5369 9.87658 7.60013 10.0292 7.60013 10.1884V10.5885C7.59806 10.7471 7.53416 10.8985 7.42205 11.0106C7.30995 11.1227 7.15849 11.1866 6.99996 11.1887Z","fill","currentColor"],["id","clip0_323_12417"],["width","14","height","14","fill","white"]],template:function(r,i){1&r&&(f.O4$(),f.TgZ(0,"svg",0)(1,"g",1),f._UZ(2,"path",2)(3,"path",3)(4,"path",4),f.qZA(),f.TgZ(5,"defs")(6,"clipPath",5),f._UZ(7,"rect",6),f.qZA()()()),2&r&&(f.Tol(i.getClassNames()),f.uIk("aria-label",i.ariaLabel)("aria-hidden",i.ariaHidden)("role",i.role))},encapsulation:2})),e})();var Vp=$(2132);const By=["container"];function EI(n,e){if(1&n&&f._UZ(0,"span"),2&n){const t=f.oxw(2);f.Tol("p-toast-message-icon pi "+t.message.icon)}}function TI(n,e){1&n&&f._UZ(0,"CheckIcon")}function bI(n,e){1&n&&f._UZ(0,"InfoCircleIcon")}function SI(n,e){1&n&&f._UZ(0,"TimesCircleIcon")}function CI(n,e){1&n&&f._UZ(0,"ExclamationTriangleIcon")}function xI(n,e){if(1&n&&(f.TgZ(0,"span",11),f.ynx(1),f.YNc(2,TI,1,0,"CheckIcon",3),f.YNc(3,bI,1,0,"InfoCircleIcon",3),f.YNc(4,SI,1,0,"TimesCircleIcon",3),f.YNc(5,CI,1,0,"ExclamationTriangleIcon",3),f.BQk(),f.qZA()),2&n){const t=f.oxw(2);f.xp6(2),f.Q6J("ngIf","success"===t.message.severity),f.xp6(1),f.Q6J("ngIf","info"===t.message.severity),f.xp6(1),f.Q6J("ngIf","error"===t.message.severity),f.xp6(1),f.Q6J("ngIf","warn"===t.message.severity)}}function AI(n,e){if(1&n&&(f.ynx(0),f.YNc(1,EI,1,2,"span",6),f.YNc(2,xI,6,4,"span",7),f.TgZ(3,"div",8)(4,"div",9),f._uU(5),f.qZA(),f.TgZ(6,"div",10),f._uU(7),f.qZA()(),f.BQk()),2&n){const t=f.oxw();f.xp6(1),f.Q6J("ngIf",t.message.icon),f.xp6(1),f.Q6J("ngIf",!t.message.icon),f.xp6(3),f.Oqu(t.message.summary),f.xp6(2),f.Oqu(t.message.detail)}}function kI(n,e){1&n&&f.GkF(0)}function OI(n,e){if(1&n&&f._UZ(0,"span"),2&n){const t=f.oxw(2);f.Tol("p-toast-message-icon pi "+t.message.closeIcon)}}function DI(n,e){1&n&&f._UZ(0,"TimesIcon",14),2&n&&f.Q6J("styleClass","p-toast-icon-close-icon")}function NI(n,e){if(1&n){const t=f.EpF();f.TgZ(0,"button",12),f.NdJ("click",function(i){f.CHM(t);const s=f.oxw();return f.KtG(s.onCloseIconClick(i))})("keydown.enter",function(i){f.CHM(t);const s=f.oxw();return f.KtG(s.onCloseIconClick(i))}),f.YNc(1,OI,1,2,"span",6),f.YNc(2,DI,1,1,"TimesIcon",13),f.qZA()}if(2&n){const t=f.oxw();f.xp6(1),f.Q6J("ngIf",t.message.closeIcon),f.xp6(1),f.Q6J("ngIf",!t.message.closeIcon)}}const RI=function(n){return[n,"p-toast-message"]},PI=function(n,e,t,r){return{showTransformParams:n,hideTransformParams:e,showTransitionParams:t,hideTransitionParams:r}},MI=function(n){return{value:"visible",params:n}},LI=function(n){return{$implicit:n}};function FI(n,e){if(1&n){const t=f.EpF();f.TgZ(0,"p-toastItem",3),f.NdJ("onClose",function(i){f.CHM(t);const s=f.oxw();return f.KtG(s.onMessageClose(i))})("@toastAnimation.start",function(i){f.CHM(t);const s=f.oxw();return f.KtG(s.onAnimationStart(i))})("@toastAnimation.done",function(i){f.CHM(t);const s=f.oxw();return f.KtG(s.onAnimationEnd(i))}),f.qZA()}if(2&n){const t=e.$implicit,r=e.index,i=f.oxw();f.Q6J("message",t)("index",r)("template",i.template)("@toastAnimation",void 0)("showTransformOptions",i.showTransformOptions)("hideTransformOptions",i.hideTransformOptions)("showTransitionOptions",i.showTransitionOptions)("hideTransitionOptions",i.hideTransitionOptions)}}let UI=(()=>{var n;class e{constructor(r){(0,P.Z)(this,"zone",void 0),(0,P.Z)(this,"message",void 0),(0,P.Z)(this,"index",void 0),(0,P.Z)(this,"template",void 0),(0,P.Z)(this,"showTransformOptions",void 0),(0,P.Z)(this,"hideTransformOptions",void 0),(0,P.Z)(this,"showTransitionOptions",void 0),(0,P.Z)(this,"hideTransitionOptions",void 0),(0,P.Z)(this,"onClose",new f.vpe),(0,P.Z)(this,"containerViewChild",void 0),(0,P.Z)(this,"timeout",void 0),this.zone=r}ngAfterViewInit(){this.initTimeout()}initTimeout(){this.message.sticky||this.zone.runOutsideAngular(()=>{this.timeout=setTimeout(()=>{this.onClose.emit({index:this.index,message:this.message})},this.message.life||3e3)})}clearTimeout(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}onMouseEnter(){this.clearTimeout()}onMouseLeave(){this.initTimeout()}onCloseIconClick(r){this.clearTimeout(),this.onClose.emit({index:this.index,message:this.message}),r.preventDefault()}ngOnDestroy(){this.clearTimeout()}}return n=e,(0,P.Z)(e,"\u0275fac",function(r){return new(r||n)(f.Y36(f.R0b))}),(0,P.Z)(e,"\u0275cmp",f.Xpm({type:n,selectors:[["p-toastItem"]],viewQuery:function(r,i){if(1&r&&f.Gf(By,5),2&r){let s;f.iGM(s=f.CRH())&&(i.containerViewChild=s.first)}},hostAttrs:[1,"p-element"],inputs:{message:"message",index:"index",template:"template",showTransformOptions:"showTransformOptions",hideTransformOptions:"hideTransformOptions",showTransitionOptions:"showTransitionOptions",hideTransitionOptions:"hideTransitionOptions"},outputs:{onClose:"onClose"},decls:6,vars:21,consts:[[3,"ngClass","mouseenter","mouseleave"],["container",""],["role","alert","aria-live","assertive","aria-atomic","true",1,"p-toast-message-content",3,"ngClass"],[4,"ngIf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["type","button","class","p-toast-icon-close p-link","pRipple","",3,"click","keydown.enter",4,"ngIf"],[3,"class",4,"ngIf"],["class","p-toast-message-icon",4,"ngIf"],[1,"p-toast-message-text"],[1,"p-toast-summary"],[1,"p-toast-detail"],[1,"p-toast-message-icon"],["type","button","pRipple","",1,"p-toast-icon-close","p-link",3,"click","keydown.enter"],[3,"styleClass",4,"ngIf"],[3,"styleClass"]],template:function(r,i){1&r&&(f.TgZ(0,"div",0,1),f.NdJ("mouseenter",function(){return i.onMouseEnter()})("mouseleave",function(){return i.onMouseLeave()}),f.TgZ(2,"div",2),f.YNc(3,AI,8,4,"ng-container",3),f.YNc(4,kI,1,0,"ng-container",4),f.YNc(5,NI,3,2,"button",5),f.qZA()()),2&r&&(f.Tol(i.message.styleClass),f.Q6J("ngClass",f.VKq(10,RI,"p-toast-message-"+i.message.severity))("@messageState",f.VKq(17,MI,f.l5B(12,PI,i.showTransformOptions,i.hideTransformOptions,i.showTransitionOptions,i.hideTransitionOptions))),f.uIk("id",i.message.id),f.xp6(2),f.Q6J("ngClass",i.message.contentStyleClass),f.xp6(1),f.Q6J("ngIf",!i.template),f.xp6(1),f.Q6J("ngTemplateOutlet",i.template)("ngTemplateOutletContext",f.VKq(19,LI,i.message)),f.xp6(1),f.Q6J("ngIf",!1!==i.message.closable))},dependencies:function(){return[v.mk,v.O5,v.tP,Pp.H,Mp,Lp,Fp,Up,Vp.q]},encapsulation:2,data:{animation:[(0,_n.X$)("messageState",[(0,_n.SB)("visible",(0,_n.oB)({transform:"translateY(0)",opacity:1})),(0,_n.eR)("void => *",[(0,_n.oB)({transform:"{{showTransformParams}}",opacity:0}),(0,_n.jt)("{{showTransitionParams}}")]),(0,_n.eR)("* => void",[(0,_n.jt)("{{hideTransitionParams}}",(0,_n.oB)({height:0,opacity:0,transform:"{{hideTransformParams}}"}))])])]},changeDetection:0})),e})(),VI=(()=>{var n;class e{constructor(r,i,s,a,h){(0,P.Z)(this,"document",void 0),(0,P.Z)(this,"renderer",void 0),(0,P.Z)(this,"messageService",void 0),(0,P.Z)(this,"cd",void 0),(0,P.Z)(this,"config",void 0),(0,P.Z)(this,"key",void 0),(0,P.Z)(this,"autoZIndex",!0),(0,P.Z)(this,"baseZIndex",0),(0,P.Z)(this,"style",void 0),(0,P.Z)(this,"styleClass",void 0),(0,P.Z)(this,"position","top-right"),(0,P.Z)(this,"preventOpenDuplicates",!1),(0,P.Z)(this,"preventDuplicates",!1),(0,P.Z)(this,"showTransformOptions","translateY(100%)"),(0,P.Z)(this,"hideTransformOptions","translateY(-100%)"),(0,P.Z)(this,"showTransitionOptions","300ms ease-out"),(0,P.Z)(this,"hideTransitionOptions","250ms ease-in"),(0,P.Z)(this,"breakpoints",void 0),(0,P.Z)(this,"onClose",new f.vpe),(0,P.Z)(this,"containerViewChild",void 0),(0,P.Z)(this,"templates",void 0),(0,P.Z)(this,"messageSubscription",void 0),(0,P.Z)(this,"clearSubscription",void 0),(0,P.Z)(this,"messages",void 0),(0,P.Z)(this,"messagesArchieve",void 0),(0,P.Z)(this,"template",void 0),(0,P.Z)(this,"styleElement",void 0),(0,P.Z)(this,"id",(0,Nu.Th)()),this.document=r,this.renderer=i,this.messageService=s,this.cd=a,this.config=h}ngOnInit(){this.messageSubscription=this.messageService.messageObserver.subscribe(r=>{if(r)if(Array.isArray(r)){const i=r.filter(s=>this.canAdd(s));this.add(i)}else this.canAdd(r)&&this.add([r])}),this.clearSubscription=this.messageService.clearObserver.subscribe(r=>{r?this.key===r&&(this.messages=null):this.messages=null,this.cd.markForCheck()})}ngAfterViewInit(){this.breakpoints&&this.createStyle()}add(r){this.messages=this.messages?[...this.messages,...r]:[...r],this.preventDuplicates&&(this.messagesArchieve=this.messagesArchieve?[...this.messagesArchieve,...r]:[...r]),this.cd.markForCheck()}canAdd(r){let i=this.key===r.key;return i&&this.preventOpenDuplicates&&(i=!this.containsMessage(this.messages,r)),i&&this.preventDuplicates&&(i=!this.containsMessage(this.messagesArchieve,r)),i}containsMessage(r,i){return!!r&&null!=r.find(s=>s.summary===i.summary&&s.detail==i.detail&&s.severity===i.severity)}ngAfterContentInit(){this.templates.forEach(r=>{r.getType(),this.template=r.template})}onMessageClose(r){this.messages.splice(r.index,1),this.onClose.emit({message:r.message}),this.cd.detectChanges()}onAnimationStart(r){"void"===r.fromState&&(this.renderer.setAttribute(this.containerViewChild.nativeElement,this.id,""),this.autoZIndex&&""===this.containerViewChild.nativeElement.style.zIndex&&Nu.P9.set("modal",this.containerViewChild.nativeElement,this.baseZIndex||this.config.zIndex.modal))}onAnimationEnd(r){"void"===r.toState&&this.autoZIndex&&Nu.gb.isEmpty(this.messages)&&Nu.P9.clear(this.containerViewChild.nativeElement)}createStyle(){if(!this.styleElement){this.styleElement=this.renderer.createElement("style"),this.styleElement.type="text/css",this.renderer.appendChild(this.document.head,this.styleElement);let r="";for(let i in this.breakpoints){let s="";for(let a in this.breakpoints[i])s+=a+":"+this.breakpoints[i][a]+" !important;";r+=`\n                    @media screen and (max-width: ${i}) {\n                        .p-toast[${this.id}] {\n                           ${s}\n                        }\n                    }\n                `}this.renderer.setProperty(this.styleElement,"innerHTML",r)}}destroyStyle(){this.styleElement&&(this.renderer.removeChild(this.document.head,this.styleElement),this.styleElement=null)}ngOnDestroy(){this.messageSubscription&&this.messageSubscription.unsubscribe(),this.containerViewChild&&this.autoZIndex&&Nu.P9.clear(this.containerViewChild.nativeElement),this.clearSubscription&&this.clearSubscription.unsubscribe(),this.destroyStyle()}}return n=e,(0,P.Z)(e,"\u0275fac",function(r){return new(r||n)(f.Y36(v.K0),f.Y36(f.Qsj),f.Y36(R.ez),f.Y36(f.sBO),f.Y36(R.b4))}),(0,P.Z)(e,"\u0275cmp",f.Xpm({type:n,selectors:[["p-toast"]],contentQueries:function(r,i,s){if(1&r&&f.Suo(s,R.jx,4),2&r){let a;f.iGM(a=f.CRH())&&(i.templates=a)}},viewQuery:function(r,i){if(1&r&&f.Gf(By,5),2&r){let s;f.iGM(s=f.CRH())&&(i.containerViewChild=s.first)}},hostAttrs:[1,"p-element"],inputs:{key:"key",autoZIndex:"autoZIndex",baseZIndex:"baseZIndex",style:"style",styleClass:"styleClass",position:"position",preventOpenDuplicates:"preventOpenDuplicates",preventDuplicates:"preventDuplicates",showTransformOptions:"showTransformOptions",hideTransformOptions:"hideTransformOptions",showTransitionOptions:"showTransitionOptions",hideTransitionOptions:"hideTransitionOptions",breakpoints:"breakpoints"},outputs:{onClose:"onClose"},decls:3,vars:5,consts:[[3,"ngClass","ngStyle"],["container",""],[3,"message","index","template","showTransformOptions","hideTransformOptions","showTransitionOptions","hideTransitionOptions","onClose",4,"ngFor","ngForOf"],[3,"message","index","template","showTransformOptions","hideTransformOptions","showTransitionOptions","hideTransitionOptions","onClose"]],template:function(r,i){1&r&&(f.TgZ(0,"div",0,1),f.YNc(2,FI,1,8,"p-toastItem",2),f.qZA()),2&r&&(f.Tol(i.styleClass),f.Q6J("ngClass","p-toast p-component p-toast-"+i.position)("ngStyle",i.style),f.xp6(2),f.Q6J("ngForOf",i.messages))},dependencies:[v.mk,v.sg,v.PC,UI],styles:[".p-toast{position:fixed;width:25rem}.p-toast-message{overflow:hidden}.p-toast-message-content{display:flex;align-items:flex-start}.p-toast-message-text{flex:1 1 auto}.p-toast-top-right{top:20px;right:20px}.p-toast-top-left{top:20px;left:20px}.p-toast-bottom-left{bottom:20px;left:20px}.p-toast-bottom-right{bottom:20px;right:20px}.p-toast-top-center{top:20px;left:50%;transform:translate(-50%)}.p-toast-bottom-center{bottom:20px;left:50%;transform:translate(-50%)}.p-toast-center{left:50%;top:50%;min-width:20vw;transform:translate(-50%,-50%)}.p-toast-icon-close{display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}.p-toast-icon-close.p-link{cursor:pointer}\n"],encapsulation:2,data:{animation:[(0,_n.X$)("toastAnimation",[(0,_n.eR)(":enter, :leave",[(0,_n.IO)("@*",(0,_n.pV)())])])]},changeDetection:0})),e})(),BI=(()=>{var n;class e{}return n=e,(0,P.Z)(e,"\u0275fac",function(r){return new(r||n)}),(0,P.Z)(e,"\u0275mod",f.oAB({type:n})),(0,P.Z)(e,"\u0275inj",f.cJS({imports:[v.ez,Pp.T,Mp,Lp,Fp,Up,Vp.q,R.m8]})),e})();var Th=$(5829);function zI(n,e){if(1&n&&(f.TgZ(0,"div")(1,"span",6),f._uU(2),f.qZA()()),2&n){const t=f.oxw();f.xp6(2),f.hij(" ",t.stageLevel.value," ")}}function ZI(n,e){if(1&n&&f._uU(0),2&n){const t=f.oxw();f.hij(" ",t.stageLevel.value," ")}}function GI(n,e){1&n&&(f.TgZ(0,"span",9),f._UZ(1,"i",10),f.qZA())}function qI(n,e){if(1&n&&(f.TgZ(0,"div",7),f.YNc(1,GI,2,0,"span",8),f.qZA()),2&n){const t=f.oxw();f.xp6(1),f.Q6J("ngForOf",t.stars)}}function jI(n,e){1&n&&(f.TgZ(0,"span",12),f._UZ(1,"i",10),f.qZA())}function $I(n,e){if(1&n&&(f.TgZ(0,"div"),f.YNc(1,jI,2,0,"span",11),f.qZA()),2&n){const t=f.oxw(2);f.xp6(1),f.Q6J("ngForOf",t.stars)}}function KI(n,e){1&n&&(f.TgZ(0,"span",14),f._UZ(1,"i",15),f.qZA())}function HI(n,e){if(1&n&&f.YNc(0,KI,2,0,"span",13),2&n){const t=f.oxw(2);f.Q6J("ngForOf",t.stars)}}function WI(n,e){if(1&n&&(f.TgZ(0,"div",7),f.YNc(1,$I,2,1,"div",2),f.YNc(2,HI,1,1,"ng-template",null,3,f.W1O),f.qZA()),2&n){const t=f.MAs(3),r=f.oxw();f.xp6(1),f.Q6J("ngIf",r.stageLevel.completed)("ngIfElse",t)}}const QI=function(n,e){return{"stage-level-number-unselected":n,"stage-level-number-selected":e}};let YI=(()=>{var n;class e{constructor(){this.stars=new Array(1,2,3)}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275cmp=f.Xpm({type:n,selectors:[["app-stage-level"]],inputs:{stageLevel:"stageLevel"},decls:9,vars:8,consts:[[1,"stage-level-layout"],[2,"text-align","center",3,"ngClass"],[4,"ngIf","ngIfElse"],["NOT_COMPLETED",""],["style","display: flex; justify-content: center;",4,"ngIf","ngIfElse"],["STAGE_LEVEL_NOT_SELECTED",""],[1,"stage-level-completed-value"],[2,"display","flex","justify-content","center"],["class","stage-level-asterisk-selected",4,"ngFor","ngForOf"],[1,"stage-level-asterisk-selected"],[1,"pi","pi-star-fill",2,"font-size","10px"],["class","stage-level-asterisk-unselected stage-level-completed",4,"ngFor","ngForOf"],[1,"stage-level-asterisk-unselected","stage-level-completed"],["class","stage-level-asterisk-unselected",4,"ngFor","ngForOf"],[1,"stage-level-asterisk-unselected"],[1,"pi","pi-star",2,"font-size","10px"]],template:function(r,i){if(1&r&&(f.TgZ(0,"div",0)(1,"div",1),f.YNc(2,zI,3,1,"div",2),f.YNc(3,ZI,1,1,"ng-template",null,3,f.W1O),f.qZA(),f.TgZ(5,"div"),f.YNc(6,qI,2,1,"div",4),f.YNc(7,WI,4,2,"ng-template",null,5,f.W1O),f.qZA()()),2&r){const s=f.MAs(4),a=f.MAs(8);f.xp6(1),f.Q6J("ngClass",f.WLB(5,QI,!i.stageLevel.selected,i.stageLevel.selected)),f.xp6(1),f.Q6J("ngIf",i.stageLevel.completed)("ngIfElse",s),f.xp6(4),f.Q6J("ngIf",i.stageLevel.selected)("ngIfElse",a)}},dependencies:[v.mk,v.sg,v.O5,Th.oO],styles:[".stage-level-layout[_ngcontent-%COMP%]{padding-top:1px}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-font[_ngcontent-%COMP%], .stage-level-layout[_ngcontent-%COMP%]   .stage-level-number-selected[_ngcontent-%COMP%], .stage-level-layout[_ngcontent-%COMP%]   .stage-level-number-unselected[_ngcontent-%COMP%]{font-size:17px}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-number-unselected[_ngcontent-%COMP%]{font-weight:450}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-number-selected[_ngcontent-%COMP%]{font-weight:600}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-asterisk-unselected[_ngcontent-%COMP%]{color:#00f}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-asterisk-selected[_ngcontent-%COMP%]{color:#ec09eb}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-completed[_ngcontent-%COMP%], .stage-level-layout[_ngcontent-%COMP%]   .stage-level-completed-value[_ngcontent-%COMP%]{color:green;opacity:.5}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-completed-value[_ngcontent-%COMP%]{font-weight:500;color:#000}"]}),e})();function JI(n,e){1&n&&(f.TgZ(0,"div")(1,"span",3),f._uU(2,"No stage levels defined!"),f.qZA()())}const XI=function(n){return{"border-bottom":n}};function ew(n,e){if(1&n&&(f.TgZ(0,"div",6),f._UZ(1,"app-stage-level",7),f.qZA()),2&n){const t=e.$implicit;f.Q6J("ngStyle",f.VKq(2,XI,t.selected?"none":"1px solid #d4d4d4")),f.xp6(1),f.Q6J("stageLevel",t)}}function tw(n,e){if(1&n&&(f.TgZ(0,"div",4),f.YNc(1,ew,2,4,"div",5),f.qZA()),2&n){const t=f.oxw();f.xp6(1),f.Q6J("ngForOf",t.stageLevels)}}let nw=(()=>{var n;class e{constructor(){this.MAXSTAGE_LEVELS=5,this.NO_STAGE_LEVELS=!1}ngOnInit(){this.NO_STAGE_LEVELS=!this.stageLevels||this.stageLevels&&this.stageLevels.length!=this.MAXSTAGE_LEVELS}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275cmp=f.Xpm({type:n,selectors:[["app-game-stage-levels"]],inputs:{stageLevels:"stageLevels"},decls:4,vars:2,consts:[[1,"game-stage-level-layout"],[4,"ngIf","ngIfElse"],["HAS_STAGE_LEVELS",""],[1,"warning-message"],[1,"stage-levels"],["class","stage-level",3,"ngStyle",4,"ngFor","ngForOf"],[1,"stage-level",3,"ngStyle"],[3,"stageLevel"]],template:function(r,i){if(1&r&&(f.TgZ(0,"div",0),f.YNc(1,JI,3,0,"div",1),f.YNc(2,tw,2,1,"ng-template",null,2,f.W1O),f.qZA()),2&r){const s=f.MAs(3);f.xp6(1),f.Q6J("ngIf",i.NO_STAGE_LEVELS)("ngIfElse",s)}},dependencies:[v.sg,v.O5,v.PC,Th.Zl,YI],styles:[".digit-font-settings[_ngcontent-%COMP%], .game-stage-level-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%]{font-size:17px;font-weight:500;line-height:17px;font-family:Courier New,Courier,monospace;letter-spacing:.03em}.digits-border-horizontal[_ngcontent-%COMP%], .game-stage-level-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%]{border-bottom:1px solid #d4d4d4;padding:12px 0}.game-stage-level-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%]{font-weight:500;font-size:17px;text-align:center;color:orange;padding-left:calc(50% - 115px)}.game-stage-level-layout[_ngcontent-%COMP%]   .stage-levels[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:center;align-items:center}.game-stage-level-layout[_ngcontent-%COMP%]   .stage-levels[_ngcontent-%COMP%]   .stage-level[_ngcontent-%COMP%]{border:1px solid #d4d4d4;padding:0 10px;order:0;flex:1 1 auto;align-self:auto}"]}),e})();class zy{constructor(e=1/0){this.capacity=e,this.itemStorage=[]}peekBy(e){return this.itemStorage[e]}clear(){this.itemStorage.splice(0,this.itemStorage.length)}push(e){if(this.size()===this.capacity)throw Error("Error: The Stack has reached maximum Capacity!");this.itemStorage.push(e)}pop(){return this.itemStorage.pop()}peek(){return this.itemStorage[this.size()-1]}size(){return this.itemStorage.length}}class Zy{constructor(e,t,r){this.operands=e,this.operator=t,this.result=r}}var Bp=$(430),rw=$(6550);const Gy=function(n){return{"background-color":n}};function iw(n,e){if(1&n){const t=f.EpF();f.TgZ(0,"button",8),f.NdJ("click",function(){f.CHM(t);const i=f.oxw().$implicit,s=f.oxw();return f.KtG(s.onOperandButtonClick(i))}),f._uU(1),f.qZA()}if(2&n){const t=f.oxw().$implicit;f.Q6J("disabled",t.disabled)("ngStyle",f.VKq(3,Gy,t.selected?"rgb(190 209 253 / 59%)":"white")),f.xp6(1),f.hij("",t.value," ")}}function sw(n,e){if(1&n&&(f.ynx(0),f.YNc(1,iw,2,5,"button",7),f.BQk()),2&n){const t=e.index;f.xp6(1),f.Q6J("ngIf",t<3)}}function ow(n,e){if(1&n){const t=f.EpF();f.TgZ(0,"button",8),f.NdJ("click",function(){f.CHM(t);const i=f.oxw().$implicit,s=f.oxw();return f.KtG(s.onOperandButtonClick(i))}),f._uU(1),f.qZA()}if(2&n){const t=f.oxw().$implicit;f.Q6J("disabled",t.disabled)("ngStyle",f.VKq(3,Gy,t.selected?"rgb(190 209 253 / 59%)":"transparent")),f.xp6(1),f.hij("",t.value," ")}}function aw(n,e){if(1&n&&(f.ynx(0),f.YNc(1,ow,2,5,"button",7),f.BQk()),2&n){const t=e.index;f.xp6(1),f.Q6J("ngIf",t>2)}}function cw(n,e){if(1&n){const t=f.EpF();f.ynx(0),f.TgZ(1,"button",9),f.NdJ("click",function(){const s=f.CHM(t).$implicit,a=f.oxw();return f.KtG(a.onOperatorButtonClick(s))}),f._UZ(2,"mat-icon",10),f.qZA(),f.BQk()}if(2&n){const t=e.$implicit,r=e.index;f.xp6(1),f.Q6J("ngClass",0===r?"revert-button":"arithmetic-operation-button"),f.xp6(1),f.s9C("svgIcon",t.icon)}}let uw=(()=>{var n;class e{constructor(r,i){this.operators=new Array({selected:!1,caption:X.OPERATOR_REV,operator:X.OPERATOR_REV,icon:"revert"},{selected:!1,caption:X.OPERATOR_ADD,operator:X.OPERATOR_ADD,icon:"addition"},{selected:!1,caption:X.OPERATOR_SUB,operator:X.OPERATOR_SUB,icon:"substraction"},{selected:!1,caption:X.OPERATOR_MUL,operator:X.OPERATOR_MUL,icon:"multiplication"},{selected:!1,caption:X.OPERATOR_DIV,operator:X.OPERATOR_DIV,icon:"division"}),this.onExpectedResultReached=new f.vpe,this.onInvalidOperationExecuted=new f.vpe,r.addSvgIcon("revert",i.bypassSecurityTrustResourceUrl("assets/icons/rotate-left-solid.svg")),r.addSvgIcon("addition",i.bypassSecurityTrustResourceUrl("assets/icons/plus-solid.svg")),r.addSvgIcon("substraction",i.bypassSecurityTrustResourceUrl("assets/icons/minus-solid.svg")),r.addSvgIcon("multiplication",i.bypassSecurityTrustResourceUrl("assets/icons/xmark-solid.svg")),r.addSvgIcon("division",i.bypassSecurityTrustResourceUrl("assets/icons/divide-solid.svg"))}getSelectedOperator(){return this.operators.find(r=>r.selected)}clearSelectionOfOperands(){this.gameParameters.operands.forEach(r=>{r.selected=!1})}isTheExpectedResultReached(r){return this.gameParameters.result===r}addStateToHistory(r){this.history.push(r)}clearSelectionOfOperators(){this.operators.forEach(r=>{r.selected=!1})}addGameOperationToOperationHistory(r){this.operationHistory?.push(r)}ngOnInit(){this.history=new zy,this.operationHistory=new zy}revertLastOperation(){this.history.size()>0?this.gameParameters=this.history.pop():console.log("History is empty!"),this.clearSelectionOfOperators(),this.clearSelectionOfOperands(),this.selectedOperandA=null,this.selectedOperandB=null}enableOfAllOperands(){this.gameParameters.operands.forEach(r=>{r.disabled=!1})}clearHistory(){this.history?.clear()}removeLastOperation(){return this.history.pop()}onOperandButtonClick(r){if(r.selected=!r.selected,!r.selected){if(this.selectedOperandB&&this.selectedOperandB.id===r.id)return this.selectedOperandB.selected=!1,void(this.selectedOperandB=null);if(this.selectedOperandA&&this.selectedOperandA.id===r.id)return this.selectedOperandA.selected=!1,void(this.selectedOperandA=null)}this.selectedOperandA?this.selectedOperandA.id!==r.id&&(this.selectedOperandB||(this.selectedOperandB=r)):this.selectedOperandA=r;var i=this.getSelectedOperator();if(this.selectedOperandA&&this.selectedOperandB&&!i)this.selectedOperandB.selected=!1,this.selectedOperandB=null;else if(this.selectedOperandA&&this.selectedOperandB&&i){let s=Be.cloneGameParameters(this.gameParameters),a=Be.evaluate(this.selectedOperandA.value,this.selectedOperandB.value,i.operator);if(this.addStateToHistory(s),a===Number.MIN_VALUE)this.onInvalidOperationExecuted.emit(a);else{let h=new Array(this.selectedOperandA.value,this.selectedOperandB.value),d=new Zy(h,i.operator,a);this.addGameOperationToOperationHistory(d),this.isTheExpectedResultReached(a)&&this.onExpectedResultReached.emit(this.operationHistory),r.value=a,this.gameParameters.operands.find(y=>y.id==this.selectedOperandA.id).disabled=!0,this.clearSelectionOfOperators(),this.clearSelectionOfOperands(),this.selectedOperandA=null,this.selectedOperandB=null}}console.log(`Value ${r.value} Selected ${r.selected}`)}onOperatorButtonClick(r){if(this.selectedOperandA||r.operator===X.OPERATOR_REV){if(r.selected=!r.selected,r.operator===X.OPERATOR_REV){this.revertLastOperation();let i=Be.cloneGameParameters(this.gameParameters),s=new Array;i.operands.forEach(h=>{s.push(h.value)});let a=new Zy(s,r.operator,this.gameParameters.result);this.addGameOperationToOperationHistory(a)}console.log(`Caption ${r.caption} Selected ${r.selected}`)}else r.selected=!1}ngOnDestroy(){this.history.clear(),this.history=void 0,this.operationHistory.clear(),this.operationHistory=void 0}}return(n=e).\u0275fac=function(r){return new(r||n)(f.Y36(Bp.jv),f.Y36(rw.H7))},n.\u0275cmp=f.Xpm({type:n,selectors:[["app-game-arithmetic-operations"]],inputs:{gameParameters:"gameParameters"},outputs:{onExpectedResultReached:"onExpectedResultReached",onInvalidOperationExecuted:"onInvalidOperationExecuted"},decls:13,vars:4,consts:[[1,"game-arithmetic-operations-layout"],[1,"usage-instruction"],[1,"expected-result"],[1,"operands-container"],[1,"three-operands"],[4,"ngFor","ngForOf"],[1,"operators-container"],["type","button","class","operand",3,"disabled","ngStyle","click",4,"ngIf"],["type","button",1,"operand",3,"disabled","ngStyle","click"],["type","button",1,"operator-content",3,"ngClass","click"],[1,"operator-content-icon",3,"svgIcon"]],template:function(r,i){1&r&&(f.TgZ(0,"div",0)(1,"div",1),f._uU(2,"Use the any combination of number to reach the target:"),f.qZA(),f.TgZ(3,"div")(4,"label",2),f._uU(5),f.qZA()(),f.TgZ(6,"div",3)(7,"div",4),f.YNc(8,sw,2,1,"ng-container",5),f.qZA(),f.TgZ(9,"div",4),f.YNc(10,aw,2,1,"ng-container",5),f.qZA()(),f.TgZ(11,"div",6),f.YNc(12,cw,3,2,"ng-container",5),f.qZA()()),2&r&&(f.xp6(5),f.Oqu(i.gameParameters.result),f.xp6(3),f.Q6J("ngForOf",i.gameParameters.operands),f.xp6(2),f.Q6J("ngForOf",i.gameParameters.operands),f.xp6(2),f.Q6J("ngForOf",i.operators))},dependencies:[v.mk,v.sg,v.O5,v.PC,Th.oO,Th.Zl,Bp.Hw],styles:[".game-arithmetic-operations-layout[_ngcontent-%COMP%]{text-align:center}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .usage-instruction[_ngcontent-%COMP%]{font-size:13px;font-weight:500;line-height:13px;letter-spacing:.02em;padding-bottom:20px;font-family:Arial,Helvetica,sans-serif}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .expected-result[_ngcontent-%COMP%]{text-align:center;font-size:55px;font-weight:500;padding-bottom:1rem}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operands-container[_ngcontent-%COMP%]{font-size:44px;font-weight:500}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operands-container[_ngcontent-%COMP%]   .three-operands[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:7px}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operands-container[_ngcontent-%COMP%]   .three-operands[_ngcontent-%COMP%]   .operand[_ngcontent-%COMP%]{width:90px;height:90px;border:4px dashed blue;border-radius:50%;padding:32px 23px 30px 20px;font-size:26px;font-weight:550;margin:4px 10px;font-family:Courier New,Courier,monospace}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operands-container[_ngcontent-%COMP%]   .three-operands[_ngcontent-%COMP%]   .operand[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]:hover{border:4px solid blue}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operators-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:center;align-content:center;align-items:center}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operator-content[_ngcontent-%COMP%]{order:0;flex:0 1 auto;align-self:auto;width:3.55rem;height:3.55rem;border:4px solid #6b6b6b;border-radius:50%;margin:3px;display:flex;justify-content:center;align-items:center;color:#00f}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operator-content-icon[_ngcontent-%COMP%]{width:30px;height:30px;font-weight:500;vertical-align:middle}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .revert-button[_ngcontent-%COMP%]{background-color:#dbfbdd}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .revert-button[_ngcontent-%COMP%]:hover{background-color:#aae0ae}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .arithmetic-operation-button[_ngcontent-%COMP%]{background-color:#d9ecff}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .arithmetic-operation-button[_ngcontent-%COMP%]:hover{background-color:#aed7ff}"]}),e})();const lw=["arithmeticOperations"],hw=[{path:"digits/digits-game",component:(()=>{var n;class e{constructor(r,i,s,a){this.messageService=r,this.cookieService=i,this.clipboardService=s,this.numbersFirestoreService=a,this.COOKIE_LK_DIGITS="CookieLKNumbers",this.currentDate=new Date,this.stageLevels=[],this.gameParameters=[],this.stageIndex=0,this.todayPuzzleDataItems=[]}initializeStageLevels(){this.stageLevels=new Array({selected:!0,index:0,value:96,completed:!1,summary:""},{selected:!1,index:1,value:161,completed:!1,summary:""},{selected:!1,index:2,value:275,completed:!1,summary:""},{selected:!1,index:3,value:355,completed:!1,summary:""},{selected:!1,index:4,value:404,completed:!1,summary:""})}stageToCompleted(){this.stageLevels[this.stageIndex].completed=!0,this.stageLevels[this.stageIndex].selected=!1}formatOperations(r){let i="Completed! Executed Operations:\n",s=r.size()-1;for(;s>=0;){const a=r.peekBy(s);i+=s+1+". "+a?.operands[0]+" "+a?.operator+" "+a?.operands[1]+" = "+a?.result+"\n",--s}return i}createSummaryOfTHeOperations(r,i){let s=this.stageLevels[r].value+" -> ";for(;i.size()>0;){const a=i.pop();s+=""+a?.operator}return s+="\n",s}showSuccessMessage(r){this.messageService.add({severity:"success",summary:"Congratulation!",detail:r})}showErrorMessage(r){this.messageService.add({severity:"error",summary:"Error!",detail:r})}setupStages(){let r=0;this.gameParameters.forEach(i=>{this.stageLevels[r].value=i.result,++r})}storeGameStateToCookie(){let r=new z;r.storeDate=new Date,r.stageIndex=this.stageIndex,r.stageLevels=this.stageLevels,r.completed=this.stageIndex===this.stageLevels.length-1,r.gameParameters=this.gameParameters;let i=r.cookieData2Text(),s=new Date;s.setHours(23,59,59,999),this.cookieService.set(this.COOKIE_LK_DIGITS,i,s)}restoreGameStateFromCookie(){let i,r=this.cookieService.get(this.COOKIE_LK_DIGITS);return r&&""!=r?(i=new z,i=i.text2CookieData(r)):(console.log("Unable to retrieve the Game State"),i=null),i}mapPuzzleDataToGameParameters(r){r.stages.forEach(i=>{let s=this.gameParameters.find(a=>a.stageIndex===i.stageIndex);if(s){s.result=i.expectedValue;let a=0;s.operands.forEach(d=>{d.value=i.operands[a],a++}),this.initializeStageLevels(),this.stageLevels.find(d=>d.index===i.stageIndex)}})}mapGameParametersToPuzzleData(r){let i=new Me;return i.day=new Date,i.day.setHours(23,59,59,999),r.forEach(s=>{let a=new Nt;a.stageIndex=s.stageIndex,a.expectedValue=s.result;let h=new Array;s.operands.forEach(d=>{h.push(d.value)}),a.operands=h,i.stages.push(a)}),i}isDateSame(r,i){return r.getFullYear()===i.getFullYear()&&r.getMonth()===i.getMonth()&&r.getDate()===i.getDate()}updatePuzzleDataInDb(r){this.firestorePuzzleData.data=JSON.stringify(r),this.numbersFirestoreService.update(this.firestorePuzzleData.id,{data:this.firestorePuzzleData.data}).then(()=>console.log("The Puzzle Data was updated successfully!")).catch(i=>console.log(i))}ngOnInit(){this.initializeStageLevels(),alert("This \"Numbers\" game is a prototype only!\n        -no known bugs, except for Origin trial controlled feature not enabled: 'interest-cohort'");let r=this.restoreGameStateFromCookie();if(r){const i=new Date(r.storeDate);if(this.isDateSame(i,new Date)){if(this.stageIndex=r.stageIndex,this.stageLevels=r.stageLevels,this.gameParameters=r.gameParameters,this.setupStages(),r.completed){if(this.stageIndex===this.stageLevels.length-1){let a="Genius!\n";this.stageLevels.forEach(h=>{a+=h.summary}),this.clipboardService.copy(a),alert(a)}return}console.log("Game state restored from cookie")}else{this.generateGameParameters=new Ce,this.gameParameters=this.generateGameParameters.generateStageNumbers(),this.storeGameStateToCookie(),this.setupStages();let s=this.mapGameParametersToPuzzleData(this.gameParameters);console.log("Date mismatch which restored from cookie "+s),this.updatePuzzleDataInDb(s)}}else{console.log("No game state in cookie"),this.generateGameParameters=new Ce,this.gameParameters=this.generateGameParameters.generateStageNumbers();let i=navigator.language;this.numbersFirestoreService.getAll().snapshotChanges().pipe((0,ae.U)(s=>s.map(a=>({id:a.payload.doc.id,...a.payload.doc.data()})))).subscribe(s=>{this.firestorePuzzleDataItems=s;let a=s.filter(m=>m.locale===i);this.firestorePuzzleData=a[0],this.todayPuzzleData=JSON.parse(this.firestorePuzzleData.data),console.log("Puzzle Data retrieved from DB");const h=new Date,d=new Date(this.todayPuzzleData.day);if(this.todayPuzzleData.day&&this.isDateSame(d,h))console.log("Puzzle Data day date is matched, restore puzzle data to Game Parameters"),this.mapPuzzleDataToGameParameters(this.todayPuzzleData),this.storeGameStateToCookie(),this.setupStages();else{console.log("Puzzle Data day date is Not matched, generate new game parameters"),this.generateGameParameters=new Ce,this.gameParameters=this.generateGameParameters.generateStageNumbers(),this.storeGameStateToCookie(),this.setupStages();let m=this.mapGameParametersToPuzzleData(this.gameParameters);console.log(JSON.stringify(m)),this.updatePuzzleDataInDb(m)}})}}onExpectedResultReached(r){const i=this.formatOperations(r),s=this.createSummaryOfTHeOperations(this.stageIndex,r);this.stageLevels[this.stageIndex].summary=s,this.clipboardService.copy(i),this.showSuccessMessage("You are reach the expected result!"),alert(i),this.stageToCompleted();let a=this.stageIndex===this.stageLevels.length-1;if(a){let h="Genius!\n";this.stageLevels.forEach(d=>{h+=d.summary}),this.clipboardService.copy(h),alert(h)}a||(this.stageIndex++,this.stageLevels[this.stageIndex].selected=!0),this.storeGameStateToCookie(),this.arithmeticComponent.clearHistory()}onInvalidOperationExecuted(r){this.showErrorMessage("Invalid Operation Executed!"),this.arithmeticComponent.revertLastOperation(),console.log(r)}onDeleteCookie(){this.cookieService.deleteAll()}onUpdatePuzzleData(){console.log("Will update puzzle data")}}return(n=e).\u0275fac=function(r){return new(r||n)(f.Y36(R.ez),f.Y36(re),f.Y36(Ee),f.Y36(Vy))},n.\u0275cmp=f.Xpm({type:n,selectors:[["app-digits-game"]],viewQuery:function(r,i){if(1&r&&f.Gf(lw,7),2&r){let s;f.iGM(s=f.CRH())&&(i.arithmeticComponent=s.first)}},features:[f._Bn([R.ez,re])],decls:18,vars:6,consts:[[1,"digits-game-layout"],["position","top-center","closable","true"],[1,"digits-game-title"],["href","https://www.nytimes.com/games/digits",1,"anchor-underline-off"],[1,"title-bar"],[1,"title-bar-name",3,"click"],[1,"title-bar-date",3,"click"],[1,"tool-bar"],[3,"stageLevels"],[3,"gameParameters","onExpectedResultReached","onInvalidOperationExecuted"],["arithmeticOperations",""]],template:function(r,i){1&r&&(f.TgZ(0,"div",0),f._UZ(1,"p-toast",1),f.TgZ(2,"div",2),f._uU(3," This is a daily numbers puzzle, similar to the "),f.TgZ(4,"a",3),f._uU(5,"NY Times Digits"),f.qZA(),f._uU(6,", which unfortunatelly discontinued at August 8, 2023 "),f.qZA(),f.TgZ(7,"div",4)(8,"div",5),f.NdJ("click",function(){return i.onDeleteCookie()}),f._uU(9," Numbers "),f.qZA(),f.TgZ(10,"div",6),f.NdJ("click",function(){return i.onUpdatePuzzleData()}),f._uU(11),f.ALo(12,"date"),f.qZA()(),f.TgZ(13,"div",7),f._UZ(14,"app-game-stage-levels",8),f.qZA(),f.TgZ(15,"div")(16,"app-game-arithmetic-operations",9,10),f.NdJ("onExpectedResultReached",function(a){return i.onExpectedResultReached(a)})("onInvalidOperationExecuted",function(a){return i.onInvalidOperationExecuted(a)}),f.qZA()()()),2&r&&(f.xp6(11),f.hij(" ",f.xi3(12,3,i.currentDate,"MM/dd/yyyy")," "),f.xp6(3),f.Q6J("stageLevels",i.stageLevels),f.xp6(2),f.Q6J("gameParameters",i.gameParameters[i.stageIndex]))},dependencies:[VI,nw,uw,v.uU],styles:[".digit-font-settings[_ngcontent-%COMP%], .digits-game-layout[_ngcontent-%COMP%]   .tool-bar[_ngcontent-%COMP%], .digits-game-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%]{font-size:17px;font-weight:500;line-height:17px;font-family:Courier New,Courier,monospace;letter-spacing:.03em}.digits-border-horizontal[_ngcontent-%COMP%], .digits-game-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%], .digits-game-layout[_ngcontent-%COMP%]   .digits-game-title[_ngcontent-%COMP%]{border-bottom:1px solid #d4d4d4;padding:12px 0}.digits-game-layout[_ngcontent-%COMP%]{height:98vh;width:100vw}.digits-game-layout[_ngcontent-%COMP%]   .digits-game-title[_ngcontent-%COMP%]{text-align:center}.digits-game-layout[_ngcontent-%COMP%]   .anchor-underline-off[_ngcontent-%COMP%]{text-decoration:none}.digits-game-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%]{font-weight:500;font-size:17px;text-align:center;color:orange}.digits-game-layout[_ngcontent-%COMP%]   .title-bar[_ngcontent-%COMP%]{padding:6px 0;display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-around;align-content:stretch;align-items:center;font-size:28px;font-weight:300;font-family:Arial,Helvetica,sans-serif}.digits-game-layout[_ngcontent-%COMP%]   .title-bar[_ngcontent-%COMP%]   .title-bar-name[_ngcontent-%COMP%], .digits-game-layout[_ngcontent-%COMP%]   .title-bar[_ngcontent-%COMP%]   .title-bar-date[_ngcontent-%COMP%]{order:0;flex:0 1 auto;align-self:auto}.digits-game-layout[_ngcontent-%COMP%]   .tool-bar[_ngcontent-%COMP%]{height:52px}@media only screen and (max-width: 600px){.digits-game-layout[_ngcontent-%COMP%]{height:101vh;width:101vw}}"]}),e})()}];let dw=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=f.oAB({type:n}),n.\u0275inj=f.cJS({imports:[v.ez,ne.Bz.forChild(hw),ne.Bz]}),e})();var fw=$(9814);let Dw=(()=>{var n;class e{}return n=e,(0,P.Z)(e,"\u0275fac",function(r){return new(r||n)}),(0,P.Z)(e,"\u0275mod",f.oAB({type:n})),(0,P.Z)(e,"\u0275inj",f.cJS({imports:[v.ez,Pp.T,Mp,Lp,Fp,Up,Vp.q]})),e})();var Nw=$(2340);let Rw=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=f.oAB({type:n}),n.\u0275inj=f.cJS({providers:[Vy],imports:[v.ez,ne.Bz,BI,Dw,dw,fw.o9,Bp.Ps,_t,os.initializeApp(Nw.N.firebasePuzzleData),wI]}),e})()},6101:(ts,Ot,$)=>{$.d(Ot,{Z:()=>Nt});var v=$(2090),ne=$(4859),R=$(7212),X=$(1877);class ht{constructor(ye,Ee){this._delegate=ye,this.firebase=Ee,(0,R._addComponent)(ye,new ne.wA("app-compat",()=>this,"PUBLIC")),this.container=ye.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(ye){this._delegate.automaticDataCollectionEnabled=ye}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(ye=>{this._delegate.checkDestroyed(),ye()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),(0,R.deleteApp)(this._delegate)))}_getService(ye,Ee=R._DEFAULT_ENTRY_NAME){var Bt;this._delegate.checkDestroyed();const rn=this._delegate.container.getProvider(ye);return!rn.isInitialized()&&"EXPLICIT"===(null===(Bt=rn.getComponent())||void 0===Bt?void 0:Bt.instantiationMode)&&rn.initialize(),rn.getImmediate({identifier:Ee})}_removeServiceInstance(ye,Ee=R._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(ye).clearInstance(Ee)}_addComponent(ye){(0,R._addComponent)(this._delegate,ye)}_addOrOverwriteComponent(ye){(0,R._addOrOverwriteComponent)(this._delegate,ye)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Be=new v.LL("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),z=function Ce(){const Ge=function Dt(Ge){const ye={},Ee={__esModule:!0,initializeApp:function _t(Te,Ct={}){const F=R.initializeApp(Te,Ct);if((0,v.r3)(ye,F.name))return ye[F.name];const Xe=new Ge(F,Ee);return ye[F.name]=Xe,Xe},app:rn,registerVersion:R.registerVersion,setLogLevel:R.setLogLevel,onLog:R.onLog,apps:null,SDK_VERSION:R.SDK_VERSION,INTERNAL:{registerComponent:function Re(Te){const Ct=Te.name,F=Ct.replace("-compat","");if(R._registerComponent(Te)&&"PUBLIC"===Te.type){const Xe=(nt=rn())=>{if("function"!=typeof nt[F])throw Be.create("invalid-app-argument",{appName:Ct});return nt[F]()};void 0!==Te.serviceProps&&(0,v.ZB)(Xe,Te.serviceProps),Ee[F]=Xe,Ge.prototype[F]=function(...nt){return this._getService.bind(this,Ct).apply(this,Te.multipleInstances?nt:[])}}return"PUBLIC"===Te.type?Ee[F]:null},removeApp:function Bt(Te){delete ye[Te]},useAsService:function xr(Te,Ct){return"serverAuth"===Ct?null:Ct},modularAPIs:R}};function rn(Te){if(!(0,v.r3)(ye,Te=Te||R._DEFAULT_ENTRY_NAME))throw Be.create("no-app",{appName:Te});return ye[Te]}return Ee.default=Ee,Object.defineProperty(Ee,"apps",{get:function P(){return Object.keys(ye).map(Te=>ye[Te])}}),rn.App=Ge,Ee}(ht);return Ge.INTERNAL=Object.assign(Object.assign({},Ge.INTERNAL),{createFirebaseNamespace:Ce,extendNamespace:function ye(Ee){(0,v.ZB)(Ge,Ee)},createSubscribe:v.ne,ErrorFactory:v.LL,deepExtend:v.ZB}),Ge}(),f=new X.Yd("@firebase/app-compat");if((0,v.jU)()&&void 0!==self.firebase){f.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const Ge=self.firebase.SDK_VERSION;Ge&&Ge.indexOf("LITE")>=0&&f.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const Nt=z;!function Me(Ge){(0,R.registerVersion)("@firebase/app-compat","0.2.13",Ge)}()},7212:(ts,Ot,$)=>{$.r(Ot),$.d(Ot,{FirebaseError:()=>X.ZR,SDK_VERSION:()=>ja,_DEFAULT_ENTRY_NAME:()=>pn,_addComponent:()=>vt,_addOrOverwriteComponent:()=>nr,_apps:()=>Mt,_clearComponents:()=>an,_components:()=>on,_getProvider:()=>ir,_registerComponent:()=>rr,_removeServiceInstance:()=>os,deleteApp:()=>zn,getApp:()=>gi,getApps:()=>un,initializeApp:()=>Tn,onLog:()=>as,registerVersion:()=>zt,setLogLevel:()=>xt});var v=$(5861),ne=$(4859),R=$(1877),X=$(2090);const ht=(D,A)=>A.some(B=>D instanceof B);let Je,Be;const z=new WeakMap,f=new WeakMap,re=new WeakMap,ae=new WeakMap,Me=new WeakMap;let ye={get(D,A,B){if(D instanceof IDBTransaction){if("done"===A)return f.get(D);if("objectStoreNames"===A)return D.objectStoreNames||re.get(D);if("store"===A)return B.objectStoreNames[1]?void 0:B.objectStore(B.objectStoreNames[0])}return _t(D[A])},set:(D,A,B)=>(D[A]=B,!0),has:(D,A)=>D instanceof IDBTransaction&&("done"===A||"store"===A)||A in D};function rn(D){return"function"==typeof D?function Bt(D){return D!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function Ce(){return Be||(Be=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(D)?function(...A){return D.apply(P(this),A),_t(z.get(this))}:function(...A){return _t(D.apply(P(this),A))}:function(A,...B){const b=D.call(P(this),A,...B);return re.set(b,A.sort?A.sort():[A]),_t(b)}}(D):(D instanceof IDBTransaction&&function Ge(D){if(f.has(D))return;const A=new Promise((B,b)=>{const ce=()=>{D.removeEventListener("complete",de),D.removeEventListener("error",se),D.removeEventListener("abort",se)},de=()=>{B(),ce()},se=()=>{b(D.error||new DOMException("AbortError","AbortError")),ce()};D.addEventListener("complete",de),D.addEventListener("error",se),D.addEventListener("abort",se)});f.set(D,A)}(D),ht(D,function Dt(){return Je||(Je=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(D,ye):D)}function _t(D){if(D instanceof IDBRequest)return function Nt(D){const A=new Promise((B,b)=>{const ce=()=>{D.removeEventListener("success",de),D.removeEventListener("error",se)},de=()=>{B(_t(D.result)),ce()},se=()=>{b(D.error),ce()};D.addEventListener("success",de),D.addEventListener("error",se)});return A.then(B=>{B instanceof IDBCursor&&z.set(B,D)}).catch(()=>{}),Me.set(A,D),A}(D);if(ae.has(D))return ae.get(D);const A=rn(D);return A!==D&&(ae.set(D,A),Me.set(A,D)),A}const P=D=>Me.get(D),Te=["get","getKey","getAll","getAllKeys","count"],Ct=["put","add","delete","clear"],F=new Map;function Xe(D,A){if(!(D instanceof IDBDatabase)||A in D||"string"!=typeof A)return;if(F.get(A))return F.get(A);const B=A.replace(/FromIndex$/,""),b=A!==B,ce=Ct.includes(B);if(!(B in(b?IDBIndex:IDBObjectStore).prototype)||!ce&&!Te.includes(B))return;const de=function(){var se=(0,v.Z)(function*(wt,...Pe){const q=this.transaction(wt,ce?"readwrite":"readonly");let sr=q.store;return b&&(sr=sr.index(Pe.shift())),(yield Promise.all([sr[B](...Pe),ce&&q.done]))[0]});return function(Pe){return se.apply(this,arguments)}}();return F.set(A,de),de}!function Ee(D){ye=D(ye)}(D=>({...D,get:(A,B,b)=>Xe(A,B)||D.get(A,B,b),has:(A,B)=>!!Xe(A,B)||D.has(A,B)}));class nt{constructor(A){this.container=A}getPlatformInfoString(){return this.container.getProviders().map(B=>{if(function vn(D){const A=D.getComponent();return"VERSION"===A?.type}(B)){const b=B.getImmediate();return`${b.library}/${b.version}`}return null}).filter(B=>B).join(" ")}}const Ar="@firebase/app",In=new R.Yd("@firebase/app"),pn="[DEFAULT]",Rr={[Ar]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Mt=new Map,on=new Map;function vt(D,A){try{D.container.addComponent(A)}catch(B){In.debug(`Component ${A.name} failed to register with FirebaseApp ${D.name}`,B)}}function nr(D,A){D.container.addOrOverwriteComponent(A)}function rr(D){const A=D.name;if(on.has(A))return In.debug(`There were multiple attempts to register component ${A}.`),!1;on.set(A,D);for(const B of Mt.values())vt(B,D);return!0}function ir(D,A){const B=D.container.getProvider("heartbeat").getImmediate({optional:!0});return B&&B.triggerHeartbeat(),D.container.getProvider(A)}function os(D,A,B=pn){ir(D,A).clearInstance(B)}function an(){on.clear()}const cn=new X.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Pr{constructor(A,B,b){this._isDeleted=!1,this._options=Object.assign({},A),this._config=Object.assign({},B),this._name=B.name,this._automaticDataCollectionEnabled=B.automaticDataCollectionEnabled,this._container=b,this.container.addComponent(new ne.wA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(A){this.checkDestroyed(),this._automaticDataCollectionEnabled=A}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(A){this._isDeleted=A}checkDestroyed(){if(this.isDeleted)throw cn.create("app-deleted",{appName:this._name})}}const ja="9.23.0";function Tn(D,A={}){let B=D;"object"!=typeof A&&(A={name:A});const b=Object.assign({name:pn,automaticDataCollectionEnabled:!1},A),ce=b.name;if("string"!=typeof ce||!ce)throw cn.create("bad-app-name",{appName:String(ce)});if(B||(B=(0,X.aH)()),!B)throw cn.create("no-options");const de=Mt.get(ce);if(de){if((0,X.vZ)(B,de.options)&&(0,X.vZ)(b,de.config))return de;throw cn.create("duplicate-app",{appName:ce})}const se=new ne.H0(ce);for(const Pe of on.values())se.addComponent(Pe);const wt=new Pr(B,b,se);return Mt.set(ce,wt),wt}function gi(D=pn){const A=Mt.get(D);if(!A&&D===pn&&(0,X.aH)())return Tn();if(!A)throw cn.create("no-app",{appName:D});return A}function un(){return Array.from(Mt.values())}function zn(D){return et.apply(this,arguments)}function et(){return(et=(0,v.Z)(function*(D){const A=D.name;Mt.has(A)&&(Mt.delete(A),yield Promise.all(D.container.getProviders().map(B=>B.delete())),D.isDeleted=!0)})).apply(this,arguments)}function zt(D,A,B){var b;let ce=null!==(b=Rr[D])&&void 0!==b?b:D;B&&(ce+=`-${B}`);const de=ce.match(/\s|\//),se=A.match(/\s|\//);if(de||se){const wt=[`Unable to register library "${ce}" with version "${A}":`];return de&&wt.push(`library name "${ce}" contains illegal characters (whitespace or "/")`),de&&se&&wt.push("and"),se&&wt.push(`version name "${A}" contains illegal characters (whitespace or "/")`),void In.warn(wt.join(" "))}rr(new ne.wA(`${ce}-version`,()=>({library:ce,version:A}),"VERSION"))}function as(D,A){if(null!==D&&"function"!=typeof D)throw cn.create("invalid-log-argument");(0,R.Am)(D,A)}function xt(D){(0,R.Ub)(D)}const cs="firebase-heartbeat-database",bn=1,E="firebase-heartbeat-store";let I=null;function T(){return I||(I=function Re(D,A,{blocked:B,upgrade:b,blocking:ce,terminated:de}={}){const se=indexedDB.open(D,A),wt=_t(se);return b&&se.addEventListener("upgradeneeded",Pe=>{b(_t(se.result),Pe.oldVersion,Pe.newVersion,_t(se.transaction),Pe)}),B&&se.addEventListener("blocked",Pe=>B(Pe.oldVersion,Pe.newVersion,Pe)),wt.then(Pe=>{de&&Pe.addEventListener("close",()=>de()),ce&&Pe.addEventListener("versionchange",q=>ce(q.oldVersion,q.newVersion,q))}).catch(()=>{}),wt}(cs,bn,{upgrade:(D,A)=>{0===A&&D.createObjectStore(E)}}).catch(D=>{throw cn.create("idb-open",{originalErrorMessage:D.message})})),I}function k(){return(k=(0,v.Z)(function*(D){try{return yield(yield T()).transaction(E).objectStore(E).get(Oe(D))}catch(A){if(A instanceof X.ZR)In.warn(A.message);else{const B=cn.create("idb-get",{originalErrorMessage:A?.message});In.warn(B.message)}}})).apply(this,arguments)}function ee(D,A){return ue.apply(this,arguments)}function ue(){return(ue=(0,v.Z)(function*(D,A){try{const b=(yield T()).transaction(E,"readwrite");yield b.objectStore(E).put(A,Oe(D)),yield b.done}catch(B){if(B instanceof X.ZR)In.warn(B.message);else{const b=cn.create("idb-set",{originalErrorMessage:B?.message});In.warn(b.message)}}})).apply(this,arguments)}function Oe(D){return`${D.name}!${D.options.appId}`}class dt{constructor(A){this.container=A,this._heartbeatsCache=null;const B=this.container.getProvider("app").getImmediate();this._storage=new Sn(B),this._heartbeatsCachePromise=this._storage.read().then(b=>(this._heartbeatsCache=b,b))}triggerHeartbeat(){var A=this;return(0,v.Z)(function*(){const b=A.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),ce=be();if(null===A._heartbeatsCache&&(A._heartbeatsCache=yield A._heartbeatsCachePromise),A._heartbeatsCache.lastSentHeartbeatDate!==ce&&!A._heartbeatsCache.heartbeats.some(de=>de.date===ce))return A._heartbeatsCache.heartbeats.push({date:ce,agent:b}),A._heartbeatsCache.heartbeats=A._heartbeatsCache.heartbeats.filter(de=>{const se=new Date(de.date).valueOf();return Date.now()-se<=2592e6}),A._storage.overwrite(A._heartbeatsCache)})()}getHeartbeatsHeader(){var A=this;return(0,v.Z)(function*(){if(null===A._heartbeatsCache&&(yield A._heartbeatsCachePromise),null===A._heartbeatsCache||0===A._heartbeatsCache.heartbeats.length)return"";const B=be(),{heartbeatsToSend:b,unsentEntries:ce}=function ln(D,A=1024){const B=[];let b=D.slice();for(const ce of D){const de=B.find(se=>se.agent===ce.agent);if(de){if(de.dates.push(ce.date),Mr(B)>A){de.dates.pop();break}}else if(B.push({agent:ce.agent,dates:[ce.date]}),Mr(B)>A){B.pop();break}b=b.slice(1)}return{heartbeatsToSend:B,unsentEntries:b}}(A._heartbeatsCache.heartbeats),de=(0,X.L)(JSON.stringify({version:2,heartbeats:b}));return A._heartbeatsCache.lastSentHeartbeatDate=B,ce.length>0?(A._heartbeatsCache.heartbeats=ce,yield A._storage.overwrite(A._heartbeatsCache)):(A._heartbeatsCache.heartbeats=[],A._storage.overwrite(A._heartbeatsCache)),de})()}}function be(){return(new Date).toISOString().substring(0,10)}class Sn{constructor(A){this.app=A,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,v.Z)(function*(){return!!(0,X.hl)()&&(0,X.eu)().then(()=>!0).catch(()=>!1)})()}read(){var A=this;return(0,v.Z)(function*(){return(yield A._canUseIndexedDBPromise)&&(yield function M(D){return k.apply(this,arguments)}(A.app))||{heartbeats:[]}})()}overwrite(A){var B=this;return(0,v.Z)(function*(){var b;if(yield B._canUseIndexedDBPromise){const de=yield B.read();return ee(B.app,{lastSentHeartbeatDate:null!==(b=A.lastSentHeartbeatDate)&&void 0!==b?b:de.lastSentHeartbeatDate,heartbeats:A.heartbeats})}})()}add(A){var B=this;return(0,v.Z)(function*(){var b;if(yield B._canUseIndexedDBPromise){const de=yield B.read();return ee(B.app,{lastSentHeartbeatDate:null!==(b=A.lastSentHeartbeatDate)&&void 0!==b?b:de.lastSentHeartbeatDate,heartbeats:[...de.heartbeats,...A.heartbeats]})}})()}}function Mr(D){return(0,X.L)(JSON.stringify({version:2,heartbeats:D})).length}!function $a(D){rr(new ne.wA("platform-logger",A=>new nt(A),"PRIVATE")),rr(new ne.wA("heartbeat",A=>new dt(A),"PRIVATE")),zt(Ar,"0.9.13",D),zt(Ar,"0.9.13","esm2017"),zt("fire-js","")}("")},8463:(ts,Ot,$)=>{$.r(Ot);var v=$(5861),ne=$(6101),R=$(2090),X=$(7212),ht=$(655),Je=$(1877),Be=$(4859);const Ce={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"};const Nt=function ae(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend."}},Ge=function Me(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},ye=new R.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Bt=new Je.Yd("@firebase/auth");function _t(u,...o){Bt.logLevel<=Je.in.ERROR&&Bt.error(`Auth (${X.SDK_VERSION}): ${u}`,...o)}function P(u,...o){throw Ct(u,...o)}function Re(u,...o){return Ct(u,...o)}function xr(u,o,c){const l=Object.assign(Object.assign({},Ge()),{[o]:c});return new R.LL("auth","Firebase",l).create(o,{appName:u.name})}function Te(u,o,c){if(!(o instanceof c))throw c.name!==o.constructor.name&&P(u,"argument-error"),xr(u,"argument-error",`Type of ${o.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Ct(u,...o){if("string"!=typeof u){const c=o[0],l=[...o.slice(1)];return l[0]&&(l[0].appName=u.name),u._errorFactory.create(c,...l)}return ye.create(u,...o)}function F(u,o,...c){if(!u)throw Ct(o,...c)}function Xe(u){const o="INTERNAL ASSERTION FAILED: "+u;throw _t(o),new Error(o)}function nt(u,o){u||Xe(o)}function vn(){var u;return typeof self<"u"&&(null===(u=self.location)||void 0===u?void 0:u.href)||""}function Ar(){return"http:"===er()||"https:"===er()}function er(){var u;return typeof self<"u"&&(null===(u=self.location)||void 0===u?void 0:u.protocol)||null}class Wt{constructor(o,c){this.shortDelay=o,this.longDelay=c,nt(c>o,"Short delay should be less than long delay!"),this.isMobile=(0,R.uI)()||(0,R.b$)()}get(){return function In(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Ar()||(0,R.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Bn(u,o){nt(u.emulator,"Emulator should always be set here");const{url:c}=u.emulator;return o?`${c}${o.startsWith("/")?o.slice(1):o}`:c}class ns{static initialize(o,c,l){this.fetchImpl=o,c&&(this.headersImpl=c),l&&(this.responseImpl=l)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:void Xe("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:void Xe("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:void Xe("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const za={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},rs=new Wt(3e4,6e4);function ke(u,o){return u.tenantId&&!o.tenantId?Object.assign(Object.assign({},o),{tenantId:u.tenantId}):o}function Fe(u,o,c,l){return sn.apply(this,arguments)}function sn(){return(sn=(0,v.Z)(function*(u,o,c,l,p={}){return Or(u,p,(0,v.Z)(function*(){let g={},w={};l&&("GET"===o?w=l:g={body:JSON.stringify(l)});const C=(0,R.xO)(Object.assign({key:u.config.apiKey},w)).slice(1),U=yield u._getAdditionalHeaders();return U["Content-Type"]="application/json",u.languageCode&&(U["X-Firebase-Locale"]=u.languageCode),ns.fetch()(is(u,u.config.apiHost,c,C),Object.assign({method:o,headers:U,referrerPolicy:"no-referrer"},g))}))})).apply(this,arguments)}function Or(u,o,c){return tr.apply(this,arguments)}function tr(){return(tr=(0,v.Z)(function*(u,o,c){u._canInitEmulator=!1;const l=Object.assign(Object.assign({},za),o);try{const p=new wn(u),g=yield Promise.race([c(),p.promise]);p.clearNetworkTimeout();const w=yield g.json();if("needConfirmation"in w)throw Dr(u,"account-exists-with-different-credential",w);if(g.ok&&!("errorMessage"in w))return w;{const C=g.ok?w.errorMessage:w.error.message,[U,G]=C.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===U)throw Dr(u,"credential-already-in-use",w);if("EMAIL_EXISTS"===U)throw Dr(u,"email-already-in-use",w);if("USER_DISABLED"===U)throw Dr(u,"user-disabled",w);const Y=l[U]||U.toLowerCase().replace(/[_\s]+/g,"-");if(G)throw xr(u,Y,G);P(u,Y)}}catch(p){if(p instanceof R.ZR)throw p;P(u,"network-request-failed",{message:String(p)})}})).apply(this,arguments)}function Qt(u,o,c,l){return Rt.apply(this,arguments)}function Rt(){return(Rt=(0,v.Z)(function*(u,o,c,l,p={}){const g=yield Fe(u,o,c,l,p);return"mfaPendingCredential"in g&&P(u,"multi-factor-auth-required",{_serverResponse:g}),g})).apply(this,arguments)}function is(u,o,c,l){const p=`${o}${c}?${l}`;return u.config.emulator?Bn(u.config,p):`${u.config.apiScheme}://${p}`}class wn{constructor(o){this.auth=o,this.timer=null,this.promise=new Promise((c,l)=>{this.timer=setTimeout(()=>l(Re(this.auth,"network-request-failed")),rs.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Dr(u,o,c){const l={appName:u.name};c.email&&(l.email=c.email),c.phoneNumber&&(l.phoneNumber=c.phoneNumber);const p=Re(u,o,l);return p.customData._tokenResponse=c,p}function it(){return(it=(0,v.Z)(function*(u,o){return Fe(u,"POST","/v1/accounts:delete",o)})).apply(this,arguments)}function Nr(){return(Nr=(0,v.Z)(function*(u,o){return Fe(u,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Pt(){return(Pt=(0,v.Z)(function*(u,o){return Fe(u,"POST","/v1/accounts:lookup",o)})).apply(this,arguments)}function En(u){if(u)try{const o=new Date(Number(u));if(!isNaN(o.getTime()))return o.toUTCString()}catch{}}function pn(){return(pn=(0,v.Z)(function*(u,o=!1){const c=(0,R.m9)(u),l=yield c.getIdToken(o),p=Mt(l);F(p&&p.exp&&p.auth_time&&p.iat,c.auth,"internal-error");const g="object"==typeof p.firebase?p.firebase:void 0,w=g?.sign_in_provider;return{claims:p,token:l,authTime:En(Rr(p.auth_time)),issuedAtTime:En(Rr(p.iat)),expirationTime:En(Rr(p.exp)),signInProvider:w||null,signInSecondFactor:g?.sign_in_second_factor||null}})).apply(this,arguments)}function Rr(u){return 1e3*Number(u)}function Mt(u){const[o,c,l]=u.split(".");if(void 0===o||void 0===c||void 0===l)return _t("JWT malformed, contained fewer than 3 sections"),null;try{const p=(0,R.tV)(c);return p?JSON.parse(p):(_t("Failed to decode base64 JWT payload"),null)}catch(p){return _t("Caught error parsing JWT payload as JSON",p?.toString()),null}}function vt(u,o){return nr.apply(this,arguments)}function nr(){return(nr=(0,v.Z)(function*(u,o,c=!1){if(c)return o;try{return yield o}catch(l){throw l instanceof R.ZR&&function rr({code:u}){return"auth/user-disabled"===u||"auth/user-token-expired"===u}(l)&&u.auth.currentUser===u&&(yield u.auth.signOut()),l}})).apply(this,arguments)}class ir{constructor(o){this.user=o,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(o){var c;if(o){const l=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),l}{this.errorBackoff=3e4;const p=(null!==(c=this.user.stsTokenManager.expirationTime)&&void 0!==c?c:0)-Date.now()-3e5;return Math.max(0,p)}}schedule(o=!1){var c=this;if(!this.isRunning)return;const l=this.getInterval(o);this.timerId=setTimeout((0,v.Z)(function*(){yield c.iteration()}),l)}iteration(){var o=this;return(0,v.Z)(function*(){try{yield o.user.getIdToken(!0)}catch(c){return void("auth/network-request-failed"===c?.code&&o.schedule(!0))}o.schedule()})()}}class os{constructor(o,c){this.createdAt=o,this.lastLoginAt=c,this._initializeTime()}_initializeTime(){this.lastSignInTime=En(this.lastLoginAt),this.creationTime=En(this.createdAt)}_copy(o){this.createdAt=o.createdAt,this.lastLoginAt=o.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function an(u){return mi.apply(this,arguments)}function mi(){return mi=(0,v.Z)(function*(u){var o;const c=u.auth,l=yield u.getIdToken(),p=yield vt(u,function Ga(u,o){return Pt.apply(this,arguments)}(c,{idToken:l}));F(p?.users.length,c,"internal-error");const g=p.users[0];u._notifyReloadListener(g);const w=null!==(o=g.providerUserInfo)&&void 0!==o&&o.length?function Tn(u){return u.map(o=>{var{providerId:c}=o,l=(0,ht._T)(o,["providerId"]);return{providerId:c,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}(g.providerUserInfo):[],C=function ja(u,o){return[...u.filter(l=>!o.some(p=>p.providerId===l.providerId)),...o]}(u.providerData,w),Y=!!u.isAnonymous&&!(u.email&&g.passwordHash||C?.length),Q={uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:C,metadata:new os(g.createdAt,g.lastLoginAt),isAnonymous:Y};Object.assign(u,Q)}),mi.apply(this,arguments)}function Pr(){return(Pr=(0,v.Z)(function*(u){const o=(0,R.m9)(u);yield an(o),yield o.auth._persistUserIfCurrent(o),o.auth._notifyListenersIfCurrent(o)})).apply(this,arguments)}function un(){return(un=(0,v.Z)(function*(u,o){const c=yield Or(u,{},(0,v.Z)(function*(){const l=(0,R.xO)({grant_type:"refresh_token",refresh_token:o}).slice(1),{tokenApiHost:p,apiKey:g}=u.config,w=is(u,p,"/v1/token",`key=${g}`),C=yield u._getAdditionalHeaders();return C["Content-Type"]="application/x-www-form-urlencoded",ns.fetch()(w,{method:"POST",headers:C,body:l})}));return{accessToken:c.access_token,expiresIn:c.expires_in,refreshToken:c.refresh_token}})).apply(this,arguments)}class zn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(o){F(o.idToken,"internal-error"),F(typeof o.idToken<"u","internal-error"),F(typeof o.refreshToken<"u","internal-error");const c="expiresIn"in o&&typeof o.expiresIn<"u"?Number(o.expiresIn):function on(u){const o=Mt(u);return F(o,"internal-error"),F(typeof o.exp<"u","internal-error"),F(typeof o.iat<"u","internal-error"),Number(o.exp)-Number(o.iat)}(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,c)}getToken(o,c=!1){var l=this;return(0,v.Z)(function*(){return F(!l.accessToken||l.refreshToken,o,"user-token-expired"),c||!l.accessToken||l.isExpired?l.refreshToken?(yield l.refresh(o,l.refreshToken),l.accessToken):null:l.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(o,c){var l=this;return(0,v.Z)(function*(){const{accessToken:p,refreshToken:g,expiresIn:w}=yield function gi(u,o){return un.apply(this,arguments)}(o,c);l.updateTokensAndExpiration(p,g,Number(w))})()}updateTokensAndExpiration(o,c,l){this.refreshToken=c||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*l}static fromJSON(o,c){const{refreshToken:l,accessToken:p,expirationTime:g}=c,w=new zn;return l&&(F("string"==typeof l,"internal-error",{appName:o}),w.refreshToken=l),p&&(F("string"==typeof p,"internal-error",{appName:o}),w.accessToken=p),g&&(F("number"==typeof g,"internal-error",{appName:o}),w.expirationTime=g),w}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}_clone(){return Object.assign(new zn,this.toJSON())}_performRefresh(){return Xe("not implemented")}}function et(u,o){F("string"==typeof u||typeof u>"u","internal-error",{appName:o})}class zt{constructor(o){var{uid:c,auth:l,stsTokenManager:p}=o,g=(0,ht._T)(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ir(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=c,this.auth=l,this.stsTokenManager=p,this.accessToken=p.accessToken,this.displayName=g.displayName||null,this.email=g.email||null,this.emailVerified=g.emailVerified||!1,this.phoneNumber=g.phoneNumber||null,this.photoURL=g.photoURL||null,this.isAnonymous=g.isAnonymous||!1,this.tenantId=g.tenantId||null,this.providerData=g.providerData?[...g.providerData]:[],this.metadata=new os(g.createdAt||void 0,g.lastLoginAt||void 0)}getIdToken(o){var c=this;return(0,v.Z)(function*(){const l=yield vt(c,c.stsTokenManager.getToken(c.auth,o));return F(l,c.auth,"internal-error"),c.accessToken!==l&&(c.accessToken=l,yield c.auth._persistUserIfCurrent(c),c.auth._notifyListenersIfCurrent(c)),l})()}getIdTokenResult(o){return function ss(u){return pn.apply(this,arguments)}(this,o)}reload(){return function cn(u){return Pr.apply(this,arguments)}(this)}_assign(o){this!==o&&(F(this.uid===o.uid,this.auth,"internal-error"),this.displayName=o.displayName,this.photoURL=o.photoURL,this.email=o.email,this.emailVerified=o.emailVerified,this.phoneNumber=o.phoneNumber,this.isAnonymous=o.isAnonymous,this.tenantId=o.tenantId,this.providerData=o.providerData.map(c=>Object.assign({},c)),this.metadata._copy(o.metadata),this.stsTokenManager._assign(o.stsTokenManager))}_clone(o){const c=new zt(Object.assign(Object.assign({},this),{auth:o,stsTokenManager:this.stsTokenManager._clone()}));return c.metadata._copy(this.metadata),c}_onReload(o){F(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=o,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(o){this.reloadListener?this.reloadListener(o):this.reloadUserInfo=o}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(o,c=!1){var l=this;return(0,v.Z)(function*(){let p=!1;o.idToken&&o.idToken!==l.stsTokenManager.accessToken&&(l.stsTokenManager.updateFromServerResponse(o),p=!0),c&&(yield an(l)),yield l.auth._persistUserIfCurrent(l),p&&l.auth._notifyListenersIfCurrent(l)})()}delete(){var o=this;return(0,v.Z)(function*(){const c=yield o.getIdToken();return yield vt(o,function Za(u,o){return it.apply(this,arguments)}(o.auth,{idToken:c})),o.stsTokenManager.clearRefreshToken(),o.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(o=>Object.assign({},o)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(o,c){var l,p,g,w,C,U,G,Y;const Q=null!==(l=c.displayName)&&void 0!==l?l:void 0,Ve=null!==(p=c.email)&&void 0!==p?p:void 0,jt=null!==(g=c.phoneNumber)&&void 0!==g?g:void 0,oi=null!==(w=c.photoURL)&&void 0!==w?w:void 0,Kc=null!==(C=c.tenantId)&&void 0!==C?C:void 0,ga=null!==(U=c._redirectEventId)&&void 0!==U?U:void 0,Un=null!==(G=c.createdAt)&&void 0!==G?G:void 0,Hc=null!==(Y=c.lastLoginAt)&&void 0!==Y?Y:void 0,{uid:Er,emailVerified:Wc,isAnonymous:ya,providerData:qi,stsTokenManager:_a}=c;F(Er&&_a,o,"internal-error");const ai=zn.fromJSON(this.name,_a);F("string"==typeof Er,o,"internal-error"),et(Q,o.name),et(Ve,o.name),F("boolean"==typeof Wc,o,"internal-error"),F("boolean"==typeof ya,o,"internal-error"),et(jt,o.name),et(oi,o.name),et(Kc,o.name),et(ga,o.name),et(Un,o.name),et(Hc,o.name);const St=new zt({uid:Er,auth:o,email:Ve,emailVerified:Wc,displayName:Q,isAnonymous:ya,photoURL:oi,phoneNumber:jt,tenantId:Kc,stsTokenManager:ai,createdAt:Un,lastLoginAt:Hc});return qi&&Array.isArray(qi)&&(St.providerData=qi.map(Qc=>Object.assign({},Qc))),ga&&(St._redirectEventId=ga),St}static _fromIdTokenResponse(o,c,l=!1){return(0,v.Z)(function*(){const p=new zn;p.updateFromServerResponse(c);const g=new zt({uid:c.localId,auth:o,stsTokenManager:p,isAnonymous:l});return yield an(g),g})()}}const as=new Map;function xt(u){nt(u instanceof Function,"Expected a class definition");let o=as.get(u);return o?(nt(o instanceof u,"Instance stored in cache mismatched with class"),o):(o=new u,as.set(u,o),o)}const bn=(()=>{class u{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,v.Z)(function*(){return!0})()}_set(c,l){var p=this;return(0,v.Z)(function*(){p.storage[c]=l})()}_get(c){var l=this;return(0,v.Z)(function*(){const p=l.storage[c];return void 0===p?null:p})()}_remove(c){var l=this;return(0,v.Z)(function*(){delete l.storage[c]})()}_addListener(c,l){}_removeListener(c,l){}}return u.type="NONE",u})();function E(u,o,c){return`firebase:${u}:${o}:${c}`}class I{constructor(o,c,l){this.persistence=o,this.auth=c,this.userKey=l;const{config:p,name:g}=this.auth;this.fullUserKey=E(this.userKey,p.apiKey,g),this.fullPersistenceKey=E("persistence",p.apiKey,g),this.boundEventHandler=c._onStorageEvent.bind(c),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(o){return this.persistence._set(this.fullUserKey,o.toJSON())}getCurrentUser(){var o=this;return(0,v.Z)(function*(){const c=yield o.persistence._get(o.fullUserKey);return c?zt._fromJSON(o.auth,c):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(o){var c=this;return(0,v.Z)(function*(){if(c.persistence===o)return;const l=yield c.getCurrentUser();return yield c.removeCurrentUser(),c.persistence=o,l?c.setCurrentUser(l):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(o,c,l="authUser"){return(0,v.Z)(function*(){if(!c.length)return new I(xt(bn),o,l);const p=(yield Promise.all(c.map(function(){var G=(0,v.Z)(function*(Y){if(yield Y._isAvailable())return Y});return function(Y){return G.apply(this,arguments)}}()))).filter(G=>G);let g=p[0]||xt(bn);const w=E(l,o.config.apiKey,o.name);let C=null;for(const G of c)try{const Y=yield G._get(w);if(Y){const Q=zt._fromJSON(o,Y);G!==g&&(C=Q),g=G;break}}catch{}const U=p.filter(G=>G._shouldAllowMigration);return g._shouldAllowMigration&&U.length?(g=U[0],C&&(yield g._set(w,C.toJSON())),yield Promise.all(c.map(function(){var G=(0,v.Z)(function*(Y){if(Y!==g)try{yield Y._remove(w)}catch{}});return function(Y){return G.apply(this,arguments)}}())),new I(g,o,l)):new I(g,o,l)})()}}function T(u){const o=u.toLowerCase();if(o.includes("opera/")||o.includes("opr/")||o.includes("opios/"))return"Opera";if(ue(o))return"IEMobile";if(o.includes("msie")||o.includes("trident/"))return"IE";if(o.includes("edge/"))return"Edge";if(M(o))return"Firefox";if(o.includes("silk/"))return"Silk";if(It(o))return"Blackberry";if(st(o))return"Webos";if(k(o))return"Safari";if((o.includes("chrome/")||ee(o))&&!o.includes("edge/"))return"Chrome";if(Oe(o))return"Android";{const l=u.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===l?.length)return l[1]}return"Other"}function M(u=(0,R.z$)()){return/firefox\//i.test(u)}function k(u=(0,R.z$)()){const o=u.toLowerCase();return o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("crios/")&&!o.includes("android")}function ee(u=(0,R.z$)()){return/crios\//i.test(u)}function ue(u=(0,R.z$)()){return/iemobile/i.test(u)}function Oe(u=(0,R.z$)()){return/android/i.test(u)}function It(u=(0,R.z$)()){return/blackberry/i.test(u)}function st(u=(0,R.z$)()){return/webos/i.test(u)}function dt(u=(0,R.z$)()){return/iphone|ipad|ipod/i.test(u)||/macintosh/i.test(u)&&/mobile/i.test(u)}function Mr(u=(0,R.z$)()){return dt(u)||Oe(u)||st(u)||It(u)||/windows phone/i.test(u)||ue(u)}function D(u,o=[]){let c;switch(u){case"Browser":c=T((0,R.z$)());break;case"Worker":c=`${T((0,R.z$)())}-${u}`;break;default:c=u}const l=o.length?o.join(","):"FirebaseCore-web";return`${c}/JsCore/${X.SDK_VERSION}/${l}`}function B(){return(B=(0,v.Z)(function*(u){return(yield Fe(u,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function b(u,o){return ce.apply(this,arguments)}function ce(){return(ce=(0,v.Z)(function*(u,o){return Fe(u,"GET","/v2/recaptchaConfig",ke(u,o))})).apply(this,arguments)}function de(u){return void 0!==u&&void 0!==u.getResponse}function se(u){return void 0!==u&&void 0!==u.enterprise}class wt{constructor(o){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===o.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=o.recaptchaKey.split("/")[3],this.emailPasswordEnabled=o.recaptchaEnforcementState.some(c=>"EMAIL_PASSWORD_PROVIDER"===c.provider&&"OFF"!==c.enforcementState)}}function q(u){return new Promise((o,c)=>{const l=document.createElement("script");l.setAttribute("src",u),l.onload=o,l.onerror=p=>{const g=Re("internal-error");g.customData=p,c(g)},l.type="text/javascript",l.charset="UTF-8",function Pe(){var u,o;return null!==(o=null===(u=document.getElementsByTagName("head"))||void 0===u?void 0:u[0])&&void 0!==o?o:document}().appendChild(l)})}function sr(u){return`__${u}${Math.floor(1e6*Math.random())}`}class Ru{constructor(o){this.type="recaptcha-enterprise",this.auth=_e(o)}verify(o="verify",c=!1){var l=this;return(0,v.Z)(function*(){function g(){return g=(0,v.Z)(function*(C){if(!c){if(null==C.tenantId&&null!=C._agentRecaptchaConfig)return C._agentRecaptchaConfig.siteKey;if(null!=C.tenantId&&void 0!==C._tenantRecaptchaConfigs[C.tenantId])return C._tenantRecaptchaConfigs[C.tenantId].siteKey}return new Promise(function(){var U=(0,v.Z)(function*(G,Y){b(C,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(Q=>{if(void 0!==Q.recaptchaKey){const Ve=new wt(Q);return null==C.tenantId?C._agentRecaptchaConfig=Ve:C._tenantRecaptchaConfigs[C.tenantId]=Ve,G(Ve.siteKey)}Y(new Error("recaptcha Enterprise site key undefined"))}).catch(Q=>{Y(Q)})});return function(G,Y){return U.apply(this,arguments)}}())}),g.apply(this,arguments)}function w(C,U,G){const Y=window.grecaptcha;se(Y)?Y.enterprise.ready(()=>{Y.enterprise.execute(C,{action:o}).then(Q=>{U(Q)}).catch(()=>{U("NO_RECAPTCHA")})}):G(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((C,U)=>{(function p(C){return g.apply(this,arguments)})(l.auth).then(G=>{if(!c&&se(window.grecaptcha))w(G,C,U);else{if(typeof window>"u")return void U(new Error("RecaptchaVerifier is only supported in browser"));q("https://www.google.com/recaptcha/enterprise.js?render="+G).then(()=>{w(G,C,U)}).catch(Y=>{U(Y)})}}).catch(G=>{U(G)})})})()}}function Cn(u,o,c){return Ka.apply(this,arguments)}function Ka(){return(Ka=(0,v.Z)(function*(u,o,c,l=!1){const p=new Ru(u);let g;try{g=yield p.verify(c)}catch{g=yield p.verify(c,!0)}const w=Object.assign({},o);return Object.assign(w,l?{captchaResp:g}:{captchaResponse:g}),Object.assign(w,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(w,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),w})).apply(this,arguments)}class bh{constructor(o){this.auth=o,this.queue=[]}pushCallback(o,c){const l=g=>new Promise((w,C)=>{try{w(o(g))}catch(U){C(U)}});l.onAbort=c,this.queue.push(l);const p=this.queue.length-1;return()=>{this.queue[p]=()=>Promise.resolve()}}runMiddleware(o){var c=this;return(0,v.Z)(function*(){if(c.auth.currentUser===o)return;const l=[];try{for(const p of c.queue)yield p(o),p.onAbort&&l.push(p.onAbort)}catch(p){l.reverse();for(const g of l)try{g()}catch{}throw c.auth._errorFactory.create("login-blocked",{originalMessage:p?.message})}})()}}class Sh{constructor(o,c,l,p){this.app=o,this.heartbeatServiceProvider=c,this.appCheckServiceProvider=l,this.config=p,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ls(this),this.idTokenSubscription=new ls(this),this.beforeStateQueue=new bh(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ye,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=o.name,this.clientVersion=p.sdkClientVersion}_initializeWithPersistence(o,c){var l=this;return c&&(this._popupRedirectResolver=xt(c)),this._initializationPromise=this.queue((0,v.Z)(function*(){var p,g;if(!l._deleted&&(l.persistenceManager=yield I.create(l,o),!l._deleted)){if(null!==(p=l._popupRedirectResolver)&&void 0!==p&&p._shouldInitProactively)try{yield l._popupRedirectResolver._initialize(l)}catch{}yield l.initializeCurrentUser(c),l.lastNotifiedUid=(null===(g=l.currentUser)||void 0===g?void 0:g.uid)||null,!l._deleted&&(l._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var o=this;return(0,v.Z)(function*(){if(o._deleted)return;const c=yield o.assertedPersistence.getCurrentUser();if(o.currentUser||c){if(o.currentUser&&c&&o.currentUser.uid===c.uid)return o._currentUser._assign(c),void(yield o.currentUser.getIdToken());yield o._updateCurrentUser(c,!0)}})()}initializeCurrentUser(o){var c=this;return(0,v.Z)(function*(){var l;const p=yield c.assertedPersistence.getCurrentUser();let g=p,w=!1;if(o&&c.config.authDomain){yield c.getOrInitRedirectPersistenceManager();const C=null===(l=c.redirectUser)||void 0===l?void 0:l._redirectEventId,U=g?._redirectEventId,G=yield c.tryRedirectSignIn(o);(!C||C===U)&&G?.user&&(g=G.user,w=!0)}if(!g)return c.directlySetCurrentUser(null);if(!g._redirectEventId){if(w)try{yield c.beforeStateQueue.runMiddleware(g)}catch(C){g=p,c._popupRedirectResolver._overrideRedirectResult(c,()=>Promise.reject(C))}return g?c.reloadAndSetCurrentUserOrClear(g):c.directlySetCurrentUser(null)}return F(c._popupRedirectResolver,c,"argument-error"),yield c.getOrInitRedirectPersistenceManager(),c.redirectUser&&c.redirectUser._redirectEventId===g._redirectEventId?c.directlySetCurrentUser(g):c.reloadAndSetCurrentUserOrClear(g)})()}tryRedirectSignIn(o){var c=this;return(0,v.Z)(function*(){let l=null;try{l=yield c._popupRedirectResolver._completeRedirectFn(c,o,!0)}catch{yield c._setRedirectUser(null)}return l})()}reloadAndSetCurrentUserOrClear(o){var c=this;return(0,v.Z)(function*(){try{yield an(o)}catch(l){if("auth/network-request-failed"!==l?.code)return c.directlySetCurrentUser(null)}return c.directlySetCurrentUser(o)})()}useDeviceLanguage(){this.languageCode=function kr(){if(typeof navigator>"u")return null;const u=navigator;return u.languages&&u.languages[0]||u.language||null}()}_delete(){var o=this;return(0,v.Z)(function*(){o._deleted=!0})()}updateCurrentUser(o){var c=this;return(0,v.Z)(function*(){const l=o?(0,R.m9)(o):null;return l&&F(l.auth.config.apiKey===c.config.apiKey,c,"invalid-user-token"),c._updateCurrentUser(l&&l._clone(c))})()}_updateCurrentUser(o,c=!1){var l=this;return(0,v.Z)(function*(){if(!l._deleted)return o&&F(l.tenantId===o.tenantId,l,"tenant-id-mismatch"),c||(yield l.beforeStateQueue.runMiddleware(o)),l.queue((0,v.Z)(function*(){yield l.directlySetCurrentUser(o),l.notifyAuthListeners()}))})()}signOut(){var o=this;return(0,v.Z)(function*(){return yield o.beforeStateQueue.runMiddleware(null),(o.redirectPersistenceManager||o._popupRedirectResolver)&&(yield o._setRedirectUser(null)),o._updateCurrentUser(null,!0)})()}setPersistence(o){var c=this;return this.queue((0,v.Z)(function*(){yield c.assertedPersistence.setPersistence(xt(o))}))}initializeRecaptchaConfig(){var o=this;return(0,v.Z)(function*(){const c=yield b(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),l=new wt(c);null==o.tenantId?o._agentRecaptchaConfig=l:o._tenantRecaptchaConfigs[o.tenantId]=l,l.emailPasswordEnabled&&new Ru(o).verify()})()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(o){this._errorFactory=new R.LL("auth","Firebase",o())}onAuthStateChanged(o,c,l){return this.registerStateListener(this.authStateSubscription,o,c,l)}beforeAuthStateChanged(o,c){return this.beforeStateQueue.pushCallback(o,c)}onIdTokenChanged(o,c,l){return this.registerStateListener(this.idTokenSubscription,o,c,l)}toJSON(){var o;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(o=this._currentUser)||void 0===o?void 0:o.toJSON()}}_setRedirectUser(o,c){var l=this;return(0,v.Z)(function*(){const p=yield l.getOrInitRedirectPersistenceManager(c);return null===o?p.removeCurrentUser():p.setCurrentUser(o)})()}getOrInitRedirectPersistenceManager(o){var c=this;return(0,v.Z)(function*(){if(!c.redirectPersistenceManager){const l=o&&xt(o)||c._popupRedirectResolver;F(l,c,"argument-error"),c.redirectPersistenceManager=yield I.create(c,[xt(l._redirectPersistence)],"redirectUser"),c.redirectUser=yield c.redirectPersistenceManager.getCurrentUser()}return c.redirectPersistenceManager})()}_redirectUserForId(o){var c=this;return(0,v.Z)(function*(){var l,p;return c._isInitialized&&(yield c.queue((0,v.Z)(function*(){}))),(null===(l=c._currentUser)||void 0===l?void 0:l._redirectEventId)===o?c._currentUser:(null===(p=c.redirectUser)||void 0===p?void 0:p._redirectEventId)===o?c.redirectUser:null})()}_persistUserIfCurrent(o){var c=this;return(0,v.Z)(function*(){if(o===c.currentUser)return c.queue((0,v.Z)(function*(){return c.directlySetCurrentUser(o)}))})()}_notifyListenersIfCurrent(o){o===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o,c;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=null!==(c=null===(o=this.currentUser)||void 0===o?void 0:o.uid)&&void 0!==c?c:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(o,c,l,p){if(this._deleted)return()=>{};const g="function"==typeof c?c:c.next.bind(c),w=this._isInitialized?Promise.resolve():this._initializationPromise;return F(w,this,"internal-error"),w.then(()=>g(this.currentUser)),"function"==typeof c?o.addObserver(c,l,p):o.addObserver(c)}directlySetCurrentUser(o){var c=this;return(0,v.Z)(function*(){c.currentUser&&c.currentUser!==o&&c._currentUser._stopProactiveRefresh(),o&&c.isProactiveRefreshEnabled&&o._startProactiveRefresh(),c.currentUser=o,o?yield c.assertedPersistence.setCurrentUser(o):yield c.assertedPersistence.removeCurrentUser()})()}queue(o){return this.operations=this.operations.then(o,o),this.operations}get assertedPersistence(){return F(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(o){!o||this.frameworks.includes(o)||(this.frameworks.push(o),this.frameworks.sort(),this.clientVersion=D(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var o=this;return(0,v.Z)(function*(){var c;const l={"X-Client-Version":o.clientVersion};o.app.options.appId&&(l["X-Firebase-gmpid"]=o.app.options.appId);const p=yield null===(c=o.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===c?void 0:c.getHeartbeatsHeader();p&&(l["X-Firebase-Client"]=p);const g=yield o._getAppCheckToken();return g&&(l["X-Firebase-AppCheck"]=g),l})()}_getAppCheckToken(){var o=this;return(0,v.Z)(function*(){var c;const l=yield null===(c=o.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===c?void 0:c.getToken();return l?.error&&function rn(u,...o){Bt.logLevel<=Je.in.WARN&&Bt.warn(`Auth (${X.SDK_VERSION}): ${u}`,...o)}(`Error while retrieving App Check token: ${l.error}`),l?.token})()}}function _e(u){return(0,R.m9)(u)}class ls{constructor(o){this.auth=o,this.observer=null,this.addObserver=(0,R.ne)(c=>this.observer=c)}get next(){return F(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Ha(u){const o=u.indexOf(":");return o<0?"":u.substr(0,o+1)}function Qa(u){if(!u)return null;const o=Number(u);return isNaN(o)?null:o}class yi{constructor(o,c){this.providerId=o,this.signInMethod=c}toJSON(){return Xe("not implemented")}_getIdTokenResponse(o){return Xe("not implemented")}_linkToIdToken(o,c){return Xe("not implemented")}_getReauthenticationResolver(o){return Xe("not implemented")}}function _i(u,o){return vi.apply(this,arguments)}function vi(){return(vi=(0,v.Z)(function*(u,o){return Fe(u,"POST","/v1/accounts:resetPassword",ke(u,o))})).apply(this,arguments)}function mn(u,o){return hs.apply(this,arguments)}function hs(){return(hs=(0,v.Z)(function*(u,o){return Fe(u,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Ya(){return(Ya=(0,v.Z)(function*(u,o){return Fe(u,"POST","/v1/accounts:update",ke(u,o))})).apply(this,arguments)}function ar(u,o){return lo.apply(this,arguments)}function lo(){return(lo=(0,v.Z)(function*(u,o){return Qt(u,"POST","/v1/accounts:signInWithPassword",ke(u,o))})).apply(this,arguments)}function Ii(u,o){return ho.apply(this,arguments)}function ho(){return(ho=(0,v.Z)(function*(u,o){return Fe(u,"POST","/v1/accounts:sendOobCode",ke(u,o))})).apply(this,arguments)}function fo(){return(fo=(0,v.Z)(function*(u,o){return Ii(u,o)})).apply(this,arguments)}function ds(u,o){return fs.apply(this,arguments)}function fs(){return(fs=(0,v.Z)(function*(u,o){return Ii(u,o)})).apply(this,arguments)}function ps(u,o){return ms.apply(this,arguments)}function ms(){return(ms=(0,v.Z)(function*(u,o){return Ii(u,o)})).apply(this,arguments)}function po(){return(po=(0,v.Z)(function*(u,o){return Ii(u,o)})).apply(this,arguments)}function Lr(){return(Lr=(0,v.Z)(function*(u,o){return Qt(u,"POST","/v1/accounts:signInWithEmailLink",ke(u,o))})).apply(this,arguments)}function Fr(){return(Fr=(0,v.Z)(function*(u,o){return Qt(u,"POST","/v1/accounts:signInWithEmailLink",ke(u,o))})).apply(this,arguments)}class gs extends yi{constructor(o,c,l,p=null){super("password",l),this._email=o,this._password=c,this._tenantId=p}static _fromEmailAndPassword(o,c){return new gs(o,c,"password")}static _fromEmailAndCode(o,c,l=null){return new gs(o,c,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(o){const c="string"==typeof o?JSON.parse(o):o;if(c?.email&&c?.password){if("password"===c.signInMethod)return this._fromEmailAndPassword(c.email,c.password);if("emailLink"===c.signInMethod)return this._fromEmailAndCode(c.email,c.password,c.tenantId)}return null}_getIdTokenResponse(o){var c=this;return(0,v.Z)(function*(){var l;switch(c.signInMethod){case"password":const p={returnSecureToken:!0,email:c._email,password:c._password,clientType:"CLIENT_TYPE_WEB"};if(null!==(l=o._getRecaptchaConfig())&&void 0!==l&&l.emailPasswordEnabled){const g=yield Cn(o,p,"signInWithPassword");return ar(o,g)}return ar(o,p).catch(function(){var g=(0,v.Z)(function*(w){if("auth/missing-recaptcha-token"===w.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const C=yield Cn(o,p,"signInWithPassword");return ar(o,C)}return Promise.reject(w)});return function(w){return g.apply(this,arguments)}}());case"emailLink":return function Ah(u,o){return Lr.apply(this,arguments)}(o,{email:c._email,oobCode:c._password});default:P(o,"internal-error")}})()}_linkToIdToken(o,c){var l=this;return(0,v.Z)(function*(){switch(l.signInMethod){case"password":return mn(o,{idToken:c,returnSecureToken:!0,email:l._email,password:l._password});case"emailLink":return function kh(u,o){return Fr.apply(this,arguments)}(o,{idToken:c,email:l._email,oobCode:l._password});default:P(o,"internal-error")}})()}_getReauthenticationResolver(o){return this._getIdTokenResponse(o)}}function Zn(u,o){return wi.apply(this,arguments)}function wi(){return(wi=(0,v.Z)(function*(u,o){return Qt(u,"POST","/v1/accounts:signInWithIdp",ke(u,o))})).apply(this,arguments)}class xn extends yi{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(o){const c=new xn(o.providerId,o.signInMethod);return o.idToken||o.accessToken?(o.idToken&&(c.idToken=o.idToken),o.accessToken&&(c.accessToken=o.accessToken),o.nonce&&!o.pendingToken&&(c.nonce=o.nonce),o.pendingToken&&(c.pendingToken=o.pendingToken)):o.oauthToken&&o.oauthTokenSecret?(c.accessToken=o.oauthToken,c.secret=o.oauthTokenSecret):P("argument-error"),c}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(o){const c="string"==typeof o?JSON.parse(o):o,{providerId:l,signInMethod:p}=c,g=(0,ht._T)(c,["providerId","signInMethod"]);if(!l||!p)return null;const w=new xn(l,p);return w.idToken=g.idToken||void 0,w.accessToken=g.accessToken||void 0,w.secret=g.secret,w.nonce=g.nonce,w.pendingToken=g.pendingToken||null,w}_getIdTokenResponse(o){return Zn(o,this.buildRequest())}_linkToIdToken(o,c){const l=this.buildRequest();return l.idToken=c,Zn(o,l)}_getReauthenticationResolver(o){const c=this.buildRequest();return c.autoCreate=!1,Zn(o,c)}buildRequest(){const o={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)o.pendingToken=this.pendingToken;else{const c={};this.idToken&&(c.id_token=this.idToken),this.accessToken&&(c.access_token=this.accessToken),this.secret&&(c.oauth_token_secret=this.secret),c.providerId=this.providerId,this.nonce&&!this.pendingToken&&(c.nonce=this.nonce),o.postBody=(0,R.xO)(c)}return o}}function mo(){return(mo=(0,v.Z)(function*(u,o){return Fe(u,"POST","/v1/accounts:sendVerificationCode",ke(u,o))})).apply(this,arguments)}function Ei(){return(Ei=(0,v.Z)(function*(u,o){return Qt(u,"POST","/v1/accounts:signInWithPhoneNumber",ke(u,o))})).apply(this,arguments)}function ys(){return(ys=(0,v.Z)(function*(u,o){const c=yield Qt(u,"POST","/v1/accounts:signInWithPhoneNumber",ke(u,o));if(c.temporaryProof)throw Dr(u,"account-exists-with-different-credential",c);return c})).apply(this,arguments)}const tc={USER_NOT_FOUND:"user-not-found"};function go(){return(go=(0,v.Z)(function*(u,o){return Qt(u,"POST","/v1/accounts:signInWithPhoneNumber",ke(u,Object.assign(Object.assign({},o),{operation:"REAUTH"})),tc)})).apply(this,arguments)}class cr extends yi{constructor(o){super("phone","phone"),this.params=o}static _fromVerification(o,c){return new cr({verificationId:o,verificationCode:c})}static _fromTokenResponse(o,c){return new cr({phoneNumber:o,temporaryProof:c})}_getIdTokenResponse(o){return function Lu(u,o){return Ei.apply(this,arguments)}(o,this._makeVerificationRequest())}_linkToIdToken(o,c){return function ec(u,o){return ys.apply(this,arguments)}(o,Object.assign({idToken:c},this._makeVerificationRequest()))}_getReauthenticationResolver(o){return function nc(u,o){return go.apply(this,arguments)}(o,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:o,phoneNumber:c,verificationId:l,verificationCode:p}=this.params;return o&&c?{temporaryProof:o,phoneNumber:c}:{sessionInfo:l,code:p}}toJSON(){const o={providerId:this.providerId};return this.params.phoneNumber&&(o.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(o.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(o.verificationCode=this.params.verificationCode),this.params.verificationId&&(o.verificationId=this.params.verificationId),o}static fromJSON(o){"string"==typeof o&&(o=JSON.parse(o));const{verificationId:c,verificationCode:l,phoneNumber:p,temporaryProof:g}=o;return l||c||p||g?new cr({verificationId:c,verificationCode:l,phoneNumber:p,temporaryProof:g}):null}}class Ti{constructor(o){var c,l,p,g,w,C;const U=(0,R.zd)((0,R.pd)(o)),G=null!==(c=U.apiKey)&&void 0!==c?c:null,Y=null!==(l=U.oobCode)&&void 0!==l?l:null,Q=function Oh(u){switch(u){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(p=U.mode)&&void 0!==p?p:null);F(G&&Y&&Q,"argument-error"),this.apiKey=G,this.operation=Q,this.code=Y,this.continueUrl=null!==(g=U.continueUrl)&&void 0!==g?g:null,this.languageCode=null!==(w=U.languageCode)&&void 0!==w?w:null,this.tenantId=null!==(C=U.tenantId)&&void 0!==C?C:null}static parseLink(o){const c=function Fu(u){const o=(0,R.zd)((0,R.pd)(u)).link,c=o?(0,R.zd)((0,R.pd)(o)).deep_link_id:null,l=(0,R.zd)((0,R.pd)(u)).deep_link_id;return(l?(0,R.zd)((0,R.pd)(l)).link:null)||l||c||o||u}(o);try{return new Ti(c)}catch{return null}}}let yo=(()=>{class u{constructor(){this.providerId=u.PROVIDER_ID}static credential(c,l){return gs._fromEmailAndPassword(c,l)}static credentialWithLink(c,l){const p=Ti.parseLink(l);return F(p,"argument-error"),gs._fromEmailAndCode(c,p.code,p.tenantId)}}return u.PROVIDER_ID="password",u.EMAIL_PASSWORD_SIGN_IN_METHOD="password",u.EMAIL_LINK_SIGN_IN_METHOD="emailLink",u})();class Gn{constructor(o){this.providerId=o,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(o){this.defaultLanguageCode=o}setCustomParameters(o){return this.customParameters=o,this}getCustomParameters(){return this.customParameters}}class ur extends Gn{constructor(){super(...arguments),this.scopes=[]}addScope(o){return this.scopes.includes(o)||this.scopes.push(o),this}getScopes(){return[...this.scopes]}}class lr extends ur{static credentialFromJSON(o){const c="string"==typeof o?JSON.parse(o):o;return F("providerId"in c&&"signInMethod"in c,"argument-error"),xn._fromParams(c)}credential(o){return this._credential(Object.assign(Object.assign({},o),{nonce:o.rawNonce}))}_credential(o){return F(o.idToken||o.accessToken,"argument-error"),xn._fromParams(Object.assign(Object.assign({},o),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(o){return lr.oauthCredentialFromTaggedObject(o)}static credentialFromError(o){return lr.oauthCredentialFromTaggedObject(o.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{oauthIdToken:c,oauthAccessToken:l,oauthTokenSecret:p,pendingToken:g,nonce:w,providerId:C}=o;if(!l&&!p&&!c&&!g||!C)return null;try{return new lr(C)._credential({idToken:c,accessToken:l,nonce:w,pendingToken:g})}catch{return null}}}let _o=(()=>{class u extends ur{constructor(){super("facebook.com")}static credential(c){return xn._fromParams({providerId:u.PROVIDER_ID,signInMethod:u.FACEBOOK_SIGN_IN_METHOD,accessToken:c})}static credentialFromResult(c){return u.credentialFromTaggedObject(c)}static credentialFromError(c){return u.credentialFromTaggedObject(c.customData||{})}static credentialFromTaggedObject({_tokenResponse:c}){if(!c||!("oauthAccessToken"in c)||!c.oauthAccessToken)return null;try{return u.credential(c.oauthAccessToken)}catch{return null}}}return u.FACEBOOK_SIGN_IN_METHOD="facebook.com",u.PROVIDER_ID="facebook.com",u})(),ot=(()=>{class u extends ur{constructor(){super("google.com"),this.addScope("profile")}static credential(c,l){return xn._fromParams({providerId:u.PROVIDER_ID,signInMethod:u.GOOGLE_SIGN_IN_METHOD,idToken:c,accessToken:l})}static credentialFromResult(c){return u.credentialFromTaggedObject(c)}static credentialFromError(c){return u.credentialFromTaggedObject(c.customData||{})}static credentialFromTaggedObject({_tokenResponse:c}){if(!c)return null;const{oauthIdToken:l,oauthAccessToken:p}=c;if(!l&&!p)return null;try{return u.credential(l,p)}catch{return null}}}return u.GOOGLE_SIGN_IN_METHOD="google.com",u.PROVIDER_ID="google.com",u})(),pt=(()=>{class u extends ur{constructor(){super("github.com")}static credential(c){return xn._fromParams({providerId:u.PROVIDER_ID,signInMethod:u.GITHUB_SIGN_IN_METHOD,accessToken:c})}static credentialFromResult(c){return u.credentialFromTaggedObject(c)}static credentialFromError(c){return u.credentialFromTaggedObject(c.customData||{})}static credentialFromTaggedObject({_tokenResponse:c}){if(!c||!("oauthAccessToken"in c)||!c.oauthAccessToken)return null;try{return u.credential(c.oauthAccessToken)}catch{return null}}}return u.GITHUB_SIGN_IN_METHOD="github.com",u.PROVIDER_ID="github.com",u})();class hr extends yi{constructor(o,c){super(o,o),this.pendingToken=c}_getIdTokenResponse(o){return Zn(o,this.buildRequest())}_linkToIdToken(o,c){const l=this.buildRequest();return l.idToken=c,Zn(o,l)}_getReauthenticationResolver(o){const c=this.buildRequest();return c.autoCreate=!1,Zn(o,c)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(o){const c="string"==typeof o?JSON.parse(o):o,{providerId:l,signInMethod:p,pendingToken:g}=c;return l&&p&&g&&l===p?new hr(l,g):null}static _create(o,c){return new hr(o,c)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Io extends Gn{constructor(o){F(o.startsWith("saml."),"argument-error"),super(o)}static credentialFromResult(o){return Io.samlCredentialFromTaggedObject(o)}static credentialFromError(o){return Io.samlCredentialFromTaggedObject(o.customData||{})}static credentialFromJSON(o){const c=hr.fromJSON(o);return F(c,"argument-error"),c}static samlCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{pendingToken:c,providerId:l}=o;if(!c||!l)return null;try{return hr._create(l,c)}catch{return null}}}let Vu=(()=>{class u extends ur{constructor(){super("twitter.com")}static credential(c,l){return xn._fromParams({providerId:u.PROVIDER_ID,signInMethod:u.TWITTER_SIGN_IN_METHOD,oauthToken:c,oauthTokenSecret:l})}static credentialFromResult(c){return u.credentialFromTaggedObject(c)}static credentialFromError(c){return u.credentialFromTaggedObject(c.customData||{})}static credentialFromTaggedObject({_tokenResponse:c}){if(!c)return null;const{oauthAccessToken:l,oauthTokenSecret:p}=c;if(!l||!p)return null;try{return u.credential(l,p)}catch{return null}}}return u.TWITTER_SIGN_IN_METHOD="twitter.com",u.PROVIDER_ID="twitter.com",u})();function _s(u,o){return rc.apply(this,arguments)}function rc(){return(rc=(0,v.Z)(function*(u,o){return Qt(u,"POST","/v1/accounts:signUp",ke(u,o))})).apply(this,arguments)}class hn{constructor(o){this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}static _fromIdTokenResponse(o,c,l,p=!1){return(0,v.Z)(function*(){const g=yield zt._fromIdTokenResponse(o,l,p),w=Bu(l);return new hn({user:g,providerId:w,_tokenResponse:l,operationType:c})})()}static _forOperation(o,c,l){return(0,v.Z)(function*(){yield o._updateTokensIfNecessary(l,!0);const p=Bu(l);return new hn({user:o,providerId:p,_tokenResponse:l,operationType:c})})()}}function Bu(u){return u.providerId?u.providerId:"phoneNumber"in u?"phone":null}function Ur(){return(Ur=(0,v.Z)(function*(u){var o;const c=_e(u);if(yield c._initializationPromise,null!==(o=c.currentUser)&&void 0!==o&&o.isAnonymous)return new hn({user:c.currentUser,providerId:null,operationType:"signIn"});const l=yield _s(c,{returnSecureToken:!0}),p=yield hn._fromIdTokenResponse(c,"signIn",l,!0);return yield c._updateCurrentUser(p.user),p})).apply(this,arguments)}class bi extends R.ZR{constructor(o,c,l,p){var g;super(c.code,c.message),this.operationType=l,this.user=p,Object.setPrototypeOf(this,bi.prototype),this.customData={appName:o.name,tenantId:null!==(g=o.tenantId)&&void 0!==g?g:void 0,_serverResponse:c.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(o,c,l,p){return new bi(o,c,l,p)}}function ic(u,o,c,l){return("reauthenticate"===o?c._getReauthenticationResolver(u):c._getIdTokenResponse(u)).catch(g=>{throw"auth/multi-factor-auth-required"===g.code?bi._fromErrorAndOperation(u,g,o,l):g})}function zu(u){return new Set(u.map(({providerId:o})=>o).filter(o=>!!o))}function Is(){return Is=(0,v.Z)(function*(u,o){const c=(0,R.m9)(u);yield To(!0,c,o);const{providerUserInfo:l}=yield function co(u,o){return Nr.apply(this,arguments)}(c.auth,{idToken:yield c.getIdToken(),deleteProvider:[o]}),p=zu(l||[]);return c.providerData=c.providerData.filter(g=>p.has(g.providerId)),p.has("phone")||(c.phoneNumber=null),yield c.auth._persistUserIfCurrent(c),c}),Is.apply(this,arguments)}function ws(u,o){return Eo.apply(this,arguments)}function Eo(){return(Eo=(0,v.Z)(function*(u,o,c=!1){const l=yield vt(u,o._linkToIdToken(u.auth,yield u.getIdToken()),c);return hn._forOperation(u,"link",l)})).apply(this,arguments)}function To(u,o,c){return Vr.apply(this,arguments)}function Vr(){return(Vr=(0,v.Z)(function*(u,o,c){yield an(o);const p=!1===u?"provider-already-linked":"no-such-provider";F(zu(o.providerData).has(c)===u,o.auth,p)})).apply(this,arguments)}function sc(u,o){return bo.apply(this,arguments)}function bo(){return(bo=(0,v.Z)(function*(u,o,c=!1){const{auth:l}=u,p="reauthenticate";try{const g=yield vt(u,ic(l,p,o,u),c);F(g.idToken,l,"internal-error");const w=Mt(g.idToken);F(w,l,"internal-error");const{sub:C}=w;return F(u.uid===C,l,"user-mismatch"),hn._forOperation(u,p,g)}catch(g){throw"auth/user-not-found"===g?.code&&P(l,"user-mismatch"),g}})).apply(this,arguments)}function oc(u,o){return Si.apply(this,arguments)}function Si(){return(Si=(0,v.Z)(function*(u,o,c=!1){const l="signIn",p=yield ic(u,l,o),g=yield hn._fromIdTokenResponse(u,l,p);return c||(yield u._updateCurrentUser(g.user)),g})).apply(this,arguments)}function So(u,o){return ac.apply(this,arguments)}function ac(){return(ac=(0,v.Z)(function*(u,o){return oc(_e(u),o)})).apply(this,arguments)}function Br(u,o){return cc.apply(this,arguments)}function cc(){return(cc=(0,v.Z)(function*(u,o){const c=(0,R.m9)(u);return yield To(!1,c,o.providerId),ws(c,o)})).apply(this,arguments)}function Zu(u,o){return qn.apply(this,arguments)}function qn(){return(qn=(0,v.Z)(function*(u,o){return sc((0,R.m9)(u),o)})).apply(this,arguments)}function Ci(){return(Ci=(0,v.Z)(function*(u,o){return Qt(u,"POST","/v1/accounts:signInWithCustomToken",ke(u,o))})).apply(this,arguments)}function zr(){return zr=(0,v.Z)(function*(u,o){const c=_e(u),l=yield function Gu(u,o){return Ci.apply(this,arguments)}(c,{token:o,returnSecureToken:!0}),p=yield hn._fromIdTokenResponse(c,"signIn",l);return yield c._updateCurrentUser(p.user),p}),zr.apply(this,arguments)}class xi{constructor(o,c){this.factorId=o,this.uid=c.mfaEnrollmentId,this.enrollmentTime=new Date(c.enrolledAt).toUTCString(),this.displayName=c.displayName}static _fromServerResponse(o,c){return"phoneInfo"in c?Et._fromServerResponse(o,c):"totpInfo"in c?Co._fromServerResponse(o,c):P(o,"internal-error")}}class Et extends xi{constructor(o){super("phone",o),this.phoneNumber=o.phoneInfo}static _fromServerResponse(o,c){return new Et(c)}}class Co extends xi{constructor(o){super("totp",o)}static _fromServerResponse(o,c){return new Co(c)}}function An(u,o,c){var l;F((null===(l=c.url)||void 0===l?void 0:l.length)>0,u,"invalid-continue-uri"),F(typeof c.dynamicLinkDomain>"u"||c.dynamicLinkDomain.length>0,u,"invalid-dynamic-link-domain"),o.continueUrl=c.url,o.dynamicLinkDomain=c.dynamicLinkDomain,o.canHandleCodeInApp=c.handleCodeInApp,c.iOS&&(F(c.iOS.bundleId.length>0,u,"missing-ios-bundle-id"),o.iOSBundleId=c.iOS.bundleId),c.android&&(F(c.android.packageName.length>0,u,"missing-android-pkg-name"),o.androidInstallApp=c.android.installApp,o.androidMinimumVersionCode=c.android.minimumVersion,o.androidPackageName=c.android.packageName)}function Ao(){return Ao=(0,v.Z)(function*(u,o,c){var l;const p=_e(u),g={requestType:"PASSWORD_RESET",email:o,clientType:"CLIENT_TYPE_WEB"};if(null!==(l=p._getRecaptchaConfig())&&void 0!==l&&l.emailPasswordEnabled){const w=yield Cn(p,g,"getOobCode",!0);c&&An(p,w,c),yield ds(p,w)}else c&&An(p,g,c),yield ds(p,g).catch(function(){var w=(0,v.Z)(function*(C){if("auth/missing-recaptcha-token"!==C.code)return Promise.reject(C);{console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");const U=yield Cn(p,g,"getOobCode",!0);c&&An(p,U,c),yield ds(p,U)}});return function(C){return w.apply(this,arguments)}}())}),Ao.apply(this,arguments)}function ko(){return(ko=(0,v.Z)(function*(u,o,c){yield _i((0,R.m9)(u),{oobCode:o,newPassword:c})})).apply(this,arguments)}function Zr(){return Zr=(0,v.Z)(function*(u,o){yield function Ch(u,o){return Ya.apply(this,arguments)}((0,R.m9)(u),{oobCode:o})}),Zr.apply(this,arguments)}function Oo(u,o){return Es.apply(this,arguments)}function Es(){return(Es=(0,v.Z)(function*(u,o){const c=(0,R.m9)(u),l=yield _i(c,{oobCode:o}),p=l.requestType;switch(F(p,c,"internal-error"),p){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":F(l.newEmail,c,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":F(l.mfaInfo,c,"internal-error");default:F(l.email,c,"internal-error")}let g=null;return l.mfaInfo&&(g=xi._fromServerResponse(_e(c),l.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.newEmail:l.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.email:l.newEmail)||null,multiFactorInfo:g},operation:p}})).apply(this,arguments)}function Ai(){return(Ai=(0,v.Z)(function*(u,o){const{data:c}=yield Oo((0,R.m9)(u),o);return c.email})).apply(this,arguments)}function Do(){return Do=(0,v.Z)(function*(u,o,c){var l;const p=_e(u),g={returnSecureToken:!0,email:o,password:c,clientType:"CLIENT_TYPE_WEB"};let w;if(null!==(l=p._getRecaptchaConfig())&&void 0!==l&&l.emailPasswordEnabled){const G=yield Cn(p,g,"signUpPassword");w=_s(p,G)}else w=_s(p,g).catch(function(){var G=(0,v.Z)(function*(Y){if("auth/missing-recaptcha-token"===Y.code){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const Q=yield Cn(p,g,"signUpPassword");return _s(p,Q)}return Promise.reject(Y)});return function(Y){return G.apply(this,arguments)}}());const C=yield w.catch(G=>Promise.reject(G)),U=yield hn._fromIdTokenResponse(p,"signIn",C);return yield p._updateCurrentUser(U.user),U}),Do.apply(this,arguments)}function ki(){return ki=(0,v.Z)(function*(u,o,c){var l;const p=_e(u),g={requestType:"EMAIL_SIGNIN",email:o,clientType:"CLIENT_TYPE_WEB"};function w(C,U){F(U.handleCodeInApp,p,"argument-error"),U&&An(p,C,U)}if(null!==(l=p._getRecaptchaConfig())&&void 0!==l&&l.emailPasswordEnabled){const C=yield Cn(p,g,"getOobCode",!0);w(C,c),yield ps(p,C)}else w(g,c),yield ps(p,g).catch(function(){var C=(0,v.Z)(function*(U){if("auth/missing-recaptcha-token"!==U.code)return Promise.reject(U);{console.log("Email link sign-in is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const G=yield Cn(p,g,"getOobCode",!0);w(G,c),yield ps(p,G)}});return function(U){return C.apply(this,arguments)}}())}),ki.apply(this,arguments)}function No(){return(No=(0,v.Z)(function*(u,o,c){const l=(0,R.m9)(u),p=yo.credentialWithLink(o,c||vn());return F(p._tenantId===(l.tenantId||null),l,"tenant-id-mismatch"),So(l,p)})).apply(this,arguments)}function fc(){return(fc=(0,v.Z)(function*(u,o){return Fe(u,"POST","/v1/accounts:createAuthUri",ke(u,o))})).apply(this,arguments)}function Ro(){return Ro=(0,v.Z)(function*(u,o){const l={identifier:o,continueUri:Ar()?vn():"http://localhost"},{signinMethods:p}=yield function Ku(u,o){return fc.apply(this,arguments)}((0,R.m9)(u),l);return p||[]}),Ro.apply(this,arguments)}function Gr(){return Gr=(0,v.Z)(function*(u,o){const c=(0,R.m9)(u),p={requestType:"VERIFY_EMAIL",idToken:yield u.getIdToken()};o&&An(c.auth,p,o);const{email:g}=yield function xh(u,o){return fo.apply(this,arguments)}(c.auth,p);g!==u.email&&(yield u.reload())}),Gr.apply(this,arguments)}function Ss(){return Ss=(0,v.Z)(function*(u,o,c){const l=(0,R.m9)(u),g={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield u.getIdToken(),newEmail:o};c&&An(l.auth,g,c);const{email:w}=yield function Ja(u,o){return po.apply(this,arguments)}(l.auth,g);w!==u.email&&(yield u.reload())}),Ss.apply(this,arguments)}function pc(){return(pc=(0,v.Z)(function*(u,o){return Fe(u,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Mo(){return Mo=(0,v.Z)(function*(u,{displayName:o,photoURL:c}){if(void 0===o&&void 0===c)return;const l=(0,R.m9)(u),g={idToken:yield l.getIdToken(),displayName:o,photoUrl:c,returnSecureToken:!0},w=yield vt(l,function Rh(u,o){return pc.apply(this,arguments)}(l.auth,g));l.displayName=w.displayName||null,l.photoURL=w.photoUrl||null;const C=l.providerData.find(({providerId:U})=>"password"===U);C&&(C.displayName=l.displayName,C.photoURL=l.photoURL),yield l._updateTokensIfNecessary(w)}),Mo.apply(this,arguments)}function kn(u,o,c){return Oi.apply(this,arguments)}function Oi(){return(Oi=(0,v.Z)(function*(u,o,c){const{auth:l}=u,g={idToken:yield u.getIdToken(),returnSecureToken:!0};o&&(g.email=o),c&&(g.password=c);const w=yield vt(u,mn(l,g));yield u._updateTokensIfNecessary(w,!0)})).apply(this,arguments)}class $r{constructor(o,c,l={}){this.isNewUser=o,this.providerId=c,this.profile=l}}class ze extends $r{constructor(o,c,l,p){super(o,c,l),this.username=p}}class Fo extends $r{constructor(o,c){super(o,"facebook.com",c)}}class Cs extends ze{constructor(o,c){super(o,"github.com",c,"string"==typeof c?.login?c?.login:null)}}class xs extends $r{constructor(o,c){super(o,"google.com",c)}}class Mh extends ze{constructor(o,c,l){super(o,"twitter.com",c,l)}}function Wu(u){const{user:o,_tokenResponse:c}=u;return o.isAnonymous&&!c?{providerId:null,isNewUser:!1,profile:null}:function Lo(u){var o,c;if(!u)return null;const{providerId:l}=u,p=u.rawUserInfo?JSON.parse(u.rawUserInfo):{},g=u.isNewUser||"identitytoolkit#SignupNewUserResponse"===u.kind;if(!l&&u?.idToken){const w=null===(c=null===(o=Mt(u.idToken))||void 0===o?void 0:o.firebase)||void 0===c?void 0:c.sign_in_provider;if(w)return new $r(g,"anonymous"!==w&&"custom"!==w?w:null)}if(!l)return null;switch(l){case"facebook.com":return new Fo(g,p);case"github.com":return new Cs(g,p);case"google.com":return new xs(g,p);case"twitter.com":return new Mh(g,p,u.screenName||null);case"custom":case"anonymous":return new $r(g,null);default:return new $r(g,l,p)}}(c)}class Hr{constructor(o,c,l){this.type=o,this.credential=c,this.auth=l}static _fromIdtoken(o,c){return new Hr("enroll",o,c)}static _fromMfaPendingCredential(o){return new Hr("signin",o)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(o){var c,l;if(o?.multiFactorSession){if(null!==(c=o.multiFactorSession)&&void 0!==c&&c.pendingCredential)return Hr._fromMfaPendingCredential(o.multiFactorSession.pendingCredential);if(null!==(l=o.multiFactorSession)&&void 0!==l&&l.idToken)return Hr._fromIdtoken(o.multiFactorSession.idToken)}return null}}class mc{constructor(o,c,l){this.session=o,this.hints=c,this.signInResolver=l}static _fromError(o,c){const l=_e(o),p=c.customData._serverResponse,g=(p.mfaInfo||[]).map(C=>xi._fromServerResponse(l,C));F(p.mfaPendingCredential,l,"internal-error");const w=Hr._fromMfaPendingCredential(p.mfaPendingCredential);return new mc(w,g,function(){var C=(0,v.Z)(function*(U){const G=yield U._process(l,w);delete p.mfaInfo,delete p.mfaPendingCredential;const Y=Object.assign(Object.assign({},p),{idToken:G.idToken,refreshToken:G.refreshToken});switch(c.operationType){case"signIn":const Q=yield hn._fromIdTokenResponse(l,c.operationType,Y);return yield l._updateCurrentUser(Q.user),Q;case"reauthenticate":return F(c.user,l,"internal-error"),hn._forOperation(c.user,c.operationType,Y);default:P(l,"internal-error")}});return function(U){return C.apply(this,arguments)}}())}resolveSignIn(o){var c=this;return(0,v.Z)(function*(){return c.signInResolver(o)})()}}class Vo{constructor(o){this.user=o,this.enrolledFactors=[],o._onReload(c=>{c.mfaInfo&&(this.enrolledFactors=c.mfaInfo.map(l=>xi._fromServerResponse(o.auth,l)))})}static _fromUser(o){return new Vo(o)}getSession(){var o=this;return(0,v.Z)(function*(){return Hr._fromIdtoken(yield o.user.getIdToken(),o.user.auth)})()}enroll(o,c){var l=this;return(0,v.Z)(function*(){const p=o,g=yield l.getSession(),w=yield vt(l.user,p._process(l.user.auth,g,c));return yield l.user._updateTokensIfNecessary(w),l.user.reload()})()}unenroll(o){var c=this;return(0,v.Z)(function*(){const l="string"==typeof o?o:o.uid,p=yield c.user.getIdToken();try{const g=yield vt(c.user,function yc(u,o){return Fe(u,"POST","/v2/accounts/mfaEnrollment:withdraw",ke(u,o))}(c.user.auth,{idToken:p,mfaEnrollmentId:l}));c.enrolledFactors=c.enrolledFactors.filter(({uid:w})=>w!==l),yield c.user._updateTokensIfNecessary(g),yield c.user.reload()}catch(g){throw g}})()}}const Bo=new WeakMap,zo="__sak";class Ju{constructor(o,c){this.storageRetriever=o,this.type=c}_isAvailable(){try{return this.storage?(this.storage.setItem(zo,"1"),this.storage.removeItem(zo),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(o,c){return this.storage.setItem(o,JSON.stringify(c)),Promise.resolve()}_get(o){const c=this.storage.getItem(o);return Promise.resolve(c?JSON.parse(c):null)}_remove(o){return this.storage.removeItem(o),Promise.resolve()}get storage(){return this.storageRetriever()}}const Di=(()=>{class u extends Ju{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(c,l)=>this.onStorageEvent(c,l),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function qh(){const u=(0,R.z$)();return k(u)||dt(u)}()&&function $a(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=Mr(),this._shouldAllowMigration=!0}forAllChangedKeys(c){for(const l of Object.keys(this.listeners)){const p=this.storage.getItem(l),g=this.localCache[l];p!==g&&c(l,g,p)}}onStorageEvent(c,l=!1){if(!c.key)return void this.forAllChangedKeys((C,U,G)=>{this.notifyListeners(C,G)});const p=c.key;if(l?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const C=this.storage.getItem(p);if(c.newValue!==C)null!==c.newValue?this.storage.setItem(p,c.newValue):this.storage.removeItem(p);else if(this.localCache[p]===c.newValue&&!l)return}const g=()=>{const C=this.storage.getItem(p);!l&&this.localCache[p]===C||this.notifyListeners(p,C)},w=this.storage.getItem(p);!function Sn(){return(0,R.w1)()&&10===document.documentMode}()||w===c.newValue||c.newValue===c.oldValue?g():setTimeout(g,10)}notifyListeners(c,l){this.localCache[c]=l;const p=this.listeners[c];if(p)for(const g of Array.from(p))g(l&&JSON.parse(l))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((c,l,p)=>{this.onStorageEvent(new StorageEvent("storage",{key:c,oldValue:l,newValue:p}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(c,l){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[c]||(this.listeners[c]=new Set,this.localCache[c]=this.storage.getItem(c)),this.listeners[c].add(l)}_removeListener(c,l){this.listeners[c]&&(this.listeners[c].delete(l),0===this.listeners[c].size&&delete this.listeners[c]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(c,l){var p=()=>super._set,g=this;return(0,v.Z)(function*(){yield p().call(g,c,l),g.localCache[c]=JSON.stringify(l)})()}_get(c){var l=()=>super._get,p=this;return(0,v.Z)(function*(){const g=yield l().call(p,c);return p.localCache[c]=JSON.stringify(g),g})()}_remove(c){var l=()=>super._remove,p=this;return(0,v.Z)(function*(){yield l().call(p,c),delete p.localCache[c]})()}}return u.type="LOCAL",u})(),dn=(()=>{class u extends Ju{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(c,l){}_removeListener(c,l){}}return u.type="SESSION",u})();let $h=(()=>{class u{constructor(c){this.eventTarget=c,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(c){const l=this.receivers.find(g=>g.isListeningto(c));if(l)return l;const p=new u(c);return this.receivers.push(p),p}isListeningto(c){return this.eventTarget===c}handleEvent(c){var l=this;return(0,v.Z)(function*(){const p=c,{eventId:g,eventType:w,data:C}=p.data,U=l.handlersMap[w];if(!U?.size)return;p.ports[0].postMessage({status:"ack",eventId:g,eventType:w});const G=Array.from(U).map(function(){var Q=(0,v.Z)(function*(Ve){return Ve(p.origin,C)});return function(Ve){return Q.apply(this,arguments)}}()),Y=yield function ks(u){return Promise.all(u.map(function(){var o=(0,v.Z)(function*(c){try{return{fulfilled:!0,value:yield c}}catch(l){return{fulfilled:!1,reason:l}}});return function(c){return o.apply(this,arguments)}}()))}(G);p.ports[0].postMessage({status:"done",eventId:g,eventType:w,response:Y})})()}_subscribe(c,l){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[c]||(this.handlersMap[c]=new Set),this.handlersMap[c].add(l)}_unsubscribe(c,l){this.handlersMap[c]&&l&&this.handlersMap[c].delete(l),(!l||0===this.handlersMap[c].size)&&delete this.handlersMap[c],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return u.receivers=[],u})();function Ze(u="",o=10){let c="";for(let l=0;l<o;l++)c+=Math.floor(10*Math.random());return u+c}class Xu{constructor(o){this.target=o,this.handlers=new Set}removeMessageHandler(o){o.messageChannel&&(o.messageChannel.port1.removeEventListener("message",o.onMessage),o.messageChannel.port1.close()),this.handlers.delete(o)}_send(o,c,l=50){var p=this;return(0,v.Z)(function*(){const g=typeof MessageChannel<"u"?new MessageChannel:null;if(!g)throw new Error("connection_unavailable");let w,C;return new Promise((U,G)=>{const Y=Ze("",20);g.port1.start();const Q=setTimeout(()=>{G(new Error("unsupported_event"))},l);C={messageChannel:g,onMessage(Ve){const jt=Ve;if(jt.data.eventId===Y)switch(jt.data.status){case"ack":clearTimeout(Q),w=setTimeout(()=>{G(new Error("timeout"))},3e3);break;case"done":clearTimeout(w),U(jt.data.response);break;default:clearTimeout(Q),clearTimeout(w),G(new Error("invalid_response"))}}},p.handlers.add(C),g.port1.addEventListener("message",C.onMessage),p.target.postMessage({eventType:o,eventId:Y,data:c},[g.port2])}).finally(()=>{C&&p.removeMessageHandler(C)})})()}}function rt(){return window}function vc(){return typeof rt().WorkerGlobalScope<"u"&&"function"==typeof rt().importScripts}function Go(){return(Go=(0,v.Z)(function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const Ic="firebaseLocalStorageDb",Os="firebaseLocalStorage",nl="fbase_key";class Ni{constructor(o){this.request=o}toPromise(){return new Promise((o,c)=>{this.request.addEventListener("success",()=>{o(this.request.result)}),this.request.addEventListener("error",()=>{c(this.request.error)})})}}function Ri(u,o){return u.transaction([Os],o?"readwrite":"readonly").objectStore(Os)}function jo(){const u=indexedDB.open(Ic,1);return new Promise((o,c)=>{u.addEventListener("error",()=>{c(u.error)}),u.addEventListener("upgradeneeded",()=>{const l=u.result;try{l.createObjectStore(Os,{keyPath:nl})}catch(p){c(p)}}),u.addEventListener("success",(0,v.Z)(function*(){const l=u.result;l.objectStoreNames.contains(Os)?o(l):(l.close(),yield function Ds(){const u=indexedDB.deleteDatabase(Ic);return new Ni(u).toPromise()}(),o(yield jo()))}))})}function $o(u,o,c){return Pi.apply(this,arguments)}function Pi(){return(Pi=(0,v.Z)(function*(u,o,c){const l=Ri(u,!0).put({[nl]:o,value:c});return new Ni(l).toPromise()})).apply(this,arguments)}function Mi(){return(Mi=(0,v.Z)(function*(u,o){const c=Ri(u,!1).get(o),l=yield new Ni(c).toPromise();return void 0===l?null:l.value})).apply(this,arguments)}function il(u,o){const c=Ri(u,!0).delete(o);return new Ni(c).toPromise()}const Wr=(()=>{class u{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var c=this;return(0,v.Z)(function*(){return c.db||(c.db=yield jo()),c.db})()}_withRetries(c){var l=this;return(0,v.Z)(function*(){let p=0;for(;;)try{const g=yield l._openDb();return yield c(g)}catch(g){if(p++>3)throw g;l.db&&(l.db.close(),l.db=void 0)}})()}initializeServiceWorkerMessaging(){var c=this;return(0,v.Z)(function*(){return vc()?c.initializeReceiver():c.initializeSender()})()}initializeReceiver(){var c=this;return(0,v.Z)(function*(){c.receiver=$h._getInstance(function qo(){return vc()?self:null}()),c.receiver._subscribe("keyChanged",function(){var l=(0,v.Z)(function*(p,g){return{keyProcessed:(yield c._poll()).includes(g.key)}});return function(p,g){return l.apply(this,arguments)}}()),c.receiver._subscribe("ping",function(){var l=(0,v.Z)(function*(p,g){return["keyChanged"]});return function(p,g){return l.apply(this,arguments)}}())})()}initializeSender(){var c=this;return(0,v.Z)(function*(){var l,p;if(c.activeServiceWorker=yield function el(){return Go.apply(this,arguments)}(),!c.activeServiceWorker)return;c.sender=new Xu(c.activeServiceWorker);const g=yield c.sender._send("ping",{},800);g&&null!==(l=g[0])&&void 0!==l&&l.fulfilled&&null!==(p=g[0])&&void 0!==p&&p.value.includes("keyChanged")&&(c.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(c){var l=this;return(0,v.Z)(function*(){if(l.sender&&l.activeServiceWorker&&function tl(){var u;return(null===(u=navigator?.serviceWorker)||void 0===u?void 0:u.controller)||null}()===l.activeServiceWorker)try{yield l.sender._send("keyChanged",{key:c},l.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,v.Z)(function*(){try{if(!indexedDB)return!1;const c=yield jo();return yield $o(c,zo,"1"),yield il(c,zo),!0}catch{}return!1})()}_withPendingWrite(c){var l=this;return(0,v.Z)(function*(){l.pendingWrites++;try{yield c()}finally{l.pendingWrites--}})()}_set(c,l){var p=this;return(0,v.Z)(function*(){return p._withPendingWrite((0,v.Z)(function*(){return yield p._withRetries(g=>$o(g,c,l)),p.localCache[c]=l,p.notifyServiceWorker(c)}))})()}_get(c){var l=this;return(0,v.Z)(function*(){const p=yield l._withRetries(g=>function rl(u,o){return Mi.apply(this,arguments)}(g,c));return l.localCache[c]=p,p})()}_remove(c){var l=this;return(0,v.Z)(function*(){return l._withPendingWrite((0,v.Z)(function*(){return yield l._withRetries(p=>il(p,c)),delete l.localCache[c],l.notifyServiceWorker(c)}))})()}_poll(){var c=this;return(0,v.Z)(function*(){const l=yield c._withRetries(w=>{const C=Ri(w,!1).getAll();return new Ni(C).toPromise()});if(!l)return[];if(0!==c.pendingWrites)return[];const p=[],g=new Set;for(const{fbase_key:w,value:C}of l)g.add(w),JSON.stringify(c.localCache[w])!==JSON.stringify(C)&&(c.notifyListeners(w,C),p.push(w));for(const w of Object.keys(c.localCache))c.localCache[w]&&!g.has(w)&&(c.notifyListeners(w,null),p.push(w));return p})()}notifyListeners(c,l){this.localCache[c]=l;const p=this.listeners[c];if(p)for(const g of Array.from(p))g(l)}startPolling(){var c=this;this.stopPolling(),this.pollTimer=setInterval((0,v.Z)(function*(){return c._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(c,l){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[c]||(this.listeners[c]=new Set,this._get(c)),this.listeners[c].add(l)}_removeListener(c,l){this.listeners[c]&&(this.listeners[c].delete(l),0===this.listeners[c].size&&delete this.listeners[c]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return u.type="LOCAL",u})(),Rs=1e12;class Qr{constructor(o){this.auth=o,this.counter=Rs,this._widgets=new Map}render(o,c){const l=this.counter;return this._widgets.set(l,new cl(o,this.auth.name,c||{})),this.counter++,l}reset(o){var c;const l=o||Rs;null===(c=this._widgets.get(l))||void 0===c||c.delete(),this._widgets.delete(l)}getResponse(o){var c;return(null===(c=this._widgets.get(o||Rs))||void 0===c?void 0:c.getResponse())||""}execute(o){var c=this;return(0,v.Z)(function*(){var l;return null===(l=c._widgets.get(o||Rs))||void 0===l||l.execute(),""})()}}class cl{constructor(o,c,l){this.params=l,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const p="string"==typeof o?document.getElementById(o):o;F(p,"argument-error",{appName:c}),this.container=p,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function ul(u){const o=[],c="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let l=0;l<u;l++)o.push(c.charAt(Math.floor(62*Math.random())));return o.join("")}(50);const{callback:o,"expired-callback":c}=this.params;if(o)try{o(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,c)try{c()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Ho=sr("rcb"),ll=new Wt(3e4,6e4);class Yt{constructor(){var o;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(o=rt().grecaptcha)||void 0===o||!o.render)}load(o,c=""){return F(function hl(u){return u.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(u)}(c),o,"argument-error"),this.shouldResolveImmediately(c)&&de(rt().grecaptcha)?Promise.resolve(rt().grecaptcha):new Promise((l,p)=>{const g=rt().setTimeout(()=>{p(Re(o,"network-request-failed"))},ll.get());rt()[Ho]=()=>{rt().clearTimeout(g),delete rt()[Ho];const C=rt().grecaptcha;if(!C||!de(C))return void p(Re(o,"internal-error"));const U=C.render;C.render=(G,Y)=>{const Q=U(G,Y);return this.counter++,Q},this.hostLanguage=c,l(C)},q(`https://www.google.com/recaptcha/api.js??${(0,R.xO)({onload:Ho,render:"explicit",hl:c})}`).catch(()=>{clearTimeout(g),p(Re(o,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(o){var c;return!(null===(c=rt().grecaptcha)||void 0===c||!c.render)&&(o===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class dl{load(o){return(0,v.Z)(function*(){return new Qr(o)})()}clearedOneInstance(){}}const Yr="recaptcha",Wh={theme:"light",type:"image"};class gn{constructor(o,c=Object.assign({},Wh),l){this.parameters=c,this.type=Yr,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=_e(l),this.isInvisible="invisible"===this.parameters.size,F(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const p="string"==typeof o?document.getElementById(o):o;F(p,this.auth,"argument-error"),this.container=p,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new dl:new Yt,this.validateStartingState()}verify(){var o=this;return(0,v.Z)(function*(){o.assertNotDestroyed();const c=yield o.render(),l=o.getAssertedRecaptcha();return l.getResponse(c)||new Promise(g=>{const w=C=>{C&&(o.tokenChangeListeners.delete(w),g(C))};o.tokenChangeListeners.add(w),o.isInvisible&&l.execute(c)})})()}render(){try{this.assertNotDestroyed()}catch(o){return Promise.reject(o)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(o=>{throw this.renderPromise=null,o})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(o=>{this.container.removeChild(o)})}validateStartingState(){F(!this.parameters.sitekey,this.auth,"argument-error"),F(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),F(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(o){return c=>{if(this.tokenChangeListeners.forEach(l=>l(c)),"function"==typeof o)o(c);else if("string"==typeof o){const l=rt()[o];"function"==typeof l&&l(c)}}}assertNotDestroyed(){F(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var o=this;return(0,v.Z)(function*(){if(yield o.init(),!o.widgetId){let c=o.container;if(!o.isInvisible){const l=document.createElement("div");c.appendChild(l),c=l}o.widgetId=o.getAssertedRecaptcha().render(c,o.parameters)}return o.widgetId})()}init(){var o=this;return(0,v.Z)(function*(){F(Ar()&&!vc(),o.auth,"internal-error"),yield function Tc(){let u=null;return new Promise(o=>{"complete"!==document.readyState?(u=()=>o(),window.addEventListener("load",u)):o()}).catch(o=>{throw u&&window.removeEventListener("load",u),o})}(),o.recaptcha=yield o._recaptchaLoader.load(o.auth,o.auth.languageCode||void 0);const c=yield function A(u){return B.apply(this,arguments)}(o.auth);F(c,o.auth,"internal-error"),o.parameters.sitekey=c})()}getAssertedRecaptcha(){return F(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class De{constructor(o,c){this.verificationId=o,this.onConfirmation=c}confirm(o){const c=cr._fromVerification(this.verificationId,o);return this.onConfirmation(c)}}function Ps(){return(Ps=(0,v.Z)(function*(u,o,c){const l=_e(u),p=yield Li(l,o,(0,R.m9)(c));return new De(p,g=>So(l,g))})).apply(this,arguments)}function Qo(){return(Qo=(0,v.Z)(function*(u,o,c){const l=(0,R.m9)(u);yield To(!1,l,"phone");const p=yield Li(l.auth,o,(0,R.m9)(c));return new De(p,g=>Br(l,g))})).apply(this,arguments)}function fr(){return(fr=(0,v.Z)(function*(u,o,c){const l=(0,R.m9)(u),p=yield Li(l.auth,o,(0,R.m9)(c));return new De(p,g=>Zu(l,g))})).apply(this,arguments)}function Li(u,o,c){return Yo.apply(this,arguments)}function Yo(){return Yo=(0,v.Z)(function*(u,o,c){var l;const p=yield c.verify();try{let g;if(F("string"==typeof p,u,"argument-error"),F(c.type===Yr,u,"argument-error"),g="string"==typeof o?{phoneNumber:o}:o,"session"in g){const w=g.session;if("phoneNumber"in g)return F("enroll"===w.type,u,"internal-error"),(yield function zh(u,o){return Fe(u,"POST","/v2/accounts/mfaEnrollment:start",ke(u,o))}(u,{idToken:w.credential,phoneEnrollmentInfo:{phoneNumber:g.phoneNumber,recaptchaToken:p}})).phoneSessionInfo.sessionInfo;{F("signin"===w.type,u,"internal-error");const C=(null===(l=g.multiFactorHint)||void 0===l?void 0:l.uid)||g.multiFactorUid;return F(C,u,"missing-multi-factor-info"),(yield function wc(u,o){return Fe(u,"POST","/v2/accounts/mfaSignIn:start",ke(u,o))}(u,{mfaPendingCredential:w.credential,mfaEnrollmentId:C,phoneSignInInfo:{recaptchaToken:p}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:w}=yield function Mu(u,o){return mo.apply(this,arguments)}(u,{phoneNumber:g.phoneNumber,recaptchaToken:p});return w}}finally{c._reset()}}),Yo.apply(this,arguments)}function Zt(){return(Zt=(0,v.Z)(function*(u,o){yield ws((0,R.m9)(u),o)})).apply(this,arguments)}let tt=(()=>{class u{constructor(c){this.providerId=u.PROVIDER_ID,this.auth=_e(c)}verifyPhoneNumber(c,l){return Li(this.auth,c,(0,R.m9)(l))}static credential(c,l){return cr._fromVerification(c,l)}static credentialFromResult(c){return u.credentialFromTaggedObject(c)}static credentialFromError(c){return u.credentialFromTaggedObject(c.customData||{})}static credentialFromTaggedObject({_tokenResponse:c}){if(!c)return null;const{phoneNumber:l,temporaryProof:p}=c;return l&&p?cr._fromTokenResponse(l,p):null}}return u.PROVIDER_ID="phone",u.PHONE_SIGN_IN_METHOD="phone",u})();function Nn(u,o){return o?xt(o):(F(u._popupRedirectResolver,u,"argument-error"),u._popupRedirectResolver)}class Fi extends yi{constructor(o){super("custom","custom"),this.params=o}_getIdTokenResponse(o){return Zn(o,this._buildIdpRequest())}_linkToIdToken(o,c){return Zn(o,this._buildIdpRequest(c))}_getReauthenticationResolver(o){return Zn(o,this._buildIdpRequest())}_buildIdpRequest(o){const c={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return o&&(c.idToken=o),c}}function Ms(u){return oc(u.auth,new Fi(u),u.bypassAuthState)}function Jo(u){const{auth:o,user:c}=u;return F(c,o,"internal-error"),sc(c,new Fi(u),u.bypassAuthState)}function fl(u){return pr.apply(this,arguments)}function pr(){return(pr=(0,v.Z)(function*(u){const{auth:o,user:c}=u;return F(c,o,"internal-error"),ws(c,new Fi(u),u.bypassAuthState)})).apply(this,arguments)}class pl{constructor(o,c,l,p,g=!1){this.auth=o,this.resolver=l,this.user=p,this.bypassAuthState=g,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(c)?c:[c]}execute(){var o=this;return new Promise(function(){var c=(0,v.Z)(function*(l,p){o.pendingPromise={resolve:l,reject:p};try{o.eventManager=yield o.resolver._initialize(o.auth),yield o.onExecution(),o.eventManager.registerConsumer(o)}catch(g){o.reject(g)}});return function(l,p){return c.apply(this,arguments)}}())}onAuthEvent(o){var c=this;return(0,v.Z)(function*(){const{urlResponse:l,sessionId:p,postBody:g,tenantId:w,error:C,type:U}=o;if(C)return void c.reject(C);const G={auth:c.auth,requestUri:l,sessionId:p,tenantId:w||void 0,postBody:g||void 0,user:c.user,bypassAuthState:c.bypassAuthState};try{c.resolve(yield c.getIdpTask(U)(G))}catch(Y){c.reject(Y)}})()}onError(o){this.reject(o)}getIdpTask(o){switch(o){case"signInViaPopup":case"signInViaRedirect":return Ms;case"linkViaPopup":case"linkViaRedirect":return fl;case"reauthViaPopup":case"reauthViaRedirect":return Jo;default:P(this.auth,"internal-error")}}resolve(o){nt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(o),this.unregisterAndCleanUp()}reject(o){nt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(o),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Yh=new Wt(2e3,1e4);function Cc(){return(Cc=(0,v.Z)(function*(u,o,c){const l=_e(u);Te(u,o,Gn);const p=Nn(l,c);return new xc(l,"signInViaPopup",o,p).executeNotNull()})).apply(this,arguments)}function Xo(){return(Xo=(0,v.Z)(function*(u,o,c){const l=(0,R.m9)(u);Te(l.auth,o,Gn);const p=Nn(l.auth,c);return new xc(l.auth,"reauthViaPopup",o,p,l).executeNotNull()})).apply(this,arguments)}function Ui(){return(Ui=(0,v.Z)(function*(u,o,c){const l=(0,R.m9)(u);Te(l.auth,o,Gn);const p=Nn(l.auth,c);return new xc(l.auth,"linkViaPopup",o,p,l).executeNotNull()})).apply(this,arguments)}let xc=(()=>{class u extends pl{constructor(c,l,p,g,w){super(c,l,g,w),this.provider=p,this.authWindow=null,this.pollId=null,u.currentPopupAction&&u.currentPopupAction.cancel(),u.currentPopupAction=this}executeNotNull(){var c=this;return(0,v.Z)(function*(){const l=yield c.execute();return F(l,c.auth,"internal-error"),l})()}onExecution(){var c=this;return(0,v.Z)(function*(){nt(1===c.filter.length,"Popup operations only handle one event");const l=Ze();c.authWindow=yield c.resolver._openPopup(c.auth,c.provider,c.filter[0],l),c.authWindow.associatedEvent=l,c.resolver._originValidation(c.auth).catch(p=>{c.reject(p)}),c.resolver._isIframeWebStorageSupported(c.auth,p=>{p||c.reject(Re(c.auth,"web-storage-unsupported"))}),c.pollUserCancellation()})()}get eventId(){var c;return(null===(c=this.authWindow)||void 0===c?void 0:c.associatedEvent)||null}cancel(){this.reject(Re(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,u.currentPopupAction=null}pollUserCancellation(){const c=()=>{var l,p;this.pollId=null!==(p=null===(l=this.authWindow)||void 0===l?void 0:l.window)&&void 0!==p&&p.closed?window.setTimeout(()=>{this.pollId=null,this.reject(Re(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(c,Yh.get())};c()}}return u.currentPopupAction=null,u})();const ed="pendingRedirect",Rn=new Map;class ml extends pl{constructor(o,c,l=!1){super(o,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],c,void 0,l),this.eventId=null}execute(){var o=()=>super.execute,c=this;return(0,v.Z)(function*(){let l=Rn.get(c.auth._key());if(!l){try{const g=(yield function mt(u,o){return mr.apply(this,arguments)}(c.resolver,c.auth))?yield o().call(c):null;l=()=>Promise.resolve(g)}catch(p){l=()=>Promise.reject(p)}Rn.set(c.auth._key(),l)}return c.bypassAuthState||Rn.set(c.auth._key(),()=>Promise.resolve(null)),l()})()}onAuthEvent(o){var c=()=>super.onAuthEvent,l=this;return(0,v.Z)(function*(){if("signInViaRedirect"===o.type)return c().call(l,o);if("unknown"!==o.type){if(o.eventId){const p=yield l.auth._redirectUserForId(o.eventId);if(p)return l.user=p,c().call(l,o);l.resolve(null)}}else l.resolve(null)})()}onExecution(){return(0,v.Z)(function*(){})()}cleanUp(){}}function mr(){return(mr=(0,v.Z)(function*(u,o){const c=Jt(o),l=He(u);if(!(yield l._isAvailable()))return!1;const p="true"===(yield l._get(c));return yield l._remove(c),p})).apply(this,arguments)}function Pn(u,o){return Ls.apply(this,arguments)}function Ls(){return(Ls=(0,v.Z)(function*(u,o){return He(u)._set(Jt(o),"true")})).apply(this,arguments)}function V(u,o){Rn.set(u._key(),o)}function He(u){return xt(u._redirectPersistence)}function Jt(u){return E(ed,u.config.apiKey,u.name)}function Ac(u,o,c){return function J(u,o,c){return te.apply(this,arguments)}(u,o,c)}function te(){return(te=(0,v.Z)(function*(u,o,c){const l=_e(u);Te(u,o,Gn),yield l._initializationPromise;const p=Nn(l,c);return yield Pn(p,l),p._openRedirect(l,o,"signInViaRedirect")})).apply(this,arguments)}function nd(u,o,c){return function W(u,o,c){return O.apply(this,arguments)}(u,o,c)}function O(){return(O=(0,v.Z)(function*(u,o,c){const l=(0,R.m9)(u);Te(l.auth,o,Gn),yield l.auth._initializationPromise;const p=Nn(l.auth,c);yield Pn(p,l.auth);const g=yield gl(l);return p._openRedirect(l.auth,o,"reauthViaRedirect",g)})).apply(this,arguments)}function L(u,o,c){return function at(u,o,c){return ea.apply(this,arguments)}(u,o,c)}function ea(){return(ea=(0,v.Z)(function*(u,o,c){const l=(0,R.m9)(u);Te(l.auth,o,Gn),yield l.auth._initializationPromise;const p=Nn(l.auth,c);yield To(!1,l,o.providerId),yield Pn(p,l.auth);const g=yield gl(l);return p._openRedirect(l.auth,o,"linkViaRedirect",g)})).apply(this,arguments)}function kc(){return(kc=(0,v.Z)(function*(u,o){return yield _e(u)._initializationPromise,ta(u,o,!1)})).apply(this,arguments)}function ta(u,o){return Oc.apply(this,arguments)}function Oc(){return(Oc=(0,v.Z)(function*(u,o,c=!1){const l=_e(u),p=Nn(l,o),w=yield new ml(l,p,c).execute();return w&&!c&&(delete w.user._redirectEventId,yield l._persistUserIfCurrent(w.user),yield l._setRedirectUser(null,o)),w})).apply(this,arguments)}function gl(u){return na.apply(this,arguments)}function na(){return(na=(0,v.Z)(function*(u){const o=Ze(`${u.uid}:::`);return u._redirectEventId=o,yield u.auth._setRedirectUser(u),yield u.auth._persistUserIfCurrent(u),o})).apply(this,arguments)}class sd{constructor(o){this.auth=o,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(o){this.consumers.add(o),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,o)&&(this.sendToConsumer(this.queuedRedirectEvent,o),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(o){this.consumers.delete(o)}onEvent(o){if(this.hasEventBeenHandled(o))return!1;let c=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(o,l)&&(c=!0,this.sendToConsumer(o,l),this.saveEventToCache(o))}),this.hasHandledPotentialRedirect||!function le(u){switch(u.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Dc(u);default:return!1}}(o)||(this.hasHandledPotentialRedirect=!0,c||(this.queuedRedirectEvent=o,c=!0)),c}sendToConsumer(o,c){var l;if(o.error&&!Dc(o)){const p=(null===(l=o.error.code)||void 0===l?void 0:l.split("auth/")[1])||"internal-error";c.onError(Re(this.auth,p))}else c.onAuthEvent(o)}isEventForConsumer(o,c){const l=null===c.eventId||!!o.eventId&&o.eventId===c.eventId;return c.filter.includes(o.type)&&l}hasEventBeenHandled(o){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(yl(o))}saveEventToCache(o){this.cachedEventUids.add(yl(o)),this.lastProcessedEventTime=Date.now()}}function yl(u){return[u.type,u.eventId,u.sessionId,u.tenantId].filter(o=>o).join("-")}function Dc({type:u,error:o}){return"unknown"===u&&"auth/no-auth-event"===o?.code}function Jr(u){return ra.apply(this,arguments)}function ra(){return(ra=(0,v.Z)(function*(u,o={}){return Fe(u,"GET","/v1/projects",o)})).apply(this,arguments)}const je=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ie=/^https?/;function we(){return(we=(0,v.Z)(function*(u){if(u.config.emulator)return;const{authorizedDomains:o}=yield Jr(u);for(const c of o)try{if(od(c))return}catch{}P(u,"unauthorized-domain")})).apply(this,arguments)}function od(u){const o=vn(),{protocol:c,hostname:l}=new URL(o);if(u.startsWith("chrome-extension://")){const w=new URL(u);return""===w.hostname&&""===l?"chrome-extension:"===c&&u.replace("chrome-extension://","")===o.replace("chrome-extension://",""):"chrome-extension:"===c&&w.hostname===l}if(!ie.test(c))return!1;if(je.test(u))return l===u;const p=u.replace(/\./g,"\\.");return new RegExp("^(.+\\."+p+"|"+p+")$","i").test(l)}const We=new Wt(3e4,6e4);function j(){const u=rt().___jsl;if(u?.H)for(const o of Object.keys(u.H))if(u.H[o].r=u.H[o].r||[],u.H[o].L=u.H[o].L||[],u.H[o].r=[...u.H[o].L],u.CP)for(let c=0;c<u.CP.length;c++)u.CP[c]=null}let Vi=null;const ad=new Wt(5e3,15e3),sa="__/auth/iframe",cd="emulator/auth/iframe",Us={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_l=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function vl(u){const o=u.config;F(o.authDomain,u,"auth-domain-config-required");const c=o.emulator?Bn(o,cd):`https://${u.config.authDomain}/${sa}`,l={apiKey:o.apiKey,appName:u.name,v:X.SDK_VERSION},p=_l.get(u.config.apiHost);p&&(l.eid=p);const g=u._getFrameworks();return g.length&&(l.fw=g.join(",")),`${c}?${(0,R.xO)(l).slice(1)}`}function Vs(){return Vs=(0,v.Z)(function*(u){const o=yield function Xr(u){return Vi=Vi||function ia(u){return new Promise((o,c)=>{var l,p,g;function w(){j(),gapi.load("gapi.iframes",{callback:()=>{o(gapi.iframes.getContext())},ontimeout:()=>{j(),c(Re(u,"network-request-failed"))},timeout:We.get()})}if(null!==(p=null===(l=rt().gapi)||void 0===l?void 0:l.iframes)&&void 0!==p&&p.Iframe)o(gapi.iframes.getContext());else{if(null===(g=rt().gapi)||void 0===g||!g.load){const C=sr("iframefcb");return rt()[C]=()=>{gapi.load?w():c(Re(u,"network-request-failed"))},q(`https://apis.google.com/js/api.js?onload=${C}`).catch(U=>c(U))}w()}}).catch(o=>{throw Vi=null,o})}(u),Vi}(u),c=rt().gapi;return F(c,u,"internal-error"),o.open({where:document.body,url:vl(u),messageHandlersFilter:c.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Us,dontclear:!0},l=>new Promise(function(){var p=(0,v.Z)(function*(g,w){yield l.restyle({setHideOnLeave:!1});const C=Re(u,"network-request-failed"),U=rt().setTimeout(()=>{w(C)},ad.get());function G(){rt().clearTimeout(U),g(l)}l.ping(G).then(G,()=>{w(C)})});return function(g,w){return p.apply(this,arguments)}}()))}),Vs.apply(this,arguments)}const Il={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Bs{constructor(o){this.window=o,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const zs="__/auth/handler",yr="emulator/auth/handler",ld=encodeURIComponent("fac");function $n(u,o,c,l,p,g){return oa.apply(this,arguments)}function oa(){return(oa=(0,v.Z)(function*(u,o,c,l,p,g){F(u.config.authDomain,u,"auth-domain-config-required"),F(u.config.apiKey,u,"invalid-api-key");const w={apiKey:u.config.apiKey,appName:u.name,authType:c,redirectUrl:l,v:X.SDK_VERSION,eventId:p};if(o instanceof Gn){o.setDefaultLanguage(u.languageCode),w.providerId=o.providerId||"",(0,R.xb)(o.getCustomParameters())||(w.customParameters=JSON.stringify(o.getCustomParameters()));for(const[Y,Q]of Object.entries(g||{}))w[Y]=Q}if(o instanceof ur){const Y=o.getScopes().filter(Q=>""!==Q);Y.length>0&&(w.scopes=Y.join(","))}u.tenantId&&(w.tid=u.tenantId);const C=w;for(const Y of Object.keys(C))void 0===C[Y]&&delete C[Y];const U=yield u._getAppCheckToken(),G=U?`#${ld}=${encodeURIComponent(U)}`:"";return`${function Rc({config:u}){return u.emulator?Bn(u,yr):`https://${u.authDomain}/${zs}`}(u)}?${(0,R.xO)(C).slice(1)}${G}`})).apply(this,arguments)}const Pc="webStorageSupport",Gt=class hd{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=dn,this._completeRedirectFn=ta,this._overrideRedirectResult=V}_openPopup(o,c,l,p){var g=this;return(0,v.Z)(function*(){var w;nt(null===(w=g.eventManagers[o._key()])||void 0===w?void 0:w.manager,"_initialize() not called before _openPopup()");const C=yield $n(o,c,l,vn(),p);return function yn(u,o,c,l=500,p=600){const g=Math.max((window.screen.availHeight-p)/2,0).toString(),w=Math.max((window.screen.availWidth-l)/2,0).toString();let C="";const U=Object.assign(Object.assign({},Il),{width:l.toString(),height:p.toString(),top:g,left:w}),G=(0,R.z$)().toLowerCase();c&&(C=ee(G)?"_blank":c),M(G)&&(o=o||"http://localhost",U.scrollbars="yes");const Y=Object.entries(U).reduce((Ve,[jt,oi])=>`${Ve}${jt}=${oi},`,"");if(function ln(u=(0,R.z$)()){var o;return dt(u)&&!(null===(o=window.navigator)||void 0===o||!o.standalone)}(G)&&"_self"!==C)return function ud(u,o){const c=document.createElement("a");c.href=u,c.target=o;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),c.dispatchEvent(l)}(o||"",C),new Bs(null);const Q=window.open(o||"",C,Y);F(Q,u,"popup-blocked");try{Q.focus()}catch{}return new Bs(Q)}(o,C,Ze())})()}_openRedirect(o,c,l,p){var g=this;return(0,v.Z)(function*(){return yield g._originValidation(o),function Kh(u){rt().location.href=u}(yield $n(o,c,l,vn(),p)),new Promise(()=>{})})()}_initialize(o){const c=o._key();if(this.eventManagers[c]){const{manager:p,promise:g}=this.eventManagers[c];return p?Promise.resolve(p):(nt(g,"If manager is not set, promise should be"),g)}const l=this.initAndGetManager(o);return this.eventManagers[c]={promise:l},l.catch(()=>{delete this.eventManagers[c]}),l}initAndGetManager(o){var c=this;return(0,v.Z)(function*(){const l=yield function Xt(u){return Vs.apply(this,arguments)}(o),p=new sd(o);return l.register("authEvent",g=>(F(g?.authEvent,o,"invalid-auth-event"),{status:p.onEvent(g.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),c.eventManagers[o._key()]={manager:p},c.iframes[o._key()]=l,p})()}_isIframeWebStorageSupported(o,c){this.iframes[o._key()].send(Pc,{type:Pc},p=>{var g;const w=null===(g=p?.[0])||void 0===g?void 0:g[Pc];void 0!==w&&c(!!w),P(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(o){const c=o._key();return this.originValidationPromises[c]||(this.originValidationPromises[c]=function Fs(u){return we.apply(this,arguments)}(o)),this.originValidationPromises[c]}get _shouldInitProactively(){return Mr()||k()||dt()}};class Zs{constructor(o){this.factorId=o}_process(o,c,l){switch(c.type){case"enroll":return this._finalizeEnroll(o,c.credential,l);case"signin":return this._finalizeSignIn(o,c.credential);default:return Xe("unexpected MultiFactorSessionType")}}}class ei extends Zs{constructor(o){super("phone"),this.credential=o}static _fromCredential(o){return new ei(o)}_finalizeEnroll(o,c,l){return function Yu(u,o){return Fe(u,"POST","/v2/accounts/mfaEnrollment:finalize",ke(u,o))}(o,{idToken:c,displayName:l,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(o,c){return function Ec(u,o){return Fe(u,"POST","/v2/accounts/mfaSignIn:finalize",ke(u,o))}(o,{mfaPendingCredential:c,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let El=(()=>{class u{constructor(){}static assertion(c){return ei._fromCredential(c)}}return u.FACTOR_ID="phone",u})();var Fc="@firebase/auth";class Tl{constructor(o){this.auth=o,this.internalListeners=new Map}getUid(){var o;return this.assertAuthConfigured(),(null===(o=this.auth.currentUser)||void 0===o?void 0:o.uid)||null}getToken(o){var c=this;return(0,v.Z)(function*(){return c.assertAuthConfigured(),yield c.auth._initializationPromise,c.auth.currentUser?{accessToken:yield c.auth.currentUser.getIdToken(o)}:null})()}addAuthTokenListener(o){if(this.assertAuthConfigured(),this.internalListeners.has(o))return;const c=this.auth.onIdTokenChanged(l=>{o(l?.stsTokenManager.accessToken||null)});this.internalListeners.set(o,c),this.updateProactiveRefresh()}removeAuthTokenListener(o){this.assertAuthConfigured();const c=this.internalListeners.get(o);c&&(this.internalListeners.delete(o),c(),this.updateProactiveRefresh())}assertAuthConfigured(){F(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function ti(){return window}(0,R.Pz)("authIdTokenMaxAge"),function fd(u){(0,X._registerComponent)(new Be.wA("auth",(o,{options:c})=>{const l=o.getProvider("app").getImmediate(),p=o.getProvider("heartbeat"),g=o.getProvider("app-check-internal"),{apiKey:w,authDomain:C}=l.options;F(w&&!w.includes(":"),"invalid-api-key",{appName:l.name});const U={apiKey:w,authDomain:C,clientPlatform:u,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:D(u)},G=new Sh(l,p,g,U);return function or(u,o){const c=o?.persistence||[],l=(Array.isArray(c)?c:[c]).map(xt);o?.errorMap&&u._updateErrorMap(o.errorMap),u._initializeWithPersistence(l,o?.popupRedirectResolver)}(G,c),G},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,c,l)=>{o.getProvider("auth-internal").initialize()})),(0,X._registerComponent)(new Be.wA("auth-internal",o=>{const c=_e(o.getProvider("auth").getImmediate());return new Tl(c)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,X.registerVersion)(Fc,"0.23.2",function dd(u){switch(u){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(u)),(0,X.registerVersion)(Fc,"0.23.2","esm2017")}("Browser");function Uc(){return Uc=(0,v.Z)(function*(u,o,c){var l;const{BuildInfo:p}=ti();nt(o.sessionId,"AuthEvent did not contain a session ID");const g=yield function Sl(u){return ca.apply(this,arguments)}(o.sessionId),w={};return dt()?w.ibi=p.packageName:Oe()?w.apn=p.packageName:P(u,"operation-not-supported-in-this-environment"),p.displayName&&(w.appDisplayName=p.displayName),w.sessionId=g,$n(u,c,o.type,void 0,null!==(l=o.eventId)&&void 0!==l?l:void 0,w)}),Uc.apply(this,arguments)}function Vc(){return(Vc=(0,v.Z)(function*(u){const{BuildInfo:o}=ti(),c={};dt()?c.iosBundleId=o.packageName:Oe()?c.androidPackageName=o.packageName:P(u,"operation-not-supported-in-this-environment"),yield Jr(u,c)})).apply(this,arguments)}function aa(){return(aa=(0,v.Z)(function*(u,o,c){const{cordova:l}=ti();let p=()=>{};try{yield new Promise((g,w)=>{let C=null;function U(){var Q;g();const Ve=null===(Q=l.plugins.browsertab)||void 0===Q?void 0:Q.close;"function"==typeof Ve&&Ve(),"function"==typeof c?.close&&c.close()}function G(){C||(C=window.setTimeout(()=>{w(Re(u,"redirect-cancelled-by-user"))},2e3))}function Y(){"visible"===document?.visibilityState&&G()}o.addPassiveListener(U),document.addEventListener("resume",G,!1),Oe()&&document.addEventListener("visibilitychange",Y,!1),p=()=>{o.removePassiveListener(U),document.removeEventListener("resume",G,!1),document.removeEventListener("visibilitychange",Y,!1),C&&window.clearTimeout(C)}})}finally{p()}})).apply(this,arguments)}function ca(){return(ca=(0,v.Z)(function*(u){const o=function Td(u){if(nt(/[0-9a-zA-Z]+/.test(u),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(u);const o=new ArrayBuffer(u.length),c=new Uint8Array(o);for(let l=0;l<u.length;l++)c[l]=u.charCodeAt(l);return c}(u),c=yield crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(c)).map(p=>p.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}class gt extends sd{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(o=>{this.resolveInialized=o})}addPassiveListener(o){this.passiveListeners.add(o)}removePassiveListener(o){this.passiveListeners.delete(o)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(o){return this.resolveInialized(),this.passiveListeners.forEach(c=>c(o)),super.onEvent(o)}initialized(){var o=this;return(0,v.Z)(function*(){yield o.initPromise})()}}function zc(u){return Le.apply(this,arguments)}function Le(){return(Le=(0,v.Z)(function*(u){const o=yield Ue()._get(la(u));return o&&(yield Ue()._remove(la(u))),o})).apply(this,arguments)}function Tt(){const u=[];for(let c=0;c<20;c++){const l=Math.floor(62*Math.random());u.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(l))}return u.join("")}function Ue(){return xt(Di)}function la(u){return E("authEvent",u.config.apiKey,u.name)}function qs(u){if(!u?.includes("?"))return{};const[o,...c]=u.split("?");return(0,R.zd)(c.join("?"))}const Sd=class ct{constructor(){this._redirectPersistence=dn,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=ta,this._overrideRedirectResult=V}_initialize(o){var c=this;return(0,v.Z)(function*(){const l=o._key();let p=c.eventManagers.get(l);return p||(p=new gt(o),c.eventManagers.set(l,p),c.attachCallbackListeners(o,p)),p})()}_openPopup(o){P(o,"operation-not-supported-in-this-environment")}_openRedirect(o,c,l,p){var g=this;return(0,v.Z)(function*(){!function Ed(u){var o,c,l,p,g,w,C,U,G,Y;const Q=ti();F("function"==typeof(null===(o=Q?.universalLinks)||void 0===o?void 0:o.subscribe),u,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),F(typeof(null===(c=Q?.BuildInfo)||void 0===c?void 0:c.packageName)<"u",u,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),F("function"==typeof(null===(g=null===(p=null===(l=Q?.cordova)||void 0===l?void 0:l.plugins)||void 0===p?void 0:p.browsertab)||void 0===g?void 0:g.openUrl),u,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),F("function"==typeof(null===(U=null===(C=null===(w=Q?.cordova)||void 0===w?void 0:w.plugins)||void 0===C?void 0:C.browsertab)||void 0===U?void 0:U.isAvailable),u,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),F("function"==typeof(null===(Y=null===(G=Q?.cordova)||void 0===G?void 0:G.InAppBrowser)||void 0===Y?void 0:Y.open),u,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(o);const w=yield g._initialize(o);yield w.initialized(),w.resetRedirect(),function td(){Rn.clear()}(),yield g._originValidation(o);const C=function Cl(u,o,c=null){return{type:o,eventId:c,urlResponse:null,sessionId:Tt(),postBody:null,tenantId:u.tenantId,error:Re(u,"no-auth-event")}}(o,l,p);yield function _r(u,o){return Ue()._set(la(u),o)}(o,C);const U=yield function _d(u,o,c){return Uc.apply(this,arguments)}(o,C,c),G=yield function Id(u){const{cordova:o}=ti();return new Promise(c=>{o.plugins.browsertab.isAvailable(l=>{let p=null;l?o.plugins.browsertab.openUrl(u):p=o.InAppBrowser.open(u,function be(u=(0,R.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(u)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(u)}()?"_blank":"_system","location=yes"),c(p)})})}(U);return function wd(u,o,c){return aa.apply(this,arguments)}(o,w,G)})()}_isIframeWebStorageSupported(o,c){throw new Error("Method not implemented.")}_originValidation(o){const c=o._key();return this.originValidationPromises[c]||(this.originValidationPromises[c]=function vd(u){return Vc.apply(this,arguments)}(o)),this.originValidationPromises[c]}attachCallbackListeners(o,c){const{universalLinks:l,handleOpenURL:p,BuildInfo:g}=ti(),w=setTimeout((0,v.Z)(function*(){yield zc(o),c.onEvent(Kn())}),500),C=function(){var Y=(0,v.Z)(function*(Q){clearTimeout(w);const Ve=yield zc(o);let jt=null;Ve&&Q?.url&&(jt=function ua(u,o){var c,l;const p=function qt(u){const o=qs(u),c=o.link?decodeURIComponent(o.link):void 0,l=qs(c).link,p=o.deep_link_id?decodeURIComponent(o.deep_link_id):void 0;return qs(p).link||p||l||c||u}(o);if(p.includes("/__/auth/callback")){const g=qs(p),w=g.firebaseError?function Bi(u){try{return JSON.parse(u)}catch{return null}}(decodeURIComponent(g.firebaseError)):null,C=null===(l=null===(c=w?.code)||void 0===c?void 0:c.split("auth/"))||void 0===l?void 0:l[1],U=C?Re(C):null;return U?{type:u.type,eventId:u.eventId,tenantId:u.tenantId,error:U,urlResponse:null,sessionId:null,postBody:null}:{type:u.type,eventId:u.eventId,tenantId:u.tenantId,sessionId:u.sessionId,urlResponse:p,postBody:null}}return null}(Ve,Q.url)),c.onEvent(jt||Kn())});return function(Ve){return Y.apply(this,arguments)}}();typeof l<"u"&&"function"==typeof l.subscribe&&l.subscribe(null,C);const U=p,G=`${g.packageName.toLowerCase()}://`;ti().handleOpenURL=function(){var Y=(0,v.Z)(function*(Q){if(Q.toLowerCase().startsWith(G)&&C({url:Q}),"function"==typeof U)try{U(Q)}catch(Ve){console.error(Ve)}});return function(Q){return Y.apply(this,arguments)}}()}};function Kn(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Re("no-auth-event")}}function Wn(){var u;return(null===(u=self?.location)||void 0===u?void 0:u.protocol)||null}function Qn(u=(0,R.z$)()){return!("file:"!==Wn()&&"ionic:"!==Wn()&&"capacitor:"!==Wn()||!u.toLowerCase().match(/iphone|ipad|ipod|android/))}function zi(){try{const u=self.localStorage,o=Ze();if(u)return u.setItem(o,"1"),u.removeItem(o),!function Mn(u=(0,R.z$)()){return function fa(){return(0,R.w1)()&&11===document?.documentMode}()||function Ir(u=(0,R.z$)()){return/Edge\/\d+/.test(u)}(u)}()||(0,R.hl)()}catch{return Ln()&&(0,R.hl)()}return!1}function Ln(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function pa(){return(function Cd(){return"http:"===Wn()||"https:"===Wn()}()||(0,R.ru)()||Qn())&&!function vr(){return(0,R.b$)()||(0,R.UG)()}()&&zi()&&!Ln()}function ni(){return Qn()&&typeof document<"u"}function Zi(){return(Zi=(0,v.Z)(function*(){return!!ni()&&new Promise(u=>{const o=setTimeout(()=>{u(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(o),u(!0)})})})).apply(this,arguments)}const Ft={LOCAL:"local",NONE:"none",SESSION:"session"},Yn=F,Gc="persistence";function Gi(u){return ii.apply(this,arguments)}function ii(){return(ii=(0,v.Z)(function*(u){yield u._initializationPromise;const o=kl(),c=E(Gc,u.config.apiKey,u.name);o&&o.setItem(c,u._getPersistence())})).apply(this,arguments)}function kl(){var u;try{return(null===(u=function ri(){return typeof window<"u"?window:null}())||void 0===u?void 0:u.sessionStorage)||null}catch{return null}}const xd=F;class Jn{constructor(){this.browserResolver=xt(Gt),this.cordovaResolver=xt(Sd),this.underlyingResolver=null,this._redirectPersistence=dn,this._completeRedirectFn=ta,this._overrideRedirectResult=V}_initialize(o){var c=this;return(0,v.Z)(function*(){return yield c.selectUnderlyingResolver(),c.assertedUnderlyingResolver._initialize(o)})()}_openPopup(o,c,l,p){var g=this;return(0,v.Z)(function*(){return yield g.selectUnderlyingResolver(),g.assertedUnderlyingResolver._openPopup(o,c,l,p)})()}_openRedirect(o,c,l,p){var g=this;return(0,v.Z)(function*(){return yield g.selectUnderlyingResolver(),g.assertedUnderlyingResolver._openRedirect(o,c,l,p)})()}_isIframeWebStorageSupported(o,c){this.assertedUnderlyingResolver._isIframeWebStorageSupported(o,c)}_originValidation(o){return this.assertedUnderlyingResolver._originValidation(o)}get _shouldInitProactively(){return ni()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return xd(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var o=this;return(0,v.Z)(function*(){if(o.underlyingResolver)return;const c=yield function Zc(){return Zi.apply(this,arguments)}();o.underlyingResolver=c?o.cordovaResolver:o.browserResolver})()}}function qc(u){return u.unwrap()}function Ol(u){return Xn(u)}function Xn(u){const{_tokenResponse:o}=u instanceof R.ZR?u.customData:u;if(!o)return null;if(!(u instanceof R.ZR)&&"temporaryProof"in o&&"phoneNumber"in o)return tt.credentialFromResult(u);const c=o.providerId;if(!c||c===Ce.PASSWORD)return null;let l;switch(c){case Ce.GOOGLE:l=ot;break;case Ce.FACEBOOK:l=_o;break;case Ce.GITHUB:l=pt;break;case Ce.TWITTER:l=Vu;break;default:const{oauthIdToken:p,oauthAccessToken:g,oauthTokenSecret:w,pendingToken:C,nonce:U}=o;return g||w||p||C?C?c.startsWith("saml.")?hr._create(c,C):xn._fromParams({providerId:c,signInMethod:c,pendingToken:C,idToken:p,accessToken:g}):new lr(c).credential({idToken:p,accessToken:g,rawNonce:U}):null}return u instanceof R.ZR?l.credentialFromError(u):l.credentialFromResult(u)}function Ut(u,o){return o.catch(c=>{throw c instanceof R.ZR&&function qe(u,o){var c;const l=null===(c=o.customData)||void 0===c?void 0:c._tokenResponse;if("auth/multi-factor-auth-required"===o?.code)o.resolver=new Ad(u,function Qu(u,o){var c;const l=(0,R.m9)(u),p=o;return F(o.customData.operationType,l,"argument-error"),F(null===(c=p.customData._serverResponse)||void 0===c?void 0:c.mfaPendingCredential,l,"argument-error"),mc._fromError(l,p)}(u,o));else if(l){const p=Xn(o),g=o;p&&(g.credential=p,g.tenantId=l.tenantId||void 0,g.email=l.email||void 0,g.phoneNumber=l.phoneNumber||void 0)}}(u,c),c}).then(c=>{const p=c.user;return{operationType:c.operationType,credential:Ol(c),additionalUserInfo:Wu(c),user:Fn.getOrCreate(p)}})}function ma(u,o){return wr.apply(this,arguments)}function wr(){return(wr=(0,v.Z)(function*(u,o){const c=yield o;return{verificationId:c.verificationId,confirm:l=>Ut(u,c.confirm(l))}})).apply(this,arguments)}class Ad{constructor(o,c){this.resolver=c,this.auth=function bt(u){return u.wrapped()}(o)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(o){return Ut(qc(this.auth),this.resolver.resolveSignIn(o))}}class Fn{constructor(o){this._delegate=o,this.multiFactor=function Gh(u){const o=(0,R.m9)(u);return Bo.has(o)||Bo.set(o,Vo._fromUser(o)),Bo.get(o)}(o)}static getOrCreate(o){return Fn.USER_MAP.has(o)||Fn.USER_MAP.set(o,new Fn(o)),Fn.USER_MAP.get(o)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(o){return this._delegate.getIdTokenResult(o)}getIdToken(o){return this._delegate.getIdToken(o)}linkAndRetrieveDataWithCredential(o){return this.linkWithCredential(o)}linkWithCredential(o){var c=this;return(0,v.Z)(function*(){return Ut(c.auth,Br(c._delegate,o))})()}linkWithPhoneNumber(o,c){var l=this;return(0,v.Z)(function*(){return ma(l.auth,function Dn(u,o,c){return Qo.apply(this,arguments)}(l._delegate,o,c))})()}linkWithPopup(o){var c=this;return(0,v.Z)(function*(){return Ut(c.auth,function Xh(u,o,c){return Ui.apply(this,arguments)}(c._delegate,o,Jn))})()}linkWithRedirect(o){var c=this;return(0,v.Z)(function*(){return yield Gi(_e(c.auth)),L(c._delegate,o,Jn)})()}reauthenticateAndRetrieveDataWithCredential(o){return this.reauthenticateWithCredential(o)}reauthenticateWithCredential(o){var c=this;return(0,v.Z)(function*(){return Ut(c.auth,Zu(c._delegate,o))})()}reauthenticateWithPhoneNumber(o,c){return ma(this.auth,function bc(u,o,c){return fr.apply(this,arguments)}(this._delegate,o,c))}reauthenticateWithPopup(o){return Ut(this.auth,function Jh(u,o,c){return Xo.apply(this,arguments)}(this._delegate,o,Jn))}reauthenticateWithRedirect(o){var c=this;return(0,v.Z)(function*(){return yield Gi(_e(c.auth)),nd(c._delegate,o,Jn)})()}sendEmailVerification(o){return function Po(u,o){return Gr.apply(this,arguments)}(this._delegate,o)}unlink(o){var c=this;return(0,v.Z)(function*(){return yield function wo(u,o){return Is.apply(this,arguments)}(c._delegate,o),c})()}updateEmail(o){return function Ph(u,o){return kn((0,R.m9)(u),o,null)}(this._delegate,o)}updatePassword(o){return function jr(u,o){return kn((0,R.m9)(u),null,o)}(this._delegate,o)}updatePhoneNumber(o){return function jn(u,o){return Zt.apply(this,arguments)}(this._delegate,o)}updateProfile(o){return function Hu(u,o){return Mo.apply(this,arguments)}(this._delegate,o)}verifyBeforeUpdateEmail(o,c){return function qr(u,o,c){return Ss.apply(this,arguments)}(this._delegate,o,c)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Fn.USER_MAP=new WeakMap;const me=F;let Ne=(()=>{class u{constructor(c,l){if(this.app=c,l.isInitialized())return this._delegate=l.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:p}=c.options;me(p,"invalid-api-key",{appName:c.name}),me(p,"invalid-api-key",{appName:c.name});const g=typeof window<"u"?Jn:void 0;this._delegate=l.initialize({options:{persistence:jc(p,c.name),popupRedirectResolver:g}}),this._delegate._updateErrorMap(Nt),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Fn.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(c){this._delegate.languageCode=c}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(c){this._delegate.tenantId=c}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(c,l){!function Pu(u,o,c){const l=_e(u);F(l._canInitEmulator,l,"emulator-config-failed"),F(/^https?:\/\//.test(o),l,"invalid-emulator-scheme");const p=!!c?.disableWarnings,g=Ha(o),{host:w,port:C}=function Wa(u){const o=Ha(u),c=/(\/\/)?([^?#/]+)/.exec(u.substr(o.length));if(!c)return{host:"",port:null};const l=c[2].split("@").pop()||"",p=/^(\[[^\]]+\])(:|$)/.exec(l);if(p){const g=p[1];return{host:g,port:Qa(l.substr(g.length+1))}}{const[g,w]=l.split(":");return{host:g,port:Qa(w)}}}(o);l.config.emulator={url:`${g}//${w}${null===C?"":`:${C}`}/`},l.settings.appVerificationDisabledForTesting=!0,l.emulatorConfig=Object.freeze({host:w,port:C,protocol:g.replace(":",""),options:Object.freeze({disableWarnings:p})}),p||function At(){function u(){const o=document.createElement("p"),c=o.style;o.innerText="Running in emulator mode. Do not use with production credentials.",c.position="fixed",c.width="100%",c.backgroundColor="#ffffff",c.border=".1em solid #000000",c.color="#b50000",c.bottom="0px",c.left="0px",c.margin="0px",c.zIndex="10000",c.textAlign="center",o.classList.add("firebase-emulator-warning"),document.body.appendChild(o)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",u):u())}()}(this._delegate,c,l)}applyActionCode(c){return function ju(u,o){return Zr.apply(this,arguments)}(this._delegate,c)}checkActionCode(c){return Oo(this._delegate,c)}confirmPasswordReset(c,l){return function uc(u,o,c){return ko.apply(this,arguments)}(this._delegate,c,l)}createUserWithEmailAndPassword(c,l){var p=this;return(0,v.Z)(function*(){return Ut(p._delegate,function Ts(u,o,c){return Do.apply(this,arguments)}(p._delegate,c,l))})()}fetchProvidersForEmail(c){return this.fetchSignInMethodsForEmail(c)}fetchSignInMethodsForEmail(c){return function bs(u,o){return Ro.apply(this,arguments)}(this._delegate,c)}isSignInWithEmailLink(c){return function dc(u,o){const c=Ti.parseLink(o);return"EMAIL_SIGNIN"===c?.operation}(0,c)}getRedirectResult(){var c=this;return(0,v.Z)(function*(){me(pa(),c._delegate,"operation-not-supported-in-this-environment");const l=yield function rd(u,o){return kc.apply(this,arguments)}(c._delegate,Jn);return l?Ut(c._delegate,Promise.resolve(l)):{credential:null,user:null}})()}addFrameworkForLogging(c){!function Qe(u,o){_e(u)._logFramework(o)}(this._delegate,c)}onAuthStateChanged(c,l,p){const{next:g,error:w,complete:C}=si(c,l,p);return this._delegate.onAuthStateChanged(g,w,C)}onIdTokenChanged(c,l,p){const{next:g,error:w,complete:C}=si(c,l,p);return this._delegate.onIdTokenChanged(g,w,C)}sendSignInLinkToEmail(c,l){return function hc(u,o,c){return ki.apply(this,arguments)}(this._delegate,c,l)}sendPasswordResetEmail(c,l){return function xo(u,o,c){return Ao.apply(this,arguments)}(this._delegate,c,l||void 0)}setPersistence(c){var l=this;return(0,v.Z)(function*(){let p;switch(function xl(u,o){Yn(Object.values(Ft).includes(o),u,"invalid-persistence-type"),(0,R.b$)()?Yn(o!==Ft.SESSION,u,"unsupported-persistence-type"):(0,R.UG)()?Yn(o===Ft.NONE,u,"unsupported-persistence-type"):Ln()?Yn(o===Ft.NONE||o===Ft.LOCAL&&(0,R.hl)(),u,"unsupported-persistence-type"):Yn(o===Ft.NONE||zi(),u,"unsupported-persistence-type")}(l._delegate,c),c){case Ft.SESSION:p=dn;break;case Ft.LOCAL:p=(yield xt(Wr)._isAvailable())?Wr:Di;break;case Ft.NONE:p=bn;break;default:return P("argument-error",{appName:l._delegate.name})}return l._delegate.setPersistence(p)})()}signInAndRetrieveDataWithCredential(c){return this.signInWithCredential(c)}signInAnonymously(){return Ut(this._delegate,function vs(u){return Ur.apply(this,arguments)}(this._delegate))}signInWithCredential(c){return Ut(this._delegate,So(this._delegate,c))}signInWithCustomToken(c){return Ut(this._delegate,function qu(u,o){return zr.apply(this,arguments)}(this._delegate,c))}signInWithEmailAndPassword(c,l){return Ut(this._delegate,function Nh(u,o,c){return So((0,R.m9)(u),yo.credential(o,c))}(this._delegate,c,l))}signInWithEmailLink(c,l){return Ut(this._delegate,function $u(u,o,c){return No.apply(this,arguments)}(this._delegate,c,l))}signInWithPhoneNumber(c,l){return ma(this._delegate,function Qh(u,o,c){return Ps.apply(this,arguments)}(this._delegate,c,l))}signInWithPopup(c){var l=this;return(0,v.Z)(function*(){return me(pa(),l._delegate,"operation-not-supported-in-this-environment"),Ut(l._delegate,function Sc(u,o,c){return Cc.apply(this,arguments)}(l._delegate,c,Jn))})()}signInWithRedirect(c){var l=this;return(0,v.Z)(function*(){return me(pa(),l._delegate,"operation-not-supported-in-this-environment"),yield Gi(l._delegate),Ac(l._delegate,c,Jn)})()}updateCurrentUser(c){return this._delegate.updateCurrentUser(c)}verifyPasswordResetCode(c){return function lc(u,o){return Ai.apply(this,arguments)}(this._delegate,c)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return u.Persistence=Ft,u})();function si(u,o,c){let l=u;"function"!=typeof u&&({next:l,error:o,complete:c}=u);const p=l;return{next:w=>p(w&&Fn.getOrCreate(w)),error:o,complete:c}}function jc(u,o){const c=function Al(u,o){const c=kl();if(!c)return[];const l=E(Gc,u,o);switch(c.getItem(l)){case Ft.NONE:return[bn];case Ft.LOCAL:return[Wr,dn];case Ft.SESSION:return[dn];default:return[]}}(u,o);if(typeof self<"u"&&!c.includes(Wr)&&c.push(Wr),typeof window<"u")for(const l of[Di,dn])c.includes(l)||c.push(l);return c.includes(bn)||c.push(bn),c}class js{constructor(){this.providerId="phone",this._delegate=new tt(qc(ne.Z.auth()))}static credential(o,c){return tt.credential(o,c)}verifyPhoneNumber(o,c){return this._delegate.verifyPhoneNumber(o,c)}unwrap(){return this._delegate}}js.PHONE_SIGN_IN_METHOD=tt.PHONE_SIGN_IN_METHOD,js.PROVIDER_ID=tt.PROVIDER_ID;const Dl=F;class $c{constructor(o,c,l=ne.Z.app()){var p;Dl(null===(p=l.options)||void 0===p?void 0:p.apiKey,"invalid-api-key",{appName:l.name}),this._delegate=new gn(o,c,l.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function Rl(u){u.INTERNAL.registerComponent(new Be.wA("auth-compat",o=>{const c=o.getProvider("app-compat").getImmediate(),l=o.getProvider("auth");return new Ne(c,l)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:yo,FacebookAuthProvider:_o,GithubAuthProvider:pt,GoogleAuthProvider:ot,OAuthProvider:lr,SAMLAuthProvider:Io,PhoneAuthProvider:js,PhoneMultiFactorGenerator:El,RecaptchaVerifier:$c,TwitterAuthProvider:Vu,Auth:Ne,AuthCredential:yi,Error:R.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),u.registerVersion("@firebase/auth-compat","0.4.2")}(ne.Z)},4859:(ts,Ot,$)=>{$.d(Ot,{H0:()=>Dt,wA:()=>R});var v=$(5861),ne=$(2090);class R{constructor(z,f,re){this.name=z,this.instanceFactory=f,this.type=re,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(z){return this.instantiationMode=z,this}setMultipleInstances(z){return this.multipleInstances=z,this}setServiceProps(z){return this.serviceProps=z,this}setInstanceCreatedCallback(z){return this.onInstanceCreated=z,this}}const X="[DEFAULT]";class ht{constructor(z,f){this.name=z,this.container=f,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(z){const f=this.normalizeInstanceIdentifier(z);if(!this.instancesDeferred.has(f)){const re=new ne.BH;if(this.instancesDeferred.set(f,re),this.isInitialized(f)||this.shouldAutoInitialize())try{const ae=this.getOrInitializeService({instanceIdentifier:f});ae&&re.resolve(ae)}catch{}}return this.instancesDeferred.get(f).promise}getImmediate(z){var f;const re=this.normalizeInstanceIdentifier(z?.identifier),ae=null!==(f=z?.optional)&&void 0!==f&&f;if(!this.isInitialized(re)&&!this.shouldAutoInitialize()){if(ae)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:re})}catch(Me){if(ae)return null;throw Me}}getComponent(){return this.component}setComponent(z){if(z.name!==this.name)throw Error(`Mismatching Component ${z.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=z,this.shouldAutoInitialize()){if(function Be(Ce){return"EAGER"===Ce.instantiationMode}(z))try{this.getOrInitializeService({instanceIdentifier:X})}catch{}for(const[f,re]of this.instancesDeferred.entries()){const ae=this.normalizeInstanceIdentifier(f);try{const Me=this.getOrInitializeService({instanceIdentifier:ae});re.resolve(Me)}catch{}}}}clearInstance(z=X){this.instancesDeferred.delete(z),this.instancesOptions.delete(z),this.instances.delete(z)}delete(){var z=this;return(0,v.Z)(function*(){const f=Array.from(z.instances.values());yield Promise.all([...f.filter(re=>"INTERNAL"in re).map(re=>re.INTERNAL.delete()),...f.filter(re=>"_delete"in re).map(re=>re._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(z=X){return this.instances.has(z)}getOptions(z=X){return this.instancesOptions.get(z)||{}}initialize(z={}){const{options:f={}}=z,re=this.normalizeInstanceIdentifier(z.instanceIdentifier);if(this.isInitialized(re))throw Error(`${this.name}(${re}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const ae=this.getOrInitializeService({instanceIdentifier:re,options:f});for(const[Me,Nt]of this.instancesDeferred.entries())re===this.normalizeInstanceIdentifier(Me)&&Nt.resolve(ae);return ae}onInit(z,f){var re;const ae=this.normalizeInstanceIdentifier(f),Me=null!==(re=this.onInitCallbacks.get(ae))&&void 0!==re?re:new Set;Me.add(z),this.onInitCallbacks.set(ae,Me);const Nt=this.instances.get(ae);return Nt&&z(Nt,ae),()=>{Me.delete(z)}}invokeOnInitCallbacks(z,f){const re=this.onInitCallbacks.get(f);if(re)for(const ae of re)try{ae(z,f)}catch{}}getOrInitializeService({instanceIdentifier:z,options:f={}}){let re=this.instances.get(z);if(!re&&this.component&&(re=this.component.instanceFactory(this.container,{instanceIdentifier:(Ce=z,Ce===X?void 0:Ce),options:f}),this.instances.set(z,re),this.instancesOptions.set(z,f),this.invokeOnInitCallbacks(re,z),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,z,re)}catch{}var Ce;return re||null}normalizeInstanceIdentifier(z=X){return this.component?this.component.multipleInstances?z:X:z}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Dt{constructor(z){this.name=z,this.providers=new Map}addComponent(z){const f=this.getProvider(z.name);if(f.isComponentSet())throw new Error(`Component ${z.name} has already been registered with ${this.name}`);f.setComponent(z)}addOrOverwriteComponent(z){this.getProvider(z.name).isComponentSet()&&this.providers.delete(z.name),this.addComponent(z)}getProvider(z){if(this.providers.has(z))return this.providers.get(z);const f=new ht(z,this);return this.providers.set(z,f),f}getProviders(){return Array.from(this.providers.values())}}},1877:(ts,Ot,$)=>{$.d(Ot,{Am:()=>Ce,Ub:()=>Dt,Yd:()=>Be,in:()=>ne});const v=[];var ne=(()=>((ne=ne||{})[ne.DEBUG=0]="DEBUG",ne[ne.VERBOSE=1]="VERBOSE",ne[ne.INFO=2]="INFO",ne[ne.WARN=3]="WARN",ne[ne.ERROR=4]="ERROR",ne[ne.SILENT=5]="SILENT",ne))();const R={debug:ne.DEBUG,verbose:ne.VERBOSE,info:ne.INFO,warn:ne.WARN,error:ne.ERROR,silent:ne.SILENT},X=ne.INFO,ht={[ne.DEBUG]:"log",[ne.VERBOSE]:"log",[ne.INFO]:"info",[ne.WARN]:"warn",[ne.ERROR]:"error"},Je=(z,f,...re)=>{if(f<z.logLevel)return;const ae=(new Date).toISOString(),Me=ht[f];if(!Me)throw new Error(`Attempted to log a message with an invalid logType (value: ${f})`);console[Me](`[${ae}]  ${z.name}:`,...re)};class Be{constructor(f){this.name=f,this._logLevel=X,this._logHandler=Je,this._userLogHandler=null,v.push(this)}get logLevel(){return this._logLevel}set logLevel(f){if(!(f in ne))throw new TypeError(`Invalid value "${f}" assigned to \`logLevel\``);this._logLevel=f}setLogLevel(f){this._logLevel="string"==typeof f?R[f]:f}get logHandler(){return this._logHandler}set logHandler(f){if("function"!=typeof f)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=f}get userLogHandler(){return this._userLogHandler}set userLogHandler(f){this._userLogHandler=f}debug(...f){this._userLogHandler&&this._userLogHandler(this,ne.DEBUG,...f),this._logHandler(this,ne.DEBUG,...f)}log(...f){this._userLogHandler&&this._userLogHandler(this,ne.VERBOSE,...f),this._logHandler(this,ne.VERBOSE,...f)}info(...f){this._userLogHandler&&this._userLogHandler(this,ne.INFO,...f),this._logHandler(this,ne.INFO,...f)}warn(...f){this._userLogHandler&&this._userLogHandler(this,ne.WARN,...f),this._logHandler(this,ne.WARN,...f)}error(...f){this._userLogHandler&&this._userLogHandler(this,ne.ERROR,...f),this._logHandler(this,ne.ERROR,...f)}}function Dt(z){v.forEach(f=>{f.setLogLevel(z)})}function Ce(z,f){for(const re of v){let ae=null;f&&f.level&&(ae=R[f.level]),re.userLogHandler=null===z?null:(Me,Nt,...Ge)=>{const ye=Ge.map(Ee=>{if(null==Ee)return null;if("string"==typeof Ee)return Ee;if("number"==typeof Ee||"boolean"==typeof Ee)return Ee.toString();if(Ee instanceof Error)return Ee.message;try{return JSON.stringify(Ee)}catch{return null}}).filter(Ee=>Ee).join(" ");Nt>=(ae??Me.logLevel)&&z({level:ne[Nt].toLowerCase(),message:ye,args:Ge,type:Me.name})}}}},5861:(ts,Ot,$)=>{function v(R,X,ht,Je,Be,Dt,Ce){try{var z=R[Dt](Ce),f=z.value}catch(re){return void ht(re)}z.done?X(f):Promise.resolve(f).then(Je,Be)}function ne(R){return function(){var X=this,ht=arguments;return new Promise(function(Je,Be){var Dt=R.apply(X,ht);function Ce(f){v(Dt,Je,Be,Ce,z,"next",f)}function z(f){v(Dt,Je,Be,Ce,z,"throw",f)}Ce(void 0)})}}$.d(Ot,{Z:()=>ne})}}]);