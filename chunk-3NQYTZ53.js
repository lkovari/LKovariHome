import{a as kp}from"./chunk-4WOZYAGK.js";import{c as bp,d as Cp,e as Dn}from"./chunk-A2K5OBDJ.js";import{a as Ap,b as gc,c as Sp,d as vs,e as _c,f as Zo,g as xp,h as Pp,i as yc,j as Ee,k as mi,l as Kt,m as ea,n as ws,o as Rp,p as Dp,q as kn,r as pt}from"./chunk-MDXMAHBI.js";import{$ as Tp,R as pp,S as fp,T as gp,U as vp,V as wp,W as rt,X as hi,Y as Xi,_ as _s,aa as Ip,ba as ys,ca as di,da as Ep,ea as se,g as Yo,ga as xt,ha as Jo,i as Xo,ia as Ji,n as mp}from"./chunk-DE4ZGVMT.js";import{c as ui,d as Rn,f as Gt,g as gs,h as un,i as pc,j as _p,k as fc,l as yp}from"./chunk-S35HUXPS.js";import{$a as vt,$b as Pn,Ab as li,B as Qm,C as Lo,Cb as $o,D as zo,Ea as _e,Eb as sp,F as uc,Fa as Ue,Fb as op,Ga as dc,H as Bo,Ha as Ct,Hb as ap,I as si,Ia as Sn,Ib as ms,J as hc,Ja as ne,Jb as lp,Kb as cp,L as Wm,Lb as mc,Mb as ps,Na as re,O as lt,Oa as M,P as Be,Pb as De,Q as He,Qb as ln,R as Y,S as Qi,Sa as xe,T as Ym,Ta as Yi,Ua as oi,Va as At,W as Xm,Wa as St,Wb as jt,X as le,Xa as L,Y as ce,Ya as q,Yb as cn,Z as It,Za as X,Zb as up,_ as Et,_a as yt,_b as Ho,ab as on,ac as Qo,b as Ki,ba as Jm,bb as qe,c as $i,ca as ct,cc as hp,da as ut,db as ep,eb as Pe,ec as mt,f as Fo,fb as tp,fc as ci,g as Km,ga as Wi,gb as H,gc as Wo,hb as np,i as ri,ib as Uo,j as Hi,ja as bt,jb as ip,k as Cn,kb as ai,l as An,lb as an,mb as ht,n as $e,nb as dt,nc as dp,qb as ds,rb as ye,s as $m,sa as Zm,sb as xn,sc as fs,t as us,tb as qt,ua as N,ub as qo,va as de,vb as jo,wb as Go,xb as rp,ya as hs,yb as Ko,z as Hm,zb as Ot}from"./chunk-7W7GFG2S.js";import{a as Vt,b as lc,e as cc,f as P}from"./chunk-KT3CPUTC.js";var pe=(()=>{class i{static{this.OPERATOR_REV="\xAB"}static{this.OPERATOR_ADD="+"}static{this.OPERATOR_SUB="-"}static{this.OPERATOR_MUL="\xD7"}static{this.OPERATOR_DIV="/"}}return i})();var Zi=class{constructor(e,t,n,r){this.id=e,this.selected=t,this.disabled=n,this.value=r}};var er=class{constructor(){this.operands=[]}};var Nt=class{static evaluate(e,t,n){let r=Number.MIN_VALUE;switch(n){case pe.OPERATOR_ADD:{r=e+t;break}case pe.OPERATOR_SUB:{r=e>=t?e-t:Number.MIN_VALUE;break}case pe.OPERATOR_DIV:{r=e%t==0?e/t:Number.MIN_VALUE;break}case pe.OPERATOR_MUL:{r=e*t;break}}return r}static cloneGameParameters(e){let t=new er;return t.result=e.result,e.operands.forEach(n=>{let r=new Zi(n.id,!1,!1,-1);Object.assign(r,n),t.operands.push(r)}),t}};var ta=class{constructor(){this.numbers=[]}generateNumber(e,t){let n=Math.floor(e+Math.random()*(t-e+1));for(;this.numbers.indexOf(n)>=0;)n=Math.floor(e+Math.random()*(t-e+1));this.numbers.push(n)}getGeneratedNumbers(){return this.numbers}clearGeneratedNumbers(){this.numbers=[]}};var na=class{generateNumber(e,t){return Math.floor(e+Math.random()*(t-e+1))}choiceRandomOperation(){let e=this.generateNumber(0,4),t=pe.OPERATOR_ADD;switch(e){case 0:{t=pe.OPERATOR_ADD;break}case 1:{t=pe.OPERATOR_SUB;break}case 2:{t=pe.OPERATOR_MUL;break}case 3:{t=pe.OPERATOR_DIV;break}}return t}checkExecuteDivision(e,t){return e%t===0}checkExecuteSubstraction(e,t){return e>t}removeOperandByIndex(e,t){let n=t;return e<t&&(n=t-1),this.operands.splice(e,1),n}calculateResult(e){let t=this.operands.length,n=0,r=0,s=this.generateNumber(3,5),o=Number.MIN_VALUE;for(;r<s&&e.length>1;){let l=this.choiceRandomOperation(),c=this.generateNumber(0,t-1);for(o===Number.MIN_VALUE&&(o=this.generateNumber(0,t-1));o===c;)c=this.generateNumber(0,t-1);switch(l){case pe.OPERATOR_ADD:{e[o]=Nt.evaluate(e[o],e[c],l),o=this.removeOperandByIndex(c,o),--t,++r;break}case pe.OPERATOR_SUB:{if(this.checkExecuteSubstraction(e[o],e[c]))e[o]=Nt.evaluate(e[o],e[c],l),o=this.removeOperandByIndex(c,o),--t,++r;else continue;break}case pe.OPERATOR_MUL:{e[o]=Nt.evaluate(e[o],e[c],l),o=this.removeOperandByIndex(c,o),--t,++r;break}case pe.OPERATOR_DIV:{if(this.checkExecuteDivision(e[o],e[c]))e[o]=Nt.evaluate(e[o],e[c],l),o=this.removeOperandByIndex(c,o),--t,++r;else continue;break}}}return n=e[o],n}generateGameParameter(e){let t=new ta;switch(e){case 0:{t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(5,10),t.generateNumber(10,25);break}case 1:{t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(5,10),t.generateNumber(10,15),t.generateNumber(10,25);break}case 2:{t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(5,10),t.generateNumber(5,15),t.generateNumber(10,20),t.generateNumber(10,25);break}case 3:{t.generateNumber(1,5),t.generateNumber(5,10),t.generateNumber(5,15),t.generateNumber(10,15),t.generateNumber(10,20),t.generateNumber(10,25);break}case 4:{t.generateNumber(1,10),t.generateNumber(5,10),t.generateNumber(5,15),t.generateNumber(10,15),t.generateNumber(10,25),t.generateNumber(10,25);break}}let n=t.getGeneratedNumbers();n=n.sort((m,f)=>m-f);let r=new Array(n[0],n[1],n[2],n[3],n[4],n[5]);this.operands=new Array(n[0],n[1],n[2],n[3],n[4],n[5]),t.clearGeneratedNumbers();let s=0,o=0;switch(e){case 0:{s=30,o=100;break}case 1:{s=50,o=150;break}case 2:{s=100,o=200;break}case 3:{s=300,o=400;break}case 4:{s=400,o=550;break}}let l=this.calculateResult(this.operands);for(;s>l||l>o;)this.operands=new Array(n[0],n[1],n[2],n[3],n[4],n[5]),l=this.calculateResult(this.operands);let c=new er;c.result=l;let h=0;return r.forEach(m=>{let f=new Zi(h,!1,!1,m);c.operands.push(f),++h}),c}generateStageNumbers(){let e=new Array;for(let t=0;t<5;t++){let n=this.generateGameParameter(t);n.stageIndex=t,e.push(n)}return e=e.sort((t,n)=>t.result-n.result),e}};var Ts=class{cookieData2Text(){return JSON.stringify(this)}text2CookieData(e){return JSON.parse(e)}};var ia=(()=>{class i{constructor(t,n){this.document=t,this.platformId=n,this.documentIsAccessible=ci(this.platformId)}static getCookieRegExp(t){let n=t.replace(/([\[\]{}()|=;+?,.*^$])/gi,"\\$1");return new RegExp("(?:^"+n+"|;\\s*"+n+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(t){try{return decodeURIComponent(t)}catch{return t}}check(t){return this.documentIsAccessible?(t=encodeURIComponent(t),i.getCookieRegExp(t).test(this.document.cookie)):!1}get(t){if(this.documentIsAccessible&&this.check(t)){t=encodeURIComponent(t);let r=i.getCookieRegExp(t).exec(this.document.cookie);return r[1]?i.safeDecodeURIComponent(r[1]):""}else return""}getAll(){if(!this.documentIsAccessible)return{};let t={},n=this.document;return n.cookie&&n.cookie!==""&&n.cookie.split(";").forEach(r=>{let[s,o]=r.split("=");t[i.safeDecodeURIComponent(s.replace(/^ /,""))]=i.safeDecodeURIComponent(o)}),t}set(t,n,r,s,o,l,c,h){if(!this.documentIsAccessible)return;if(typeof r=="number"||r instanceof Date||s||o||l||c){let _={expires:r,path:s,domain:o,secure:l,sameSite:c||"Lax",partitioned:h};this.set(t,n,_);return}let m=encodeURIComponent(t)+"="+encodeURIComponent(n)+";",f=r||{};if(f.expires)if(typeof f.expires=="number"){let _=new Date(new Date().getTime()+f.expires*1e3*60*60*24);m+="expires="+_.toUTCString()+";"}else m+="expires="+f.expires.toUTCString()+";";f.path&&(m+="path="+f.path+";"),f.domain&&(m+="domain="+f.domain+";"),f.secure===!1&&f.sameSite==="None"&&(f.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${t} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),f.secure&&(m+="secure;"),f.sameSite||(f.sameSite="Lax"),m+="sameSite="+f.sameSite+";",f.partitioned&&(m+="Partitioned;"),this.document.cookie=m}delete(t,n,r,s,o="Lax"){if(!this.documentIsAccessible)return;let l=new Date("Thu, 01 Jan 1970 00:00:01 GMT");this.set(t,"",{expires:l,path:n,domain:r,secure:s,sameSite:o})}deleteAll(t,n,r,s="Lax"){if(!this.documentIsAccessible)return;let o=this.getAll();for(let l in o)o.hasOwnProperty(l)&&this.delete(l,t,n,r,s)}static{this.\u0275fac=function(n){return new(n||i)(Y(jt),Y(bt))}}static{this.\u0275prov=lt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var ra=class{constructor(){this.stages=[]}};var sa=class{constructor(){this.operands=[]}};var Is=class{};var Vp=new He("WindowToken",typeof window<"u"&&window.document?{providedIn:"root",factory:()=>window}:{providedIn:"root",factory:()=>{}});var Op=(()=>{class i{constructor(t,n,r){this.ngZone=t,this.document=n,this.window=r,this.copySubject=new $i,this.copyResponse$=this.copySubject.asObservable(),this.config={}}configure(t){this.config=t}copy(t){if(!this.isSupported||!t)return this.pushCopyResponse({isSuccess:!1,content:t});let n=this.copyFromContent(t);return n?this.pushCopyResponse({content:t,isSuccess:n}):this.pushCopyResponse({isSuccess:!1,content:t})}get isSupported(){return!!this.document.queryCommandSupported&&!!this.document.queryCommandSupported("copy")&&!!this.window}isTargetValid(t){if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement){if(t.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');return!0}throw new Error("Target should be input or textarea")}copyFromInputElement(t,n=!0){try{this.selectTarget(t);let r=this.copyText();return this.clearSelection(n?t:void 0,this.window),r&&this.isCopySuccessInIE11()}catch{return!1}}isCopySuccessInIE11(){let t=this.window.clipboardData;return!(t&&t.getData&&!t.getData("Text"))}copyFromContent(t,n=this.document.body){if(this.tempTextArea&&!n.contains(this.tempTextArea)&&this.destroy(this.tempTextArea.parentElement||void 0),!this.tempTextArea){this.tempTextArea=this.createTempTextArea(this.document,this.window);try{n.appendChild(this.tempTextArea)}catch{throw new Error("Container should be a Dom element")}}this.tempTextArea.value=t;let r=this.copyFromInputElement(this.tempTextArea,!1);return this.config.cleanUpAfterCopy&&this.destroy(this.tempTextArea.parentElement||void 0),r}destroy(t=this.document.body){this.tempTextArea&&(t.removeChild(this.tempTextArea),this.tempTextArea=void 0)}selectTarget(t){return t.select(),t.setSelectionRange(0,t.value.length),t.value.length}copyText(){return this.document.execCommand("copy")}clearSelection(t,n){t&&t.focus(),n.getSelection()?.removeAllRanges()}createTempTextArea(t,n){let r=t.documentElement.getAttribute("dir")==="rtl",s;s=t.createElement("textarea"),s.style.fontSize="12pt",s.style.border="0",s.style.padding="0",s.style.margin="0",s.style.position="absolute",s.style[r?"right":"left"]="-9999px";let o=n.pageYOffset||t.documentElement.scrollTop;return s.style.top=o+"px",s.setAttribute("readonly",""),s}pushCopyResponse(t){this.copySubject.observers.length>0&&this.ngZone.run(()=>{this.copySubject.next(t)})}pushCopyReponse(t){this.pushCopyResponse(t)}}return i.\u0275fac=function(t){return new(t||i)(Y(ut),Y(jt),Y(Vp,8))},i.\u0275prov=lt({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Np=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=Ue({type:i}),i.\u0275inj=Be({imports:[mt]}),i})();var My="firebase",Fy="10.14.1";kn(My,Fy,"app");var tr=new lp("ANGULARFIRE2_VERSION");var Ly=(i,e)=>{let t=e?[e]:Dp(),n=[];return t.forEach(r=>{r.container.getProvider(i).instances.forEach(o=>{n.includes(o)||n.push(o)})}),n},pi=class{constructor(){return Ly(zy)}},zy="app-check";function vc(){}var oa=class{zone;delegate;constructor(e,t=Km){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){let r=this.zone,s=function(o){r.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,n)}},wc=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",vc,{},vc,vc)),t.pipe(Wm({next:n,complete:n,error:n})).subscribe(e).add(n)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},aa=(()=>{class i{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new oa(Zone.current)),this.insideAngular=t.run(()=>new oa(Zone.current,Fo)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(n){return new(n||i)(Y(ut))};static \u0275prov=lt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function By(){let i=globalThis.\u0275AngularFireScheduler;if(!i)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return i}function ft(i){return Uy(By())(i)}function Uy(i){return function(t){return t=t.lift(new wc(i.ngZone)),t.pipe(Hi(i.outsideAngular),ri(i.insideAngular))}}var Gy=new Map,Ky={activated:!1,tokenObservers:[]},$y={initialized:!1,enabled:!1};function Mt(i){return Gy.get(i)||Object.assign({},Ky)}function Up(){return $y}var Hy="https://content-firebaseappcheck.googleapis.com/v1";var Qy="exchangeDebugToken",Fp={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},mE=24*60*60*1e3;var Ic=class{constructor(e,t,n,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return P(this,null,function*(){this.stop();try{this.pending=new gc,this.pending.promise.catch(t=>{}),yield Wy(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new gc,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function Wy(i){return new Promise(e=>{setTimeout(e,i)})}var Yy={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Vn=new Pp("appCheck","AppCheck",Yy);function qp(i){if(!Mt(i).activated)throw Vn.create("use-before-activation",{appName:i.name})}function jp(n,r){return P(this,arguments,function*({url:i,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let b=yield o.getHeartbeatsHeader();b&&(s["X-Firebase-Client"]=b)}let l={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(i,l)}catch(b){throw Vn.create("fetch-network-error",{originalErrorMessage:b?.message})}if(c.status!==200)throw Vn.create("fetch-status-error",{httpStatus:c.status});let h;try{h=yield c.json()}catch(b){throw Vn.create("fetch-parse-error",{originalErrorMessage:b?.message})}let m=h.ttl.match(/^([\d.]+)(s)$/);if(!m||!m[2]||isNaN(Number(m[1])))throw Vn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${h.ttl}`});let f=Number(m[1])*1e3,_=Date.now();return{token:h.token,expireTimeMillis:_+f,issuedAtTimeMillis:_}})}function Gp(i,e){let{projectId:t,appId:n,apiKey:r}=i.options;return{url:`${Hy}/projects/${t}/apps/${n}:${Qy}?key=${r}`,body:{debug_token:e}}}var Xy="firebase-app-check-database",Jy=1,Ec="firebase-app-check-store";var la=null;function Zy(){return la||(la=new Promise((i,e)=>{try{let t=indexedDB.open(Xy,Jy);t.onsuccess=n=>{i(n.target.result)},t.onerror=n=>{var r;e(Vn.create("storage-open",{originalErrorMessage:(r=n.target.error)===null||r===void 0?void 0:r.message}))},t.onupgradeneeded=n=>{let r=n.target.result;switch(n.oldVersion){case 0:r.createObjectStore(Ec,{keyPath:"compositeKey"})}}}catch(t){e(Vn.create("storage-open",{originalErrorMessage:t?.message}))}}),la)}function e1(i,e){return t1(n1(i),e)}function t1(i,e){return P(this,null,function*(){let n=(yield Zy()).transaction(Ec,"readwrite"),s=n.objectStore(Ec).put({compositeKey:i,value:e});return new Promise((o,l)=>{s.onsuccess=c=>{o()},n.onerror=c=>{var h;l(Vn.create("storage-set",{originalErrorMessage:(h=c.target.error)===null||h===void 0?void 0:h.message}))}})})}function n1(i){return`${i.options.appId}-${i.name}`}var bc=new ea("@firebase/app-check");function Tc(i,e){return Zo()?e1(i,e).catch(t=>{bc.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Kp(){return Up().enabled}function $p(){return P(this,null,function*(){let i=Up();if(i.enabled&&i.token)return i.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var i1={error:"UNKNOWN_ERROR"};function r1(i){return Ap.encodeString(JSON.stringify(i),!1)}function Cc(i,e=!1){return P(this,null,function*(){let t=i.app;qp(t);let n=Mt(t),r=n.token,s;if(r&&!Es(r)&&(n.token=void 0,r=void 0),!r){let c=yield n.cachedTokenPromise;c&&(Es(c)?r=c:yield Tc(t,void 0))}if(!e&&r&&Es(r))return{token:r.token};let o=!1;if(Kp()){n.exchangeTokenPromise||(n.exchangeTokenPromise=jp(Gp(t,yield $p()),i.heartbeatServiceProvider).finally(()=>{n.exchangeTokenPromise=void 0}),o=!0);let c=yield n.exchangeTokenPromise;return yield Tc(t,c),n.token=c,{token:c.token}}try{n.exchangeTokenPromise||(n.exchangeTokenPromise=n.provider.getToken().finally(()=>{n.exchangeTokenPromise=void 0}),o=!0),r=yield Mt(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?bc.warn(c.message):bc.error(c),s=c}let l;return r?s?Es(r)?l={token:r.token,internalError:s}:l=zp(s):(l={token:r.token},n.token=r,yield Tc(t,r)):l=zp(s),o&&l1(t,l),l})}function s1(i){return P(this,null,function*(){let e=i.app;qp(e);let{provider:t}=Mt(e);if(Kp()){let n=yield $p(),{token:r}=yield jp(Gp(e,n),i.heartbeatServiceProvider);return{token:r}}else{let{token:n}=yield t.getToken();return{token:n}}})}function o1(i,e,t,n){let{app:r}=i,s=Mt(r),o={next:t,error:n,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Es(s.token)){let l=s.token;Promise.resolve().then(()=>{t({token:l.token}),Lp(i)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Lp(i))}function Hp(i,e){let t=Mt(i),n=t.tokenObservers.filter(r=>r.next!==e);n.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=n}function Lp(i){let{app:e}=i,t=Mt(e),n=t.tokenRefresher;n||(n=a1(i),t.tokenRefresher=n),!n.isRunning()&&t.isTokenAutoRefreshEnabled&&n.start()}function a1(i){let{app:e}=i;return new Ic(()=>P(this,null,function*(){let t=Mt(e),n;if(t.token?n=yield Cc(i,!0):n=yield Cc(i),n.error)throw n.error;if(n.internalError)throw n.internalError}),()=>!0,()=>{let t=Mt(e);if(t.token){let n=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,r=t.token.expireTimeMillis-5*60*1e3;return n=Math.min(n,r),Math.max(0,n-Date.now())}else return 0},Fp.RETRIAL_MIN_WAIT,Fp.RETRIAL_MAX_WAIT)}function l1(i,e){let t=Mt(i).tokenObservers;for(let n of t)try{n.type==="EXTERNAL"&&e.error!=null?n.error(e.error):n.next(e)}catch{}}function Es(i){return i.expireTimeMillis-Date.now()>0}function zp(i){return{token:r1(i1),error:i}}var Ac=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Mt(this.app);for(let t of e)Hp(this.app,t.next);return Promise.resolve()}};function c1(i,e){return new Ac(i,e)}function u1(i){return{getToken:e=>Cc(i,e),getLimitedUseToken:()=>s1(i),addTokenListener:e=>o1(i,"INTERNAL",e),removeTokenListener:e=>Hp(i.app,e)}}var h1="@firebase/app-check",d1="0.8.8";var m1="app-check",Bp="app-check-internal";function p1(){ws(new mi(m1,i=>{let e=i.getProvider("app").getImmediate(),t=i.getProvider("heartbeat");return c1(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((i,e,t)=>{i.getProvider(Bp).initialize()})),ws(new mi(Bp,i=>{let e=i.getProvider("app-check").getImmediate();return u1(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),kn(h1,d1)}p1();var f1=["localhost","0.0.0.0","127.0.0.1"],CE=typeof window<"u"&&f1.includes(window.location.hostname);var g1="firebase",_1="10.14.1";pt.registerVersion(g1,_1,"app-compat");var y1=["ngOnDestroy"],Yp=(i,e,t,n={})=>new Proxy(i,{get:(r,s)=>t.runOutsideAngular(()=>{if(i[s])return n?.spy?.get&&n.spy.get(s,i[s]),i[s];if(y1.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(l=>{let c=l?.[s];return typeof c=="function"?c.bind(l):c?.then?c.then(h=>t.run(()=>h)):t.run(()=>c)});return new Proxy(()=>{},{get:(l,c)=>o[c],apply:(l,c,h)=>o.then(m=>{let f=m?.(...h);return n?.spy?.apply&&n.spy.apply(s,h,f),f})})})});var ca=class{constructor(e){return e}},nr=new He("angularfire2.app.options"),ir=new He("angularfire2.app.name");function bs(i,e,t){let n=typeof t=="string"&&t||"[DEFAULT]",r=typeof t=="object"&&t||{};r.name=r.name||n;let o=pt.apps.filter(l=>l&&l.name===r.name)[0]||e.runOutsideAngular(()=>pt.initializeApp(i,r));try{if(JSON.stringify(i)!==JSON.stringify(o.options)){let l=!!module.hot;v1("error",`${o.name} Firebase App already initialized with different options${l?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new ca(o)}var v1=(i,...e)=>{mc()&&typeof console<"u"&&console[i](...e)},w1={provide:ca,useFactory:bs,deps:[nr,ut,[new Ym,ir]]},Xp=(()=>{class i{static initializeApp(t,n){return{ngModule:i,providers:[{provide:nr,useValue:t},{provide:ir,useValue:n}]}}constructor(t){pt.registerVersion("angularfire",tr.full,"core"),pt.registerVersion("angularfire",tr.full,"app-compat"),pt.registerVersion("angular",cp.full,t.toString())}static \u0275fac=function(n){return new(n||i)(Y(bt))};static \u0275mod=Ue({type:i});static \u0275inj=Be({providers:[w1]})}return i})();function ua(i,e,t,n,r){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(l=>l[0]===i)||[];if(s)return T1(r,o)||(Wp("error",`${e} was already initialized on the ${t} Firebase App with different settings.${I1?" You may need to reload as Firebase is not HMR aware.":""}`),Wp("warn",{is:r,was:o})),s;{let l=n();return globalThis.\u0275AngularfireInstanceCache.push([i,l,r]),l}}function T1(i,e){try{return i.toString()===e.toString()}catch{return i===e}}var I1=typeof module<"u"&&!!module.hot,Wp=(i,...e)=>{mc()&&typeof console<"u"&&console[i](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Sc=new He("angularfire2.auth.use-emulator"),xc=new He("angularfire2.auth.settings"),Pc=new He("angularfire2.auth.tenant-id"),Rc=new He("angularfire2.auth.langugage-code"),Dc=new He("angularfire2.auth.use-device-language"),kc=new He("angularfire.auth.persistence"),Vc=(i,e,t,n,r,s,o,l)=>ua(`${i.name}.auth`,"AngularFireAuth",i.name,()=>{let c=e.runOutsideAngular(()=>i.auth());if(t&&c.useEmulator(...t),n&&(c.tenantId=n),c.languageCode=r,s&&c.useDeviceLanguage(),o)for(let[h,m]of Object.entries(o))c.settings[h]=m;return l&&c.setPersistence(l),c},[t,n,r,s,o,l]),Jp=(()=>{class i{authState;idToken;user;idTokenResult;credential;constructor(t,n,r,s,o,l,c,h,m,f,_,b){let k=new $i,O=An(void 0).pipe(ri(o.outsideAngular),si(()=>s.runOutsideAngular(()=>import("./chunk-MVPI6QRS.js"))),$e(()=>bs(t,s,n)),$e(R=>Vc(R,s,l,h,m,f,c,_)),uc({bufferSize:1,refCount:!1}));if(Wo(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=An(null);else{O.pipe(Qm()).subscribe();let R=O.pipe(si(z=>z.getRedirectResult().then(W=>W,()=>null)),ft,uc({bufferSize:1,refCount:!1})),$=O.pipe(si(z=>new Ki(W=>({unsubscribe:s.runOutsideAngular(()=>z.onAuthStateChanged(Z=>W.next(Z),Z=>W.error(Z),()=>W.complete()))})))),Q=O.pipe(si(z=>new Ki(W=>({unsubscribe:s.runOutsideAngular(()=>z.onIdTokenChanged(Z=>W.next(Z),Z=>W.error(Z),()=>W.complete()))}))));this.authState=R.pipe(hc($),Hi(o.outsideAngular),ri(o.insideAngular)),this.user=R.pipe(hc(Q),Hi(o.outsideAngular),ri(o.insideAngular)),this.idToken=this.user.pipe(si(z=>z?Cn(z.getIdToken()):An(null))),this.idTokenResult=this.user.pipe(si(z=>z?Cn(z.getIdTokenResult()):An(null))),this.credential=$m(R,k,this.authState.pipe(us(z=>!z))).pipe($e(z=>z?.user?z:null),Hi(o.outsideAngular),ri(o.insideAngular))}return Yp(this,O,s,{spy:{apply:(R,$,Q)=>{(R.startsWith("signIn")||R.startsWith("createUser"))&&Q.then(z=>k.next(z))}}})}static \u0275fac=function(n){return new(n||i)(Y(nr),Y(ir,8),Y(bt),Y(ut),Y(aa),Y(Sc,8),Y(xc,8),Y(Pc,8),Y(Rc,8),Y(Dc,8),Y(kc,8),Y(pi,8))};static \u0275prov=lt({token:i,factory:i.\u0275fac,providedIn:"any"})}return i})();var Zp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ef={};var On,Oc;(function(){var i;function e(w,g){function v(){}v.prototype=g.prototype,w.D=g.prototype,w.prototype=new v,w.prototype.constructor=w,w.C=function(T,I,C){for(var y=Array(arguments.length-2),nn=2;nn<arguments.length;nn++)y[nn-2]=arguments[nn];return g.prototype[I].apply(T,y)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(w,g,v){v||(v=0);var T=Array(16);if(typeof g=="string")for(var I=0;16>I;++I)T[I]=g.charCodeAt(v++)|g.charCodeAt(v++)<<8|g.charCodeAt(v++)<<16|g.charCodeAt(v++)<<24;else for(I=0;16>I;++I)T[I]=g[v++]|g[v++]<<8|g[v++]<<16|g[v++]<<24;g=w.g[0],v=w.g[1],I=w.g[2];var C=w.g[3],y=g+(C^v&(I^C))+T[0]+3614090360&4294967295;g=v+(y<<7&4294967295|y>>>25),y=C+(I^g&(v^I))+T[1]+3905402710&4294967295,C=g+(y<<12&4294967295|y>>>20),y=I+(v^C&(g^v))+T[2]+606105819&4294967295,I=C+(y<<17&4294967295|y>>>15),y=v+(g^I&(C^g))+T[3]+3250441966&4294967295,v=I+(y<<22&4294967295|y>>>10),y=g+(C^v&(I^C))+T[4]+4118548399&4294967295,g=v+(y<<7&4294967295|y>>>25),y=C+(I^g&(v^I))+T[5]+1200080426&4294967295,C=g+(y<<12&4294967295|y>>>20),y=I+(v^C&(g^v))+T[6]+2821735955&4294967295,I=C+(y<<17&4294967295|y>>>15),y=v+(g^I&(C^g))+T[7]+4249261313&4294967295,v=I+(y<<22&4294967295|y>>>10),y=g+(C^v&(I^C))+T[8]+1770035416&4294967295,g=v+(y<<7&4294967295|y>>>25),y=C+(I^g&(v^I))+T[9]+2336552879&4294967295,C=g+(y<<12&4294967295|y>>>20),y=I+(v^C&(g^v))+T[10]+4294925233&4294967295,I=C+(y<<17&4294967295|y>>>15),y=v+(g^I&(C^g))+T[11]+2304563134&4294967295,v=I+(y<<22&4294967295|y>>>10),y=g+(C^v&(I^C))+T[12]+1804603682&4294967295,g=v+(y<<7&4294967295|y>>>25),y=C+(I^g&(v^I))+T[13]+4254626195&4294967295,C=g+(y<<12&4294967295|y>>>20),y=I+(v^C&(g^v))+T[14]+2792965006&4294967295,I=C+(y<<17&4294967295|y>>>15),y=v+(g^I&(C^g))+T[15]+1236535329&4294967295,v=I+(y<<22&4294967295|y>>>10),y=g+(I^C&(v^I))+T[1]+4129170786&4294967295,g=v+(y<<5&4294967295|y>>>27),y=C+(v^I&(g^v))+T[6]+3225465664&4294967295,C=g+(y<<9&4294967295|y>>>23),y=I+(g^v&(C^g))+T[11]+643717713&4294967295,I=C+(y<<14&4294967295|y>>>18),y=v+(C^g&(I^C))+T[0]+3921069994&4294967295,v=I+(y<<20&4294967295|y>>>12),y=g+(I^C&(v^I))+T[5]+3593408605&4294967295,g=v+(y<<5&4294967295|y>>>27),y=C+(v^I&(g^v))+T[10]+38016083&4294967295,C=g+(y<<9&4294967295|y>>>23),y=I+(g^v&(C^g))+T[15]+3634488961&4294967295,I=C+(y<<14&4294967295|y>>>18),y=v+(C^g&(I^C))+T[4]+3889429448&4294967295,v=I+(y<<20&4294967295|y>>>12),y=g+(I^C&(v^I))+T[9]+568446438&4294967295,g=v+(y<<5&4294967295|y>>>27),y=C+(v^I&(g^v))+T[14]+3275163606&4294967295,C=g+(y<<9&4294967295|y>>>23),y=I+(g^v&(C^g))+T[3]+4107603335&4294967295,I=C+(y<<14&4294967295|y>>>18),y=v+(C^g&(I^C))+T[8]+1163531501&4294967295,v=I+(y<<20&4294967295|y>>>12),y=g+(I^C&(v^I))+T[13]+2850285829&4294967295,g=v+(y<<5&4294967295|y>>>27),y=C+(v^I&(g^v))+T[2]+4243563512&4294967295,C=g+(y<<9&4294967295|y>>>23),y=I+(g^v&(C^g))+T[7]+1735328473&4294967295,I=C+(y<<14&4294967295|y>>>18),y=v+(C^g&(I^C))+T[12]+2368359562&4294967295,v=I+(y<<20&4294967295|y>>>12),y=g+(v^I^C)+T[5]+4294588738&4294967295,g=v+(y<<4&4294967295|y>>>28),y=C+(g^v^I)+T[8]+2272392833&4294967295,C=g+(y<<11&4294967295|y>>>21),y=I+(C^g^v)+T[11]+1839030562&4294967295,I=C+(y<<16&4294967295|y>>>16),y=v+(I^C^g)+T[14]+4259657740&4294967295,v=I+(y<<23&4294967295|y>>>9),y=g+(v^I^C)+T[1]+2763975236&4294967295,g=v+(y<<4&4294967295|y>>>28),y=C+(g^v^I)+T[4]+1272893353&4294967295,C=g+(y<<11&4294967295|y>>>21),y=I+(C^g^v)+T[7]+4139469664&4294967295,I=C+(y<<16&4294967295|y>>>16),y=v+(I^C^g)+T[10]+3200236656&4294967295,v=I+(y<<23&4294967295|y>>>9),y=g+(v^I^C)+T[13]+681279174&4294967295,g=v+(y<<4&4294967295|y>>>28),y=C+(g^v^I)+T[0]+3936430074&4294967295,C=g+(y<<11&4294967295|y>>>21),y=I+(C^g^v)+T[3]+3572445317&4294967295,I=C+(y<<16&4294967295|y>>>16),y=v+(I^C^g)+T[6]+76029189&4294967295,v=I+(y<<23&4294967295|y>>>9),y=g+(v^I^C)+T[9]+3654602809&4294967295,g=v+(y<<4&4294967295|y>>>28),y=C+(g^v^I)+T[12]+3873151461&4294967295,C=g+(y<<11&4294967295|y>>>21),y=I+(C^g^v)+T[15]+530742520&4294967295,I=C+(y<<16&4294967295|y>>>16),y=v+(I^C^g)+T[2]+3299628645&4294967295,v=I+(y<<23&4294967295|y>>>9),y=g+(I^(v|~C))+T[0]+4096336452&4294967295,g=v+(y<<6&4294967295|y>>>26),y=C+(v^(g|~I))+T[7]+1126891415&4294967295,C=g+(y<<10&4294967295|y>>>22),y=I+(g^(C|~v))+T[14]+2878612391&4294967295,I=C+(y<<15&4294967295|y>>>17),y=v+(C^(I|~g))+T[5]+4237533241&4294967295,v=I+(y<<21&4294967295|y>>>11),y=g+(I^(v|~C))+T[12]+1700485571&4294967295,g=v+(y<<6&4294967295|y>>>26),y=C+(v^(g|~I))+T[3]+2399980690&4294967295,C=g+(y<<10&4294967295|y>>>22),y=I+(g^(C|~v))+T[10]+4293915773&4294967295,I=C+(y<<15&4294967295|y>>>17),y=v+(C^(I|~g))+T[1]+2240044497&4294967295,v=I+(y<<21&4294967295|y>>>11),y=g+(I^(v|~C))+T[8]+1873313359&4294967295,g=v+(y<<6&4294967295|y>>>26),y=C+(v^(g|~I))+T[15]+4264355552&4294967295,C=g+(y<<10&4294967295|y>>>22),y=I+(g^(C|~v))+T[6]+2734768916&4294967295,I=C+(y<<15&4294967295|y>>>17),y=v+(C^(I|~g))+T[13]+1309151649&4294967295,v=I+(y<<21&4294967295|y>>>11),y=g+(I^(v|~C))+T[4]+4149444226&4294967295,g=v+(y<<6&4294967295|y>>>26),y=C+(v^(g|~I))+T[11]+3174756917&4294967295,C=g+(y<<10&4294967295|y>>>22),y=I+(g^(C|~v))+T[2]+718787259&4294967295,I=C+(y<<15&4294967295|y>>>17),y=v+(C^(I|~g))+T[9]+3951481745&4294967295,w.g[0]=w.g[0]+g&4294967295,w.g[1]=w.g[1]+(I+(y<<21&4294967295|y>>>11))&4294967295,w.g[2]=w.g[2]+I&4294967295,w.g[3]=w.g[3]+C&4294967295}n.prototype.u=function(w,g){g===void 0&&(g=w.length);for(var v=g-this.blockSize,T=this.B,I=this.h,C=0;C<g;){if(I==0)for(;C<=v;)r(this,w,C),C+=this.blockSize;if(typeof w=="string"){for(;C<g;)if(T[I++]=w.charCodeAt(C++),I==this.blockSize){r(this,T),I=0;break}}else for(;C<g;)if(T[I++]=w[C++],I==this.blockSize){r(this,T),I=0;break}}this.h=I,this.o+=g},n.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var g=1;g<w.length-8;++g)w[g]=0;var v=8*this.o;for(g=w.length-8;g<w.length;++g)w[g]=v&255,v/=256;for(this.u(w),w=Array(16),g=v=0;4>g;++g)for(var T=0;32>T;T+=8)w[v++]=this.g[g]>>>T&255;return w};function s(w,g){var v=l;return Object.prototype.hasOwnProperty.call(v,w)?v[w]:v[w]=g(w)}function o(w,g){this.h=g;for(var v=[],T=!0,I=w.length-1;0<=I;I--){var C=w[I]|0;T&&C==g||(v[I]=C,T=!1)}this.g=v}var l={};function c(w){return-128<=w&&128>w?s(w,function(g){return new o([g|0],0>g?-1:0)}):new o([w|0],0>w?-1:0)}function h(w){if(isNaN(w)||!isFinite(w))return f;if(0>w)return R(h(-w));for(var g=[],v=1,T=0;w>=v;T++)g[T]=w/v|0,v*=4294967296;return new o(g,0)}function m(w,g){if(w.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(w.charAt(0)=="-")return R(m(w.substring(1),g));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=h(Math.pow(g,8)),T=f,I=0;I<w.length;I+=8){var C=Math.min(8,w.length-I),y=parseInt(w.substring(I,I+C),g);8>C?(C=h(Math.pow(g,C)),T=T.j(C).add(h(y))):(T=T.j(v),T=T.add(h(y)))}return T}var f=c(0),_=c(1),b=c(16777216);i=o.prototype,i.m=function(){if(O(this))return-R(this).m();for(var w=0,g=1,v=0;v<this.g.length;v++){var T=this.i(v);w+=(0<=T?T:4294967296+T)*g,g*=4294967296}return w},i.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(k(this))return"0";if(O(this))return"-"+R(this).toString(w);for(var g=h(Math.pow(w,6)),v=this,T="";;){var I=W(v,g).g;v=$(v,I.j(g));var C=((0<v.g.length?v.g[0]:v.h)>>>0).toString(w);if(v=I,k(v))return C+T;for(;6>C.length;)C="0"+C;T=C+T}},i.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function k(w){if(w.h!=0)return!1;for(var g=0;g<w.g.length;g++)if(w.g[g]!=0)return!1;return!0}function O(w){return w.h==-1}i.l=function(w){return w=$(this,w),O(w)?-1:k(w)?0:1};function R(w){for(var g=w.g.length,v=[],T=0;T<g;T++)v[T]=~w.g[T];return new o(v,~w.h).add(_)}i.abs=function(){return O(this)?R(this):this},i.add=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],T=0,I=0;I<=g;I++){var C=T+(this.i(I)&65535)+(w.i(I)&65535),y=(C>>>16)+(this.i(I)>>>16)+(w.i(I)>>>16);T=y>>>16,C&=65535,y&=65535,v[I]=y<<16|C}return new o(v,v[v.length-1]&-2147483648?-1:0)};function $(w,g){return w.add(R(g))}i.j=function(w){if(k(this)||k(w))return f;if(O(this))return O(w)?R(this).j(R(w)):R(R(this).j(w));if(O(w))return R(this.j(R(w)));if(0>this.l(b)&&0>w.l(b))return h(this.m()*w.m());for(var g=this.g.length+w.g.length,v=[],T=0;T<2*g;T++)v[T]=0;for(T=0;T<this.g.length;T++)for(var I=0;I<w.g.length;I++){var C=this.i(T)>>>16,y=this.i(T)&65535,nn=w.i(I)>>>16,Kr=w.i(I)&65535;v[2*T+2*I]+=y*Kr,Q(v,2*T+2*I),v[2*T+2*I+1]+=C*Kr,Q(v,2*T+2*I+1),v[2*T+2*I+1]+=y*nn,Q(v,2*T+2*I+1),v[2*T+2*I+2]+=C*nn,Q(v,2*T+2*I+2)}for(T=0;T<g;T++)v[T]=v[2*T+1]<<16|v[2*T];for(T=g;T<2*g;T++)v[T]=0;return new o(v,0)};function Q(w,g){for(;(w[g]&65535)!=w[g];)w[g+1]+=w[g]>>>16,w[g]&=65535,g++}function z(w,g){this.g=w,this.h=g}function W(w,g){if(k(g))throw Error("division by zero");if(k(w))return new z(f,f);if(O(w))return g=W(R(w),g),new z(R(g.g),R(g.h));if(O(g))return g=W(w,R(g)),new z(R(g.g),g.h);if(30<w.g.length){if(O(w)||O(g))throw Error("slowDivide_ only works with positive integers.");for(var v=_,T=g;0>=T.l(w);)v=Z(v),T=Z(T);var I=ee(v,1),C=ee(T,1);for(T=ee(T,2),v=ee(v,2);!k(T);){var y=C.add(T);0>=y.l(w)&&(I=I.add(v),C=y),T=ee(T,1),v=ee(v,1)}return g=$(w,I.j(g)),new z(I,g)}for(I=f;0<=w.l(g);){for(v=Math.max(1,Math.floor(w.m()/g.m())),T=Math.ceil(Math.log(v)/Math.LN2),T=48>=T?1:Math.pow(2,T-48),C=h(v),y=C.j(g);O(y)||0<y.l(w);)v-=T,C=h(v),y=C.j(g);k(C)&&(C=_),I=I.add(C),w=$(w,y)}return new z(I,w)}i.A=function(w){return W(this,w).h},i.and=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],T=0;T<g;T++)v[T]=this.i(T)&w.i(T);return new o(v,this.h&w.h)},i.or=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],T=0;T<g;T++)v[T]=this.i(T)|w.i(T);return new o(v,this.h|w.h)},i.xor=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],T=0;T<g;T++)v[T]=this.i(T)^w.i(T);return new o(v,this.h^w.h)};function Z(w){for(var g=w.g.length+1,v=[],T=0;T<g;T++)v[T]=w.i(T)<<1|w.i(T-1)>>>31;return new o(v,w.h)}function ee(w,g){var v=g>>5;g%=32;for(var T=w.g.length-v,I=[],C=0;C<T;C++)I[C]=0<g?w.i(C+v)>>>g|w.i(C+v+1)<<32-g:w.i(C+v);return new o(I,w.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Oc=ef.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=m,On=ef.Integer=o}).apply(typeof Zp<"u"?Zp:typeof self<"u"?self:typeof window<"u"?window:{});var ha=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},hn={};var Nc,b1,rr,Mc,Cs,da,Fc,Lc,zc;(function(){var i,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,u,d){return a==Array.prototype||a==Object.prototype||(a[u]=d.value),a};function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof ha=="object"&&ha];for(var u=0;u<a.length;++u){var d=a[u];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var n=t(this);function r(a,u){if(u)e:{var d=n;a=a.split(".");for(var p=0;p<a.length-1;p++){var E=a[p];if(!(E in d))break e;d=d[E]}a=a[a.length-1],p=d[a],u=u(p),u!=p&&u!=null&&e(d,a,{configurable:!0,writable:!0,value:u})}}function s(a,u){a instanceof String&&(a+="");var d=0,p=!1,E={next:function(){if(!p&&d<a.length){var S=d++;return{value:u(S,a[S]),done:!1}}return p=!0,{done:!0,value:void 0}}};return E[Symbol.iterator]=function(){return E},E}r("Array.prototype.values",function(a){return a||function(){return s(this,function(u,d){return d})}});var o=o||{},l=this||self;function c(a){var u=typeof a;return u=u!="object"?u:a?Array.isArray(a)?"array":u:"null",u=="array"||u=="object"&&typeof a.length=="number"}function h(a){var u=typeof a;return u=="object"&&a!=null||u=="function"}function m(a,u,d){return a.call.apply(a.bind,arguments)}function f(a,u,d){if(!a)throw Error();if(2<arguments.length){var p=Array.prototype.slice.call(arguments,2);return function(){var E=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(E,p),a.apply(u,E)}}return function(){return a.apply(u,arguments)}}function _(a,u,d){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:f,_.apply(null,arguments)}function b(a,u){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),a.apply(this,p)}}function k(a,u){function d(){}d.prototype=u.prototype,a.aa=u.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(p,E,S){for(var F=Array(arguments.length-2),fe=2;fe<arguments.length;fe++)F[fe-2]=arguments[fe];return u.prototype[E].apply(p,F)}}function O(a){let u=a.length;if(0<u){let d=Array(u);for(let p=0;p<u;p++)d[p]=a[p];return d}return[]}function R(a,u){for(let d=1;d<arguments.length;d++){let p=arguments[d];if(c(p)){let E=a.length||0,S=p.length||0;a.length=E+S;for(let F=0;F<S;F++)a[E+F]=p[F]}else a.push(p)}}class ${constructor(u,d){this.i=u,this.j=d,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function Q(a){return/^[\s\xa0]*$/.test(a)}function z(){var a=l.navigator;return a&&(a=a.userAgent)?a:""}function W(a){return W[" "](a),a}W[" "]=function(){};var Z=z().indexOf("Gecko")!=-1&&!(z().toLowerCase().indexOf("webkit")!=-1&&z().indexOf("Edge")==-1)&&!(z().indexOf("Trident")!=-1||z().indexOf("MSIE")!=-1)&&z().indexOf("Edge")==-1;function ee(a,u,d){for(let p in a)u.call(d,a[p],p,a)}function w(a,u){for(let d in a)u.call(void 0,a[d],d,a)}function g(a){let u={};for(let d in a)u[d]=a[d];return u}let v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(a,u){let d,p;for(let E=1;E<arguments.length;E++){p=arguments[E];for(d in p)a[d]=p[d];for(let S=0;S<v.length;S++)d=v[S],Object.prototype.hasOwnProperty.call(p,d)&&(a[d]=p[d])}}function I(a){var u=1;a=a.split(":");let d=[];for(;0<u&&a.length;)d.push(a.shift()),u--;return a.length&&d.push(a.join(":")),d}function C(a){l.setTimeout(()=>{throw a},0)}function y(){var a=Fl;let u=null;return a.g&&(u=a.g,a.g=a.g.next,a.g||(a.h=null),u.next=null),u}class nn{constructor(){this.h=this.g=null}add(u,d){let p=Kr.get();p.set(u,d),this.h?this.h.next=p:this.g=p,this.h=p}}var Kr=new $(()=>new ey,a=>a.reset());class ey{constructor(){this.next=this.g=this.h=null}set(u,d){this.h=u,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let $r,Hr=!1,Fl=new nn,Gd=()=>{let a=l.Promise.resolve(void 0);$r=()=>{a.then(ty)}};var ty=()=>{for(var a;a=y();){try{a.h.call(a.g)}catch(d){C(d)}var u=Kr;u.j(a),100>u.h&&(u.h++,a.next=u.g,u.g=a)}Hr=!1};function Tn(){this.s=this.s,this.C=this.C}Tn.prototype.s=!1,Tn.prototype.ma=function(){this.s||(this.s=!0,this.N())},Tn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ye(a,u){this.type=a,this.g=this.target=u,this.defaultPrevented=!1}Ye.prototype.h=function(){this.defaultPrevented=!0};var ny=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,u=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};l.addEventListener("test",d,u),l.removeEventListener("test",d,u)}catch{}return a}();function Qr(a,u){if(Ye.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,p=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=u,u=a.relatedTarget){if(Z){e:{try{W(u.nodeName);var E=!0;break e}catch{}E=!1}E||(u=null)}}else d=="mouseover"?u=a.fromElement:d=="mouseout"&&(u=a.toElement);this.relatedTarget=u,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:iy[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Qr.aa.h.call(this)}}k(Qr,Ye);var iy={2:"touch",3:"pen",4:"mouse"};Qr.prototype.h=function(){Qr.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Wr="closure_listenable_"+(1e6*Math.random()|0),ry=0;function sy(a,u,d,p,E){this.listener=a,this.proxy=null,this.src=u,this.type=d,this.capture=!!p,this.ha=E,this.key=++ry,this.da=this.fa=!1}function wo(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function To(a){this.src=a,this.g={},this.h=0}To.prototype.add=function(a,u,d,p,E){var S=a.toString();a=this.g[S],a||(a=this.g[S]=[],this.h++);var F=zl(a,u,p,E);return-1<F?(u=a[F],d||(u.fa=!1)):(u=new sy(u,this.src,S,!!p,E),u.fa=d,a.push(u)),u};function Ll(a,u){var d=u.type;if(d in a.g){var p=a.g[d],E=Array.prototype.indexOf.call(p,u,void 0),S;(S=0<=E)&&Array.prototype.splice.call(p,E,1),S&&(wo(u),a.g[d].length==0&&(delete a.g[d],a.h--))}}function zl(a,u,d,p){for(var E=0;E<a.length;++E){var S=a[E];if(!S.da&&S.listener==u&&S.capture==!!d&&S.ha==p)return E}return-1}var Bl="closure_lm_"+(1e6*Math.random()|0),Ul={};function Kd(a,u,d,p,E){if(p&&p.once)return Hd(a,u,d,p,E);if(Array.isArray(u)){for(var S=0;S<u.length;S++)Kd(a,u[S],d,p,E);return null}return d=Kl(d),a&&a[Wr]?a.K(u,d,h(p)?!!p.capture:!!p,E):$d(a,u,d,!1,p,E)}function $d(a,u,d,p,E,S){if(!u)throw Error("Invalid event type");var F=h(E)?!!E.capture:!!E,fe=jl(a);if(fe||(a[Bl]=fe=new To(a)),d=fe.add(u,d,p,F,S),d.proxy)return d;if(p=oy(),d.proxy=p,p.src=a,p.listener=d,a.addEventListener)ny||(E=F),E===void 0&&(E=!1),a.addEventListener(u.toString(),p,E);else if(a.attachEvent)a.attachEvent(Wd(u.toString()),p);else if(a.addListener&&a.removeListener)a.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function oy(){function a(d){return u.call(a.src,a.listener,d)}let u=ay;return a}function Hd(a,u,d,p,E){if(Array.isArray(u)){for(var S=0;S<u.length;S++)Hd(a,u[S],d,p,E);return null}return d=Kl(d),a&&a[Wr]?a.L(u,d,h(p)?!!p.capture:!!p,E):$d(a,u,d,!0,p,E)}function Qd(a,u,d,p,E){if(Array.isArray(u))for(var S=0;S<u.length;S++)Qd(a,u[S],d,p,E);else p=h(p)?!!p.capture:!!p,d=Kl(d),a&&a[Wr]?(a=a.i,u=String(u).toString(),u in a.g&&(S=a.g[u],d=zl(S,d,p,E),-1<d&&(wo(S[d]),Array.prototype.splice.call(S,d,1),S.length==0&&(delete a.g[u],a.h--)))):a&&(a=jl(a))&&(u=a.g[u.toString()],a=-1,u&&(a=zl(u,d,p,E)),(d=-1<a?u[a]:null)&&ql(d))}function ql(a){if(typeof a!="number"&&a&&!a.da){var u=a.src;if(u&&u[Wr])Ll(u.i,a);else{var d=a.type,p=a.proxy;u.removeEventListener?u.removeEventListener(d,p,a.capture):u.detachEvent?u.detachEvent(Wd(d),p):u.addListener&&u.removeListener&&u.removeListener(p),(d=jl(u))?(Ll(d,a),d.h==0&&(d.src=null,u[Bl]=null)):wo(a)}}}function Wd(a){return a in Ul?Ul[a]:Ul[a]="on"+a}function ay(a,u){if(a.da)a=!0;else{u=new Qr(u,this);var d=a.listener,p=a.ha||a.src;a.fa&&ql(a),a=d.call(p,u)}return a}function jl(a){return a=a[Bl],a instanceof To?a:null}var Gl="__closure_events_fn_"+(1e9*Math.random()>>>0);function Kl(a){return typeof a=="function"?a:(a[Gl]||(a[Gl]=function(u){return a.handleEvent(u)}),a[Gl])}function Xe(){Tn.call(this),this.i=new To(this),this.M=this,this.F=null}k(Xe,Tn),Xe.prototype[Wr]=!0,Xe.prototype.removeEventListener=function(a,u,d,p){Qd(this,a,u,d,p)};function nt(a,u){var d,p=a.F;if(p)for(d=[];p;p=p.F)d.push(p);if(a=a.M,p=u.type||u,typeof u=="string")u=new Ye(u,a);else if(u instanceof Ye)u.target=u.target||a;else{var E=u;u=new Ye(p,a),T(u,E)}if(E=!0,d)for(var S=d.length-1;0<=S;S--){var F=u.g=d[S];E=Io(F,p,!0,u)&&E}if(F=u.g=a,E=Io(F,p,!0,u)&&E,E=Io(F,p,!1,u)&&E,d)for(S=0;S<d.length;S++)F=u.g=d[S],E=Io(F,p,!1,u)&&E}Xe.prototype.N=function(){if(Xe.aa.N.call(this),this.i){var a=this.i,u;for(u in a.g){for(var d=a.g[u],p=0;p<d.length;p++)wo(d[p]);delete a.g[u],a.h--}}this.F=null},Xe.prototype.K=function(a,u,d,p){return this.i.add(String(a),u,!1,d,p)},Xe.prototype.L=function(a,u,d,p){return this.i.add(String(a),u,!0,d,p)};function Io(a,u,d,p){if(u=a.i.g[String(u)],!u)return!0;u=u.concat();for(var E=!0,S=0;S<u.length;++S){var F=u[S];if(F&&!F.da&&F.capture==d){var fe=F.listener,Ke=F.ha||F.src;F.fa&&Ll(a.i,F),E=fe.call(Ke,p)!==!1&&E}}return E&&!p.defaultPrevented}function Yd(a,u,d){if(typeof a=="function")d&&(a=_(a,d));else if(a&&typeof a.handleEvent=="function")a=_(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:l.setTimeout(a,u||0)}function Xd(a){a.g=Yd(()=>{a.g=null,a.i&&(a.i=!1,Xd(a))},a.l);let u=a.h;a.h=null,a.m.apply(null,u)}class ly extends Tn{constructor(u,d){super(),this.m=u,this.l=d,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:Xd(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Yr(a){Tn.call(this),this.h=a,this.g={}}k(Yr,Tn);var Jd=[];function Zd(a){ee(a.g,function(u,d){this.g.hasOwnProperty(d)&&ql(u)},a),a.g={}}Yr.prototype.N=function(){Yr.aa.N.call(this),Zd(this)},Yr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var $l=l.JSON.stringify,cy=l.JSON.parse,uy=class{stringify(a){return l.JSON.stringify(a,void 0)}parse(a){return l.JSON.parse(a,void 0)}};function Hl(){}Hl.prototype.h=null;function em(a){return a.h||(a.h=a.i())}function tm(){}var Xr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ql(){Ye.call(this,"d")}k(Ql,Ye);function Wl(){Ye.call(this,"c")}k(Wl,Ye);var ei={},nm=null;function Eo(){return nm=nm||new Xe}ei.La="serverreachability";function im(a){Ye.call(this,ei.La,a)}k(im,Ye);function Jr(a){let u=Eo();nt(u,new im(u))}ei.STAT_EVENT="statevent";function rm(a,u){Ye.call(this,ei.STAT_EVENT,a),this.stat=u}k(rm,Ye);function it(a){let u=Eo();nt(u,new rm(u,a))}ei.Ma="timingevent";function sm(a,u){Ye.call(this,ei.Ma,a),this.size=u}k(sm,Ye);function Zr(a,u){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){a()},u)}function es(){this.g=!0}es.prototype.xa=function(){this.g=!1};function hy(a,u,d,p,E,S){a.info(function(){if(a.g)if(S)for(var F="",fe=S.split("&"),Ke=0;Ke<fe.length;Ke++){var he=fe[Ke].split("=");if(1<he.length){var Je=he[0];he=he[1];var Ze=Je.split("_");F=2<=Ze.length&&Ze[1]=="type"?F+(Je+"="+he+"&"):F+(Je+"=redacted&")}}else F=null;else F=S;return"XMLHTTP REQ ("+p+") [attempt "+E+"]: "+u+`
`+d+`
`+F})}function dy(a,u,d,p,E,S,F){a.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+E+"]: "+u+`
`+d+`
`+S+" "+F})}function Ui(a,u,d,p){a.info(function(){return"XMLHTTP TEXT ("+u+"): "+py(a,d)+(p?" "+p:"")})}function my(a,u){a.info(function(){return"TIMEOUT: "+u})}es.prototype.info=function(){};function py(a,u){if(!a.g)return u;if(!u)return null;try{var d=JSON.parse(u);if(d){for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var p=d[a];if(!(2>p.length)){var E=p[1];if(Array.isArray(E)&&!(1>E.length)){var S=E[0];if(S!="noop"&&S!="stop"&&S!="close")for(var F=1;F<E.length;F++)E[F]=""}}}}return $l(d)}catch{return u}}var bo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},om={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Yl;function Co(){}k(Co,Hl),Co.prototype.g=function(){return new XMLHttpRequest},Co.prototype.i=function(){return{}},Yl=new Co;function In(a,u,d,p){this.j=a,this.i=u,this.l=d,this.R=p||1,this.U=new Yr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new am}function am(){this.i=null,this.g="",this.h=!1}var lm={},Xl={};function Jl(a,u,d){a.L=1,a.v=Po(rn(u)),a.m=d,a.P=!0,cm(a,null)}function cm(a,u){a.F=Date.now(),Ao(a),a.A=rn(a.v);var d=a.A,p=a.R;Array.isArray(p)||(p=[String(p)]),Em(d.i,"t",p),a.C=0,d=a.j.J,a.h=new am,a.g=Um(a.j,d?u:null,!a.m),0<a.O&&(a.M=new ly(_(a.Y,a,a.g),a.O)),u=a.U,d=a.g,p=a.ca;var E="readystatechange";Array.isArray(E)||(E&&(Jd[0]=E.toString()),E=Jd);for(var S=0;S<E.length;S++){var F=Kd(d,E[S],p||u.handleEvent,!1,u.h||u);if(!F)break;u.g[F.key]=F}u=a.H?g(a.H):{},a.m?(a.u||(a.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,u)):(a.u="GET",a.g.ea(a.A,a.u,null,u)),Jr(),hy(a.i,a.u,a.A,a.l,a.R,a.m)}In.prototype.ca=function(a){a=a.target;let u=this.M;u&&sn(a)==3?u.j():this.Y(a)},In.prototype.Y=function(a){try{if(a==this.g)e:{let Ze=sn(this.g);var u=this.g.Ba();let Gi=this.g.Z();if(!(3>Ze)&&(Ze!=3||this.g&&(this.h.h||this.g.oa()||Rm(this.g)))){this.J||Ze!=4||u==7||(u==8||0>=Gi?Jr(3):Jr(2)),Zl(this);var d=this.g.Z();this.X=d;t:if(um(this)){var p=Rm(this.g);a="";var E=p.length,S=sn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ti(this),ts(this);var F="";break t}this.h.i=new l.TextDecoder}for(u=0;u<E;u++)this.h.h=!0,a+=this.h.i.decode(p[u],{stream:!(S&&u==E-1)});p.length=0,this.h.g+=a,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=d==200,dy(this.i,this.u,this.A,this.l,this.R,Ze,d),this.o){if(this.T&&!this.K){t:{if(this.g){var fe,Ke=this.g;if((fe=Ke.g?Ke.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Q(fe)){var he=fe;break t}}he=null}if(d=he)Ui(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ec(this,d);else{this.o=!1,this.s=3,it(12),ti(this),ts(this);break e}}if(this.P){d=!0;let kt;for(;!this.J&&this.C<F.length;)if(kt=fy(this,F),kt==Xl){Ze==4&&(this.s=4,it(14),d=!1),Ui(this.i,this.l,null,"[Incomplete Response]");break}else if(kt==lm){this.s=4,it(15),Ui(this.i,this.l,F,"[Invalid Chunk]"),d=!1;break}else Ui(this.i,this.l,kt,null),ec(this,kt);if(um(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ze!=4||F.length!=0||this.h.h||(this.s=1,it(16),d=!1),this.o=this.o&&d,!d)Ui(this.i,this.l,F,"[Invalid Chunked Response]"),ti(this),ts(this);else if(0<F.length&&!this.W){this.W=!0;var Je=this.j;Je.g==this&&Je.ba&&!Je.M&&(Je.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),oc(Je),Je.M=!0,it(11))}}else Ui(this.i,this.l,F,null),ec(this,F);Ze==4&&ti(this),this.o&&!this.J&&(Ze==4?Fm(this.j,this):(this.o=!1,Ao(this)))}else ky(this.g),d==400&&0<F.indexOf("Unknown SID")?(this.s=3,it(12)):(this.s=0,it(13)),ti(this),ts(this)}}}catch{}finally{}};function um(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function fy(a,u){var d=a.C,p=u.indexOf(`
`,d);return p==-1?Xl:(d=Number(u.substring(d,p)),isNaN(d)?lm:(p+=1,p+d>u.length?Xl:(u=u.slice(p,p+d),a.C=p+d,u)))}In.prototype.cancel=function(){this.J=!0,ti(this)};function Ao(a){a.S=Date.now()+a.I,hm(a,a.I)}function hm(a,u){if(a.B!=null)throw Error("WatchDog timer not null");a.B=Zr(_(a.ba,a),u)}function Zl(a){a.B&&(l.clearTimeout(a.B),a.B=null)}In.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(my(this.i,this.A),this.L!=2&&(Jr(),it(17)),ti(this),this.s=2,ts(this)):hm(this,this.S-a)};function ts(a){a.j.G==0||a.J||Fm(a.j,a)}function ti(a){Zl(a);var u=a.M;u&&typeof u.ma=="function"&&u.ma(),a.M=null,Zd(a.U),a.g&&(u=a.g,a.g=null,u.abort(),u.ma())}function ec(a,u){try{var d=a.j;if(d.G!=0&&(d.g==a||tc(d.h,a))){if(!a.K&&tc(d.h,a)&&d.G==3){try{var p=d.Da.g.parse(u)}catch{p=null}if(Array.isArray(p)&&p.length==3){var E=p;if(E[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<a.F)Oo(d),ko(d);else break e;sc(d),it(18)}}else d.za=E[1],0<d.za-d.T&&37500>E[2]&&d.F&&d.v==0&&!d.C&&(d.C=Zr(_(d.Za,d),6e3));if(1>=pm(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else ii(d,11)}else if((a.K||d.g==a)&&Oo(d),!Q(u))for(E=d.Da.g.parse(u),u=0;u<E.length;u++){let he=E[u];if(d.T=he[0],he=he[1],d.G==2)if(he[0]=="c"){d.K=he[1],d.ia=he[2];let Je=he[3];Je!=null&&(d.la=Je,d.j.info("VER="+d.la));let Ze=he[4];Ze!=null&&(d.Aa=Ze,d.j.info("SVER="+d.Aa));let Gi=he[5];Gi!=null&&typeof Gi=="number"&&0<Gi&&(p=1.5*Gi,d.L=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;let kt=a.g;if(kt){let Mo=kt.g?kt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Mo){var S=p.h;S.g||Mo.indexOf("spdy")==-1&&Mo.indexOf("quic")==-1&&Mo.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(nc(S,S.h),S.h=null))}if(p.D){let ac=kt.g?kt.g.getResponseHeader("X-HTTP-Session-Id"):null;ac&&(p.ya=ac,we(p.I,p.D,ac))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms")),p=d;var F=a;if(p.qa=Bm(p,p.J?p.ia:null,p.W),F.K){fm(p.h,F);var fe=F,Ke=p.L;Ke&&(fe.I=Ke),fe.B&&(Zl(fe),Ao(fe)),p.g=F}else Nm(p);0<d.i.length&&Vo(d)}else he[0]!="stop"&&he[0]!="close"||ii(d,7);else d.G==3&&(he[0]=="stop"||he[0]=="close"?he[0]=="stop"?ii(d,7):rc(d):he[0]!="noop"&&d.l&&d.l.ta(he),d.v=0)}}Jr(4)}catch{}}var gy=class{constructor(a,u){this.g=a,this.map=u}};function dm(a){this.l=a||10,l.PerformanceNavigationTiming?(a=l.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function mm(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function pm(a){return a.h?1:a.g?a.g.size:0}function tc(a,u){return a.h?a.h==u:a.g?a.g.has(u):!1}function nc(a,u){a.g?a.g.add(u):a.h=u}function fm(a,u){a.h&&a.h==u?a.h=null:a.g&&a.g.has(u)&&a.g.delete(u)}dm.prototype.cancel=function(){if(this.i=gm(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function gm(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let u=a.i;for(let d of a.g.values())u=u.concat(d.D);return u}return O(a.i)}function _y(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(c(a)){for(var u=[],d=a.length,p=0;p<d;p++)u.push(a[p]);return u}u=[],d=0;for(p in a)u[d++]=a[p];return u}function yy(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(c(a)||typeof a=="string"){var u=[];a=a.length;for(var d=0;d<a;d++)u.push(d);return u}u=[],d=0;for(let p in a)u[d++]=p;return u}}}function _m(a,u){if(a.forEach&&typeof a.forEach=="function")a.forEach(u,void 0);else if(c(a)||typeof a=="string")Array.prototype.forEach.call(a,u,void 0);else for(var d=yy(a),p=_y(a),E=p.length,S=0;S<E;S++)u.call(void 0,p[S],d&&d[S],a)}var ym=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function vy(a,u){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var p=a[d].indexOf("="),E=null;if(0<=p){var S=a[d].substring(0,p);E=a[d].substring(p+1)}else S=a[d];u(S,E?decodeURIComponent(E.replace(/\+/g," ")):"")}}}function ni(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof ni){this.h=a.h,So(this,a.j),this.o=a.o,this.g=a.g,xo(this,a.s),this.l=a.l;var u=a.i,d=new rs;d.i=u.i,u.g&&(d.g=new Map(u.g),d.h=u.h),vm(this,d),this.m=a.m}else a&&(u=String(a).match(ym))?(this.h=!1,So(this,u[1]||"",!0),this.o=ns(u[2]||""),this.g=ns(u[3]||"",!0),xo(this,u[4]),this.l=ns(u[5]||"",!0),vm(this,u[6]||"",!0),this.m=ns(u[7]||"")):(this.h=!1,this.i=new rs(null,this.h))}ni.prototype.toString=function(){var a=[],u=this.j;u&&a.push(is(u,wm,!0),":");var d=this.g;return(d||u=="file")&&(a.push("//"),(u=this.o)&&a.push(is(u,wm,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&a.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(is(d,d.charAt(0)=="/"?Iy:Ty,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",is(d,by)),a.join("")};function rn(a){return new ni(a)}function So(a,u,d){a.j=d?ns(u,!0):u,a.j&&(a.j=a.j.replace(/:$/,""))}function xo(a,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);a.s=u}else a.s=null}function vm(a,u,d){u instanceof rs?(a.i=u,Cy(a.i,a.h)):(d||(u=is(u,Ey)),a.i=new rs(u,a.h))}function we(a,u,d){a.i.set(u,d)}function Po(a){return we(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function ns(a,u){return a?u?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function is(a,u,d){return typeof a=="string"?(a=encodeURI(a).replace(u,wy),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function wy(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var wm=/[#\/\?@]/g,Ty=/[#\?:]/g,Iy=/[#\?]/g,Ey=/[#\?@]/g,by=/#/g;function rs(a,u){this.h=this.g=null,this.i=a||null,this.j=!!u}function En(a){a.g||(a.g=new Map,a.h=0,a.i&&vy(a.i,function(u,d){a.add(decodeURIComponent(u.replace(/\+/g," ")),d)}))}i=rs.prototype,i.add=function(a,u){En(this),this.i=null,a=qi(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(u),this.h+=1,this};function Tm(a,u){En(a),u=qi(a,u),a.g.has(u)&&(a.i=null,a.h-=a.g.get(u).length,a.g.delete(u))}function Im(a,u){return En(a),u=qi(a,u),a.g.has(u)}i.forEach=function(a,u){En(this),this.g.forEach(function(d,p){d.forEach(function(E){a.call(u,E,p,this)},this)},this)},i.na=function(){En(this);let a=Array.from(this.g.values()),u=Array.from(this.g.keys()),d=[];for(let p=0;p<u.length;p++){let E=a[p];for(let S=0;S<E.length;S++)d.push(u[p])}return d},i.V=function(a){En(this);let u=[];if(typeof a=="string")Im(this,a)&&(u=u.concat(this.g.get(qi(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)u=u.concat(a[d])}return u},i.set=function(a,u){return En(this),this.i=null,a=qi(this,a),Im(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[u]),this.h+=1,this},i.get=function(a,u){return a?(a=this.V(a),0<a.length?String(a[0]):u):u};function Em(a,u,d){Tm(a,u),0<d.length&&(a.i=null,a.g.set(qi(a,u),O(d)),a.h+=d.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],u=Array.from(this.g.keys());for(var d=0;d<u.length;d++){var p=u[d];let S=encodeURIComponent(String(p)),F=this.V(p);for(p=0;p<F.length;p++){var E=S;F[p]!==""&&(E+="="+encodeURIComponent(String(F[p]))),a.push(E)}}return this.i=a.join("&")};function qi(a,u){return u=String(u),a.j&&(u=u.toLowerCase()),u}function Cy(a,u){u&&!a.j&&(En(a),a.i=null,a.g.forEach(function(d,p){var E=p.toLowerCase();p!=E&&(Tm(this,p),Em(this,E,d))},a)),a.j=u}function Ay(a,u){let d=new es;if(l.Image){let p=new Image;p.onload=b(bn,d,"TestLoadImage: loaded",!0,u,p),p.onerror=b(bn,d,"TestLoadImage: error",!1,u,p),p.onabort=b(bn,d,"TestLoadImage: abort",!1,u,p),p.ontimeout=b(bn,d,"TestLoadImage: timeout",!1,u,p),l.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=a}else u(!1)}function Sy(a,u){let d=new es,p=new AbortController,E=setTimeout(()=>{p.abort(),bn(d,"TestPingServer: timeout",!1,u)},1e4);fetch(a,{signal:p.signal}).then(S=>{clearTimeout(E),S.ok?bn(d,"TestPingServer: ok",!0,u):bn(d,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(E),bn(d,"TestPingServer: error",!1,u)})}function bn(a,u,d,p,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),p(d)}catch{}}function xy(){this.g=new uy}function Py(a,u,d){let p=d||"";try{_m(a,function(E,S){let F=E;h(E)&&(F=$l(E)),u.push(p+S+"="+encodeURIComponent(F))})}catch(E){throw u.push(p+"type="+encodeURIComponent("_badmap")),E}}function ss(a){this.l=a.Ub||null,this.j=a.eb||!1}k(ss,Hl),ss.prototype.g=function(){return new Ro(this.l,this.j)},ss.prototype.i=function(a){return function(){return a}}({});function Ro(a,u){Xe.call(this),this.D=a,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(Ro,Xe),i=Ro.prototype,i.open=function(a,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=u,this.readyState=1,as(this)},i.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(u.body=a),(this.D||l).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,os(this)),this.readyState=0},i.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,as(this)),this.g&&(this.readyState=3,as(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;bm(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function bm(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}i.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var u=a.value?a.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!a.done}))&&(this.response=this.responseText+=u)}a.done?os(this):as(this),this.readyState==3&&bm(this)}},i.Ra=function(a){this.g&&(this.response=this.responseText=a,os(this))},i.Qa=function(a){this.g&&(this.response=a,os(this))},i.ga=function(){this.g&&os(this)};function os(a){a.readyState=4,a.l=null,a.j=null,a.v=null,as(a)}i.setRequestHeader=function(a,u){this.u.append(a,u)},i.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],u=this.h.entries();for(var d=u.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=u.next();return a.join(`\r
`)};function as(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Ro.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function Cm(a){let u="";return ee(a,function(d,p){u+=p,u+=":",u+=d,u+=`\r
`}),u}function ic(a,u,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=Cm(d),typeof a=="string"?d!=null&&encodeURIComponent(String(d)):we(a,u,d))}function Se(a){Xe.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(Se,Xe);var Ry=/^https?$/i,Dy=["POST","PUT"];i=Se.prototype,i.Ha=function(a){this.J=a},i.ea=function(a,u,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);u=u?u.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Yl.g(),this.v=this.o?em(this.o):em(Yl),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(u,String(a),!0),this.B=!1}catch(S){Am(this,S);return}if(a=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var E in p)d.set(E,p[E]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(let S of p.keys())d.set(S,p.get(S));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(S=>S.toLowerCase()=="content-type"),E=l.FormData&&a instanceof l.FormData,!(0<=Array.prototype.indexOf.call(Dy,u,void 0))||p||E||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,F]of d)this.g.setRequestHeader(S,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Pm(this),this.u=!0,this.g.send(a),this.u=!1}catch(S){Am(this,S)}};function Am(a,u){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=u,a.m=5,Sm(a),Do(a)}function Sm(a){a.A||(a.A=!0,nt(a,"complete"),nt(a,"error"))}i.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,nt(this,"complete"),nt(this,"abort"),Do(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Do(this,!0)),Se.aa.N.call(this)},i.Ea=function(){this.s||(this.B||this.u||this.j?xm(this):this.bb())},i.bb=function(){xm(this)};function xm(a){if(a.h&&typeof o<"u"&&(!a.v[1]||sn(a)!=4||a.Z()!=2)){if(a.u&&sn(a)==4)Yd(a.Ea,0,a);else if(nt(a,"readystatechange"),sn(a)==4){a.h=!1;try{let F=a.Z();e:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var d;if(!(d=u)){var p;if(p=F===0){var E=String(a.D).match(ym)[1]||null;!E&&l.self&&l.self.location&&(E=l.self.location.protocol.slice(0,-1)),p=!Ry.test(E?E.toLowerCase():"")}d=p}if(d)nt(a,"complete"),nt(a,"success");else{a.m=6;try{var S=2<sn(a)?a.g.statusText:""}catch{S=""}a.l=S+" ["+a.Z()+"]",Sm(a)}}finally{Do(a)}}}}function Do(a,u){if(a.g){Pm(a);let d=a.g,p=a.v[0]?()=>{}:null;a.g=null,a.v=null,u||nt(a,"ready");try{d.onreadystatechange=p}catch{}}}function Pm(a){a.I&&(l.clearTimeout(a.I),a.I=null)}i.isActive=function(){return!!this.g};function sn(a){return a.g?a.g.readyState:0}i.Z=function(){try{return 2<sn(this)?this.g.status:-1}catch{return-1}},i.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.Oa=function(a){if(this.g){var u=this.g.responseText;return a&&u.indexOf(a)==0&&(u=u.substring(a.length)),cy(u)}};function Rm(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function ky(a){let u={};a=(a.g&&2<=sn(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<a.length;p++){if(Q(a[p]))continue;var d=I(a[p]);let E=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let S=u[E]||[];u[E]=S,S.push(d)}w(u,function(p){return p.join(", ")})}i.Ba=function(){return this.m},i.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ls(a,u,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||u}function Dm(a){this.Aa=0,this.i=[],this.j=new es,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ls("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ls("baseRetryDelayMs",5e3,a),this.cb=ls("retryDelaySeedMs",1e4,a),this.Wa=ls("forwardChannelMaxRetries",2,a),this.wa=ls("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new dm(a&&a.concurrentRequestLimit),this.Da=new xy,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}i=Dm.prototype,i.la=8,i.G=1,i.connect=function(a,u,d,p){it(0),this.W=a,this.H=u||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.I=Bm(this,null,this.W),Vo(this)};function rc(a){if(km(a),a.G==3){var u=a.U++,d=rn(a.I);if(we(d,"SID",a.K),we(d,"RID",u),we(d,"TYPE","terminate"),cs(a,d),u=new In(a,a.j,u),u.L=2,u.v=Po(rn(d)),d=!1,l.navigator&&l.navigator.sendBeacon)try{d=l.navigator.sendBeacon(u.v.toString(),"")}catch{}!d&&l.Image&&(new Image().src=u.v,d=!0),d||(u.g=Um(u.j,null),u.g.ea(u.v)),u.F=Date.now(),Ao(u)}zm(a)}function ko(a){a.g&&(oc(a),a.g.cancel(),a.g=null)}function km(a){ko(a),a.u&&(l.clearTimeout(a.u),a.u=null),Oo(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&l.clearTimeout(a.s),a.s=null)}function Vo(a){if(!mm(a.h)&&!a.s){a.s=!0;var u=a.Ga;$r||Gd(),Hr||($r(),Hr=!0),Fl.add(u,a),a.B=0}}function Vy(a,u){return pm(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=u.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=Zr(_(a.Ga,a,u),Lm(a,a.B)),a.B++,!0)}i.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let E=new In(this,this.j,a),S=this.o;if(this.S&&(S?(S=g(S),T(S,this.S)):S=this.S),this.m!==null||this.O||(E.H=S,S=null),this.P)e:{for(var u=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(u+=p,4096<u){u=d;break e}if(u===4096||d===this.i.length-1){u=d+1;break e}}u=1e3}else u=1e3;u=Om(this,E,u),d=rn(this.I),we(d,"RID",a),we(d,"CVER",22),this.D&&we(d,"X-HTTP-Session-Id",this.D),cs(this,d),S&&(this.O?u="headers="+encodeURIComponent(String(Cm(S)))+"&"+u:this.m&&ic(d,this.m,S)),nc(this.h,E),this.Ua&&we(d,"TYPE","init"),this.P?(we(d,"$req",u),we(d,"SID","null"),E.T=!0,Jl(E,d,null)):Jl(E,d,u),this.G=2}}else this.G==3&&(a?Vm(this,a):this.i.length==0||mm(this.h)||Vm(this))};function Vm(a,u){var d;u?d=u.l:d=a.U++;let p=rn(a.I);we(p,"SID",a.K),we(p,"RID",d),we(p,"AID",a.T),cs(a,p),a.m&&a.o&&ic(p,a.m,a.o),d=new In(a,a.j,d,a.B+1),a.m===null&&(d.H=a.o),u&&(a.i=u.D.concat(a.i)),u=Om(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),nc(a.h,d),Jl(d,p,u)}function cs(a,u){a.H&&ee(a.H,function(d,p){we(u,p,d)}),a.l&&_m({},function(d,p){we(u,p,d)})}function Om(a,u,d){d=Math.min(a.i.length,d);var p=a.l?_(a.l.Na,a.l,a):null;e:{var E=a.i;let S=-1;for(;;){let F=["count="+d];S==-1?0<d?(S=E[0].g,F.push("ofs="+S)):S=0:F.push("ofs="+S);let fe=!0;for(let Ke=0;Ke<d;Ke++){let he=E[Ke].g,Je=E[Ke].map;if(he-=S,0>he)S=Math.max(0,E[Ke].g-100),fe=!1;else try{Py(Je,F,"req"+he+"_")}catch{p&&p(Je)}}if(fe){p=F.join("&");break e}}}return a=a.i.splice(0,d),u.D=a,p}function Nm(a){if(!a.g&&!a.u){a.Y=1;var u=a.Fa;$r||Gd(),Hr||($r(),Hr=!0),Fl.add(u,a),a.v=0}}function sc(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=Zr(_(a.Fa,a),Lm(a,a.v)),a.v++,!0)}i.Fa=function(){if(this.u=null,Mm(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Zr(_(this.ab,this),a)}},i.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,it(10),ko(this),Mm(this))};function oc(a){a.A!=null&&(l.clearTimeout(a.A),a.A=null)}function Mm(a){a.g=new In(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var u=rn(a.qa);we(u,"RID","rpc"),we(u,"SID",a.K),we(u,"AID",a.T),we(u,"CI",a.F?"0":"1"),!a.F&&a.ja&&we(u,"TO",a.ja),we(u,"TYPE","xmlhttp"),cs(a,u),a.m&&a.o&&ic(u,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=Po(rn(u)),d.m=null,d.P=!0,cm(d,a)}i.Za=function(){this.C!=null&&(this.C=null,ko(this),sc(this),it(19))};function Oo(a){a.C!=null&&(l.clearTimeout(a.C),a.C=null)}function Fm(a,u){var d=null;if(a.g==u){Oo(a),oc(a),a.g=null;var p=2}else if(tc(a.h,u))d=u.D,fm(a.h,u),p=1;else return;if(a.G!=0){if(u.o)if(p==1){d=u.m?u.m.length:0,u=Date.now()-u.F;var E=a.B;p=Eo(),nt(p,new sm(p,d)),Vo(a)}else Nm(a);else if(E=u.s,E==3||E==0&&0<u.X||!(p==1&&Vy(a,u)||p==2&&sc(a)))switch(d&&0<d.length&&(u=a.h,u.i=u.i.concat(d)),E){case 1:ii(a,5);break;case 4:ii(a,10);break;case 3:ii(a,6);break;default:ii(a,2)}}}function Lm(a,u){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*u}function ii(a,u){if(a.j.info("Error code "+u),u==2){var d=_(a.fb,a),p=a.Xa;let E=!p;p=new ni(p||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||So(p,"https"),Po(p),E?Ay(p.toString(),d):Sy(p.toString(),d)}else it(2);a.G=0,a.l&&a.l.sa(u),zm(a),km(a)}i.fb=function(a){a?(this.j.info("Successfully pinged google.com"),it(2)):(this.j.info("Failed to ping google.com"),it(1))};function zm(a){if(a.G=0,a.ka=[],a.l){let u=gm(a.h);(u.length!=0||a.i.length!=0)&&(R(a.ka,u),R(a.ka,a.i),a.h.i.length=0,O(a.i),a.i.length=0),a.l.ra()}}function Bm(a,u,d){var p=d instanceof ni?rn(d):new ni(d);if(p.g!="")u&&(p.g=u+"."+p.g),xo(p,p.s);else{var E=l.location;p=E.protocol,u=u?u+"."+E.hostname:E.hostname,E=+E.port;var S=new ni(null);p&&So(S,p),u&&(S.g=u),E&&xo(S,E),d&&(S.l=d),p=S}return d=a.D,u=a.ya,d&&u&&we(p,d,u),we(p,"VER",a.la),cs(a,p),p}function Um(a,u,d){if(u&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=a.Ca&&!a.pa?new Se(new ss({eb:d})):new Se(a.pa),u.Ha(a.J),u}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function qm(){}i=qm.prototype,i.ua=function(){},i.ta=function(){},i.sa=function(){},i.ra=function(){},i.isActive=function(){return!0},i.Na=function(){};function No(){}No.prototype.g=function(a,u){return new _t(a,u)};function _t(a,u){Xe.call(this),this.g=new Dm(u),this.l=a,this.h=u&&u.messageUrlParams||null,a=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(a?a["X-WebChannel-Content-Type"]=u.messageContentType:a={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(a?a["X-WebChannel-Client-Profile"]=u.va:a={"X-WebChannel-Client-Profile":u.va}),this.g.S=a,(a=u&&u.Sb)&&!Q(a)&&(this.g.m=a),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!Q(u)&&(this.g.D=u,a=this.h,a!==null&&u in a&&(a=this.h,u in a&&delete a[u])),this.j=new ji(this)}k(_t,Xe),_t.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},_t.prototype.close=function(){rc(this.g)},_t.prototype.o=function(a){var u=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.u&&(d={},d.__data__=$l(a),a=d);u.i.push(new gy(u.Ya++,a)),u.G==3&&Vo(u)},_t.prototype.N=function(){this.g.l=null,delete this.j,rc(this.g),delete this.g,_t.aa.N.call(this)};function jm(a){Ql.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var u=a.__sm__;if(u){e:{for(let d in u){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,u=u!==null&&a in u?u[a]:void 0),this.data=u}else this.data=a}k(jm,Ql);function Gm(){Wl.call(this),this.status=1}k(Gm,Wl);function ji(a){this.g=a}k(ji,qm),ji.prototype.ua=function(){nt(this.g,"a")},ji.prototype.ta=function(a){nt(this.g,new jm(a))},ji.prototype.sa=function(a){nt(this.g,new Gm)},ji.prototype.ra=function(){nt(this.g,"b")},No.prototype.createWebChannel=No.prototype.g,_t.prototype.send=_t.prototype.o,_t.prototype.open=_t.prototype.m,_t.prototype.close=_t.prototype.close,zc=hn.createWebChannelTransport=function(){return new No},Lc=hn.getStatEventTarget=function(){return Eo()},Fc=hn.Event=ei,da=hn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},bo.NO_ERROR=0,bo.TIMEOUT=8,bo.HTTP_ERROR=6,Cs=hn.ErrorCode=bo,om.COMPLETE="complete",Mc=hn.EventType=om,tm.EventType=Xr,Xr.OPEN="a",Xr.CLOSE="b",Xr.ERROR="c",Xr.MESSAGE="d",Xe.prototype.listen=Xe.prototype.K,rr=hn.WebChannel=tm,b1=hn.FetchXmlHttpFactory=ss,Se.prototype.listenOnce=Se.prototype.L,Se.prototype.getLastError=Se.prototype.Ka,Se.prototype.getLastErrorCode=Se.prototype.Ba,Se.prototype.getStatus=Se.prototype.Z,Se.prototype.getResponseJson=Se.prototype.Oa,Se.prototype.getResponseText=Se.prototype.oa,Se.prototype.send=Se.prototype.ea,Se.prototype.setWithCredentials=Se.prototype.Ha,Nc=hn.XhrIo=Se}).apply(typeof ha<"u"?ha:typeof self<"u"?self:typeof window<"u"?window:{});var tf="@firebase/firestore";var Le=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Le.UNAUTHENTICATED=new Le(null),Le.GOOGLE_CREDENTIALS=new Le("google-credentials-uid"),Le.FIRST_PARTY=new Le("first-party-uid"),Le.MOCK_USER=new Le("mock-user");var Nr="10.14.0";var Un=new ea("@firebase/firestore");function cr(){return Un.logLevel}function sg(i){Un.setLogLevel(i)}function V(i,...e){if(Un.logLevel<=Kt.DEBUG){let t=e.map(Gh);Un.debug(`Firestore (${Nr}): ${i}`,...t)}}function ke(i,...e){if(Un.logLevel<=Kt.ERROR){let t=e.map(Gh);Un.error(`Firestore (${Nr}): ${i}`,...t)}}function Ft(i,...e){if(Un.logLevel<=Kt.WARN){let t=e.map(Gh);Un.warn(`Firestore (${Nr}): ${i}`,...t)}}function Gh(i){if(typeof i=="string")return i;try{return function(t){return JSON.stringify(t)}(i)}catch{return i}}function j(i="Unexpected state"){let e=`FIRESTORE (${Nr}) INTERNAL ASSERTION FAILED: `+i;throw ke(e),new Error(e)}function G(i,e){i||j()}function og(i,e){i||j()}function B(i,e){return i}var x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},D=class extends xp{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var je=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Ia=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Kc=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Le.UNAUTHENTICATED))}shutdown(){}},$c=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Hc=class{constructor(e){this.t=e,this.currentUser=Le.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){G(this.o===void 0);let n=this.i,r=c=>this.i!==n?(n=this.i,t(c)):Promise.resolve(),s=new je;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new je,e.enqueueRetryable(()=>r(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(()=>P(this,null,function*(){yield c.promise,yield r(this.currentUser)}))},l=c=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?l(c):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new je)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(G(typeof n.accessToken=="string"),new Ia(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return G(e===null||typeof e=="string"),new Le(e)}},Qc=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Le.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Wc=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Qc(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Le.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Yc=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Xc=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){G(this.o===void 0);let n=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,V("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};let r=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?r(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(G(typeof t.token=="string"),this.R=t.token,new Yc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function C1(i){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<i;n++)t[n]=Math.floor(256*Math.random());return t}var Ea=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let r=C1(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<t&&(n+=e.charAt(r[s]%e.length))}return n}};function J(i,e){return i<e?-1:i>e?1:0}function yr(i,e,t){return i.length===e.length&&i.every((n,r)=>t(n,e[r]))}function ag(i){return i+"\0"}var Ce=class i{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new D(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return i.fromMillis(Date.now())}static fromDate(e){return i.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new i(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var K=class i{constructor(e){this.timestamp=e}static fromTimestamp(e){return new i(e)}static min(){return new i(new Ce(0,0))}static max(){return new i(new Ce(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var ba=class i{constructor(e,t,n){t===void 0?t=0:t>e.length&&j(),n===void 0?n=e.length-t:n>e.length-t&&j(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return i.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof i?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let s=e.get(r),o=t.get(r);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ae=class i extends ba{construct(e,t,n){return new i(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new D(x.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(r=>r.length>0))}return new i(t)}static emptyPath(){return new i([])}},A1=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ve=class i extends ba{construct(e,t,n){return new i(e,t,n)}static isValidIdentifier(e){return A1.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),i.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new i(["__name__"])}static fromServerFormat(e){let t=[],n="",r=0,s=()=>{if(n.length===0)throw new D(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},o=!1;for(;r<e.length;){let l=e[r];if(l==="\\"){if(r+1===e.length)throw new D(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[r+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new D(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,r+=2}else l==="`"?(o=!o,r++):l!=="."||o?(n+=l,r++):(s(),r++)}if(s(),o)throw new D(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new i(t)}static emptyPath(){return new i([])}};var U=class i{constructor(e){this.path=e}static fromPath(e){return new i(ae.fromString(e))}static fromName(e){return new i(ae.fromString(e).popFirst(5))}static empty(){return new i(ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ae.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new i(new ae(e.slice()))}};var vr=class{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}};function Jc(i){return i.fields.find(e=>e.kind===2)}function gi(i){return i.fields.filter(e=>e.kind!==2)}vr.UNKNOWN_ID=-1;var fr=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Fs=class i{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new i(0,Rt.min())}};function lg(i,e){let t=i.toTimestamp().seconds,n=i.toTimestamp().nanoseconds+1,r=K.fromTimestamp(n===1e9?new Ce(t+1,0):new Ce(t,n));return new Rt(r,U.empty(),e)}function cg(i){return new Rt(i.readTime,i.key,-1)}var Rt=class i{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new i(K.min(),U.empty(),-1)}static max(){return new i(K.max(),U.empty(),-1)}};function Kh(i,e){let t=i.readTime.compareTo(e.readTime);return t!==0?t:(t=U.comparator(i.documentKey,e.documentKey),t!==0?t:J(i.largestBatchId,e.largestBatchId))}var ug="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ca=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Xn(i){return P(this,null,function*(){if(i.code!==x.FAILED_PRECONDITION||i.message!==ug)throw i;V("LocalStore","Unexpectedly lost primary lease")})}var A=class i{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&j(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new i((n,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof i?t:i.resolve(t)}catch(t){return i.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):i.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):i.reject(t)}static resolve(e){return new i((t,n)=>{t(e)})}static reject(e){return new i((t,n)=>{n(e)})}static waitFor(e){return new i((t,n)=>{let r=0,s=0,o=!1;e.forEach(l=>{++r,l.next(()=>{++s,o&&s===r&&t()},c=>n(c))}),o=!0,s===r&&t()})}static or(e){let t=i.resolve(!1);for(let n of e)t=t.next(r=>r?i.resolve(r):n());return t}static forEach(e,t){let n=[];return e.forEach((r,s)=>{n.push(t.call(this,r,s))}),this.waitFor(n)}static mapArray(e,t){return new i((n,r)=>{let s=e.length,o=new Array(s),l=0;for(let c=0;c<s;c++){let h=c;t(e[h]).next(m=>{o[h]=m,++l,l===s&&n(o)},m=>r(m))}})}static doWhile(e,t){return new i((n,r)=>{let s=()=>{e()===!0?t().next(()=>{s()},r):n()};s()})}};var Aa=class i{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new je,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ii(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{let r=$h(n.target.error);this.V.reject(new Ii(e,r))}}static open(e,t,n,r){try{return new i(t,e.transaction(r,n))}catch(s){throw new Ii(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(V("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new eu(t)}},qn=class i{constructor(e,t,n){this.name=e,this.version=t,this.p=n,i.S(vs())===12.2&&ke("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return V("SimpleDb","Removing database:",e),_i(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Zo())return!1;if(i.v())return!0;let e=vs(),t=i.S(e),n=0<t&&t<10,r=hg(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){return P(this,null,function*(){return this.db||(V("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=s=>{let o=s.target.result;t(o)},r.onblocked=()=>{n(new Ii(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=s=>{let o=s.target.error;o.name==="VersionError"?n(new D(x.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?n(new D(x.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):n(new Ii(e,o))},r.onupgradeneeded=s=>{V("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,r.transaction,s.oldVersion,this.version).next(()=>{V("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,r){return P(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let l=Aa.open(this.db,e,s?"readonly":"readwrite",n),c=r(l).next(h=>(l.g(),h)).catch(h=>(l.abort(h),A.reject(h))).toPromise();return c.catch(()=>{}),yield l.m,c}catch(l){let c=l,h=c.name!=="FirebaseError"&&o<3;if(V("SimpleDb","Transaction failed with error:",c.message,"Retrying:",h),this.close(),!h)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function hg(i){let e=i.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Zc=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return _i(this.B.delete())}},Ii=class extends D{constructor(e,t){super(x.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Jn(i){return i.name==="IndexedDbTransactionError"}var eu=class{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(V("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(V("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),_i(n)}add(e){return V("SimpleDb","ADD",this.store.name,e,e),_i(this.store.add(e))}get(e){return _i(this.store.get(e)).next(t=>(t===void 0&&(t=null),V("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return V("SimpleDb","DELETE",this.store.name,e),_i(this.store.delete(e))}count(){return V("SimpleDb","COUNT",this.store.name),_i(this.store.count())}U(e,t){let n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if(typeof r.getAll=="function"){let s=r.getAll(n.range);return new A((o,l)=>{s.onerror=c=>{l(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(n),o=[];return this.W(s,(l,c)=>{o.push(c)}).next(()=>o)}}G(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new A((r,s)=>{n.onerror=o=>{s(o.target.error)},n.onsuccess=o=>{r(o.target.result)}})}j(e,t){V("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.H=!1;let r=this.cursor(n);return this.W(r,(s,o,l)=>l.delete())}J(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.W(r,t)}Y(e){let t=this.cursor({});return new A((n,r)=>{t.onerror=s=>{let o=$h(s.target.error);r(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(l=>{l?o.continue():n()}):n()}})}W(e,t){let n=[];return new A((r,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let l=o.target.result;if(!l)return void r();let c=new Zc(l),h=t(l.primaryKey,l.value,c);if(h instanceof A){let m=h.catch(f=>(c.done(),A.reject(f)));n.push(m)}c.isDone?r():c.K===null?l.continue():l.continue(c.K)}}).next(()=>A.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function _i(i){return new A((e,t)=>{i.onsuccess=n=>{let r=n.target.result;e(r)},i.onerror=n=>{let r=$h(n.target.error);t(r)}})}var nf=!1;function $h(i){let e=qn.S(vs());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(i.message.indexOf(t)>=0){let n=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return nf||(nf=!0,setTimeout(()=>{throw n},0)),n}}return i}var tu=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){V("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>P(this,null,function*(){this.task=null;try{V("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){Jn(t)?V("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield Xn(t)}yield this.X(6e4)}))}},nu=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return P(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let n=new Set,r=t,s=!0;return A.doWhile(()=>s===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!n.has(o))return V("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,r).next(l=>{r-=l,n.add(o)});s=!1})).next(()=>t-r)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(r,s)).next(l=>(V("IndexBackfiller",`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,t,l))).next(()=>o.size)}))}re(e,t){let n=e;return t.changes.forEach((r,s)=>{let o=cg(s);Kh(o,n)>0&&(n=o)}),new Rt(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}};var wt=(()=>{class i{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return i.oe=-1,i})();function ro(i){return i==null}function Ls(i){return i===0&&1/i==-1/0}function dg(i){return typeof i=="number"&&Number.isInteger(i)&&!Ls(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}function st(i){let e="";for(let t=0;t<i.length;t++)e.length>0&&(e=rf(e)),e=S1(i.get(t),e);return rf(e)}function S1(i,e){let t=e,n=i.length;for(let r=0;r<n;r++){let s=i.charAt(r);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function rf(i){return i+""}function $t(i){let e=i.length;if(G(e>=2),e===2)return G(i.charAt(0)===""&&i.charAt(1)===""),ae.emptyPath();let t=e-2,n=[],r="";for(let s=0;s<e;){let o=i.indexOf("",s);switch((o<0||o>t)&&j(),i.charAt(o+1)){case"":let l=i.substring(s,o),c;r.length===0?c=l:(r+=l,c=r,r=""),n.push(c);break;case"":r+=i.substring(s,o),r+="\0";break;case"":r+=i.substring(s,o+1);break;default:j()}s=o+2}return new ae(n)}var sf=["userId","batchId"];function _a(i,e){return[i,st(e)]}function mg(i,e,t){return[i,st(e),t]}var x1={},P1=["prefixPath","collectionGroup","readTime","documentId"],R1=["prefixPath","collectionGroup","documentId"],D1=["collectionGroup","readTime","prefixPath","documentId"],k1=["canonicalId","targetId"],V1=["targetId","path"],O1=["path","targetId"],N1=["collectionId","parent"],M1=["indexId","uid"],F1=["uid","sequenceNumber"],L1=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],z1=["indexId","uid","orderedDocumentKey"],B1=["userId","collectionPath","documentId"],U1=["userId","collectionPath","largestBatchId"],q1=["userId","collectionGroup","largestBatchId"],pg=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],j1=[...pg,"documentOverlays"],fg=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],gg=fg,Hh=[...gg,"indexConfiguration","indexState","indexEntries"],G1=Hh,K1=[...Hh,"globals"];var zs=class extends Ca{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function Ge(i,e){let t=B(i);return qn.F(t._e,e)}function of(i){let e=0;for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&e++;return e}function Oi(i,e){for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&e(t,i[t])}function _g(i){for(let e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}var Te=class i{constructor(e,t){this.comparator=e,this.root=t||Qt.EMPTY}insert(e,t){return new i(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Qt.BLACK,null,null))}remove(e){return new i(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Qt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(r===0)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new pr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new pr(this.root,e,this.comparator,!1)}getReverseIterator(){return new pr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new pr(this.root,e,this.comparator,!0)}},pr=class{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Qt=class i{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=n??i.RED,this.left=r??i.EMPTY,this.right=s??i.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new i(e??this.key,t??this.value,n??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return i.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return i.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,i.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,i.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw j();let e=this.left.check();if(e!==this.right.check())throw j();return e+(this.isRed()?0:1)}};Qt.EMPTY=null,Qt.RED=!0,Qt.BLACK=!1;Qt.EMPTY=new class{constructor(){this.size=0}get key(){throw j()}get value(){throw j()}get color(){throw j()}get left(){throw j()}get right(){throw j()}copy(e,t,n,r,s){return this}insert(e,t,n){return new Qt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var ge=class i{constructor(e){this.comparator=e,this.data=new Te(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Sa(this.data.getIterator())}getIteratorFrom(e){return new Sa(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof i)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=n.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new i(this.comparator);return t.data=e,t}},Sa=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function sr(i){return i.hasNext()?i.getNext():void 0}var Tt=class i{constructor(e){this.fields=e,e.sort(Ve.comparator)}static empty(){return new i([])}unionWith(e){let t=new ge(Ve.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new i(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return yr(this.fields,e.fields,(t,n)=>t.isEqual(n))}};var xa=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function yg(){return typeof atob<"u"}var Ne=class i{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new xa("Invalid base64 string: "+s):s}}(e);return new i(t)}static fromUint8Array(e){let t=function(r){let s="";for(let o=0;o<r.length;++o)s+=String.fromCharCode(r[o]);return s}(e);return new i(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return J(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ne.EMPTY_BYTE_STRING=new Ne("");var $1=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function pn(i){if(G(!!i),typeof i=="string"){let e=0,t=$1.exec(i);if(G(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}let n=new Date(i);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Ie(i.seconds),nanos:Ie(i.nanos)}}function Ie(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function jn(i){return typeof i=="string"?Ne.fromBase64String(i):Ne.fromUint8Array(i)}function vl(i){var e,t;return((t=(((e=i?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Qh(i){let e=i.mapValue.fields.__previous_value__;return vl(e)?Qh(e):e}function Bs(i){let e=pn(i.mapValue.fields.__local_write_time__.timestampValue);return new Ce(e.seconds,e.nanos)}var iu=class{constructor(e,t,n,r,s,o,l,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=h}},Gn=class i{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new i("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof i&&e.projectId===this.projectId&&e.database===this.database}};var zn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},ya={nullValue:"NULL_VALUE"};function Ei(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?vl(i)?4:vg(i)?9007199254740991:wl(i)?10:11:j()}function Xt(i,e){if(i===e)return!0;let t=Ei(i);if(t!==Ei(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===e.booleanValue;case 4:return Bs(i).isEqual(Bs(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;let o=pn(r.timestampValue),l=pn(s.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(i,e);case 5:return i.stringValue===e.stringValue;case 6:return function(r,s){return jn(r.bytesValue).isEqual(jn(s.bytesValue))}(i,e);case 7:return i.referenceValue===e.referenceValue;case 8:return function(r,s){return Ie(r.geoPointValue.latitude)===Ie(s.geoPointValue.latitude)&&Ie(r.geoPointValue.longitude)===Ie(s.geoPointValue.longitude)}(i,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return Ie(r.integerValue)===Ie(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){let o=Ie(r.doubleValue),l=Ie(s.doubleValue);return o===l?Ls(o)===Ls(l):isNaN(o)&&isNaN(l)}return!1}(i,e);case 9:return yr(i.arrayValue.values||[],e.arrayValue.values||[],Xt);case 10:case 11:return function(r,s){let o=r.mapValue.fields||{},l=s.mapValue.fields||{};if(of(o)!==of(l))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!Xt(o[c],l[c])))return!1;return!0}(i,e);default:return j()}}function Us(i,e){return(i.values||[]).find(t=>Xt(t,e))!==void 0}function Kn(i,e){if(i===e)return 0;let t=Ei(i),n=Ei(e);if(t!==n)return J(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return J(i.booleanValue,e.booleanValue);case 2:return function(s,o){let l=Ie(s.integerValue||s.doubleValue),c=Ie(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(i,e);case 3:return af(i.timestampValue,e.timestampValue);case 4:return af(Bs(i),Bs(e));case 5:return J(i.stringValue,e.stringValue);case 6:return function(s,o){let l=jn(s),c=jn(o);return l.compareTo(c)}(i.bytesValue,e.bytesValue);case 7:return function(s,o){let l=s.split("/"),c=o.split("/");for(let h=0;h<l.length&&h<c.length;h++){let m=J(l[h],c[h]);if(m!==0)return m}return J(l.length,c.length)}(i.referenceValue,e.referenceValue);case 8:return function(s,o){let l=J(Ie(s.latitude),Ie(o.latitude));return l!==0?l:J(Ie(s.longitude),Ie(o.longitude))}(i.geoPointValue,e.geoPointValue);case 9:return lf(i.arrayValue,e.arrayValue);case 10:return function(s,o){var l,c,h,m;let f=s.fields||{},_=o.fields||{},b=(l=f.value)===null||l===void 0?void 0:l.arrayValue,k=(c=_.value)===null||c===void 0?void 0:c.arrayValue,O=J(((h=b?.values)===null||h===void 0?void 0:h.length)||0,((m=k?.values)===null||m===void 0?void 0:m.length)||0);return O!==0?O:lf(b,k)}(i.mapValue,e.mapValue);case 11:return function(s,o){if(s===zn.mapValue&&o===zn.mapValue)return 0;if(s===zn.mapValue)return 1;if(o===zn.mapValue)return-1;let l=s.fields||{},c=Object.keys(l),h=o.fields||{},m=Object.keys(h);c.sort(),m.sort();for(let f=0;f<c.length&&f<m.length;++f){let _=J(c[f],m[f]);if(_!==0)return _;let b=Kn(l[c[f]],h[m[f]]);if(b!==0)return b}return J(c.length,m.length)}(i.mapValue,e.mapValue);default:throw j()}}function af(i,e){if(typeof i=="string"&&typeof e=="string"&&i.length===e.length)return J(i,e);let t=pn(i),n=pn(e),r=J(t.seconds,n.seconds);return r!==0?r:J(t.nanos,n.nanos)}function lf(i,e){let t=i.values||[],n=e.values||[];for(let r=0;r<t.length&&r<n.length;++r){let s=Kn(t[r],n[r]);if(s)return s}return J(t.length,n.length)}function wr(i){return ru(i)}function ru(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?function(t){let n=pn(t);return`time(${n.seconds},${n.nanos})`}(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?function(t){return jn(t).toBase64()}(i.bytesValue):"referenceValue"in i?function(t){return U.fromName(t).toString()}(i.referenceValue):"geoPointValue"in i?function(t){return`geo(${t.latitude},${t.longitude})`}(i.geoPointValue):"arrayValue"in i?function(t){let n="[",r=!0;for(let s of t.values||[])r?r=!1:n+=",",n+=ru(s);return n+"]"}(i.arrayValue):"mapValue"in i?function(t){let n=Object.keys(t.fields||{}).sort(),r="{",s=!0;for(let o of n)s?s=!1:r+=",",r+=`${o}:${ru(t.fields[o])}`;return r+"}"}(i.mapValue):j()}function bi(i,e){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${e.path.canonicalString()}`}}function su(i){return!!i&&"integerValue"in i}function qs(i){return!!i&&"arrayValue"in i}function cf(i){return!!i&&"nullValue"in i}function uf(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function va(i){return!!i&&"mapValue"in i}function wl(i){var e,t;return((t=(((e=i?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function ks(i){if(i.geoPointValue)return{geoPointValue:Object.assign({},i.geoPointValue)};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:Object.assign({},i.timestampValue)};if(i.mapValue){let e={mapValue:{fields:{}}};return Oi(i.mapValue.fields,(t,n)=>e.mapValue.fields[t]=ks(n)),e}if(i.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(i.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ks(i.arrayValue.values[t]);return e}return Object.assign({},i)}function vg(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var wg={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function H1(i){return"nullValue"in i?ya:"booleanValue"in i?{booleanValue:!1}:"integerValue"in i||"doubleValue"in i?{doubleValue:NaN}:"timestampValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in i?{stringValue:""}:"bytesValue"in i?{bytesValue:""}:"referenceValue"in i?bi(Gn.empty(),U.empty()):"geoPointValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in i?{arrayValue:{}}:"mapValue"in i?wl(i)?wg:{mapValue:{}}:j()}function Q1(i){return"nullValue"in i?{booleanValue:!1}:"booleanValue"in i?{doubleValue:NaN}:"integerValue"in i||"doubleValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in i?{stringValue:""}:"stringValue"in i?{bytesValue:""}:"bytesValue"in i?bi(Gn.empty(),U.empty()):"referenceValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in i?{arrayValue:{}}:"arrayValue"in i?wg:"mapValue"in i?wl(i)?{mapValue:{}}:zn:j()}function hf(i,e){let t=Kn(i.value,e.value);return t!==0?t:i.inclusive&&!e.inclusive?-1:!i.inclusive&&e.inclusive?1:0}function df(i,e){let t=Kn(i.value,e.value);return t!==0?t:i.inclusive&&!e.inclusive?1:!i.inclusive&&e.inclusive?-1:0}var tt=class i{constructor(e){this.value=e}static empty(){return new i({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!va(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ks(t)}setAll(e){let t=Ve.emptyPath(),n={},r=[];e.forEach((o,l)=>{if(!t.isImmediateParentOf(l)){let c=this.getFieldsMap(t);this.applyChanges(c,n,r),n={},r=[],t=l.popLast()}o?n[l.lastSegment()]=ks(o):r.push(l.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,n,r)}delete(e){let t=this.field(e.popLast());va(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Xt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];va(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Oi(t,(r,s)=>e[r]=s);for(let r of n)delete e[r]}clone(){return new i(ks(this.value))}};function Tg(i){let e=[];return Oi(i.fields,(t,n)=>{let r=new Ve([t]);if(va(n)){let s=Tg(n.mapValue).fields;if(s.length===0)e.push(r);else for(let o of s)e.push(r.child(o))}else e.push(r)}),new Tt(e)}var ze=class i{constructor(e,t,n,r,s,o,l){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=o,this.documentState=l}static newInvalidDocument(e){return new i(e,0,K.min(),K.min(),K.min(),tt.empty(),0)}static newFoundDocument(e,t,n,r){return new i(e,1,t,K.min(),n,r,0)}static newNoDocument(e,t){return new i(e,2,t,K.min(),K.min(),tt.empty(),0)}static newUnknownDocument(e,t){return new i(e,3,t,K.min(),K.min(),tt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(K.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=tt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=tt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=K.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof i&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new i(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Jt=class{constructor(e,t){this.position=e,this.inclusive=t}};function mf(i,e,t){let n=0;for(let r=0;r<i.position.length;r++){let s=e[r],o=i.position[r];if(s.field.isKeyField()?n=U.comparator(U.fromName(o.referenceValue),t.key):n=Kn(o,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function pf(i,e){if(i===null)return e===null;if(e===null||i.inclusive!==e.inclusive||i.position.length!==e.position.length)return!1;for(let t=0;t<i.position.length;t++)if(!Xt(i.position[t],e.position[t]))return!1;return!0}var Ci=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function W1(i,e){return i.dir===e.dir&&i.field.isEqual(e.field)}var Pa=class{},ie=class i extends Pa{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new lu(e,t,n):t==="array-contains"?new hu(e,n):t==="in"?new Ra(e,n):t==="not-in"?new du(e,n):t==="array-contains-any"?new mu(e,n):new i(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new cu(e,n):new uu(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Kn(t,this.value)):t!==null&&Ei(this.value)===Ei(t)&&this.matchesComparison(Kn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return j()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},me=class i extends Pa{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new i(e,t)}matches(e){return Tr(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Tr(i){return i.op==="and"}function ou(i){return i.op==="or"}function Wh(i){return Ig(i)&&Tr(i)}function Ig(i){for(let e of i.filters)if(e instanceof me)return!1;return!0}function au(i){if(i instanceof ie)return i.field.canonicalString()+i.op.toString()+wr(i.value);if(Wh(i))return i.filters.map(e=>au(e)).join(",");{let e=i.filters.map(t=>au(t)).join(",");return`${i.op}(${e})`}}function Eg(i,e){return i instanceof ie?function(n,r){return r instanceof ie&&n.op===r.op&&n.field.isEqual(r.field)&&Xt(n.value,r.value)}(i,e):i instanceof me?function(n,r){return r instanceof me&&n.op===r.op&&n.filters.length===r.filters.length?n.filters.reduce((s,o,l)=>s&&Eg(o,r.filters[l]),!0):!1}(i,e):void j()}function bg(i,e){let t=i.filters.concat(e);return me.create(t,i.op)}function Cg(i){return i instanceof ie?function(t){return`${t.field.canonicalString()} ${t.op} ${wr(t.value)}`}(i):i instanceof me?function(t){return t.op.toString()+" {"+t.getFilters().map(Cg).join(" ,")+"}"}(i):"Filter"}var lu=class extends ie{constructor(e,t,n){super(e,t,n),this.key=U.fromName(n.referenceValue)}matches(e){let t=U.comparator(e.key,this.key);return this.matchesComparison(t)}},cu=class extends ie{constructor(e,t){super(e,"in",t),this.keys=Ag("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},uu=class extends ie{constructor(e,t){super(e,"not-in",t),this.keys=Ag("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Ag(i,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>U.fromName(n.referenceValue))}var hu=class extends ie{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return qs(t)&&Us(t.arrayValue,this.value)}},Ra=class extends ie{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Us(this.value.arrayValue,t)}},du=class extends ie{constructor(e,t){super(e,"not-in",t)}matches(e){if(Us(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Us(this.value.arrayValue,t)}},mu=class extends ie{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!qs(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Us(this.value.arrayValue,n))}};var pu=class{constructor(e,t=null,n=[],r=[],s=null,o=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=o,this.endAt=l,this.ue=null}};function fu(i,e=null,t=[],n=[],r=null,s=null,o=null){return new pu(i,e,t,n,r,s,o)}function Ai(i){let e=B(i);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>au(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),ro(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>wr(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>wr(n)).join(",")),e.ue=t}return e.ue}function so(i,e){if(i.limit!==e.limit||i.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<i.orderBy.length;t++)if(!W1(i.orderBy[t],e.orderBy[t]))return!1;if(i.filters.length!==e.filters.length)return!1;for(let t=0;t<i.filters.length;t++)if(!Eg(i.filters[t],e.filters[t]))return!1;return i.collectionGroup===e.collectionGroup&&!!i.path.isEqual(e.path)&&!!pf(i.startAt,e.startAt)&&pf(i.endAt,e.endAt)}function Da(i){return U.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}function ka(i,e){return i.filters.filter(t=>t instanceof ie&&t.field.isEqual(e))}function ff(i,e,t){let n=ya,r=!0;for(let s of ka(i,e)){let o=ya,l=!0;switch(s.op){case"<":case"<=":o=H1(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,l=!1;break;case"!=":case"not-in":o=ya}hf({value:n,inclusive:r},{value:o,inclusive:l})<0&&(n=o,r=l)}if(t!==null){for(let s=0;s<i.orderBy.length;++s)if(i.orderBy[s].field.isEqual(e)){let o=t.position[s];hf({value:n,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(n=o,r=t.inclusive);break}}return{value:n,inclusive:r}}function gf(i,e,t){let n=zn,r=!0;for(let s of ka(i,e)){let o=zn,l=!0;switch(s.op){case">=":case">":o=Q1(s.value),l=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,l=!1;break;case"!=":case"not-in":o=zn}df({value:n,inclusive:r},{value:o,inclusive:l})>0&&(n=o,r=l)}if(t!==null){for(let s=0;s<i.orderBy.length;++s)if(i.orderBy[s].field.isEqual(e)){let o=t.position[s];df({value:n,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(n=o,r=t.inclusive);break}}return{value:n,inclusive:r}}var Lt=class{constructor(e,t=null,n=[],r=[],s=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=o,this.startAt=l,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function Sg(i,e,t,n,r,s,o,l){return new Lt(i,e,t,n,r,s,o,l)}function Mr(i){return new Lt(i)}function _f(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function Yh(i){return i.collectionGroup!==null}function gr(i){let e=B(i);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new ge(Ve.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(l=l.add(h.field))})}),l})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Ci(s,n))}),t.has(Ve.keyField().canonicalString())||e.ce.push(new Ci(Ve.keyField(),n))}return e.ce}function ot(i){let e=B(i);return e.le||(e.le=Y1(e,gr(i))),e.le}function Y1(i,e){if(i.limitType==="F")return fu(i.path,i.collectionGroup,e,i.filters,i.limit,i.startAt,i.endAt);{e=e.map(r=>{let s=r.dir==="desc"?"asc":"desc";return new Ci(r.field,s)});let t=i.endAt?new Jt(i.endAt.position,i.endAt.inclusive):null,n=i.startAt?new Jt(i.startAt.position,i.startAt.inclusive):null;return fu(i.path,i.collectionGroup,e,i.filters,i.limit,t,n)}}function gu(i,e){let t=i.filters.concat([e]);return new Lt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),t,i.limit,i.limitType,i.startAt,i.endAt)}function Va(i,e,t){return new Lt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),e,t,i.startAt,i.endAt)}function oo(i,e){return so(ot(i),ot(e))&&i.limitType===e.limitType}function xg(i){return`${Ai(ot(i))}|lt:${i.limitType}`}function ur(i){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(r=>Cg(r)).join(", ")}]`),ro(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(r=>wr(r)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(r=>wr(r)).join(",")),`Target(${n})`}(ot(i))}; limitType=${i.limitType})`}function ao(i,e){return e.isFoundDocument()&&function(n,r){let s=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):U.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(i,e)&&function(n,r){for(let s of gr(n))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(i,e)&&function(n,r){for(let s of n.filters)if(!s.matches(r))return!1;return!0}(i,e)&&function(n,r){return!(n.startAt&&!function(o,l,c){let h=mf(o,l,c);return o.inclusive?h<=0:h<0}(n.startAt,gr(n),r)||n.endAt&&!function(o,l,c){let h=mf(o,l,c);return o.inclusive?h>=0:h>0}(n.endAt,gr(n),r))}(i,e)}function Pg(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function Rg(i){return(e,t)=>{let n=!1;for(let r of gr(i)){let s=X1(r,e,t);if(s!==0)return s;n=n||r.field.isKeyField()}return 0}}function X1(i,e,t){let n=i.field.isKeyField()?U.comparator(e.key,t.key):function(s,o,l){let c=o.data.field(s),h=l.data.field(s);return c!==null&&h!==null?Kn(c,h):j()}(i.field,e,t);switch(i.dir){case"asc":return n;case"desc":return-1*n;default:return j()}}var Zt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[r,s]of n)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return n.length===1?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Oi(this.inner,(t,n)=>{for(let[r,s]of n)e(r,s)})}isEmpty(){return _g(this.inner)}size(){return this.innerSize}};var J1=new Te(U.comparator);function gt(){return J1}var Dg=new Te(U.comparator);function Rs(...i){let e=Dg;for(let t of i)e=e.insert(t.key,t);return e}function kg(i){let e=Dg;return i.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Ht(){return Vs()}function Vg(){return Vs()}function Vs(){return new Zt(i=>i.toString(),(i,e)=>i.isEqual(e))}var Z1=new Te(U.comparator),ev=new ge(U.comparator);function te(...i){let e=ev;for(let t of i)e=e.add(t);return e}var tv=new ge(J);function Xh(){return tv}function Jh(i,e){if(i.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ls(e)?"-0":e}}function Og(i){return{integerValue:""+i}}function Ng(i,e){return dg(e)?Og(e):Jh(i,e)}var Ir=class{constructor(){this._=void 0}};function nv(i,e,t){return i instanceof $n?function(r,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&vl(s)&&(s=Qh(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):i instanceof fn?Fg(i,e):i instanceof gn?Lg(i,e):function(r,s){let o=Mg(r,s),l=yf(o)+yf(r.Pe);return su(o)&&su(r.Pe)?Og(l):Jh(r.serializer,l)}(i,e)}function iv(i,e,t){return i instanceof fn?Fg(i,e):i instanceof gn?Lg(i,e):t}function Mg(i,e){return i instanceof Hn?function(n){return su(n)||function(s){return!!s&&"doubleValue"in s}(n)}(e)?e:{integerValue:0}:null}var $n=class extends Ir{},fn=class extends Ir{constructor(e){super(),this.elements=e}};function Fg(i,e){let t=zg(e);for(let n of i.elements)t.some(r=>Xt(r,n))||t.push(n);return{arrayValue:{values:t}}}var gn=class extends Ir{constructor(e){super(),this.elements=e}};function Lg(i,e){let t=zg(e);for(let n of i.elements)t=t.filter(r=>!Xt(r,n));return{arrayValue:{values:t}}}var Hn=class extends Ir{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function yf(i){return Ie(i.integerValue||i.doubleValue)}function zg(i){return qs(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}var Si=class{constructor(e,t){this.field=e,this.transform=t}};function rv(i,e){return i.field.isEqual(e.field)&&function(n,r){return n instanceof fn&&r instanceof fn||n instanceof gn&&r instanceof gn?yr(n.elements,r.elements,Xt):n instanceof Hn&&r instanceof Hn?Xt(n.Pe,r.Pe):n instanceof $n&&r instanceof $n}(i.transform,e.transform)}var _u=class{constructor(e,t){this.version=e,this.transformResults=t}},Re=class i{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new i}static exists(e){return new i(void 0,e)}static updateTime(e){return new i(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function wa(i,e){return i.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(i.updateTime):i.exists===void 0||i.exists===e.isFoundDocument()}var Er=class{};function Bg(i,e){if(!i.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return i.isNoDocument()?new Wn(i.key,Re.none()):new Qn(i.key,i.data,Re.none());{let t=i.data,n=tt.empty(),r=new ge(Ve.comparator);for(let s of e.fields)if(!r.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?n.delete(s):n.set(s,o),r=r.add(s)}return new zt(i.key,n,new Tt(r.toArray()),Re.none())}}function sv(i,e,t){i instanceof Qn?function(r,s,o){let l=r.value.clone(),c=wf(r.fieldTransforms,s,o.transformResults);l.setAll(c),s.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(i,e,t):i instanceof zt?function(r,s,o){if(!wa(r.precondition,s))return void s.convertToUnknownDocument(o.version);let l=wf(r.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(Ug(r)),c.setAll(l),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(i,e,t):function(r,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Os(i,e,t,n){return i instanceof Qn?function(s,o,l,c){if(!wa(s.precondition,o))return l;let h=s.value.clone(),m=Tf(s.fieldTransforms,c,o);return h.setAll(m),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(i,e,t,n):i instanceof zt?function(s,o,l,c){if(!wa(s.precondition,o))return l;let h=Tf(s.fieldTransforms,c,o),m=o.data;return m.setAll(Ug(s)),m.setAll(h),o.convertToFoundDocument(o.version,m).setHasLocalMutations(),l===null?null:l.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(f=>f.field))}(i,e,t,n):function(s,o,l){return wa(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(i,e,t)}function ov(i,e){let t=null;for(let n of i.fieldTransforms){let r=e.data.field(n.field),s=Mg(n.transform,r||null);s!=null&&(t===null&&(t=tt.empty()),t.set(n.field,s))}return t||null}function vf(i,e){return i.type===e.type&&!!i.key.isEqual(e.key)&&!!i.precondition.isEqual(e.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&yr(n,r,(s,o)=>rv(s,o))}(i.fieldTransforms,e.fieldTransforms)&&(i.type===0?i.value.isEqual(e.value):i.type!==1||i.data.isEqual(e.data)&&i.fieldMask.isEqual(e.fieldMask))}var Qn=class extends Er{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}},zt=class extends Er{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Ug(i){let e=new Map;return i.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=i.data.field(t);e.set(t,n)}}),e}function wf(i,e,t){let n=new Map;G(i.length===t.length);for(let r=0;r<t.length;r++){let s=i[r],o=s.transform,l=e.data.field(s.field);n.set(s.field,iv(o,l,t[r]))}return n}function Tf(i,e,t){let n=new Map;for(let r of i){let s=r.transform,o=t.data.field(r.field);n.set(r.field,nv(s,o,e))}return n}var Wn=class extends Er{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},js=class extends Er{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Gs=class{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){let s=this.mutations[r];s.key.isEqual(e.key)&&sv(s,e,n[r])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=Os(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=Os(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=Vg();return this.mutations.forEach(r=>{let s=e.get(r.key),o=s.overlayedDocument,l=this.applyToLocalView(o,s.mutatedFields);l=t.has(r.key)?null:l;let c=Bg(o,l);c!==null&&n.set(r.key,c),o.isValidDocument()||o.convertToNoDocument(K.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),te())}isEqual(e){return this.batchId===e.batchId&&yr(this.mutations,e.mutations,(t,n)=>vf(t,n))&&yr(this.baseMutations,e.baseMutations,(t,n)=>vf(t,n))}},yu=class i{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){G(e.mutations.length===n.length);let r=function(){return Z1}(),s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,n[o].version);return new i(e,t,n,r)}};var Ks=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var vu=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Me,oe;function qg(i){switch(i){default:return j();case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0}}function jg(i){if(i===void 0)return ke("GRPC error has no .code"),x.UNKNOWN;switch(i){case Me.OK:return x.OK;case Me.CANCELLED:return x.CANCELLED;case Me.UNKNOWN:return x.UNKNOWN;case Me.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case Me.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case Me.INTERNAL:return x.INTERNAL;case Me.UNAVAILABLE:return x.UNAVAILABLE;case Me.UNAUTHENTICATED:return x.UNAUTHENTICATED;case Me.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case Me.NOT_FOUND:return x.NOT_FOUND;case Me.ALREADY_EXISTS:return x.ALREADY_EXISTS;case Me.PERMISSION_DENIED:return x.PERMISSION_DENIED;case Me.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case Me.ABORTED:return x.ABORTED;case Me.OUT_OF_RANGE:return x.OUT_OF_RANGE;case Me.UNIMPLEMENTED:return x.UNIMPLEMENTED;case Me.DATA_LOSS:return x.DATA_LOSS;default:return j()}}(oe=Me||(Me={}))[oe.OK=0]="OK",oe[oe.CANCELLED=1]="CANCELLED",oe[oe.UNKNOWN=2]="UNKNOWN",oe[oe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",oe[oe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",oe[oe.NOT_FOUND=5]="NOT_FOUND",oe[oe.ALREADY_EXISTS=6]="ALREADY_EXISTS",oe[oe.PERMISSION_DENIED=7]="PERMISSION_DENIED",oe[oe.UNAUTHENTICATED=16]="UNAUTHENTICATED",oe[oe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",oe[oe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",oe[oe.ABORTED=10]="ABORTED",oe[oe.OUT_OF_RANGE=11]="OUT_OF_RANGE",oe[oe.UNIMPLEMENTED=12]="UNIMPLEMENTED",oe[oe.INTERNAL=13]="INTERNAL",oe[oe.UNAVAILABLE=14]="UNAVAILABLE",oe[oe.DATA_LOSS=15]="DATA_LOSS";var If=null;function Gg(){return new TextEncoder}var av=new On([4294967295,4294967295],0);function Ef(i){let e=Gg().encode(i),t=new Oc;return t.update(e),new Uint8Array(t.digest())}function bf(i){let e=new DataView(i.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new On([t,n],0),new On([r,s],0)]}var wu=class i{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Ti(`Invalid padding: ${t}`);if(n<0)throw new Ti(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new Ti(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new Ti(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=On.fromNumber(this.Ie)}Ee(e,t,n){let r=e.add(t.multiply(On.fromNumber(n)));return r.compare(av)===1&&(r=new On([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=Ef(e),[n,r]=bf(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(n,r,s);if(!this.de(o))return!1}return!0}static create(e,t,n){let r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new i(s,r,t);return n.forEach(l=>o.insert(l)),o}insert(e){if(this.Ie===0)return;let t=Ef(e),[n,r]=bf(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(n,r,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},Ti=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var $s=class i{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,Hs.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new i(K.min(),r,new Te(J),gt(),te())}},Hs=class i{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new i(n,t,te(),te(),te())}};var _r=class{constructor(e,t,n,r){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=r}},Oa=class{constructor(e,t){this.targetId=e,this.me=t}},Na=class{constructor(e,t,n=Ne.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}},Ma=class{constructor(){this.fe=0,this.ge=Af(),this.pe=Ne.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=te(),t=te(),n=te();return this.ge.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:j()}}),new Hs(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=Af()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,G(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Tu=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=gt(),this.qe=Cf(),this.Qe=new Te(J)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:j()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,r)=>{this.ze(r)&&t(r)})}He(e){let t=e.targetId,n=e.me.count,r=this.Je(t);if(r){let s=r.target;if(Da(s))if(n===0){let o=new U(s.path);this.Ue(t,o,ze.newNoDocument(o,K.min()))}else G(n===1);else{let o=this.Ye(t);if(o!==n){let l=this.Ze(e),c=l?this.Xe(l,e,o):1;if(c!==0){this.je(t);let h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,h)}If?.et(function(m,f,_,b,k){var O,R,$,Q,z,W;let Z={localCacheCount:m,existenceFilterCount:f.count,databaseId:_.database,projectId:_.projectId},ee=f.unchangedNames;return ee&&(Z.bloomFilter={applied:k===0,hashCount:(O=ee?.hashCount)!==null&&O!==void 0?O:0,bitmapLength:(Q=($=(R=ee?.bits)===null||R===void 0?void 0:R.bitmap)===null||$===void 0?void 0:$.length)!==null&&Q!==void 0?Q:0,padding:(W=(z=ee?.bits)===null||z===void 0?void 0:z.padding)!==null&&W!==void 0?W:0,mightContain:w=>{var g;return(g=b?.mightContain(w))!==null&&g!==void 0&&g}}),Z}(o,e.me,this.Le.tt(),l,c))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=t,o,l;try{o=jn(n).toUint8Array()}catch(c){if(c instanceof xa)return Ft("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new wu(o,r,s)}catch(c){return Ft(c instanceof Ti?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.Ie===0?null:l}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){let n=this.Le.getRemoteKeysForTarget(t),r=0;return n.forEach(s=>{let o=this.Le.tt(),l=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(l)||(this.Ue(t,s,null),r++)}),r}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let l=this.Je(o);if(l){if(s.current&&Da(l.target)){let c=new U(l.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,ze.newNoDocument(c,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let n=te();this.qe.forEach((s,o)=>{let l=!0;o.forEachWhile(c=>{let h=this.Je(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(n=n.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let r=new $s(e,t,this.Qe,this.ke,n);return this.ke=gt(),this.qe=Cf(),this.Qe=new Te(J),r}$e(e,t){if(!this.ze(e))return;let n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;let r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Ma,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ge(J),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Ma),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function Cf(){return new Te(U.comparator)}function Af(){return new Te(U.comparator)}var lv={asc:"ASCENDING",desc:"DESCENDING"},cv={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},uv={and:"AND",or:"OR"},Iu=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Eu(i,e){return i.useProto3Json||ro(e)?e:{value:e}}function br(i,e){return i.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Kg(i,e){return i.useProto3Json?e.toBase64():e.toUint8Array()}function hv(i,e){return br(i,e.toTimestamp())}function Oe(i){return G(!!i),K.fromTimestamp(function(t){let n=pn(t);return new Ce(n.seconds,n.nanos)}(i))}function Zh(i,e){return bu(i,e).canonicalString()}function bu(i,e){let t=function(r){return new ae(["projects",r.projectId,"databases",r.database])}(i).child("documents");return e===void 0?t:t.child(e)}function $g(i){let e=ae.fromString(i);return G(n_(e)),e}function Qs(i,e){return Zh(i.databaseId,e.path)}function Wt(i,e){let t=$g(e);if(t.get(1)!==i.databaseId.projectId)throw new D(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+i.databaseId.projectId);if(t.get(3)!==i.databaseId.database)throw new D(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+i.databaseId.database);return new U(Wg(t))}function Hg(i,e){return Zh(i.databaseId,e)}function Qg(i){let e=$g(i);return e.length===4?ae.emptyPath():Wg(e)}function Cu(i){return new ae(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function Wg(i){return G(i.length>4&&i.get(4)==="documents"),i.popFirst(5)}function Sf(i,e,t){return{name:Qs(i,e),fields:t.value.mapValue.fields}}function Yg(i,e,t){let n=Wt(i,e.name),r=Oe(e.updateTime),s=e.createTime?Oe(e.createTime):K.min(),o=new tt({mapValue:{fields:e.fields}}),l=ze.newFoundDocument(n,r,s,o);return t&&l.setHasCommittedMutations(),t?l.setHasCommittedMutations():l}function dv(i,e){return"found"in e?function(n,r){G(!!r.found),r.found.name,r.found.updateTime;let s=Wt(n,r.found.name),o=Oe(r.found.updateTime),l=r.found.createTime?Oe(r.found.createTime):K.min(),c=new tt({mapValue:{fields:r.found.fields}});return ze.newFoundDocument(s,o,l,c)}(i,e):"missing"in e?function(n,r){G(!!r.missing),G(!!r.readTime);let s=Wt(n,r.missing),o=Oe(r.readTime);return ze.newNoDocument(s,o)}(i,e):j()}function mv(i,e){let t;if("targetChange"in e){e.targetChange;let n=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:j()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(h,m){return h.useProto3Json?(G(m===void 0||typeof m=="string"),Ne.fromBase64String(m||"")):(G(m===void 0||m instanceof Buffer||m instanceof Uint8Array),Ne.fromUint8Array(m||new Uint8Array))}(i,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(h){let m=h.code===void 0?x.UNKNOWN:jg(h.code);return new D(m,h.message||"")}(o);t=new Na(n,r,s,l||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let r=Wt(i,n.document.name),s=Oe(n.document.updateTime),o=n.document.createTime?Oe(n.document.createTime):K.min(),l=new tt({mapValue:{fields:n.document.fields}}),c=ze.newFoundDocument(r,s,o,l),h=n.targetIds||[],m=n.removedTargetIds||[];t=new _r(h,m,c.key,c)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let r=Wt(i,n.document),s=n.readTime?Oe(n.readTime):K.min(),o=ze.newNoDocument(r,s),l=n.removedTargetIds||[];t=new _r([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let r=Wt(i,n.document),s=n.removedTargetIds||[];t=new _r([],s,r,null)}else{if(!("filter"in e))return j();{e.filter;let n=e.filter;n.targetId;let{count:r=0,unchangedNames:s}=n,o=new vu(r,s),l=n.targetId;t=new Oa(l,o)}}return t}function Ws(i,e){let t;if(e instanceof Qn)t={update:Sf(i,e.key,e.value)};else if(e instanceof Wn)t={delete:Qs(i,e.key)};else if(e instanceof zt)t={update:Sf(i,e.key,e.data),updateMask:vv(e.fieldMask)};else{if(!(e instanceof js))return j();t={verify:Qs(i,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,o){let l=o.transform;if(l instanceof $n)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof fn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof gn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Hn)return{fieldPath:o.field.canonicalString(),increment:l.Pe};throw j()}(0,n))),e.precondition.isNone||(t.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:hv(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:j()}(i,e.precondition)),t}function Au(i,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?Re.updateTime(Oe(s.updateTime)):s.exists!==void 0?Re.exists(s.exists):Re.none()}(e.currentDocument):Re.none(),n=e.updateTransforms?e.updateTransforms.map(r=>function(o,l){let c=null;if("setToServerValue"in l)G(l.setToServerValue==="REQUEST_TIME"),c=new $n;else if("appendMissingElements"in l){let m=l.appendMissingElements.values||[];c=new fn(m)}else if("removeAllFromArray"in l){let m=l.removeAllFromArray.values||[];c=new gn(m)}else"increment"in l?c=new Hn(o,l.increment):j();let h=Ve.fromServerFormat(l.fieldPath);return new Si(h,c)}(i,r)):[];if(e.update){e.update.name;let r=Wt(i,e.update.name),s=new tt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(c){let h=c.fieldPaths||[];return new Tt(h.map(m=>Ve.fromServerFormat(m)))}(e.updateMask);return new zt(r,s,o,t,n)}return new Qn(r,s,t,n)}if(e.delete){let r=Wt(i,e.delete);return new Wn(r,t)}if(e.verify){let r=Wt(i,e.verify);return new js(r,t)}return j()}function pv(i,e){return i&&i.length>0?(G(e!==void 0),i.map(t=>function(r,s){let o=r.updateTime?Oe(r.updateTime):Oe(s);return o.isEqual(K.min())&&(o=Oe(s)),new _u(o,r.transformResults||[])}(t,e))):[]}function Xg(i,e){return{documents:[Hg(i,e.path)]}}function Jg(i,e){let t={structuredQuery:{}},n=e.path,r;e.collectionGroup!==null?(r=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Hg(i,r);let s=function(h){if(h.length!==0)return t_(me.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(h){if(h.length!==0)return h.map(m=>function(_){return{field:hr(_.field),direction:gv(_.dir)}}(m))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let l=Eu(i,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:r}}function Zg(i){let e=Qg(i.parent),t=i.structuredQuery,n=t.from?t.from.length:0,r=null;if(n>0){G(n===1);let m=t.from[0];m.allDescendants?r=m.collectionId:e=e.child(m.collectionId)}let s=[];t.where&&(s=function(f){let _=e_(f);return _ instanceof me&&Wh(_)?_.getFilters():[_]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(_=>function(k){return new Ci(dr(k.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(_))}(t.orderBy));let l=null;t.limit&&(l=function(f){let _;return _=typeof f=="object"?f.value:f,ro(_)?null:_}(t.limit));let c=null;t.startAt&&(c=function(f){let _=!!f.before,b=f.values||[];return new Jt(b,_)}(t.startAt));let h=null;return t.endAt&&(h=function(f){let _=!f.before,b=f.values||[];return new Jt(b,_)}(t.endAt)),Sg(e,r,o,s,l,"F",c,h)}function fv(i,e){let t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return j()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function e_(i){return i.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=dr(t.unaryFilter.field);return ie.create(n,"==",{doubleValue:NaN});case"IS_NULL":let r=dr(t.unaryFilter.field);return ie.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=dr(t.unaryFilter.field);return ie.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=dr(t.unaryFilter.field);return ie.create(o,"!=",{nullValue:"NULL_VALUE"});default:return j()}}(i):i.fieldFilter!==void 0?function(t){return ie.create(dr(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return j()}}(t.fieldFilter.op),t.fieldFilter.value)}(i):i.compositeFilter!==void 0?function(t){return me.create(t.compositeFilter.filters.map(n=>e_(n)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return j()}}(t.compositeFilter.op))}(i):j()}function gv(i){return lv[i]}function _v(i){return cv[i]}function yv(i){return uv[i]}function hr(i){return{fieldPath:i.canonicalString()}}function dr(i){return Ve.fromServerFormat(i.fieldPath)}function t_(i){return i instanceof ie?function(t){if(t.op==="=="){if(uf(t.value))return{unaryFilter:{field:hr(t.field),op:"IS_NAN"}};if(cf(t.value))return{unaryFilter:{field:hr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(uf(t.value))return{unaryFilter:{field:hr(t.field),op:"IS_NOT_NAN"}};if(cf(t.value))return{unaryFilter:{field:hr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hr(t.field),op:_v(t.op),value:t.value}}}(i):i instanceof me?function(t){let n=t.getFilters().map(r=>t_(r));return n.length===1?n[0]:{compositeFilter:{op:yv(t.op),filters:n}}}(i):j()}function vv(i){let e=[];return i.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function n_(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}var Cr=class i{constructor(e,t,n,r,s=K.min(),o=K.min(),l=Ne.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new i(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Fa=class{constructor(e){this.ct=e}};function wv(i,e){let t;if(e.document)t=Yg(i.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let n=U.fromSegments(e.noDocument.path),r=Pi(e.noDocument.readTime);t=ze.newNoDocument(n,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return j();{let n=U.fromSegments(e.unknownDocument.path),r=Pi(e.unknownDocument.version);t=ze.newUnknownDocument(n,r)}}return e.readTime&&t.setReadTime(function(r){let s=new Ce(r[0],r[1]);return K.fromTimestamp(s)}(e.readTime)),t}function xf(i,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:La(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(s,o){return{name:Qs(s,o.key),fields:o.data.value.mapValue.fields,updateTime:br(s,o.version.toTimestamp()),createTime:br(s,o.createTime.toTimestamp())}}(i.ct,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:xi(e.version)};else{if(!e.isUnknownDocument())return j();n.unknownDocument={path:t.path.toArray(),version:xi(e.version)}}return n}function La(i){let e=i.toTimestamp();return[e.seconds,e.nanoseconds]}function xi(i){let e=i.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Pi(i){let e=new Ce(i.seconds,i.nanoseconds);return K.fromTimestamp(e)}function yi(i,e){let t=(e.baseMutations||[]).map(s=>Au(i.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let n=e.mutations.map(s=>Au(i.ct,s)),r=Ce.fromMillis(e.localWriteTimeMs);return new Gs(e.batchId,r,t,n)}function Ds(i){let e=Pi(i.readTime),t=i.lastLimboFreeSnapshotVersion!==void 0?Pi(i.lastLimboFreeSnapshotVersion):K.min(),n;return n=function(s){return s.documents!==void 0}(i.query)?function(s){return G(s.documents.length===1),ot(Mr(Qg(s.documents[0])))}(i.query):function(s){return ot(Zg(s))}(i.query),new Cr(n,i.targetId,"TargetPurposeListen",i.lastListenSequenceNumber,e,t,Ne.fromBase64String(i.resumeToken))}function i_(i,e){let t=xi(e.snapshotVersion),n=xi(e.lastLimboFreeSnapshotVersion),r;r=Da(e.target)?Xg(i.ct,e.target):Jg(i.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ai(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:r}}function ed(i){let e=Zg({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?Va(e,e.limit,"L"):e}function Bc(i,e){return new Ks(e.largestBatchId,Au(i.ct,e.overlayMutation))}function Pf(i,e){let t=e.path.lastSegment();return[i,st(e.path.popLast()),t]}function Rf(i,e,t,n){return{indexId:i,uid:e,sequenceNumber:t,readTime:xi(n.readTime),documentKey:st(n.documentKey.path),largestBatchId:n.largestBatchId}}var Su=class{getBundleMetadata(e,t){return Df(e).get(t).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:Pi(s.createTime),version:s.version}}(n)})}saveBundleMetadata(e,t){return Df(e).put(function(r){return{bundleId:r.id,createTime:xi(Oe(r.createTime)),version:r.version}}(t))}getNamedQuery(e,t){return kf(e).get(t).next(n=>{if(n)return function(s){return{name:s.name,query:ed(s.bundledQuery),readTime:Pi(s.readTime)}}(n)})}saveNamedQuery(e,t){return kf(e).put(function(r){return{name:r.name,readTime:xi(Oe(r.readTime)),bundledQuery:r.bundledQuery}}(t))}};function Df(i){return Ge(i,"bundles")}function kf(i){return Ge(i,"namedQueries")}var za=class i{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let n=t.uid||"";return new i(e,n)}getOverlay(e,t){return As(e).get(Pf(this.userId,t)).next(n=>n?Bc(this.serializer,n):null)}getOverlays(e,t){let n=Ht();return A.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&n.set(r,s)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((s,o)=>{let l=new Ks(t,o);r.push(this.ht(e,l))}),A.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(o=>r.add(st(o.getCollectionPath())));let s=[];return r.forEach(o=>{let l=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,n+1],!1,!0);s.push(As(e).j("collectionPathOverlayIndex",l))}),A.waitFor(s)}getOverlaysForCollection(e,t,n){let r=Ht(),s=st(t),o=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return As(e).U("collectionPathOverlayIndex",o).next(l=>{for(let c of l){let h=Bc(this.serializer,c);r.set(h.getKey(),h)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let s=Ht(),o,l=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return As(e).J({index:"collectionGroupOverlayIndex",range:l},(c,h,m)=>{let f=Bc(this.serializer,h);s.size()<r||f.largestBatchId===o?(s.set(f.getKey(),f),o=f.largestBatchId):m.done()}).next(()=>s)}ht(e,t){return As(e).put(function(r,s,o){let[l,c,h]=Pf(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Ws(r.ct,o.mutation)}}(this.serializer,this.userId,t))}};function As(i){return Ge(i,"documentOverlays")}var xu=class{Pt(e){return Ge(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let n=t?.value;return n?Ne.fromUint8Array(n):Ne.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var dn=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Ie(e.integerValue));else if("doubleValue"in e){let n=Ie(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),Ls(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),typeof n=="string"&&(n=pn(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(jn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?vg(e)?this.dt(t,Number.MAX_SAFE_INTEGER):wl(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):j()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let n=e.fields||{};this.dt(t,55);for(let r of Object.keys(n))this.Vt(r,t),this.Tt(n[r],t)}wt(e,t){var n,r;let s=e.fields||{};this.dt(t,53);let o="value",l=((r=(n=s[o].arrayValue)===null||n===void 0?void 0:n.values)===null||r===void 0?void 0:r.length)||0;this.dt(t,15),t.At(Ie(l)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let n=e.values||[];this.dt(t,50);for(let r of n)this.Tt(r,t)}yt(e,t){this.dt(t,37),U.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};dn.vt=new dn;function Tv(i){if(i===0)return 8;let e=0;return!(i>>4)&&(e+=4,i<<=4),!(i>>6)&&(e+=2,i<<=2),!(i>>7)&&(e+=1),e}function Vf(i){let e=64-function(n){let r=0;for(let s=0;s<8;++s){let o=Tv(255&n[s]);if(r+=o,o!==8)break}return r}(i);return Math.ceil(e/8)}var Pu=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{let r=t.codePointAt(0);this.Ft(240|r>>>18),this.Ft(128|63&r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r)}}this.Mt()}Bt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{let r=t.codePointAt(0);this.Ot(240|r>>>18),this.Ot(128|63&r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r)}}this.Nt()}kt(e){let t=this.qt(e),n=Vf(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Kt(e){let t=this.qt(e),n=Vf(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}},Ru=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},Du=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},vi=class{constructor(){this.jt=new Pu,this.Ht=new Ru(this.jt),this.Jt=new Du(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var wi=class i{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new i(this.indexId,this.documentKey,this.arrayValue,n)}};function Nn(i,e){let t=i.indexId-e.indexId;return t!==0?t:(t=Of(i.arrayValue,e.arrayValue),t!==0?t:(t=Of(i.directionalValue,e.directionalValue),t!==0?t:U.comparator(i.documentKey,e.documentKey)))}function Of(i,e){for(let t=0;t<i.length&&t<e.length;++t){let n=i[t]-e[t];if(n!==0)return n}return i.length-e.length}var Ba=class{constructor(e){this.Xt=new ge((t,n)=>Ve.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(G(e.collectionGroup===this.collectionId),this.nn)return!1;let t=Jc(e);if(t!==void 0&&!this.sn(t))return!1;let n=gi(e),r=new Set,s=0,o=0;for(;s<n.length&&this.sn(n[s]);++s)r=r.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Xt.size>0){let l=this.Xt.getIterator().getNext();if(!r.has(l.field.canonicalString())){let c=n[s];if(!this.on(l,c)||!this._n(this.en[o++],c))return!1}++s}for(;s<n.length;++s){let l=n[s];if(o>=this.en.length||!this._n(this.en[o++],l))return!1}return!0}an(){if(this.nn)return null;let e=new ge(Ve.comparator),t=[];for(let n of this.tn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new fr(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new fr(n.field,0))}for(let n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new fr(n.field,n.dir==="asc"?0:1)));return new vr(vr.UNKNOWN_ID,this.collectionId,t,Fs.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function r_(i){var e,t;if(G(i instanceof ie||i instanceof me),i instanceof ie){if(i instanceof Ra){let r=((t=(e=i.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ie.create(i.field,"==",s)))||[];return me.create(r,"or")}return i}let n=i.filters.map(r=>r_(r));return me.create(n,i.op)}function Iv(i){if(i.getFilters().length===0)return[];let e=Ou(r_(i));return G(s_(e)),ku(e)||Vu(e)?[e]:e.getFilters()}function ku(i){return i instanceof ie}function Vu(i){return i instanceof me&&Wh(i)}function s_(i){return ku(i)||Vu(i)||function(t){if(t instanceof me&&ou(t)){for(let n of t.getFilters())if(!ku(n)&&!Vu(n))return!1;return!0}return!1}(i)}function Ou(i){if(G(i instanceof ie||i instanceof me),i instanceof ie)return i;if(i.filters.length===1)return Ou(i.filters[0]);let e=i.filters.map(n=>Ou(n)),t=me.create(e,i.op);return t=Ua(t),s_(t)?t:(G(t instanceof me),G(Tr(t)),G(t.filters.length>1),t.filters.reduce((n,r)=>td(n,r)))}function td(i,e){let t;return G(i instanceof ie||i instanceof me),G(e instanceof ie||e instanceof me),t=i instanceof ie?e instanceof ie?function(r,s){return me.create([r,s],"and")}(i,e):Nf(i,e):e instanceof ie?Nf(e,i):function(r,s){if(G(r.filters.length>0&&s.filters.length>0),Tr(r)&&Tr(s))return bg(r,s.getFilters());let o=ou(r)?r:s,l=ou(r)?s:r,c=o.filters.map(h=>td(h,l));return me.create(c,"or")}(i,e),Ua(t)}function Nf(i,e){if(Tr(e))return bg(e,i.getFilters());{let t=e.filters.map(n=>td(i,n));return me.create(t,"or")}}function Ua(i){if(G(i instanceof ie||i instanceof me),i instanceof ie)return i;let e=i.getFilters();if(e.length===1)return Ua(e[0]);if(Ig(i))return i;let t=e.map(r=>Ua(r)),n=[];return t.forEach(r=>{r instanceof ie?n.push(r):r instanceof me&&(r.op===i.op?n.push(...r.filters):n.push(r))}),n.length===1?n[0]:me.create(n,i.op)}var Nu=class{constructor(){this.un=new Ys}addToCollectionParentIndex(e,t){return this.un.add(t),A.resolve()}getCollectionParents(e,t){return A.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return A.resolve()}deleteFieldIndex(e,t){return A.resolve()}deleteAllFieldIndexes(e){return A.resolve()}createTargetIndexes(e,t){return A.resolve()}getDocumentsMatchingTarget(e,t){return A.resolve(null)}getIndexType(e,t){return A.resolve(0)}getFieldIndexes(e,t){return A.resolve([])}getNextCollectionGroupToUpdate(e){return A.resolve(null)}getMinOffset(e,t){return A.resolve(Rt.min())}getMinOffsetFromCollectionGroup(e,t){return A.resolve(Rt.min())}updateCollectionGroup(e,t,n){return A.resolve()}updateIndexEntries(e,t){return A.resolve()}},Ys=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new ge(ae.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new ge(ae.comparator)).toArray()}};var ma=new Uint8Array(0),Mu=class{constructor(e,t){this.databaseId=t,this.cn=new Ys,this.ln=new Zt(n=>Ai(n),(n,r)=>so(n,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let s={collectionId:n,parent:st(r)};return Mf(e).put(s)}return A.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[ag(t),""],!1,!0);return Mf(e).U(r).next(s=>{for(let o of s){if(o.collectionId!==t)break;n.push($t(o.parent))}return n})}addFieldIndex(e,t){let n=Ss(e),r=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete r.indexId;let s=n.add(r);if(t.indexState){let o=ar(e);return s.next(l=>{o.put(Rf(l,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let n=Ss(e),r=ar(e),s=or(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Ss(e),n=or(e),r=ar(e);return t.j().next(()=>n.j()).next(()=>r.j())}createTargetIndexes(e,t){return A.forEach(this.hn(t),n=>this.getIndexType(e,n).next(r=>{if(r===0||r===1){let s=new Ba(n).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let n=or(e),r=!0,s=new Map;return A.forEach(this.hn(t),o=>this.Pn(e,o).next(l=>{r&&(r=!!l),s.set(o,l)})).next(()=>{if(r){let o=te(),l=[];return A.forEach(s,(c,h)=>{V("IndexedDbIndexManager",`Using index ${function(z){return`id=${z.indexId}|cg=${z.collectionGroup}|f=${z.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`}(c)} to execute ${Ai(t)}`);let m=function(z,W){let Z=Jc(W);if(Z===void 0)return null;for(let ee of ka(z,Z.fieldPath))switch(ee.op){case"array-contains-any":return ee.value.arrayValue.values||[];case"array-contains":return[ee.value]}return null}(h,c),f=function(z,W){let Z=new Map;for(let ee of gi(W))for(let w of ka(z,ee.fieldPath))switch(w.op){case"==":case"in":Z.set(ee.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return Z.set(ee.fieldPath.canonicalString(),w.value),Array.from(Z.values())}return null}(h,c),_=function(z,W){let Z=[],ee=!0;for(let w of gi(W)){let g=w.kind===0?ff(z,w.fieldPath,z.startAt):gf(z,w.fieldPath,z.startAt);Z.push(g.value),ee&&(ee=g.inclusive)}return new Jt(Z,ee)}(h,c),b=function(z,W){let Z=[],ee=!0;for(let w of gi(W)){let g=w.kind===0?gf(z,w.fieldPath,z.endAt):ff(z,w.fieldPath,z.endAt);Z.push(g.value),ee&&(ee=g.inclusive)}return new Jt(Z,ee)}(h,c),k=this.In(c,h,_),O=this.In(c,h,b),R=this.Tn(c,h,f),$=this.En(c.indexId,m,k,_.inclusive,O,b.inclusive,R);return A.forEach($,Q=>n.G(Q,t.limit).next(z=>{z.forEach(W=>{let Z=U.fromSegments(W.documentKey);o.has(Z)||(o=o.add(Z),l.push(Z))})}))}).next(()=>l)}return A.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=Iv(me.create(e.filters,"and")).map(n=>fu(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,r,s,o,l){let c=(t!=null?t.length:1)*Math.max(n.length,s.length),h=c/(t!=null?t.length:1),m=[];for(let f=0;f<c;++f){let _=t?this.dn(t[f/h]):ma,b=this.An(e,_,n[f%h],r),k=this.Rn(e,_,s[f%h],o),O=l.map(R=>this.An(e,_,R,!0));m.push(...this.createRange(b,k,O))}return m}An(e,t,n,r){let s=new wi(e,U.empty(),t,n);return r?s:s.Zt()}Rn(e,t,n,r){let s=new wi(e,U.empty(),t,n);return r?s.Zt():s}Pn(e,t){let n=new Ba(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(s=>{let o=null;for(let l of s)n.rn(l)&&(!o||l.fields.length>o.fields.length)&&(o=l);return o})}getIndexType(e,t){let n=2,r=this.hn(t);return A.forEach(r,s=>this.Pn(e,s).next(o=>{o?n!==0&&o.fields.length<function(c){let h=new ge(Ve.comparator),m=!1;for(let f of c.filters)for(let _ of f.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?m=!0:h=h.add(_.field));for(let f of c.orderBy)f.field.isKeyField()||(h=h.add(f.field));return h.size+(m?1:0)}(s)&&(n=1):n=0})).next(()=>function(o){return o.limit!==null}(t)&&r.length>1&&n===2?1:n)}Vn(e,t){let n=new vi;for(let r of gi(e)){let s=t.data.field(r.fieldPath);if(s==null)return null;let o=n.Yt(r.kind);dn.vt.It(s,o)}return n.zt()}dn(e){let t=new vi;return dn.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let n=new vi;return dn.vt.It(bi(this.databaseId,t),n.Yt(function(s){let o=gi(s);return o.length===0?0:o[o.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(n===null)return[];let r=[];r.push(new vi);let s=0;for(let o of gi(e)){let l=n[s++];for(let c of r)if(this.fn(t,o.fieldPath)&&qs(l))r=this.gn(r,o,l);else{let h=c.Yt(o.kind);dn.vt.It(l,h)}}return this.pn(r)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){let r=[...e],s=[];for(let o of n.arrayValue.values||[])for(let l of r){let c=new vi;c.seed(l.zt()),dn.vt.It(o,c.Yt(t.kind)),s.push(c)}return s}fn(e,t){return!!e.filters.find(n=>n instanceof ie&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=Ss(e),r=ar(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{let o=[];return A.forEach(s,l=>r.get([l.indexId,this.uid]).next(c=>{o.push(function(m,f){let _=f?new Fs(f.sequenceNumber,new Rt(Pi(f.readTime),new U($t(f.documentKey)),f.largestBatchId)):Fs.empty(),b=m.fields.map(([k,O])=>new fr(Ve.fromServerFormat(k),O));return new vr(m.indexId,m.collectionGroup,b,_)}(l,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,r)=>{let s=n.indexState.sequenceNumber-r.indexState.sequenceNumber;return s!==0?s:J(n.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=Ss(e),s=ar(e);return this.yn(e).next(o=>r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(l=>A.forEach(l,c=>s.put(Rf(c.indexId,this.uid,o,n)))))}updateIndexEntries(e,t){let n=new Map;return A.forEach(t,(r,s)=>{let o=n.get(r.collectionGroup);return(o?A.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(l=>(n.set(r.collectionGroup,l),A.forEach(l,c=>this.wn(e,r,c).next(h=>{let m=this.Sn(s,c);return h.isEqual(m)?A.resolve():this.bn(e,s,c,h,m)}))))})}Dn(e,t,n,r){return or(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,r){return or(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){let r=or(e),s=new ge(Nn);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(o,l)=>{s=s.add(new wi(n.indexId,t,l.arrayValue,l.directionalValue))}).next(()=>s)}Sn(e,t){let n=new ge(Nn),r=this.Vn(t,e);if(r==null)return n;let s=Jc(t);if(s!=null){let o=e.data.field(s.fieldPath);if(qs(o))for(let l of o.arrayValue.values||[])n=n.add(new wi(t.indexId,e.key,this.dn(l),r))}else n=n.add(new wi(t.indexId,e.key,ma,r));return n}bn(e,t,n,r,s){V("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(c,h,m,f,_){let b=c.getIterator(),k=h.getIterator(),O=sr(b),R=sr(k);for(;O||R;){let $=!1,Q=!1;if(O&&R){let z=m(O,R);z<0?Q=!0:z>0&&($=!0)}else O!=null?Q=!0:$=!0;$?(f(R),R=sr(k)):Q?(_(O),O=sr(b)):(O=sr(b),R=sr(k))}}(r,s,Nn,l=>{o.push(this.Dn(e,t,n,l))},l=>{o.push(this.vn(e,t,n,l))}),A.waitFor(o)}yn(e){let t=1;return ar(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,r,s)=>{s.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((o,l)=>Nn(o,l)).filter((o,l,c)=>!l||Nn(o,c[l-1])!==0);let r=[];r.push(e);for(let o of n){let l=Nn(o,e),c=Nn(o,t);if(l===0)r[0]=e.Zt();else if(l>0&&c<0)r.push(o),r.push(o.Zt());else if(c>0)break}r.push(t);let s=[];for(let o=0;o<r.length;o+=2){if(this.Cn(r[o],r[o+1]))return[];let l=[r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,ma,[]],c=[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,ma,[]];s.push(IDBKeyRange.bound(l,c))}return s}Cn(e,t){return Nn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Ff)}getMinOffset(e,t){return A.mapArray(this.hn(t),n=>this.Pn(e,n).next(r=>r||j())).next(Ff)}};function Mf(i){return Ge(i,"collectionParents")}function or(i){return Ge(i,"indexEntries")}function Ss(i){return Ge(i,"indexConfiguration")}function ar(i){return Ge(i,"indexState")}function Ff(i){G(i.length!==0);let e=i[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<i.length;n++){let r=i[n].indexState.offset;Kh(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new Rt(e.readTime,e.documentKey,t)}var Lf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Pt=class i{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new i(e,i.DEFAULT_COLLECTION_PERCENTILE,i.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function o_(i,e,t){let n=i.store("mutations"),r=i.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),l=0,c=n.J({range:o},(m,f,_)=>(l++,_.delete()));s.push(c.next(()=>{G(l===1)}));let h=[];for(let m of t.mutations){let f=mg(e,m.key.path,t.batchId);s.push(r.delete(f)),h.push(m.key)}return A.waitFor(s).next(()=>h)}function qa(i){if(!i)return 0;let e;if(i.document)e=i.document;else if(i.unknownDocument)e=i.unknownDocument;else{if(!i.noDocument)throw j();e=i.noDocument}return JSON.stringify(e).length}Pt.DEFAULT_COLLECTION_PERCENTILE=10,Pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pt.DEFAULT=new Pt(41943040,Pt.DEFAULT_COLLECTION_PERCENTILE,Pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pt.DISABLED=new Pt(-1,0,0);var ja=class i{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Fn={}}static lt(e,t,n,r){G(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new i(s,t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Mn(e).J({index:"userMutationsIndex",range:n},(r,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let s=mr(e),o=Mn(e);return o.add({}).next(l=>{G(typeof l=="number");let c=new Gs(l,t,n,r),h=function(b,k,O){let R=O.baseMutations.map(Q=>Ws(b.ct,Q)),$=O.mutations.map(Q=>Ws(b.ct,Q));return{userId:k,batchId:O.batchId,localWriteTimeMs:O.localWriteTime.toMillis(),baseMutations:R,mutations:$}}(this.serializer,this.userId,c),m=[],f=new ge((_,b)=>J(_.canonicalString(),b.canonicalString()));for(let _ of r){let b=mg(this.userId,_.key.path,l);f=f.add(_.key.path.popLast()),m.push(o.put(h)),m.push(s.put(b,x1))}return f.forEach(_=>{m.push(this.indexManager.addToCollectionParentIndex(e,_))}),e.addOnCommittedListener(()=>{this.Fn[l]=c.keys()}),A.waitFor(m).next(()=>c)})}lookupMutationBatch(e,t){return Mn(e).get(t).next(n=>n?(G(n.userId===this.userId),yi(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?A.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let r=n.keys();return this.Fn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),s=null;return Mn(e).J({index:"userMutationsIndex",range:r},(o,l,c)=>{l.userId===this.userId&&(G(l.batchId>=n),s=yi(this.serializer,l)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Mn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(r,s,o)=>{n=s.batchId,o.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Mn(e).U("userMutationsIndex",t).next(n=>n.map(r=>yi(this.serializer,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=_a(this.userId,t.path),r=IDBKeyRange.lowerBound(n),s=[];return mr(e).J({range:r},(o,l,c)=>{let[h,m,f]=o,_=$t(m);if(h===this.userId&&t.path.isEqual(_))return Mn(e).get(f).next(b=>{if(!b)throw j();G(b.userId===this.userId),s.push(yi(this.serializer,b))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ge(J),r=[];return t.forEach(s=>{let o=_a(this.userId,s.path),l=IDBKeyRange.lowerBound(o),c=mr(e).J({range:l},(h,m,f)=>{let[_,b,k]=h,O=$t(b);_===this.userId&&s.path.isEqual(O)?n=n.add(k):f.done()});r.push(c)}),A.waitFor(r).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,s=_a(this.userId,n),o=IDBKeyRange.lowerBound(s),l=new ge(J);return mr(e).J({range:o},(c,h,m)=>{let[f,_,b]=c,k=$t(_);f===this.userId&&n.isPrefixOf(k)?k.length===r&&(l=l.add(b)):m.done()}).next(()=>this.xn(e,l))}xn(e,t){let n=[],r=[];return t.forEach(s=>{r.push(Mn(e).get(s).next(o=>{if(o===null)throw j();G(o.userId===this.userId),n.push(yi(this.serializer,o))}))}),A.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return o_(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),A.forEach(n,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return A.resolve();let n=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),r=[];return mr(e).J({range:n},(s,o,l)=>{if(s[0]===this.userId){let c=$t(s[1]);r.push(c)}else l.done()}).next(()=>{G(r.length===0)})})}containsKey(e,t){return a_(e,this.userId,t)}Nn(e){return l_(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function a_(i,e,t){let n=_a(e,t.path),r=n[1],s=IDBKeyRange.lowerBound(n),o=!1;return mr(i).J({range:s,H:!0},(l,c,h)=>{let[m,f,_]=l;m===e&&f===r&&(o=!0),h.done()}).next(()=>o)}function Mn(i){return Ge(i,"mutations")}function mr(i){return Ge(i,"documentMutations")}function l_(i){return Ge(i,"mutationQueues")}var Ar=class i{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new i(0)}static kn(){return new i(-1)}};var Fu=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let n=new Ar(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>K.fromTimestamp(new Ce(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Qn(e,r)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>lr(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(G(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let r=0,s=[];return lr(e).J((o,l)=>{let c=Ds(l);c.sequenceNumber<=t&&n.get(c.targetId)===null&&(r++,s.push(this.removeTargetData(e,c)))}).next(()=>A.waitFor(s)).next(()=>r)}forEachTarget(e,t){return lr(e).J((n,r)=>{let s=Ds(r);t(s)})}qn(e){return zf(e).get("targetGlobalKey").next(t=>(G(t!==null),t))}Qn(e,t){return zf(e).put("targetGlobalKey",t)}Kn(e,t){return lr(e).put(i_(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let n=Ai(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return lr(e).J({range:r,index:"queryTargetsIndex"},(o,l,c)=>{let h=Ds(l);so(t,h.target)&&(s=h,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){let r=[],s=Fn(e);return t.forEach(o=>{let l=st(o.path);r.push(s.put({targetId:n,path:l})),r.push(this.referenceDelegate.addReference(e,n,o))}),A.waitFor(r)}removeMatchingKeys(e,t,n){let r=Fn(e);return A.forEach(t,s=>{let o=st(s.path);return A.waitFor([r.delete([n,o]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){let n=Fn(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Fn(e),s=te();return r.J({range:n,H:!0},(o,l,c)=>{let h=$t(o[1]),m=new U(h);s=s.add(m)}).next(()=>s)}containsKey(e,t){let n=st(t.path),r=IDBKeyRange.bound([n],[ag(n)],!1,!0),s=0;return Fn(e).J({index:"documentTargetsIndex",H:!0,range:r},([o,l],c,h)=>{o!==0&&(s++,h.done())}).next(()=>s>0)}ot(e,t){return lr(e).get(t).next(n=>n?Ds(n):null)}};function lr(i){return Ge(i,"targets")}function zf(i){return Ge(i,"targetGlobal")}function Fn(i){return Ge(i,"targetDocuments")}function Bf([i,e],[t,n]){let r=J(i,t);return r===0?J(e,n):r}var Lu=class{constructor(e){this.Un=e,this.buffer=new ge(Bf),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();Bf(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},zu=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){V("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>P(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Jn(t)?V("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield Xn(t)}yield this.Hn(3e5)}))}},Bu=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return A.resolve(wt.oe);let n=new Lu(t);return this.Jn.forEachTarget(e,r=>n.zn(r.sequenceNumber)).next(()=>this.Jn.Zn(e,r=>n.zn(r))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),A.resolve(Lf)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Lf):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,r,s,o,l,c,h,m=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),r=this.params.maximumSequenceNumbersToCollect):r=f,o=Date.now(),this.nthSequenceNumber(e,r))).next(f=>(n=f,l=Date.now(),this.removeTargets(e,n,t))).next(f=>(s=f,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(f=>(h=Date.now(),cr()<=Kt.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-m}ms
	Determined least recently used ${r} in `+(l-o)+`ms
	Removed ${s} targets in `+(c-l)+`ms
	Removed ${f} documents in `+(h-c)+`ms
Total Duration: ${h-m}ms`),A.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:f})))}};function Ev(i,e){return new Bu(i,e)}var Uu=class{constructor(e,t){this.db=e,this.garbageCollector=Ev(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(r=>n+r))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,r)=>t(r))}addReference(e,t,n){return pa(e,n)}removeReference(e,t,n){return pa(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return pa(e,t)}nr(e,t){return function(r,s){let o=!1;return l_(r).Y(l=>a_(r,l,s).next(c=>(c&&(o=!0),A.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],s=0;return this.tr(e,(o,l)=>{if(l<=t){let c=this.nr(e,o).next(h=>{if(!h)return s++,n.getEntry(e,o).next(()=>(n.removeEntry(o,K.min()),Fn(e).delete(function(f){return[0,st(f.path)]}(o))))});r.push(c)}}).next(()=>A.waitFor(r)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return pa(e,t)}tr(e,t){let n=Fn(e),r,s=wt.oe;return n.J({index:"documentTargetsIndex"},([o,l],{path:c,sequenceNumber:h})=>{o===0?(s!==wt.oe&&t(new U($t(r)),s),s=h,r=c):s=wt.oe}).next(()=>{s!==wt.oe&&t(new U($t(r)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function pa(i,e){return Fn(i).put(function(n,r){return{targetId:0,path:st(n.path),sequenceNumber:r}}(e,i.currentSequenceNumber))}var Ga=class{constructor(){this.changes=new Zt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ze.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?A.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var qu=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return fi(e).put(n)}removeEntry(e,t,n){return fi(e).delete(function(s,o){let l=s.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],La(o),l[l.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=ze.newInvalidDocument(t);return fi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(xs(t))},(r,s)=>{n=this.ir(t,s)}).next(()=>n)}sr(e,t){let n={size:0,document:ze.newInvalidDocument(t)};return fi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(xs(t))},(r,s)=>{n={document:this.ir(t,s),size:qa(s)}}).next(()=>n)}getEntries(e,t){let n=gt();return this._r(e,t,(r,s)=>{let o=this.ir(r,s);n=n.insert(r,o)}).next(()=>n)}ar(e,t){let n=gt(),r=new Te(U.comparator);return this._r(e,t,(s,o)=>{let l=this.ir(s,o);n=n.insert(s,l),r=r.insert(s,qa(o))}).next(()=>({documents:n,ur:r}))}_r(e,t,n){if(t.isEmpty())return A.resolve();let r=new ge(jf);t.forEach(c=>r=r.add(c));let s=IDBKeyRange.bound(xs(r.first()),xs(r.last())),o=r.getIterator(),l=o.getNext();return fi(e).J({index:"documentKeyIndex",range:s},(c,h,m)=>{let f=U.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;l&&jf(l,f)<0;)n(l,null),l=o.getNext();l&&l.isEqual(f)&&(n(l,h),l=o.hasNext()?o.getNext():null),l?m.$(xs(l)):m.done()}).next(()=>{for(;l;)n(l,null),l=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,s){let o=t.path,l=[o.popLast().toArray(),o.lastSegment(),La(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return fi(e).U(IDBKeyRange.bound(l,c,!0)).next(h=>{s?.incrementDocumentReadCount(h.length);let m=gt();for(let f of h){let _=this.ir(U.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);_.isFoundDocument()&&(ao(t,_)||r.has(_.key))&&(m=m.insert(_.key,_))}return m})}getAllFromCollectionGroup(e,t,n,r){let s=gt(),o=qf(t,n),l=qf(t,Rt.max());return fi(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,l,!0)},(c,h,m)=>{let f=this.ir(U.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(f.key,f),s.size===r&&m.done()}).next(()=>s)}newChangeBuffer(e){return new ju(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Uf(e).get("remoteDocumentGlobalKey").next(t=>(G(!!t),t))}rr(e,t){return Uf(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let n=wv(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(K.min())))return n}return ze.newInvalidDocument(e)}};function c_(i){return new qu(i)}var ju=class extends Ga{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Zt(n=>n.toString(),(n,r)=>n.isEqual(r))}applyChanges(e){let t=[],n=0,r=new ge((s,o)=>J(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let l=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,l.readTime)),o.isValidDocument()){let c=xf(this.cr.serializer,o);r=r.add(s.path.popLast());let h=qa(c);n+=h-l.size,t.push(this.cr.addEntry(e,s,c))}else if(n-=l.size,this.trackRemovals){let c=xf(this.cr.serializer,o.convertToNoDocument(K.min()));t.push(this.cr.addEntry(e,s,c))}}),r.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,n)),A.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:r})=>(r.forEach((s,o)=>{this.lr.set(s,{size:o,readTime:n.get(s).readTime})}),n))}};function Uf(i){return Ge(i,"remoteDocumentGlobal")}function fi(i){return Ge(i,"remoteDocumentsV14")}function xs(i){let e=i.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function qf(i,e){let t=e.documentKey.path.toArray();return[i,La(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function jf(i,e){let t=i.path.toArray(),n=e.path.toArray(),r=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(r=J(t[s],n[s]),r)return r;return r=J(t.length,n.length),r||(r=J(t[t.length-2],n[n.length-2]),r||J(t[t.length-1],n[n.length-1]))}var Gu=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Ka=class{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(n!==null&&Os(n.mutation,r,Tt.empty(),Ce.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,te()).next(()=>n))}getLocalViewOfDocuments(e,t,n=te()){let r=Ht();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(s=>{let o=Rs();return s.forEach((l,c)=>{o=o.insert(l,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let n=Ht();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,te()))}populateOverlays(e,t,n){let r=[];return n.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((o,l)=>{t.set(o,l)})})}computeViews(e,t,n,r){let s=gt(),o=Vs(),l=function(){return Vs()}();return t.forEach((c,h)=>{let m=n.get(h.key);r.has(h.key)&&(m===void 0||m.mutation instanceof zt)?s=s.insert(h.key,h):m!==void 0?(o.set(h.key,m.mutation.getFieldMask()),Os(m.mutation,h,m.mutation.getFieldMask(),Ce.now())):o.set(h.key,Tt.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((h,m)=>o.set(h,m)),t.forEach((h,m)=>{var f;return l.set(h,new Gu(m,(f=o.get(h))!==null&&f!==void 0?f:null))}),l))}recalculateAndSaveOverlays(e,t){let n=Vs(),r=new Te((o,l)=>o-l),s=te();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let l of o)l.keys().forEach(c=>{let h=t.get(c);if(h===null)return;let m=n.get(c)||Tt.empty();m=l.applyToLocalView(h,m),n.set(c,m);let f=(r.get(l.batchId)||te()).add(c);r=r.insert(l.batchId,f)})}).next(()=>{let o=[],l=r.getReverseIterator();for(;l.hasNext();){let c=l.getNext(),h=c.key,m=c.value,f=Vg();m.forEach(_=>{if(!s.has(_)){let b=Bg(t.get(_),n.get(_));b!==null&&f.set(_,b),s=s.add(_)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,f))}return A.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,r){return function(o){return U.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Yh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(s=>{let o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-s.size):A.resolve(Ht()),l=-1,c=s;return o.next(h=>A.forEach(h,(m,f)=>(l<f.largestBatchId&&(l=f.largestBatchId),s.get(m)?A.resolve():this.remoteDocumentCache.getEntry(e,m).next(_=>{c=c.insert(m,_)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,c,h,te())).next(m=>({batchId:l,changes:kg(m)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next(n=>{let r=Rs();return n.isFoundDocument()&&(r=r.insert(n.key,n)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let s=t.collectionGroup,o=Rs();return this.indexManager.getCollectionParents(e,s).next(l=>A.forEach(l,c=>{let h=function(f,_){return new Lt(_,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,n,r).next(m=>{m.forEach((f,_)=>{o=o.insert(f,_)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,r))).next(o=>{s.forEach((c,h)=>{let m=h.getKey();o.get(m)===null&&(o=o.insert(m,ze.newInvalidDocument(m)))});let l=Rs();return o.forEach((c,h)=>{let m=s.get(c);m!==void 0&&Os(m.mutation,h,Tt.empty(),Ce.now()),ao(t,h)&&(l=l.insert(c,h))}),l})}};var Ku=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return A.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:Oe(r.createTime)}}(t)),A.resolve()}getNamedQuery(e,t){return A.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(r){return{name:r.name,query:ed(r.bundledQuery),readTime:Oe(r.readTime)}}(t)),A.resolve()}};var $u=class{constructor(){this.overlays=new Te(U.comparator),this.Ir=new Map}getOverlay(e,t){return A.resolve(this.overlays.get(t))}getOverlays(e,t){let n=Ht();return A.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&n.set(r,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((r,s)=>{this.ht(e,t,s)}),A.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.Ir.get(n);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(n)),A.resolve()}getOverlaysForCollection(e,t,n){let r=Ht(),s=t.length+1,o=new U(t.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){let c=l.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>n&&r.set(c.getKey(),c)}return A.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let s=new Te((h,m)=>h-m),o=this.overlays.getIterator();for(;o.hasNext();){let h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let m=s.get(h.largestBatchId);m===null&&(m=Ht(),s=s.insert(h.largestBatchId,m)),m.set(h.getKey(),h)}}let l=Ht(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,m)=>l.set(h,m)),!(l.size()>=r)););return A.resolve(l)}ht(e,t,n){let r=this.overlays.get(n.key);if(r!==null){let o=this.Ir.get(r.largestBatchId).delete(n.key);this.Ir.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new Ks(t,n));let s=this.Ir.get(t);s===void 0&&(s=te(),this.Ir.set(t,s)),this.Ir.set(t,s.add(n.key))}};var Hu=class{constructor(){this.sessionToken=Ne.EMPTY_BYTE_STRING}getSessionToken(e){return A.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,A.resolve()}};var Xs=class{constructor(){this.Tr=new ge(Fe.Er),this.dr=new ge(Fe.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let n=new Fe(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Fe(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){let t=new U(new ae([])),n=new Fe(t,e),r=new Fe(t,e+1),s=[];return this.dr.forEachInRange([n,r],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new U(new ae([])),n=new Fe(t,e),r=new Fe(t,e+1),s=te();return this.dr.forEachInRange([n,r],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Fe(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},Fe=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return U.comparator(e.key,t.key)||J(e.wr,t.wr)}static Ar(e,t){return J(e.wr,t.wr)||U.comparator(e.key,t.key)}};var Qu=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new ge(Fe.Er)}checkEmpty(e){return A.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,r){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Gs(s,t,n,r);this.mutationQueue.push(o);for(let l of r)this.br=this.br.add(new Fe(l.key,s)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return A.resolve(o)}lookupMutationBatch(e,t){return A.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=this.vr(n),s=r<0?0:r;return A.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return A.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return A.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new Fe(t,0),r=new Fe(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([n,r],o=>{let l=this.Dr(o.wr);s.push(l)}),A.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ge(J);return t.forEach(r=>{let s=new Fe(r,0),o=new Fe(r,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],l=>{n=n.add(l.wr)})}),A.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,s=n;U.isDocumentKey(s)||(s=s.child(""));let o=new Fe(new U(s),0),l=new ge(J);return this.br.forEachWhile(c=>{let h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===r&&(l=l.add(c.wr)),!0)},o),A.resolve(this.Cr(l))}Cr(e){let t=[];return e.forEach(n=>{let r=this.Dr(n);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){G(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return A.forEach(t.mutations,r=>{let s=new Fe(r.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){let n=new Fe(t,0),r=this.br.firstAfterOrEqual(n);return A.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,A.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Wu=class{constructor(e){this.Mr=e,this.docs=function(){return new Te(U.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),s=r?r.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return A.resolve(n?n.document.mutableCopy():ze.newInvalidDocument(t))}getEntries(e,t){let n=gt();return t.forEach(r=>{let s=this.docs.get(r);n=n.insert(r,s?s.document.mutableCopy():ze.newInvalidDocument(r))}),A.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let s=gt(),o=t.path,l=new U(o.child("")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){let{key:h,value:{document:m}}=c.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Kh(cg(m),n)<=0||(r.has(m.key)||ao(t,m))&&(s=s.insert(m.key,m.mutableCopy()))}return A.resolve(s)}getAllFromCollectionGroup(e,t,n,r){j()}Or(e,t){return A.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Yu(this)}getSize(e){return A.resolve(this.size)}},Yu=class extends Ga{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(n)}),A.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var Xu=class{constructor(e){this.persistence=e,this.Nr=new Zt(t=>Ai(t),so),this.lastRemoteSnapshotVersion=K.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Xs,this.targetCount=0,this.kr=Ar.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,r)=>t(r)),A.resolve()}getLastRemoteSnapshotVersion(e){return A.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return A.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),A.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),A.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new Ar(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,A.resolve()}updateTargetData(e,t){return this.Kn(t),A.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,A.resolve()}removeTargets(e,t,n){let r=0,s=[];return this.Nr.forEach((o,l)=>{l.sequenceNumber<=t&&n.get(l.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,l.targetId)),r++)}),A.waitFor(s).next(()=>r)}getTargetCount(e){return A.resolve(this.targetCount)}getTargetData(e,t){let n=this.Nr.get(t)||null;return A.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),A.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);let r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),A.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),A.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Br.yr(t);return A.resolve(n)}containsKey(e,t){return A.resolve(this.Br.containsKey(t))}};var $a=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new wt(0),this.Kr=!1,this.Kr=!0,this.$r=new Hu,this.referenceDelegate=e(this),this.Ur=new Xu(this),this.indexManager=new Nu,this.remoteDocumentCache=function(r){return new Wu(r)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new Fa(t),this.Gr=new Ku(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new $u,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Qu(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){V("MemoryPersistence","Starting transaction:",e);let r=new Ju(this.Qr.next());return this.referenceDelegate.zr(),n(r).next(s=>this.referenceDelegate.jr(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Hr(e,t){return A.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}},Ju=class extends Ca{constructor(e){super(),this.currentSequenceNumber=e}},Ha=class i{constructor(e){this.persistence=e,this.Jr=new Xs,this.Yr=null}static Zr(e){return new i(e)}get Xr(){if(this.Yr)return this.Yr;throw j()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),A.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),A.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),A.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(r=>this.Xr.add(r.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.Xr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return A.forEach(this.Xr,n=>{let r=U.fromPath(n);return this.ei(e,r).next(s=>{s||t.removeEntry(r,K.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return A.or([()=>A.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var Zu=class{constructor(e){this.serializer=e}O(e,t,n,r){let s=new Aa("createOrUpgrade",t);n<1&&r>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",sf,{unique:!0}),c.createObjectStore("documentMutations")}(e),Gf(e),function(c){c.createObjectStore("remoteDocuments")}(e));let o=A.resolve();return n<3&&r>=3&&(n!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),Gf(e)),o=o.next(()=>function(c){let h=c.store("targetGlobal"),m={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:K.min().toTimestamp(),targetCount:0};return h.put("targetGlobalKey",m)}(s))),n<4&&r>=4&&(n!==0&&(o=o.next(()=>function(c,h){return h.store("mutations").U().next(m=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",sf,{unique:!0});let f=h.store("mutations"),_=m.map(b=>f.put(b));return A.waitFor(_)})}(e,s))),o=o.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),n<5&&r>=5&&(o=o.next(()=>this.ni(s))),n<6&&r>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),n<7&&r>=7&&(o=o.next(()=>this.ii(s))),n<8&&r>=8&&(o=o.next(()=>this.si(e,s))),n<9&&r>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&r>=10&&(o=o.next(()=>this.oi(s))),n<11&&r>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&r>=12&&(o=o.next(()=>{(function(c){let h=c.createObjectStore("documentOverlays",{keyPath:B1});h.createIndex("collectionPathOverlayIndex",U1,{unique:!1}),h.createIndex("collectionGroupOverlayIndex",q1,{unique:!1})})(e)})),n<13&&r>=13&&(o=o.next(()=>function(c){let h=c.createObjectStore("remoteDocumentsV14",{keyPath:P1});h.createIndex("documentKeyIndex",R1),h.createIndex("collectionGroupIndex",D1)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&r>=14&&(o=o.next(()=>this.ai(e,s))),n<15&&r>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:M1}).createIndex("sequenceNumberIndex",F1,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:L1}).createIndex("documentKeyIndex",z1,{unique:!1})}(e))),n<16&&r>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&r>=17&&(o=o.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((n,r)=>{t+=qa(r)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(r=>A.forEach(r,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",o).next(l=>A.forEach(l,c=>{G(c.userId===s.userId);let h=yi(this.serializer,c);return o_(e,s.userId,h).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(r=>{let s=[];return n.J((o,l)=>{let c=new ae(o),h=function(f){return[0,st(f)]}(c);s.push(t.get(h).next(m=>m?A.resolve():(f=>t.put({targetId:0,path:st(f),sequenceNumber:r.highestListenSequenceNumber}))(c)))}).next(()=>A.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:N1});let n=t.store("collectionParents"),r=new Ys,s=o=>{if(r.add(o)){let l=o.lastSegment(),c=o.popLast();return n.put({collectionId:l,parent:st(c)})}};return t.store("remoteDocuments").J({H:!0},(o,l)=>{let c=new ae(o);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,l,c],h)=>{let m=$t(l);return s(m.popLast())}))}oi(e){let t=e.store("targets");return t.J((n,r)=>{let s=Ds(r),o=i_(this.serializer,s);return t.put(o)})}_i(e,t){let n=t.store("remoteDocuments"),r=[];return n.J((s,o)=>{let l=t.store("remoteDocumentsV14"),c=function(f){return f.document?new U(ae.fromString(f.document.name).popFirst(5)):f.noDocument?U.fromSegments(f.noDocument.path):f.unknownDocument?U.fromSegments(f.unknownDocument.path):j()}(o).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(l.put(h))}).next(()=>A.waitFor(r))}ai(e,t){let n=t.store("mutations"),r=c_(this.serializer),s=new $a(Ha.Zr,this.serializer.ct);return n.U().next(o=>{let l=new Map;return o.forEach(c=>{var h;let m=(h=l.get(c.userId))!==null&&h!==void 0?h:te();yi(this.serializer,c).keys().forEach(f=>m=m.add(f)),l.set(c.userId,m)}),A.forEach(l,(c,h)=>{let m=new Le(h),f=za.lt(this.serializer,m),_=s.getIndexManager(m),b=ja.lt(m,this.serializer,_,s.referenceDelegate);return new Ka(r,b,f,_).recalculateAndSaveOverlaysForDocumentKeys(new zs(t,wt.oe),c).next()})})}};function Gf(i){i.createObjectStore("targetDocuments",{keyPath:V1}).createIndex("documentTargetsIndex",O1,{unique:!0}),i.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",k1,{unique:!0}),i.createObjectStore("targetGlobal")}var Uc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",eh=class i{constructor(e,t,n,r,s,o,l,c,h,m,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=s,this.window=o,this.document=l,this.ci=h,this.li=m,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=_=>Promise.resolve(),!i.D())throw new D(x.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Uu(this,r),this.Ai=t+"main",this.serializer=new Fa(c),this.Ri=new qn(this.Ai,this.hi,new Zu(this.serializer)),this.$r=new xu,this.Ur=new Fu(this.referenceDelegate,this.serializer),this.remoteDocumentCache=c_(this.serializer),this.Gr=new Su,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,m===!1&&ke("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(x.FAILED_PRECONDITION,Uc);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new wt(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>P(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>P(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>P(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>fa(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Jn(e))return V("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return V("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Ps(e).get("owner").next(t=>A.resolve(this.vi(t)))}Ci(e){return fa(e).delete(this.clientId)}Fi(){return P(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=Ge(t,"clientMetadata");return n.U().next(r=>{let s=this.xi(r,18e5),o=r.filter(l=>s.indexOf(l)===-1);return A.forEach(o,l=>n.delete(l.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?A.resolve(!0):Ps(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new D(x.FAILED_PRECONDITION,Uc);return!1}}return!(!this.networkEnabled||!this.inForeground)||fa(e).U().next(n=>this.xi(n,5e3).find(r=>{if(this.clientId!==r.clientId){let s=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,l=this.networkEnabled===r.networkEnabled;if(s||o&&l)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&V("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return P(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new zs(e,wt.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>fa(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return ja.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Mu(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return za.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){V("IndexedDbPersistence","Starting transaction:",e);let r=t==="readonly"?"readonly":"readwrite",s=function(c){return c===17?K1:c===16?G1:c===15?Hh:c===14?gg:c===13?fg:c===12?j1:c===11?pg:void j()}(this.hi),o;return this.Ri.runTransaction(e,r,s,l=>(o=new zs(l,this.Qr?this.Qr.next():wt.oe),t==="readwrite-primary"?this.wi(o).next(c=>!!c||this.Si(o)).next(c=>{if(!c)throw ke(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new D(x.FAILED_PRECONDITION,ug);return n(o)}).next(c=>this.Di(o).next(()=>c)):this.Ki(o).next(()=>n(o)))).then(l=>(o.raiseOnCommittedEvent(),l))}Ki(e){return Ps(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(x.FAILED_PRECONDITION,Uc)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ps(e).put("owner",t)}static D(){return qn.D()}bi(e){let t=Ps(e);return t.get("owner").next(n=>this.vi(n)?(V("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):A.resolve())}Mi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(ke(`Detected an update time that is in the future: ${e} > ${n}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;_c()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let n=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return V("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ke("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){ke("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Ps(i){return Ge(i,"owner")}function fa(i){return Ge(i,"clientMetadata")}function nd(i,e){let t=i.projectId;return i.isDefaultDatabase||(t+="."+i.database),"firestore/"+e+"/"+t+"/"}var th=class i{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=r}static Wi(e,t){let n=te(),r=te();for(let s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new i(e,t.fromCache,n,r)}};var nh=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Qa=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return _c()?8:hg(vs())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,r){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,r,n).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new nh;return this.Xi(e,t,o).next(l=>{if(s.result=l,this.zi)return this.es(e,t,o,l.size)})}).next(()=>s.result)}es(e,t,n,r){return n.documentReadCount<this.ji?(cr()<=Kt.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",ur(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),A.resolve()):(cr()<=Kt.DEBUG&&V("QueryEngine","Query:",ur(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Hi*r?(cr()<=Kt.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",ur(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ot(t))):A.resolve())}Yi(e,t){if(_f(t))return A.resolve(null);let n=ot(t);return this.indexManager.getIndexType(e,n).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=Va(t,null,"F"),n=ot(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{let o=te(...s);return this.Ji.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,n).next(c=>{let h=this.ts(t,l);return this.ns(t,h,o,c.readTime)?this.Yi(e,Va(t,null,"F")):this.rs(e,h,t,c)}))})))}Zi(e,t,n,r){return _f(t)||r.isEqual(K.min())?A.resolve(null):this.Ji.getDocuments(e,n).next(s=>{let o=this.ts(t,s);return this.ns(t,o,n,r)?A.resolve(null):(cr()<=Kt.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ur(t)),this.rs(e,o,t,lg(r,-1)).next(l=>l))})}ts(e,t){let n=new ge(Rg(e));return t.forEach((r,s)=>{ao(e,s)&&(n=n.add(s))}),n}ns(e,t,n,r){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Xi(e,t,n){return cr()<=Kt.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",ur(t)),this.Ji.getDocumentsMatchingQuery(e,t,Rt.min(),n)}rs(e,t,n,r){return this.Ji.getDocumentsMatchingQuery(e,n,r).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var ih=class{constructor(e,t,n,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new Te(J),this._s=new Zt(s=>Ai(s),so),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ka(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function u_(i,e,t,n){return new ih(i,e,t,n)}function h_(i,e){return P(this,null,function*(){let t=B(i);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let r;return t.mutationQueue.getAllMutationBatches(n).next(s=>(r=s,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{let o=[],l=[],c=te();for(let h of r){o.push(h.batchId);for(let m of h.mutations)c=c.add(m.key)}for(let h of s){l.push(h.batchId);for(let m of h.mutations)c=c.add(m.key)}return t.localDocuments.getDocuments(n,c).next(h=>({hs:h,removedBatchIds:o,addedBatchIds:l}))})})})}function bv(i,e){let t=B(i);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let r=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(l,c,h,m){let f=h.batch,_=f.keys(),b=A.resolve();return _.forEach(k=>{b=b.next(()=>m.getEntry(c,k)).next(O=>{let R=h.docVersions.get(k);G(R!==null),O.version.compareTo(R)<0&&(f.applyToRemoteDocument(O,h),O.isValidDocument()&&(O.setReadTime(h.commitVersion),m.addEntry(O)))})}),b.next(()=>l.mutationQueue.removeMutationBatch(c,f))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(l){let c=te();for(let h=0;h<l.mutationResults.length;++h)l.mutationResults[h].transformResults.length>0&&(c=c.add(l.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,r))})}function d_(i){let e=B(i);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function Cv(i,e){let t=B(i),n=e.snapshotVersion,r=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});r=t.os;let l=[];e.targetChanges.forEach((m,f)=>{let _=r.get(f);if(!_)return;l.push(t.Ur.removeMatchingKeys(s,m.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(s,m.addedDocuments,f)));let b=_.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(f)!==null?b=b.withResumeToken(Ne.EMPTY_BYTE_STRING,K.min()).withLastLimboFreeSnapshotVersion(K.min()):m.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(m.resumeToken,n)),r=r.insert(f,b),function(O,R,$){return O.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-O.snapshotVersion.toMicroseconds()>=3e8?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0}(_,b,m)&&l.push(t.Ur.updateTargetData(s,b))});let c=gt(),h=te();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(s,m))}),l.push(m_(s,o,e.documentUpdates).next(m=>{c=m.Ps,h=m.Is})),!n.isEqual(K.min())){let m=t.Ur.getLastRemoteSnapshotVersion(s).next(f=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,n));l.push(m)}return A.waitFor(l).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,h)).next(()=>c)}).then(s=>(t.os=r,s))}function m_(i,e,t){let n=te(),r=te();return t.forEach(s=>n=n.add(s)),e.getEntries(i,n).next(s=>{let o=gt();return t.forEach((l,c)=>{let h=s.get(l);c.isFoundDocument()!==h.isFoundDocument()&&(r=r.add(l)),c.isNoDocument()&&c.version.isEqual(K.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):V("LocalStore","Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",c.version)}),{Ps:o,Is:r}})}function Av(i,e){let t=B(i);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Sr(i,e){let t=B(i);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return t.Ur.getTargetData(n,e).next(s=>s?(r=s,A.resolve(r)):t.Ur.allocateTargetId(n).next(o=>(r=new Cr(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=t.os.get(n.targetId);return(r===null||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}function xr(i,e,t){return P(this,null,function*(){let n=B(i),r=n.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,o=>n.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!Jn(o))throw o;V("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(r.target)})}function Wa(i,e,t){let n=B(i),r=K.min(),s=te();return n.persistence.runTransaction("Execute query","readwrite",o=>function(c,h,m){let f=B(c),_=f._s.get(m);return _!==void 0?A.resolve(f.os.get(_)):f.Ur.getTargetData(h,m)}(n,o,ot(e)).next(l=>{if(l)return r=l.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,l.targetId).next(c=>{s=c})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?r:K.min(),t?s:te())).next(l=>(g_(n,Pg(e),l),{documents:l,Ts:s})))}function p_(i,e){let t=B(i),n=B(t.Ur),r=t.os.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(o=>o?o.target:null))}function f_(i,e){let t=B(i),n=t.us.get(e)||K.min();return t.persistence.runTransaction("Get new document changes","readonly",r=>t.cs.getAllFromCollectionGroup(r,e,lg(n,-1),Number.MAX_SAFE_INTEGER)).then(r=>(g_(t,e,r),r))}function g_(i,e,t){let n=i.us.get(e)||K.min();t.forEach((r,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),i.us.set(e,n)}function Sv(i,e,t,n){return P(this,null,function*(){let r=B(i),s=te(),o=gt();for(let h of t){let m=e.Es(h.metadata.name);h.document&&(s=s.add(m));let f=e.ds(h);f.setReadTime(e.As(h.metadata.readTime)),o=o.insert(m,f)}let l=r.cs.newChangeBuffer({trackRemovals:!0}),c=yield Sr(r,function(m){return ot(Mr(ae.fromString(`__bundle__/docs/${m}`)))}(n));return r.persistence.runTransaction("Apply bundle documents","readwrite",h=>m_(h,l,o).next(m=>(l.apply(h),m)).next(m=>r.Ur.removeMatchingKeysForTargetId(h,c.targetId).next(()=>r.Ur.addMatchingKeys(h,s,c.targetId)).next(()=>r.localDocuments.getLocalViewOfDocuments(h,m.Ps,m.Is)).next(()=>m.Ps)))})}function xv(n,r){return P(this,arguments,function*(i,e,t=te()){let s=yield Sr(i,ot(ed(e.bundledQuery))),o=B(i);return o.persistence.runTransaction("Save named query","readwrite",l=>{let c=Oe(e.readTime);if(s.snapshotVersion.compareTo(c)>=0)return o.Gr.saveNamedQuery(l,e);let h=s.withResumeToken(Ne.EMPTY_BYTE_STRING,c);return o.os=o.os.insert(h.targetId,h),o.Ur.updateTargetData(l,h).next(()=>o.Ur.removeMatchingKeysForTargetId(l,s.targetId)).next(()=>o.Ur.addMatchingKeys(l,t,s.targetId)).next(()=>o.Gr.saveNamedQuery(l,e))})})}function Kf(i,e){return`firestore_clients_${i}_${e}`}function $f(i,e,t){let n=`firestore_mutations_${i}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function qc(i,e){return`firestore_targets_${i}_${e}`}var Ya=class i{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Rs(e,t,n){let r=JSON.parse(n),s,o=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return o&&r.error&&(o=typeof r.error.message=="string"&&typeof r.error.code=="string",o&&(s=new D(r.error.code,r.error.message))),o?new i(e,t,r.state,s):(ke("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Ns=class i{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){let n=JSON.parse(t),r,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(r=new D(n.error.code,n.error.message))),s?new i(e,n.state,r):(ke("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Xa=class i{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let n=JSON.parse(t),r=typeof n=="object"&&n.activeTargetIds instanceof Array,s=Xh();for(let o=0;r&&o<n.activeTargetIds.length;++o)r=dg(n.activeTargetIds[o]),s=s.add(n.activeTargetIds[o]);return r?new i(e,s):(ke("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},rh=class i{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new i(t.clientId,t.onlineState):(ke("SharedClientState",`Failed to parse online state: ${e}`),null)}},Js=class{constructor(){this.activeTargetIds=Xh()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Ms=class{constructor(e,t,n,r,s){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Te(J),this.started=!1,this.bs=[];let o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=Kf(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Js),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return P(this,null,function*(){let e=yield this.syncEngine.Qi();for(let n of e){if(n===this.ps)continue;let r=this.getItem(Kf(this.persistenceKey,n));if(r){let s=Xa.Rs(n,r);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let n=this.Ls(t);n&&this.Bs(n)}for(let n of this.bs)this.ws(n);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(qc(this.persistenceKey,e));if(r){let s=Ns.Rs(e,r);s&&(n=s.state)}}return t&&this.Ks.fs(e),this.Ns(),n}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(qc(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(r=>{this.Qs(r)}),this.currentUser=e,n.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return V("SharedClientState","READ",e,t),t}setItem(e,t){V("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){V("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(V("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void ke("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>P(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let n=this.Gs(t.key);return this.zs(n,null)}{let n=this.js(t.key,t.newValue);if(n)return this.zs(n.clientId,n)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let n=this.Hs(t.key,t.newValue);if(n)return this.Js(n)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let n=this.Ys(t.key,t.newValue);if(n)return this.Zs(n)}}else if(t.key===this.xs){if(t.newValue!==null){let n=this.Ls(t.newValue);if(n)return this.Bs(n)}}else if(t.key===this.vs){let n=function(s){let o=wt.oe;if(s!=null)try{let l=JSON.parse(s);G(typeof l=="number"),o=l}catch(l){ke("SharedClientState","Failed to read sequence number from WebStorage",l)}return o}(t.newValue);n!==wt.oe&&this.sequenceNumberHandler(n)}else if(t.key===this.Os){let n=this.Xs(t.newValue);yield Promise.all(n.map(r=>this.syncEngine.eo(r)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){let r=new Ya(this.currentUser,e,t,n),s=$f(this.persistenceKey,this.currentUser,e);this.setItem(s,r.Vs())}Qs(e){let t=$f(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,n){let r=qc(this.persistenceKey,e),s=new Ns(e,t,n);this.setItem(r,s.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let n=this.Gs(e);return Xa.Rs(n,t)}Hs(e,t){let n=this.Fs.exec(e),r=Number(n[1]),s=n[2]!==void 0?n[2]:null;return Ya.Rs(new Le(s),r,t)}Ys(e,t){let n=this.Ms.exec(e),r=Number(n[1]);return Ns.Rs(r,t)}Ls(e){return rh.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return P(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);V("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let n=t?this.Ss.insert(e,t):this.Ss.remove(e),r=this.ks(this.Ss),s=this.ks(n),o=[],l=[];return s.forEach(c=>{r.has(c)||o.push(c)}),r.forEach(c=>{s.has(c)||l.push(c)}),this.syncEngine.io(o,l).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Xh();return e.forEach((n,r)=>{t=t.unionWith(r.activeTargetIds)}),t}},Ja=class{constructor(){this.so=new Js,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Js,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var sh=class{_o(e){}shutdown(){}};var Za=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){V("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){V("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var ga=null;function jc(){return ga===null?ga=function(){return 268435456+Math.round(2147483648*Math.random())}():ga++,"0x"+ga.toString(16)}var Pv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var oh=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var et="WebChannelConnection",ah=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let n=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${r}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${s}`}get Fo(){return!1}Mo(t,n,r,s,o){let l=jc(),c=this.xo(t,n.toUriEncodedString());V("RestConnection",`Sending RPC '${t}' ${l}:`,c,r);let h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,s,o),this.No(t,c,h,r).then(m=>(V("RestConnection",`Received RPC '${t}' ${l}: `,m),m),m=>{throw Ft("RestConnection",`RPC '${t}' ${l} failed with error: `,m,"url: ",c,"request:",r),m})}Lo(t,n,r,s,o,l){return this.Mo(t,n,r,s,o)}Oo(t,n,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Nr}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,o)=>t[o]=s),r&&r.headers.forEach((s,o)=>t[o]=s)}xo(t,n){let r=Pv[t];return`${this.Do}/v1/${n}:${r}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,r){let s=jc();return new Promise((o,l)=>{let c=new Nc;c.setWithCredentials(!0),c.listenOnce(Mc.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Cs.NO_ERROR:let m=c.getResponseJson();V(et,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(m)),o(m);break;case Cs.TIMEOUT:V(et,`RPC '${e}' ${s} timed out`),l(new D(x.DEADLINE_EXCEEDED,"Request time out"));break;case Cs.HTTP_ERROR:let f=c.getStatus();if(V(et,`RPC '${e}' ${s} failed with status:`,f,"response text:",c.getResponseText()),f>0){let _=c.getResponseJson();Array.isArray(_)&&(_=_[0]);let b=_?.error;if(b&&b.status&&b.message){let k=function(R){let $=R.toLowerCase().replace(/_/g,"-");return Object.values(x).indexOf($)>=0?$:x.UNKNOWN}(b.status);l(new D(k,b.message))}else l(new D(x.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new D(x.UNAVAILABLE,"Connection failed."));break;default:j()}}finally{V(et,`RPC '${e}' ${s} completed.`)}});let h=JSON.stringify(r);V(et,`RPC '${e}' ${s} sending request:`,r),c.send(t,"POST",h,n,15)})}Bo(e,t,n){let r=jc(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=zc(),l=Lc(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;let m=s.join("");V(et,`Creating RPC '${e}' stream ${r}: ${m}`,c);let f=o.createWebChannel(m,c),_=!1,b=!1,k=new oh({Io:R=>{b?V(et,`Not sending because RPC '${e}' stream ${r} is closed:`,R):(_||(V(et,`Opening RPC '${e}' stream ${r} transport.`),f.open(),_=!0),V(et,`RPC '${e}' stream ${r} sending:`,R),f.send(R))},To:()=>f.close()}),O=(R,$,Q)=>{R.listen($,z=>{try{Q(z)}catch(W){setTimeout(()=>{throw W},0)}})};return O(f,rr.EventType.OPEN,()=>{b||(V(et,`RPC '${e}' stream ${r} transport opened.`),k.yo())}),O(f,rr.EventType.CLOSE,()=>{b||(b=!0,V(et,`RPC '${e}' stream ${r} transport closed`),k.So())}),O(f,rr.EventType.ERROR,R=>{b||(b=!0,Ft(et,`RPC '${e}' stream ${r} transport errored:`,R),k.So(new D(x.UNAVAILABLE,"The operation could not be completed")))}),O(f,rr.EventType.MESSAGE,R=>{var $;if(!b){let Q=R.data[0];G(!!Q);let z=Q,W=z.error||(($=z[0])===null||$===void 0?void 0:$.error);if(W){V(et,`RPC '${e}' stream ${r} received error:`,W);let Z=W.status,ee=function(v){let T=Me[v];if(T!==void 0)return jg(T)}(Z),w=W.message;ee===void 0&&(ee=x.INTERNAL,w="Unknown error status: "+Z+" with message "+W.message),b=!0,k.So(new D(ee,w)),f.close()}else V(et,`RPC '${e}' stream ${r} received:`,Q),k.bo(Q)}}),O(l,Fc.STAT_EVENT,R=>{R.stat===da.PROXY?V(et,`RPC '${e}' stream ${r} detected buffering proxy`):R.stat===da.NOPROXY&&V(et,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{k.wo()},0),k}};function __(){return typeof window<"u"?window:null}function Ta(){return typeof document<"u"?document:null}function lo(i){return new Iu(i,!0)}var Zs=class{constructor(e,t,n=1e3,r=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=r,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-n);r>0&&V("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var el=class{constructor(e,t,n,r,s,o,l,c){this.ui=e,this.Ho=n,this.Jo=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Zs(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return P(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return P(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return P(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===x.RESOURCE_EXHAUSTED?(ke(t.toString()),ke("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===x.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,r])=>{this.Yo===t&&this.P_(n,r)},n=>{e(()=>{let r=new D(x.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(r)})})}P_(e,t){let n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(r=>{n(()=>this.I_(r))}),this.stream.onMessage(r=>{n(()=>++this.e_==1?this.E_(r):this.onNext(r))})}i_(){this.state=5,this.t_.Go(()=>P(this,null,function*(){this.state=0,this.start()}))}I_(e){return V("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(V("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},lh=class extends el{constructor(e,t,n,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=mv(this.serializer,e),n=function(s){if(!("targetChange"in s))return K.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?K.min():o.readTime?Oe(o.readTime):K.min()}(e);return this.listener.d_(t,n)}A_(e){let t={};t.database=Cu(this.serializer),t.addTarget=function(s,o){let l,c=o.target;if(l=Da(c)?{documents:Xg(s,c)}:{query:Jg(s,c)._t},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=Kg(s,o.resumeToken);let h=Eu(s,o.expectedCount);h!==null&&(l.expectedCount=h)}else if(o.snapshotVersion.compareTo(K.min())>0){l.readTime=br(s,o.snapshotVersion.toTimestamp());let h=Eu(s,o.expectedCount);h!==null&&(l.expectedCount=h)}return l}(this.serializer,e);let n=fv(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){let t={};t.database=Cu(this.serializer),t.removeTarget=e,this.a_(t)}},ch=class extends el{constructor(e,t,n,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return G(!!e.streamToken),this.lastStreamToken=e.streamToken,G(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){G(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=pv(e.writeResults,e.commitTime),n=Oe(e.commitTime);return this.listener.g_(n,t)}p_(){let e={};e.database=Cu(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>Ws(this.serializer,n))};this.a_(t)}};var uh=class extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new D(x.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,bu(t,n),r,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new D(x.UNKNOWN,s.toString())})}Lo(e,t,n,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Lo(e,bu(t,n),r,o,l,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new D(x.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},hh=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(ke(t),this.D_=!1):V("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var dh=class{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{n.enqueueAndForget(()=>P(this,null,function*(){Zn(this)&&(V("RemoteStore","Restarting streams for network reachability change."),yield function(c){return P(this,null,function*(){let h=B(c);h.L_.add(4),yield Fr(h),h.q_.set("Unknown"),h.L_.delete(4),yield co(h)})}(this))}))}),this.q_=new hh(n,r)}};function co(i){return P(this,null,function*(){if(Zn(i))for(let e of i.B_)yield e(!0)})}function Fr(i){return P(this,null,function*(){for(let e of i.B_)yield e(!1)})}function Tl(i,e){let t=B(i);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),sd(t)?rd(t):zr(t).r_()&&id(t,e))}function Pr(i,e){let t=B(i),n=zr(t);t.N_.delete(e),n.r_()&&y_(t,e),t.N_.size===0&&(n.r_()?n.o_():Zn(t)&&t.q_.set("Unknown"))}function id(i,e){if(i.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(K.min())>0){let t=i.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}zr(i).A_(e)}function y_(i,e){i.Q_.xe(e),zr(i).R_(e)}function rd(i){i.Q_=new Tu({getRemoteKeysForTarget:e=>i.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>i.N_.get(e)||null,tt:()=>i.datastore.serializer.databaseId}),zr(i).start(),i.q_.v_()}function sd(i){return Zn(i)&&!zr(i).n_()&&i.N_.size>0}function Zn(i){return B(i).L_.size===0}function v_(i){i.Q_=void 0}function Rv(i){return P(this,null,function*(){i.q_.set("Online")})}function Dv(i){return P(this,null,function*(){i.N_.forEach((e,t)=>{id(i,e)})})}function kv(i,e){return P(this,null,function*(){v_(i),sd(i)?(i.q_.M_(e),rd(i)):i.q_.set("Unknown")})}function Vv(i,e,t){return P(this,null,function*(){if(i.q_.set("Online"),e instanceof Na&&e.state===2&&e.cause)try{yield function(r,s){return P(this,null,function*(){let o=s.cause;for(let l of s.targetIds)r.N_.has(l)&&(yield r.remoteSyncer.rejectListen(l,o),r.N_.delete(l),r.Q_.removeTarget(l))})}(i,e)}catch(n){V("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield tl(i,n)}else if(e instanceof _r?i.Q_.Ke(e):e instanceof Oa?i.Q_.He(e):i.Q_.We(e),!t.isEqual(K.min()))try{let n=yield d_(i.localStore);t.compareTo(n)>=0&&(yield function(s,o){let l=s.Q_.rt(o);return l.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){let m=s.N_.get(h);m&&s.N_.set(h,m.withResumeToken(c.resumeToken,o))}}),l.targetMismatches.forEach((c,h)=>{let m=s.N_.get(c);if(!m)return;s.N_.set(c,m.withResumeToken(Ne.EMPTY_BYTE_STRING,m.snapshotVersion)),y_(s,c);let f=new Cr(m.target,c,h,m.sequenceNumber);id(s,f)}),s.remoteSyncer.applyRemoteEvent(l)}(i,t))}catch(n){V("RemoteStore","Failed to raise snapshot:",n),yield tl(i,n)}})}function tl(i,e,t){return P(this,null,function*(){if(!Jn(e))throw e;i.L_.add(1),yield Fr(i),i.q_.set("Offline"),t||(t=()=>d_(i.localStore)),i.asyncQueue.enqueueRetryable(()=>P(this,null,function*(){V("RemoteStore","Retrying IndexedDB access"),yield t(),i.L_.delete(1),yield co(i)}))})}function w_(i,e){return e().catch(t=>tl(i,t,e))}function Lr(i){return P(this,null,function*(){let e=B(i),t=Yn(e),n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Ov(e);)try{let r=yield Av(e.localStore,n);if(r===null){e.O_.length===0&&t.o_();break}n=r.batchId,Nv(e,r)}catch(r){yield tl(e,r)}T_(e)&&I_(e)})}function Ov(i){return Zn(i)&&i.O_.length<10}function Nv(i,e){i.O_.push(e);let t=Yn(i);t.r_()&&t.V_&&t.m_(e.mutations)}function T_(i){return Zn(i)&&!Yn(i).n_()&&i.O_.length>0}function I_(i){Yn(i).start()}function Mv(i){return P(this,null,function*(){Yn(i).p_()})}function Fv(i){return P(this,null,function*(){let e=Yn(i);for(let t of i.O_)e.m_(t.mutations)})}function Lv(i,e,t){return P(this,null,function*(){let n=i.O_.shift(),r=yu.from(n,e,t);yield w_(i,()=>i.remoteSyncer.applySuccessfulWrite(r)),yield Lr(i)})}function zv(i,e){return P(this,null,function*(){e&&Yn(i).V_&&(yield function(n,r){return P(this,null,function*(){if(function(o){return qg(o)&&o!==x.ABORTED}(r.code)){let s=n.O_.shift();Yn(n).s_(),yield w_(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,r)),yield Lr(n)}})}(i,e)),T_(i)&&I_(i)})}function Hf(i,e){return P(this,null,function*(){let t=B(i);t.asyncQueue.verifyOperationInProgress(),V("RemoteStore","RemoteStore received new credentials");let n=Zn(t);t.L_.add(3),yield Fr(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield co(t)})}function mh(i,e){return P(this,null,function*(){let t=B(i);e?(t.L_.delete(2),yield co(t)):e||(t.L_.add(2),yield Fr(t),t.q_.set("Unknown"))})}function zr(i){return i.K_||(i.K_=function(t,n,r){let s=B(t);return s.w_(),new lh(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(i.datastore,i.asyncQueue,{Eo:Rv.bind(null,i),Ro:Dv.bind(null,i),mo:kv.bind(null,i),d_:Vv.bind(null,i)}),i.B_.push(e=>P(this,null,function*(){e?(i.K_.s_(),sd(i)?rd(i):i.q_.set("Unknown")):(yield i.K_.stop(),v_(i))}))),i.K_}function Yn(i){return i.U_||(i.U_=function(t,n,r){let s=B(t);return s.w_(),new ch(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(i.datastore,i.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Mv.bind(null,i),mo:zv.bind(null,i),f_:Fv.bind(null,i),g_:Lv.bind(null,i)}),i.B_.push(e=>P(this,null,function*(){e?(i.U_.s_(),yield Lr(i)):(yield i.U_.stop(),i.O_.length>0&&(V("RemoteStore",`Stopping write stream with ${i.O_.length} pending writes`),i.O_=[]))}))),i.U_}var ph=class i{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new je,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,s){let o=Date.now()+n,l=new i(e,t,o,r,s);return l.start(n),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Br(i,e){if(ke("AsyncQueue",`${e}: ${i}`),Jn(i))return new D(x.UNAVAILABLE,`${e}: ${i}`);throw i}var nl=class i{constructor(e){this.comparator=e?(t,n)=>e(t,n)||U.comparator(t.key,n.key):(t,n)=>U.comparator(t.key,n.key),this.keyedMap=Rs(),this.sortedSet=new Te(this.comparator)}static emptySet(e){return new i(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof i)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=n.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new i;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};var il=class{constructor(){this.W_=new Te(U.comparator)}track(e){let t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):j():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}},Rr=class i{constructor(e,t,n,r,s,o,l,c,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,r,s){let o=[];return t.forEach(l=>{o.push({type:0,doc:l})}),new i(e,t,nl.emptySet(t),o,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&oo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}};var fh=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},gh=class{constructor(){this.queries=Qf(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){let r=B(t),s=r.queries;r.queries=Qf(),s.forEach((o,l)=>{for(let c of l.j_)c.onError(n)})})(this,new D(x.ABORTED,"Firestore shutting down"))}};function Qf(){return new Zt(i=>xg(i),oo)}function od(i,e){return P(this,null,function*(){let t=B(i),n=3,r=e.query,s=t.queries.get(r);s?!s.H_()&&e.J_()&&(n=2):(s=new fh,n=e.J_()?0:1);try{switch(n){case 0:s.z_=yield t.onListen(r,!0);break;case 1:s.z_=yield t.onListen(r,!1);break;case 2:yield t.onFirstRemoteStoreListen(r)}}catch(o){let l=Br(o,`Initialization of query '${ur(e.query)}' failed`);return void e.onError(l)}t.queries.set(r,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&ld(t)})}function ad(i,e){return P(this,null,function*(){let t=B(i),n=e.query,r=3,s=t.queries.get(n);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?r=e.J_()?0:1:!s.H_()&&e.J_()&&(r=2))}switch(r){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function Bv(i,e){let t=B(i),n=!1;for(let r of e){let s=r.query,o=t.queries.get(s);if(o){for(let l of o.j_)l.X_(r)&&(n=!0);o.z_=r}}n&&ld(t)}function Uv(i,e,t){let n=B(i),r=n.queries.get(e);if(r)for(let s of r.j_)s.onError(t);n.queries.delete(e)}function ld(i){i.Y_.forEach(e=>{e.next()})}var _h,Wf;(Wf=_h||(_h={})).ea="default",Wf.Cache="cache";var eo=class{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){let n=[];for(let r of e.docChanges)r.type!==3&&n.push(r);e=new Rr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Rr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==_h.Cache}};var yh=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var rl=class{constructor(e){this.serializer=e}Es(e){return Wt(this.serializer,e)}ds(e){return e.metadata.exists?Yg(this.serializer,e.document,!1):ze.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Oe(e)}},vh=class{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=E_(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let n=ae.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,n=new rl(this.serializer);for(let r of e)if(r.metadata.queries){let s=n.Es(r.metadata.name);for(let o of r.metadata.queries){let l=(t.get(o)||te()).add(s);t.set(o,l)}}return t}complete(){return P(this,null,function*(){let e=yield Sv(this.localStore,new rl(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let n of this.queries)yield xv(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function E_(i){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}}var sl=class{constructor(e){this.key=e}},ol=class{constructor(e){this.key=e}},al=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=te(),this.mutatedKeys=te(),this.Aa=Rg(e),this.Ra=new nl(this.Aa)}get Va(){return this.Ta}ma(e,t){let n=t?t.fa:new il,r=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=r,l=!1,c=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,h=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((m,f)=>{let _=r.get(m),b=ao(this.query,f)?f:null,k=!!_&&this.mutatedKeys.has(_.key),O=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations),R=!1;_&&b?_.data.isEqual(b.data)?k!==O&&(n.track({type:3,doc:b}),R=!0):this.ga(_,b)||(n.track({type:2,doc:b}),R=!0,(c&&this.Aa(b,c)>0||h&&this.Aa(b,h)<0)&&(l=!0)):!_&&b?(n.track({type:0,doc:b}),R=!0):_&&!b&&(n.track({type:1,doc:_}),R=!0,(c||h)&&(l=!0)),R&&(b?(o=o.add(b),s=O?s.add(m):s.delete(m)):(o=o.delete(m),s=s.delete(m)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let m=this.query.limitType==="F"?o.last():o.first();o=o.delete(m.key),s=s.delete(m.key),n.track({type:1,doc:m})}return{Ra:o,fa:n,ns:l,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((m,f)=>function(b,k){let O=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return j()}};return O(b)-O(k)}(m.type,f.type)||this.Aa(m.doc,f.doc)),this.pa(n),r=r!=null&&r;let l=t&&!r?this.ya():[],c=this.da.size===0&&this.current&&!r?1:0,h=c!==this.Ea;return this.Ea=c,o.length!==0||h?{snapshot:new Rr(this.query,e.Ra,s,o,e.mutatedKeys,c===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new il,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=te(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});let t=[];return e.forEach(n=>{this.da.has(n)||t.push(new ol(n))}),this.da.forEach(n=>{e.has(n)||t.push(new sl(n))}),t}ba(e){this.Ta=e.Ts,this.da=te();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Rr.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},wh=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},Th=class{constructor(e){this.key=e,this.va=!1}},Ih=class{constructor(e,t,n,r,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Zt(l=>xg(l),oo),this.Ma=new Map,this.xa=new Set,this.Oa=new Te(U.comparator),this.Na=new Map,this.La=new Xs,this.Ba={},this.ka=new Map,this.qa=Ar.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function qv(i,e,t=!0){return P(this,null,function*(){let n=Il(i),r,s=n.Fa.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.Da()):r=yield b_(n,e,t,!0),r})}function jv(i,e){return P(this,null,function*(){let t=Il(i);yield b_(t,e,!0,!1)})}function b_(i,e,t,n){return P(this,null,function*(){let r=yield Sr(i.localStore,ot(e)),s=r.targetId,o=i.sharedClientState.addLocalQueryTarget(s,t),l;return n&&(l=yield cd(i,e,s,o==="current",r.resumeToken)),i.isPrimaryClient&&t&&Tl(i.remoteStore,r),l})}function cd(i,e,t,n,r){return P(this,null,function*(){i.Ka=(f,_,b)=>function(O,R,$,Q){return P(this,null,function*(){let z=R.view.ma($);z.ns&&(z=yield Wa(O.localStore,R.query,!1).then(({documents:w})=>R.view.ma(w,z)));let W=Q&&Q.targetChanges.get(R.targetId),Z=Q&&Q.targetMismatches.get(R.targetId)!=null,ee=R.view.applyChanges(z,O.isPrimaryClient,W,Z);return Eh(O,R.targetId,ee.wa),ee.snapshot})}(i,f,_,b);let s=yield Wa(i.localStore,e,!0),o=new al(e,s.Ts),l=o.ma(s.documents),c=Hs.createSynthesizedTargetChangeForCurrentChange(t,n&&i.onlineState!=="Offline",r),h=o.applyChanges(l,i.isPrimaryClient,c);Eh(i,t,h.wa);let m=new wh(e,t,o);return i.Fa.set(e,m),i.Ma.has(t)?i.Ma.get(t).push(e):i.Ma.set(t,[e]),h.snapshot})}function Gv(i,e,t){return P(this,null,function*(){let n=B(i),r=n.Fa.get(e),s=n.Ma.get(r.targetId);if(s.length>1)return n.Ma.set(r.targetId,s.filter(o=>!oo(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||(yield xr(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),t&&Pr(n.remoteStore,r.targetId),Dr(n,r.targetId)}).catch(Xn))):(Dr(n,r.targetId),yield xr(n.localStore,r.targetId,!0))})}function Kv(i,e){return P(this,null,function*(){let t=B(i),n=t.Fa.get(e),r=t.Ma.get(n.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Pr(t.remoteStore,n.targetId))})}function $v(i,e,t){return P(this,null,function*(){let n=md(i);try{let r=yield function(o,l){let c=B(o),h=Ce.now(),m=l.reduce((b,k)=>b.add(k.key),te()),f,_;return c.persistence.runTransaction("Locally write mutations","readwrite",b=>{let k=gt(),O=te();return c.cs.getEntries(b,m).next(R=>{k=R,k.forEach(($,Q)=>{Q.isValidDocument()||(O=O.add($))})}).next(()=>c.localDocuments.getOverlayedDocuments(b,k)).next(R=>{f=R;let $=[];for(let Q of l){let z=ov(Q,f.get(Q.key).overlayedDocument);z!=null&&$.push(new zt(Q.key,z,Tg(z.value.mapValue),Re.exists(!0)))}return c.mutationQueue.addMutationBatch(b,h,$,l)}).next(R=>{_=R;let $=R.applyToLocalDocumentSet(f,O);return c.documentOverlayCache.saveOverlays(b,R.batchId,$)})}).then(()=>({batchId:_.batchId,changes:kg(f)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(r.batchId),function(o,l,c){let h=o.Ba[o.currentUser.toKey()];h||(h=new Te(J)),h=h.insert(l,c),o.Ba[o.currentUser.toKey()]=h}(n,r.batchId,t),yield vn(n,r.changes),yield Lr(n.remoteStore)}catch(r){let s=Br(r,"Failed to persist write");t.reject(s)}})}function C_(i,e){return P(this,null,function*(){let t=B(i);try{let n=yield Cv(t.localStore,e);e.targetChanges.forEach((r,s)=>{let o=t.Na.get(s);o&&(G(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.va=!0:r.modifiedDocuments.size>0?G(o.va):r.removedDocuments.size>0&&(G(o.va),o.va=!1))}),yield vn(t,n,e)}catch(n){yield Xn(n)}})}function Yf(i,e,t){let n=B(i);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let r=[];n.Fa.forEach((s,o)=>{let l=o.view.Z_(e);l.snapshot&&r.push(l.snapshot)}),function(o,l){let c=B(o);c.onlineState=l;let h=!1;c.queries.forEach((m,f)=>{for(let _ of f.j_)_.Z_(l)&&(h=!0)}),h&&ld(c)}(n.eventManager,e),r.length&&n.Ca.d_(r),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Hv(i,e,t){return P(this,null,function*(){let n=B(i);n.sharedClientState.updateQueryState(e,"rejected",t);let r=n.Na.get(e),s=r&&r.key;if(s){let o=new Te(U.comparator);o=o.insert(s,ze.newNoDocument(s,K.min()));let l=te().add(s),c=new $s(K.min(),new Map,new Te(J),o,l);yield C_(n,c),n.Oa=n.Oa.remove(s),n.Na.delete(e),dd(n)}else yield xr(n.localStore,e,!1).then(()=>Dr(n,e,t)).catch(Xn)})}function Qv(i,e){return P(this,null,function*(){let t=B(i),n=e.batch.batchId;try{let r=yield bv(t.localStore,e);hd(t,n,null),ud(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield vn(t,r)}catch(r){yield Xn(r)}})}function Wv(i,e,t){return P(this,null,function*(){let n=B(i);try{let r=yield function(o,l){let c=B(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let m;return c.mutationQueue.lookupMutationBatch(h,l).next(f=>(G(f!==null),m=f.keys(),c.mutationQueue.removeMutationBatch(h,f))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,m,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,m)).next(()=>c.localDocuments.getDocuments(h,m))})}(n.localStore,e);hd(n,e,t),ud(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield vn(n,r)}catch(r){yield Xn(r)}})}function Yv(i,e){return P(this,null,function*(){let t=B(i);Zn(t.remoteStore)||V("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(o){let l=B(o);return l.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>l.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(n===-1)return void e.resolve();let r=t.ka.get(n)||[];r.push(e),t.ka.set(n,r)}catch(n){let r=Br(n,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}})}function ud(i,e){(i.ka.get(e)||[]).forEach(t=>{t.resolve()}),i.ka.delete(e)}function hd(i,e,t){let n=B(i),r=n.Ba[n.currentUser.toKey()];if(r){let s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),n.Ba[n.currentUser.toKey()]=r}}function Dr(i,e,t=null){i.sharedClientState.removeLocalQueryTarget(e);for(let n of i.Ma.get(e))i.Fa.delete(n),t&&i.Ca.$a(n,t);i.Ma.delete(e),i.isPrimaryClient&&i.La.gr(e).forEach(n=>{i.La.containsKey(n)||A_(i,n)})}function A_(i,e){i.xa.delete(e.path.canonicalString());let t=i.Oa.get(e);t!==null&&(Pr(i.remoteStore,t),i.Oa=i.Oa.remove(e),i.Na.delete(t),dd(i))}function Eh(i,e,t){for(let n of t)n instanceof sl?(i.La.addReference(n.key,e),Xv(i,n)):n instanceof ol?(V("SyncEngine","Document no longer in limbo: "+n.key),i.La.removeReference(n.key,e),i.La.containsKey(n.key)||A_(i,n.key)):j()}function Xv(i,e){let t=e.key,n=t.path.canonicalString();i.Oa.get(t)||i.xa.has(n)||(V("SyncEngine","New document in limbo: "+t),i.xa.add(n),dd(i))}function dd(i){for(;i.xa.size>0&&i.Oa.size<i.maxConcurrentLimboResolutions;){let e=i.xa.values().next().value;i.xa.delete(e);let t=new U(ae.fromString(e)),n=i.qa.next();i.Na.set(n,new Th(t)),i.Oa=i.Oa.insert(t,n),Tl(i.remoteStore,new Cr(ot(Mr(t.path)),n,"TargetPurposeLimboResolution",wt.oe))}}function vn(i,e,t){return P(this,null,function*(){let n=B(i),r=[],s=[],o=[];n.Fa.isEmpty()||(n.Fa.forEach((l,c)=>{o.push(n.Ka(c,e,t).then(h=>{var m;if((h||t)&&n.isPrimaryClient){let f=h?!h.fromCache:(m=t?.targetChanges.get(c.targetId))===null||m===void 0?void 0:m.current;n.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(h){r.push(h);let f=th.Wi(c.targetId,h);s.push(f)}}))}),yield Promise.all(o),n.Ca.d_(r),yield function(c,h){return P(this,null,function*(){let m=B(c);try{yield m.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>A.forEach(h,_=>A.forEach(_.$i,b=>m.persistence.referenceDelegate.addReference(f,_.targetId,b)).next(()=>A.forEach(_.Ui,b=>m.persistence.referenceDelegate.removeReference(f,_.targetId,b)))))}catch(f){if(!Jn(f))throw f;V("LocalStore","Failed to update sequence numbers: "+f)}for(let f of h){let _=f.targetId;if(!f.fromCache){let b=m.os.get(_),k=b.snapshotVersion,O=b.withLastLimboFreeSnapshotVersion(k);m.os=m.os.insert(_,O)}}})}(n.localStore,s))})}function Jv(i,e){return P(this,null,function*(){let t=B(i);if(!t.currentUser.isEqual(e)){V("SyncEngine","User change. New user:",e.toKey());let n=yield h_(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(l=>{l.forEach(c=>{c.reject(new D(x.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield vn(t,n.hs)}})}function Zv(i,e){let t=B(i),n=t.Na.get(e);if(n&&n.va)return te().add(n.key);{let r=te(),s=t.Ma.get(e);if(!s)return r;for(let o of s){let l=t.Fa.get(o);r=r.unionWith(l.view.Va)}return r}}function ew(i,e){return P(this,null,function*(){let t=B(i),n=yield Wa(t.localStore,e.query,!0),r=e.view.ba(n);return t.isPrimaryClient&&Eh(t,e.targetId,r.wa),r})}function tw(i,e){return P(this,null,function*(){let t=B(i);return f_(t.localStore,e).then(n=>vn(t,n))})}function nw(i,e,t,n){return P(this,null,function*(){let r=B(i),s=yield function(l,c){let h=B(l),m=B(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",f=>m.Mn(f,c).next(_=>_?h.localDocuments.getDocuments(f,_):A.resolve(null)))}(r.localStore,e);s!==null?(t==="pending"?yield Lr(r.remoteStore):t==="acknowledged"||t==="rejected"?(hd(r,e,n||null),ud(r,e),function(l,c){B(B(l).mutationQueue).On(c)}(r.localStore,e)):j(),yield vn(r,s)):V("SyncEngine","Cannot apply mutation batch with id: "+e)})}function iw(i,e){return P(this,null,function*(){let t=B(i);if(Il(t),md(t),e===!0&&t.Qa!==!0){let n=t.sharedClientState.getAllActiveQueryTargets(),r=yield Xf(t,n.toArray());t.Qa=!0,yield mh(t.remoteStore,!0);for(let s of r)Tl(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){let n=[],r=Promise.resolve();t.Ma.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?n.push(o):r=r.then(()=>(Dr(t,o),xr(t.localStore,o,!0))),Pr(t.remoteStore,o)}),yield r,yield Xf(t,n),function(o){let l=B(o);l.Na.forEach((c,h)=>{Pr(l.remoteStore,h)}),l.La.pr(),l.Na=new Map,l.Oa=new Te(U.comparator)}(t),t.Qa=!1,yield mh(t.remoteStore,!1)}})}function Xf(i,e,t){return P(this,null,function*(){let n=B(i),r=[],s=[];for(let o of e){let l,c=n.Ma.get(o);if(c&&c.length!==0){l=yield Sr(n.localStore,ot(c[0]));for(let h of c){let m=n.Fa.get(h),f=yield ew(n,m);f.snapshot&&s.push(f.snapshot)}}else{let h=yield p_(n.localStore,o);l=yield Sr(n.localStore,h),yield cd(n,S_(h),o,!1,l.resumeToken)}r.push(l)}return n.Ca.d_(s),r})}function S_(i){return Sg(i.path,i.collectionGroup,i.orderBy,i.filters,i.limit,"F",i.startAt,i.endAt)}function rw(i){return function(t){return B(B(t).persistence).Qi()}(B(i).localStore)}function sw(i,e,t,n){return P(this,null,function*(){let r=B(i);if(r.Qa)return void V("SyncEngine","Ignoring unexpected query state notification.");let s=r.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield f_(r.localStore,Pg(s[0])),l=$s.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ne.EMPTY_BYTE_STRING);yield vn(r,o,l);break}case"rejected":yield xr(r.localStore,e,!0),Dr(r,e,n);break;default:j()}})}function ow(i,e,t){return P(this,null,function*(){let n=Il(i);if(n.Qa){for(let r of e){if(n.Ma.has(r)&&n.sharedClientState.isActiveQueryTarget(r)){V("SyncEngine","Adding an already active target "+r);continue}let s=yield p_(n.localStore,r),o=yield Sr(n.localStore,s);yield cd(n,S_(s),o.targetId,!1,o.resumeToken),Tl(n.remoteStore,o)}for(let r of t)n.Ma.has(r)&&(yield xr(n.localStore,r,!1).then(()=>{Pr(n.remoteStore,r),Dr(n,r)}).catch(Xn))}})}function Il(i){let e=B(i);return e.remoteStore.remoteSyncer.applyRemoteEvent=C_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Zv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Hv.bind(null,e),e.Ca.d_=Bv.bind(null,e.eventManager),e.Ca.$a=Uv.bind(null,e.eventManager),e}function md(i){let e=B(i);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Qv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Wv.bind(null,e),e}function aw(i,e,t){let n=B(i);(function(s,o,l){return P(this,null,function*(){try{let c=yield o.getMetadata();if(yield function(b,k){let O=B(b),R=Oe(k.createTime);return O.persistence.runTransaction("hasNewerBundle","readonly",$=>O.Gr.getBundleMetadata($,k.id)).then($=>!!$&&$.createTime.compareTo(R)>=0)}(s.localStore,c))return yield o.close(),l._completeWith(function(b){return{taskState:"Success",documentsLoaded:b.totalDocuments,bytesLoaded:b.totalBytes,totalDocuments:b.totalDocuments,totalBytes:b.totalBytes}}(c)),Promise.resolve(new Set);l._updateProgress(E_(c));let h=new vh(c,s.localStore,o.serializer),m=yield o.Ua();for(;m;){let _=yield h.la(m);_&&l._updateProgress(_),m=yield o.Ua()}let f=yield h.complete();return yield vn(s,f.Ia,void 0),yield function(b,k){let O=B(b);return O.persistence.runTransaction("Save bundle","readwrite",R=>O.Gr.saveBundleMetadata(R,k))}(s.localStore,c),l._completeWith(f.progress),Promise.resolve(f.Pa)}catch(c){return Ft("SyncEngine",`Loading bundle failed with ${c}`),l._failWith(c),Promise.resolve(new Set)}})})(n,e,t).then(r=>{n.sharedClientState.notifyBundleLoaded(r)})}var bh=(()=>{class i{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return P(this,null,function*(){this.serializer=lo(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,n){return null}Ha(t,n){return null}za(t){return u_(this.persistence,new Qa,t.initialUser,this.serializer)}Ga(t){return new $a(Ha.Zr,this.serializer)}Wa(t){return new Ja}terminate(){return P(this,null,function*(){var t,n;(t=this.gcScheduler)===null||t===void 0||t.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return i.provider={build:()=>new i},i})();var ll=class i extends bh{constructor(e,t,n){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return P(this,null,function*(){yield cc(i.prototype,this,"initialize").call(this,e),yield this.Ja.initialize(this,e),yield md(this.Ja.syncEngine),yield Lr(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(e){return u_(this.persistence,new Qa,e.initialUser,this.serializer)}ja(e,t){let n=this.persistence.referenceDelegate.garbageCollector;return new zu(n,e.asyncQueue,t)}Ha(e,t){let n=new nu(t,this.persistence);return new tu(e.asyncQueue,n)}Ga(e){let t=nd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Pt.withCacheSize(this.cacheSizeBytes):Pt.DEFAULT;return new eh(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,__(),Ta(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Ja}},Ch=class i extends ll{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return P(this,null,function*(){yield cc(i.prototype,this,"initialize").call(this,e);let t=this.Ja.syncEngine;this.sharedClientState instanceof Ms&&(this.sharedClientState.syncEngine={no:nw.bind(null,t),ro:sw.bind(null,t),io:ow.bind(null,t),Qi:rw.bind(null,t),eo:tw.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(n=>P(this,null,function*(){yield iw(this.Ja.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}Wa(e){let t=__();if(!Ms.D(t))throw new D(x.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=nd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ms(t,e.asyncQueue,n,e.clientId,e.initialUser)}},pd=(()=>{class i{initialize(t,n){return P(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Yf(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Jv.bind(null,this.syncEngine),yield mh(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new gh}()}createDatastore(t){let n=lo(t.databaseInfo.databaseId),r=function(o){return new ah(o)}(t.databaseInfo);return function(o,l,c,h){return new uh(o,l,c,h)}(t.authCredentials,t.appCheckCredentials,r,n)}createRemoteStore(t){return function(r,s,o,l,c){return new dh(r,s,o,l,c)}(this.localStore,this.datastore,t.asyncQueue,n=>Yf(this.syncEngine,n,0),function(){return Za.D()?new Za:new sh}())}createSyncEngine(t,n){return function(s,o,l,c,h,m,f){let _=new Ih(s,o,l,c,h,m);return f&&(_.Qa=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){return P(this,null,function*(){var t,n;yield function(s){return P(this,null,function*(){let o=B(s);V("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield Fr(o),o.k_.shutdown(),o.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return i.provider={build:()=>new i},i})();function Jf(i,e=10240){let t=0;return{read(){return P(this,null,function*(){if(t<i.byteLength){let r={value:i.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})},cancel(){return P(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var kr=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):ke("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Ah=class{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new je,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.aa)}`))},n=>this.metadata.reject(n))}close(){return this.Xa.cancel()}getMetadata(){return P(this,null,function*(){return this.metadata.promise})}Ua(){return P(this,null,function*(){return yield this.getMetadata(),this.tu()})}tu(){return P(this,null,function*(){let e=yield this.nu();if(e===null)return null;let t=this.eu.decode(e),n=Number(t);isNaN(n)&&this.ru(`length string (${t}) is not valid number`);let r=yield this.iu(n);return new yh(JSON.parse(r),e.length+n)})}su(){return this.buffer.findIndex(e=>e===123)}nu(){return P(this,null,function*(){for(;this.su()<0&&!(yield this.ou()););if(this.buffer.length===0)return null;let e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}iu(e){return P(this,null,function*(){for(;this.buffer.length<e;)(yield this.ou())&&this.ru("Reached the end of bundle when more is expected.");let t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}ou(){return P(this,null,function*(){let e=yield this.Xa.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Sh=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return P(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new D(x.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(r,s){return P(this,null,function*(){let o=B(r),l={documents:s.map(f=>Qs(o.serializer,f))},c=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,ae.emptyPath(),l,s.length),h=new Map;c.forEach(f=>{let _=dv(o.serializer,f);h.set(_.key.toString(),_)});let m=[];return s.forEach(f=>{let _=h.get(f.toString());G(!!_),m.push(_)}),m})}(this.datastore,e);return t.forEach(n=>this.recordVersion(n)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new Wn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return P(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,n)=>{let r=U.fromPath(n);this.mutations.push(new js(r,this.precondition(r)))}),yield function(n,r){return P(this,null,function*(){let s=B(n),o={writes:r.map(l=>Ws(s.serializer,l))};yield s.Mo("Commit",s.serializer.databaseId,ae.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw j();t=K.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new D(x.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(K.min())?Re.exists(!1):Re.updateTime(t):Re.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(K.min()))throw new D(x.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Re.updateTime(t)}return Re.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var xh=class{constructor(e,t,n,r,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=s,this._u=n.maxAttempts,this.t_=new Zs(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(()=>P(this,null,function*(){let e=new Sh(this.datastore),t=this.cu(e);t&&t.then(n=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(n)}).catch(r=>{this.lu(r)}))}).catch(n=>{this.lu(n)})}))}cu(e){try{let t=this.updateFunction(e);return!ro(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!qg(t)}return!1}};var Ph=class{constructor(e,t,n,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Le.UNAUTHENTICATED,this.clientId=Ea.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,o=>P(this,null,function*(){V("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(n,o=>(V("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new je;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>P(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=Br(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};function Gc(i,e){return P(this,null,function*(){i.asyncQueue.verifyOperationInProgress(),V("FirestoreClient","Initializing OfflineComponentProvider");let t=i.configuration;yield e.initialize(t);let n=t.initialUser;i.setCredentialChangeListener(r=>P(this,null,function*(){n.isEqual(r)||(yield h_(e.localStore,r),n=r)})),e.persistence.setDatabaseDeletedListener(()=>i.terminate()),i._offlineComponents=e})}function Zf(i,e){return P(this,null,function*(){i.asyncQueue.verifyOperationInProgress();let t=yield fd(i);V("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,i.configuration),i.setCredentialChangeListener(n=>Hf(e.remoteStore,n)),i.setAppCheckTokenChangeListener((n,r)=>Hf(e.remoteStore,r)),i._onlineComponents=e})}function fd(i){return P(this,null,function*(){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){V("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Gc(i,i._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(r){return r.name==="FirebaseError"?r.code===x.FAILED_PRECONDITION||r.code===x.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;Ft("Error using user provided cache. Falling back to memory cache: "+t),yield Gc(i,new bh)}}else V("FirestoreClient","Using default OfflineComponentProvider"),yield Gc(i,new bh);return i._offlineComponents})}function El(i){return P(this,null,function*(){return i._onlineComponents||(i._uninitializedComponentsProvider?(V("FirestoreClient","Using user provided OnlineComponentProvider"),yield Zf(i,i._uninitializedComponentsProvider._online)):(V("FirestoreClient","Using default OnlineComponentProvider"),yield Zf(i,new pd))),i._onlineComponents})}function x_(i){return fd(i).then(e=>e.persistence)}function gd(i){return fd(i).then(e=>e.localStore)}function P_(i){return El(i).then(e=>e.remoteStore)}function _d(i){return El(i).then(e=>e.syncEngine)}function lw(i){return El(i).then(e=>e.datastore)}function Vr(i){return P(this,null,function*(){let e=yield El(i),t=e.eventManager;return t.onListen=qv.bind(null,e.syncEngine),t.onUnlisten=Gv.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=jv.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Kv.bind(null,e.syncEngine),t})}function cw(i){return i.asyncQueue.enqueue(()=>P(this,null,function*(){let e=yield x_(i),t=yield P_(i);return e.setNetworkEnabled(!0),function(r){let s=B(r);return s.L_.delete(0),co(s)}(t)}))}function uw(i){return i.asyncQueue.enqueue(()=>P(this,null,function*(){let e=yield x_(i),t=yield P_(i);return e.setNetworkEnabled(!1),function(r){return P(this,null,function*(){let s=B(r);s.L_.add(0),yield Fr(s),s.q_.set("Offline")})}(t)}))}function hw(i,e){let t=new je;return i.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(r,s,o){return P(this,null,function*(){try{let l=yield function(h,m){let f=B(h);return f.persistence.runTransaction("read document","readonly",_=>f.localDocuments.getDocument(_,m))}(r,s);l.isFoundDocument()?o.resolve(l):l.isNoDocument()?o.resolve(null):o.reject(new D(x.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(l){let c=Br(l,`Failed to get document '${s} from cache`);o.reject(c)}})}(yield gd(i),e,t)})),t.promise}function R_(i,e,t={}){let n=new je;return i.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(s,o,l,c,h){let m=new kr({next:_=>{m.Za(),o.enqueueAndForget(()=>ad(s,f));let b=_.docs.has(l);!b&&_.fromCache?h.reject(new D(x.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&_.fromCache&&c&&c.source==="server"?h.reject(new D(x.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(_)},error:_=>h.reject(_)}),f=new eo(Mr(l.path),m,{includeMetadataChanges:!0,_a:!0});return od(s,f)}(yield Vr(i),i.asyncQueue,e,t,n)})),n.promise}function dw(i,e){let t=new je;return i.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(r,s,o){return P(this,null,function*(){try{let l=yield Wa(r,s,!0),c=new al(s,l.Ts),h=c.ma(l.documents),m=c.applyChanges(h,!1);o.resolve(m.snapshot)}catch(l){let c=Br(l,`Failed to execute query '${s} against cache`);o.reject(c)}})}(yield gd(i),e,t)})),t.promise}function D_(i,e,t={}){let n=new je;return i.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(s,o,l,c,h){let m=new kr({next:_=>{m.Za(),o.enqueueAndForget(()=>ad(s,f)),_.fromCache&&c.source==="server"?h.reject(new D(x.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),f=new eo(l,m,{includeMetadataChanges:!0,_a:!0});return od(s,f)}(yield Vr(i),i.asyncQueue,e,t,n)})),n.promise}function mw(i,e){let t=new kr(e);return i.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(r,s){B(r).Y_.add(s),s.next()}(yield Vr(i),t)})),()=>{t.Za(),i.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(r,s){B(r).Y_.delete(s)}(yield Vr(i),t)}))}}function pw(i,e,t,n){let r=function(o,l){let c;return c=typeof o=="string"?Gg().encode(o):o,function(m,f){return new Ah(m,f)}(function(m,f){if(m instanceof Uint8Array)return Jf(m,f);if(m instanceof ArrayBuffer)return Jf(new Uint8Array(m),f);if(m instanceof ReadableStream)return m.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),l)}(t,lo(e));i.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){aw(yield _d(i),r,n)}))}function fw(i,e){return i.asyncQueue.enqueue(()=>P(this,null,function*(){return function(n,r){let s=B(n);return s.persistence.runTransaction("Get named query","readonly",o=>s.Gr.getNamedQuery(o,r))}(yield gd(i),e)}))}function k_(i){let e={};return i.timeoutSeconds!==void 0&&(e.timeoutSeconds=i.timeoutSeconds),e}var eg=new Map;function yd(i,e,t){if(!t)throw new D(x.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${e}.`)}function vd(i,e,t,n){if(e===!0&&n===!0)throw new D(x.INVALID_ARGUMENT,`${i} and ${t} cannot be used together.`)}function tg(i){if(!U.isDocumentKey(i))throw new D(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function ng(i){if(U.isDocumentKey(i))throw new D(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function bl(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(i);return e?`a custom ${e} object`:"an object"}}return typeof i=="function"?"a function":j()}function ue(i,e){if("_delegate"in i&&(i=i._delegate),!(i instanceof e)){if(e.name===i.constructor.name)throw new D(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=bl(i);throw new D(x.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return i}function V_(i,e){if(e<=0)throw new D(x.INVALID_ARGUMENT,`Function ${i}() requires a positive number, but it was: ${e}.`)}var cl=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new D(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new D(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}vd("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=k_((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new D(x.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new D(x.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new D(x.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,r){return n.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Ri=class{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cl({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new D(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cl(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Kc;switch(n.type){case"firstParty":return new Wc(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new D(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return P(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let n=eg.get(t);n&&(V("ComponentProvider","Removing Datastore"),eg.delete(t),n.terminate())}(this),Promise.resolve()}};function O_(i,e,t,n={}){var r;let s=(i=ue(i,Ri))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Ft("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),i._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),n.mockUserToken){let l,c;if(typeof n.mockUserToken=="string")l=n.mockUserToken,c=Le.MOCK_USER;else{l=Sp(n.mockUserToken,(r=i._app)===null||r===void 0?void 0:r.options.projectId);let h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new D(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Le(h)}i._authCredentials=new $c(new Ia(l,c))}}var Qe=class i{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new i(this.firestore,e,this._query)}},ve=class i{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Yt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new i(this.firestore,e,this._key)}},Yt=class i extends Qe{constructor(e,t,n){super(e,t,Mr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ve(this.firestore,null,new U(e))}withConverter(e){return new i(this.firestore,e,this._path)}};function wd(i,e,...t){if(i=Ee(i),yd("collection","path",e),i instanceof Ri){let n=ae.fromString(e,...t);return ng(n),new Yt(i,null,n)}{if(!(i instanceof ve||i instanceof Yt))throw new D(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=i._path.child(ae.fromString(e,...t));return ng(n),new Yt(i.firestore,null,n)}}function N_(i,e){if(i=ue(i,Ri),yd("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new D(x.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Qe(i,null,function(n){return new Lt(ae.emptyPath(),n)}(e))}function uo(i,e,...t){if(i=Ee(i),arguments.length===1&&(e=Ea.newId()),yd("doc","path",e),i instanceof Ri){let n=ae.fromString(e,...t);return tg(n),new ve(i,null,new U(n))}{if(!(i instanceof ve||i instanceof Yt))throw new D(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=i._path.child(ae.fromString(e,...t));return tg(n),new ve(i.firestore,i instanceof Yt?i.converter:null,new U(n))}}function Td(i,e){return i=Ee(i),e=Ee(e),(i instanceof ve||i instanceof Yt)&&(e instanceof ve||e instanceof Yt)&&i.firestore===e.firestore&&i.path===e.path&&i.converter===e.converter}function Id(i,e){return i=Ee(i),e=Ee(e),i instanceof Qe&&e instanceof Qe&&i.firestore===e.firestore&&oo(i._query,e._query)&&i.converter===e.converter}var ul=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Zs(this,"async_queue_retry"),this.Vu=()=>{let n=Ta();n&&V("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;let t=Ta();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=Ta();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new je;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return P(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Jn(e))throw e;V("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;let r=function(o){let l=o.message||"";return o.stack&&(l=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),l}(n);throw ke("INTERNAL UNHANDLED ERROR: ",r),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let r=ph.createAndSchedule(this,e,t,n,s=>this.yu(s));return this.Tu.push(r),r}fu(){this.Eu&&j()}verifyOperationInProgress(){}wu(){return P(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function Rh(i){return function(t,n){if(typeof t!="object"||t===null)return!1;let r=t;for(let s of n)if(s in r&&typeof r[s]=="function")return!0;return!1}(i,["next","error","complete"])}var Dh=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new je,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var M_=-1,Ae=class extends Ri{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new ul,this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return P(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new ul(e),this._firestoreClient=void 0,yield e}})}};function We(i){if(i._terminated)throw new D(x.FAILED_PRECONDITION,"The client has already been terminated.");return i._firestoreClient||F_(i),i._firestoreClient}function F_(i){var e,t,n;let r=i._freezeSettings(),s=function(l,c,h,m){return new iu(l,c,h,m.host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,k_(m.experimentalLongPollingOptions),m.useFetchStreams)}(i._databaseId,((e=i._app)===null||e===void 0?void 0:e.options.appId)||"",i._persistenceKey,r);i._componentsProvider||!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=r.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(i._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),i._firestoreClient=new Ph(i._authCredentials,i._appCheckCredentials,i._queue,s,i._componentsProvider&&function(l){let c=l?._online.build();return{_offline:l?._offline.build(c),_online:c}}(i._componentsProvider))}function L_(i,e){Ft("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=i._freezeSettings();return B_(i,pd.provider,{build:n=>new ll(n,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function z_(i){return P(this,null,function*(){Ft("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=i._freezeSettings();B_(i,pd.provider,{build:t=>new Ch(t,e.cacheSizeBytes)})})}function B_(i,e,t){if((i=ue(i,Ae))._firestoreClient||i._terminated)throw new D(x.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(i._componentsProvider||i._getSettings().localCache)throw new D(x.FAILED_PRECONDITION,"SDK cache is already specified.");i._componentsProvider={_online:e,_offline:t},F_(i)}function U_(i){if(i._initialized&&!i._terminated)throw new D(x.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new je;return i._queue.enqueueAndForgetEvenWhileRestricted(()=>P(this,null,function*(){try{yield function(n){return P(this,null,function*(){if(!qn.D())return Promise.resolve();let r=n+"main";yield qn.delete(r)})}(nd(i._databaseId,i._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function q_(i){return function(t){let n=new je;return t.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return Yv(yield _d(t),n)})),n.promise}(We(i=ue(i,Ae)))}function j_(i){return cw(We(i=ue(i,Ae)))}function G_(i){return uw(We(i=ue(i,Ae)))}function K_(i,e){let t=We(i=ue(i,Ae)),n=new Dh;return pw(t,i._databaseId,e,n),n}function $_(i,e){return fw(We(i=ue(i,Ae)),e).then(t=>t?new Qe(i,null,t.query):null)}var en=class i{constructor(e){this._byteString=e}static fromBase64String(e){try{return new i(Ne.fromBase64String(e))}catch(t){throw new D(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new i(Ne.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Bt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ve(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var _n=class{constructor(e){this._methodName=e}};var Di=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return J(this._lat,e._lat)||J(this._long,e._long)}};var to=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,r){if(n.length!==r.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==r[s])return!1;return!0}(this._values,e._values)}};var gw=/^__.*__$/,kh=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new zt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Qn(e,this.data,t,this.fieldTransforms)}},hl=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new zt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function H_(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw j()}}var dl=class i{constructor(e,t,n,r,s,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new i(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.Ou(e),r}Nu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return ml(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(H_(this.Cu)&&gw.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},Vh=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||lo(e)}Qu(e,t,n,r=!1){return new dl({Cu:e,methodName:t,qu:n,path:Ve.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Ni(i){let e=i._freezeSettings(),t=lo(i._databaseId);return new Vh(i._databaseId,!!e.ignoreUndefinedProperties,t)}function Cl(i,e,t,n,r,s={}){let o=i.Qu(s.merge||s.mergeFields?2:0,e,t,r);Cd("Data must be an object, but it was:",o,n);let l=Y_(n,o),c,h;if(s.merge)c=new Tt(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){let m=[];for(let f of s.mergeFields){let _=Lh(e,f,t);if(!o.contains(_))throw new D(x.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);J_(m,_)||m.push(_)}c=new Tt(m),h=o.fieldTransforms.filter(f=>c.covers(f.field))}else c=null,h=o.fieldTransforms;return new kh(new tt(l),c,h)}var no=class i extends _n{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof i}};function Q_(i,e,t){return new dl({Cu:3,qu:e.settings.qu,methodName:i._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Oh=class i extends _n{_toFieldTransform(e){return new Si(e.path,new $n)}isEqual(e){return e instanceof i}},Nh=class i extends _n{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=Q_(this,e,!0),n=this.Ku.map(s=>Mi(s,t)),r=new fn(n);return new Si(e.path,r)}isEqual(e){return e instanceof i&&yc(this.Ku,e.Ku)}},Mh=class i extends _n{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=Q_(this,e,!0),n=this.Ku.map(s=>Mi(s,t)),r=new gn(n);return new Si(e.path,r)}isEqual(e){return e instanceof i&&yc(this.Ku,e.Ku)}},Fh=class i extends _n{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){let t=new Hn(e.serializer,Ng(e.serializer,this.$u));return new Si(e.path,t)}isEqual(e){return e instanceof i&&this.$u===e.$u}};function Ed(i,e,t,n){let r=i.Qu(1,e,t);Cd("Data must be an object, but it was:",r,n);let s=[],o=tt.empty();Oi(n,(c,h)=>{let m=Ad(e,c,t);h=Ee(h);let f=r.Nu(m);if(h instanceof no)s.push(m);else{let _=Mi(h,f);_!=null&&(s.push(m),o.set(m,_))}});let l=new Tt(s);return new hl(o,l,r.fieldTransforms)}function bd(i,e,t,n,r,s){let o=i.Qu(1,e,t),l=[Lh(e,n,t)],c=[r];if(s.length%2!=0)throw new D(x.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)l.push(Lh(e,s[_])),c.push(s[_+1]);let h=[],m=tt.empty();for(let _=l.length-1;_>=0;--_)if(!J_(h,l[_])){let b=l[_],k=c[_];k=Ee(k);let O=o.Nu(b);if(k instanceof no)h.push(b);else{let R=Mi(k,O);R!=null&&(h.push(b),m.set(b,R))}}let f=new Tt(h);return new hl(m,f,o.fieldTransforms)}function W_(i,e,t,n=!1){return Mi(t,i.Qu(n?4:3,e))}function Mi(i,e){if(X_(i=Ee(i)))return Cd("Unsupported field value:",e,i),Y_(i,e);if(i instanceof _n)return function(n,r){if(!H_(r.Cu))throw r.Bu(`${n._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Bu(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(i,e),null;if(i===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,r){let s=[],o=0;for(let l of n){let c=Mi(l,r.Lu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(i,e)}return function(n,r){if((n=Ee(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Ng(r.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=Ce.fromDate(n);return{timestampValue:br(r.serializer,s)}}if(n instanceof Ce){let s=new Ce(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:br(r.serializer,s)}}if(n instanceof Di)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof en)return{bytesValue:Kg(r.serializer,n._byteString)};if(n instanceof ve){let s=r.databaseId,o=n.firestore._databaseId;if(!o.isEqual(s))throw r.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Zh(n.firestore._databaseId||r.databaseId,n._key.path)}}if(n instanceof to)return function(o,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw l.Bu("VectorValues must only contain numeric values.");return Jh(l.serializer,c)})}}}}}}(n,r);throw r.Bu(`Unsupported field value: ${bl(n)}`)}(i,e)}function Y_(i,e){let t={};return _g(i)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Oi(i,(n,r)=>{let s=Mi(r,e.Mu(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function X_(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof Ce||i instanceof Di||i instanceof en||i instanceof ve||i instanceof _n||i instanceof to)}function Cd(i,e,t){if(!X_(t)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(t)){let n=bl(t);throw n==="an object"?e.Bu(i+" a custom object"):e.Bu(i+" "+n)}}function Lh(i,e,t){if((e=Ee(e))instanceof Bt)return e._internalPath;if(typeof e=="string")return Ad(i,e);throw ml("Field path arguments must be of type string or ",i,!1,void 0,t)}var _w=new RegExp("[~\\*/\\[\\]]");function Ad(i,e,t){if(e.search(_w)>=0)throw ml(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,t);try{return new Bt(...e.split("."))._internalPath}catch{throw ml(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,t)}}function ml(i,e,t,n,r){let s=n&&!n.isEmpty(),o=r!==void 0,l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${n}`),o&&(c+=` in document ${r}`),c+=")"),new D(x.INVALID_ARGUMENT,l+i+c)}function J_(i,e){return i.some(t=>t.isEqual(e))}var ki=class{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ve(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new zh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Al("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},zh=class extends ki{data(){return super.data()}};function Al(i,e){return typeof e=="string"?Ad(i,e):e instanceof Bt?e._internalPath:e._delegate._internalPath}function Z_(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new D(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var io=class{},Vi=class extends io{};function wn(i,e,...t){let n=[];e instanceof io&&n.push(e),n=n.concat(t),function(s){let o=s.filter(c=>c instanceof Bh).length,l=s.filter(c=>c instanceof pl).length;if(o>1||o>0&&l>0)throw new D(x.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let r of n)i=r._apply(i);return i}var pl=class i extends Vi{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=this._parse(e);return c0(e._query,t),new Qe(e.firestore,e.converter,gu(e._query,t))}_parse(e){let t=Ni(e.firestore);return function(s,o,l,c,h,m,f){let _;if(h.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new D(x.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){rg(f,m);let b=[];for(let k of f)b.push(ig(c,s,k));_={arrayValue:{values:b}}}else _=ig(c,s,f)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||rg(f,m),_=W_(l,o,f,m==="in"||m==="not-in");return ie.create(h,m,_)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function e0(i,e,t){let n=e,r=Al("where",i);return pl._create(r,n,t)}var Bh=class i extends io{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new i(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:me.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(r,s){let o=r,l=s.getFlattenedFilters();for(let c of l)c0(o,c),o=gu(o,c)}(e._query,t),new Qe(e.firestore,e.converter,gu(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Uh=class i extends Vi{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new i(e,t)}_apply(e){let t=function(r,s,o){if(r.startAt!==null)throw new D(x.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new D(x.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ci(s,o)}(e._query,this._field,this._direction);return new Qe(e.firestore,e.converter,function(r,s){let o=r.explicitOrderBy.concat([s]);return new Lt(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}};function t0(i,e="asc"){let t=e,n=Al("orderBy",i);return Uh._create(n,t)}var fl=class i extends Vi{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new i(e,t,n)}_apply(e){return new Qe(e.firestore,e.converter,Va(e._query,this._limit,this._limitType))}};function n0(i){return V_("limit",i),fl._create("limit",i,"F")}function i0(i){return V_("limitToLast",i),fl._create("limitToLast",i,"L")}var gl=class i extends Vi{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=l0(e,this.type,this._docOrFields,this._inclusive);return new Qe(e.firestore,e.converter,function(r,s){return new Lt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)}(e._query,t))}};function r0(...i){return gl._create("startAt",i,!0)}function s0(...i){return gl._create("startAfter",i,!1)}var _l=class i extends Vi{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=l0(e,this.type,this._docOrFields,this._inclusive);return new Qe(e.firestore,e.converter,function(r,s){return new Lt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)}(e._query,t))}};function o0(...i){return _l._create("endBefore",i,!1)}function a0(...i){return _l._create("endAt",i,!0)}function l0(i,e,t,n){if(t[0]=Ee(t[0]),t[0]instanceof ki)return function(s,o,l,c,h){if(!c)throw new D(x.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${l}().`);let m=[];for(let f of gr(s))if(f.field.isKeyField())m.push(bi(o,c.key));else{let _=c.data.field(f.field);if(vl(_))throw new D(x.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let b=f.field.canonicalString();throw new D(x.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${b}' (used as the orderBy) does not exist.`)}m.push(_)}return new Jt(m,h)}(i._query,i.firestore._databaseId,e,t[0]._document,n);{let r=Ni(i.firestore);return function(o,l,c,h,m,f){let _=o.explicitOrderBy;if(m.length>_.length)throw new D(x.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let b=[];for(let k=0;k<m.length;k++){let O=m[k];if(_[k].field.isKeyField()){if(typeof O!="string")throw new D(x.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof O}`);if(!Yh(o)&&O.indexOf("/")!==-1)throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${O}' contains a slash.`);let R=o.path.child(ae.fromString(O));if(!U.isDocumentKey(R))throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);let $=new U(R);b.push(bi(l,$))}else{let R=W_(c,h,O);b.push(R)}}return new Jt(b,f)}(i._query,i.firestore._databaseId,r,e,t,n)}}function ig(i,e,t){if(typeof(t=Ee(t))=="string"){if(t==="")throw new D(x.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yh(e)&&t.indexOf("/")!==-1)throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(ae.fromString(t));if(!U.isDocumentKey(n))throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return bi(i,new U(n))}if(t instanceof ve)return bi(i,t._key);throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${bl(t)}.`)}function rg(i,e){if(!Array.isArray(i)||i.length===0)throw new D(x.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function c0(i,e){let t=function(r,s){for(let o of r)for(let l of o.getFlattenedFilters())if(s.indexOf(l.op)>=0)return l.op;return null}(i.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new D(x.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(x.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Or=class{convertValue(e,t="none"){switch(Ei(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ie(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(jn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw j()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return Oi(e,(r,s)=>{n[r]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,r;let s=(r=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||r===void 0?void 0:r.map(o=>Ie(o.doubleValue));return new to(s)}convertGeoPoint(e){return new Di(Ie(e.latitude),Ie(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=Qh(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Bs(e));default:return null}}convertTimestamp(e){let t=pn(e);return new Ce(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=ae.fromString(e);G(n_(n));let r=new Gn(n.get(1),n.get(3)),s=new U(n.popFirst(5));return r.isEqual(t)||ke(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Sl(i,e,t){let n;return n=i?t&&(t.merge||t.mergeFields)?i.toFirestore(e,t):i.toFirestore(e):e,n}var qh=class extends Or{constructor(e){super(),this.firestore=e}convertBytes(e){return new en(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ve(this.firestore,null,t)}};var mn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Dt=class extends ki{constructor(e,t,n,r,s,o){super(e,t,n,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Bn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(Al("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}},Bn=class extends Dt{data(e={}){return super.data(e)}},Ut=class{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new mn(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Bn(this._firestore,this._userDataWriter,n.key,n,new mn(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(l=>{let c=new Bn(r._firestore,r._userDataWriter,l.doc.key,l.doc,new mn(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(l=>s||l.type!==3).map(l=>{let c=new Bn(r._firestore,r._userDataWriter,l.doc.key,l.doc,new mn(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter),h=-1,m=-1;return l.type!==0&&(h=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),m=o.indexOf(l.doc.key)),{type:yw(l.type),doc:c,oldIndex:h,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function yw(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return j()}}function Sd(i,e){return i instanceof Dt&&e instanceof Dt?i._firestore===e._firestore&&i._key.isEqual(e._key)&&(i._document===null?e._document===null:i._document.isEqual(e._document))&&i._converter===e._converter:i instanceof Ut&&e instanceof Ut&&i._firestore===e._firestore&&Id(i.query,e.query)&&i.metadata.isEqual(e.metadata)&&i._snapshot.isEqual(e._snapshot)}function u0(i){i=ue(i,ve);let e=ue(i.firestore,Ae);return R_(We(e),i._key).then(t=>Dd(e,i,t))}var yn=class extends Or{constructor(e){super(),this.firestore=e}convertBytes(e){return new en(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ve(this.firestore,null,t)}};function h0(i){i=ue(i,ve);let e=ue(i.firestore,Ae),t=We(e),n=new yn(e);return hw(t,i._key).then(r=>new Dt(e,n,i._key,r,new mn(r!==null&&r.hasLocalMutations,!0),i.converter))}function d0(i){i=ue(i,ve);let e=ue(i.firestore,Ae);return R_(We(e),i._key,{source:"server"}).then(t=>Dd(e,i,t))}function m0(i){i=ue(i,Qe);let e=ue(i.firestore,Ae),t=We(e),n=new yn(e);return Z_(i._query),D_(t,i._query).then(r=>new Ut(e,n,i,r))}function p0(i){i=ue(i,Qe);let e=ue(i.firestore,Ae),t=We(e),n=new yn(e);return dw(t,i._query).then(r=>new Ut(e,n,i,r))}function f0(i){i=ue(i,Qe);let e=ue(i.firestore,Ae),t=We(e),n=new yn(e);return D_(t,i._query,{source:"server"}).then(r=>new Ut(e,n,i,r))}function xd(i,e,t){i=ue(i,ve);let n=ue(i.firestore,Ae),r=Sl(i.converter,e,t);return Ur(n,[Cl(Ni(n),"setDoc",i._key,r,i.converter!==null,t).toMutation(i._key,Re.none())])}function Pd(i,e,t,...n){i=ue(i,ve);let r=ue(i.firestore,Ae),s=Ni(r),o;return o=typeof(e=Ee(e))=="string"||e instanceof Bt?bd(s,"updateDoc",i._key,e,t,n):Ed(s,"updateDoc",i._key,e),Ur(r,[o.toMutation(i._key,Re.exists(!0))])}function g0(i){return Ur(ue(i.firestore,Ae),[new Wn(i._key,Re.none())])}function _0(i,e){let t=ue(i.firestore,Ae),n=uo(i),r=Sl(i.converter,e);return Ur(t,[Cl(Ni(i.firestore),"addDoc",n._key,r,i.converter!==null,{}).toMutation(n._key,Re.exists(!1))]).then(()=>n)}function Rd(i,...e){var t,n,r;i=Ee(i);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Rh(e[o])||(s=e[o],o++);let l={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Rh(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(n=f.error)===null||n===void 0?void 0:n.bind(f),e[o+2]=(r=f.complete)===null||r===void 0?void 0:r.bind(f)}let c,h,m;if(i instanceof ve)h=ue(i.firestore,Ae),m=Mr(i._key.path),c={next:f=>{e[o]&&e[o](Dd(h,i,f))},error:e[o+1],complete:e[o+2]};else{let f=ue(i,Qe);h=ue(f.firestore,Ae),m=f._query;let _=new yn(h);c={next:b=>{e[o]&&e[o](new Ut(h,_,f,b))},error:e[o+1],complete:e[o+2]},Z_(i._query)}return function(_,b,k,O){let R=new kr(O),$=new eo(b,R,k);return _.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return od(yield Vr(_),$)})),()=>{R.Za(),_.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return ad(yield Vr(_),$)}))}}(We(h),m,l,c)}function y0(i,e){return mw(We(i=ue(i,Ae)),Rh(e)?e:{next:e})}function Ur(i,e){return function(n,r){let s=new je;return n.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return $v(yield _d(n),r,s)})),s.promise}(We(i),e)}function Dd(i,e,t){let n=t.docs.get(e._key),r=new yn(i);return new Dt(i,r,e._key,n,new mn(t.hasPendingWrites,t.fromCache),e.converter)}var vw={maxAttempts:5};var yl=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ni(e)}set(e,t,n){this._verifyNotCommitted();let r=Ln(e,this._firestore),s=Sl(r.converter,t,n),o=Cl(this._dataReader,"WriteBatch.set",r._key,s,r.converter!==null,n);return this._mutations.push(o.toMutation(r._key,Re.none())),this}update(e,t,n,...r){this._verifyNotCommitted();let s=Ln(e,this._firestore),o;return o=typeof(t=Ee(t))=="string"||t instanceof Bt?bd(this._dataReader,"WriteBatch.update",s._key,t,n,r):Ed(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Re.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Ln(e,this._firestore);return this._mutations=this._mutations.concat(new Wn(t._key,Re.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(x.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ln(i,e){if((i=Ee(i)).firestore!==e)throw new D(x.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return i}var jh=class extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=Ni(t)}get(t){let n=Ln(t,this._firestore),r=new qh(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||s.length!==1)return j();let o=s[0];if(o.isFoundDocument())return new ki(this._firestore,r,o.key,o,n.converter);if(o.isNoDocument())return new ki(this._firestore,r,n._key,null,n.converter);throw j()})}set(t,n,r){let s=Ln(t,this._firestore),o=Sl(s.converter,n,r),l=Cl(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,r);return this._transaction.set(s._key,l),this}update(t,n,r,...s){let o=Ln(t,this._firestore),l;return l=typeof(n=Ee(n))=="string"||n instanceof Bt?bd(this._dataReader,"Transaction.update",o._key,n,r,s):Ed(this._dataReader,"Transaction.update",o._key,n),this._transaction.update(o._key,l),this}delete(t){let n=Ln(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Ln(e,this._firestore),n=new yn(this._firestore);return super.get(e).then(r=>new Dt(this._firestore,n,t._key,r._document,new mn(!1,!1),t.converter))}};function v0(i,e,t){i=ue(i,Ae);let n=Object.assign(Object.assign({},vw),t);return function(s){if(s.maxAttempts<1)throw new D(x.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,o,l){let c=new je;return s.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){let h=yield lw(s);new xh(s.asyncQueue,h,l,o,c).au()})),c.promise}(We(i),r=>e(new jh(i,r)),n)}function w0(){return new no("deleteField")}function T0(){return new Oh("serverTimestamp")}function I0(...i){return new Nh("arrayUnion",i)}function E0(...i){return new Mh("arrayRemove",i)}function b0(i){return new Fh("increment",i)}(function(e,t=!0){(function(r){Nr=r})(Rp),ws(new mi("firestore",(n,{instanceIdentifier:r,options:s})=>{let o=n.getProvider("app").getImmediate(),l=new Ae(new Hc(n.getProvider("auth-internal")),new Xc(n.getProvider("app-check-internal")),function(h,m){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new D(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Gn(h.options.projectId,m)}(o,r),o);return s=Object.assign({useFetchStreams:t},s),l._setSettings(s),l},"PUBLIC").setMultipleInstances(!0)),kn(tf,"4.7.3",e),kn(tf,"4.7.3","esm2017")})();var ww="@firebase/firestore-compat",Tw="0.3.38";function Fd(i,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new D("invalid-argument",`Invalid options passed to function ${i}(): You cannot specify both "merge" and "mergeFields".`);return e}function C0(){if(typeof Uint8Array>"u")throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function A0(){if(!yg())throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}var xl=class i{constructor(e){this._delegate=e}static fromBase64String(e){return A0(),new i(en.fromBase64String(e))}static fromUint8Array(e){return C0(),new i(en.fromUint8Array(e))}toBase64(){return A0(),this._delegate.toBase64()}toUint8Array(){return C0(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function kd(i){return Iw(i,["next","error","complete"])}function Iw(i,e){if(typeof i!="object"||i===null)return!1;let t=i;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}var Vd=class{enableIndexedDbPersistence(e,t){return L_(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return z_(e._delegate)}clearIndexedDbPersistence(e){return U_(e._delegate)}},Pl=class{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Gn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ft("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){O_(this._delegate,e,t,n)}enableNetwork(){return j_(this._delegate)}disableNetwork(){return G_(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,vd("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return q_(this._delegate)}onSnapshotsInSync(e){return y0(this._delegate,e)}get app(){if(!this._appCompat)throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Gr(this,wd(this._delegate,e))}catch(t){throw at(t,"collection()","Firestore.collection()")}}doc(e){try{return new tn(this,uo(this._delegate,e))}catch(t){throw at(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Bi(this,N_(this._delegate,e))}catch(t){throw at(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return v0(this._delegate,t=>e(new Rl(this,t)))}batch(){return We(this._delegate),new Dl(new yl(this._delegate,e=>Ur(this._delegate,e)))}loadBundle(e){return K_(this._delegate,e)}namedQuery(e){return $_(this._delegate,e).then(t=>t?new Bi(this,t):null)}},qr=class extends Or{constructor(e){super(),this.firestore=e}convertBytes(e){return new xl(new en(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return tn.forKey(t,this.firestore,null)}};function Ew(i){sg(i)}var Rl=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new qr(e)}get(e){let t=Fi(e);return this._delegate.get(t).then(n=>new Li(this._firestore,new Dt(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){let r=Fi(e);return n?(Fd("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){let s=Fi(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...r),this}delete(e){let t=Fi(e);return this._delegate.delete(t),this}},Dl=class{constructor(e){this._delegate=e}set(e,t,n){let r=Fi(e);return n?(Fd("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){let s=Fi(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...r),this}delete(e){let t=Fi(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},jr=class i{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new Bn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new zi(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=i.INSTANCES,r=n.get(e);r||(r=new WeakMap,n.set(e,r));let s=r.get(t);return s||(s=new i(e,new qr(e),t),r.set(t,s)),s}};jr.INSTANCES=new WeakMap;var tn=class i{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new qr(e)}static forPath(e,t,n){if(e.length%2!==0)throw new D("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new i(t,new ve(t._delegate,n,new U(e)))}static forKey(e,t,n){return new i(t,new ve(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Gr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Gr(this.firestore,wd(this._delegate,e))}catch(t){throw at(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=Ee(e),e instanceof ve?Td(this._delegate,e):!1}set(e,t){t=Fd("DocumentReference.set",t);try{return t?xd(this._delegate,e,t):xd(this._delegate,e)}catch(n){throw at(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return arguments.length===1?Pd(this._delegate,e):Pd(this._delegate,e,t,...n)}catch(r){throw at(r,"updateDoc()","DocumentReference.update()")}}delete(){return g0(this._delegate)}onSnapshot(...e){let t=S0(e),n=x0(e,r=>new Li(this.firestore,new Dt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)));return Rd(this._delegate,t,n)}get(e){let t;return e?.source==="cache"?t=h0(this._delegate):e?.source==="server"?t=d0(this._delegate):t=u0(this._delegate),t.then(n=>new Li(this.firestore,new Dt(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new i(this.firestore,e?this._delegate.withConverter(jr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function at(i,e,t){return i.message=i.message.replace(e,t),i}function S0(i){for(let e of i)if(typeof e=="object"&&!kd(e))return e;return{}}function x0(i,e){var t,n;let r;return kd(i[0])?r=i[0]:kd(i[1])?r=i[1]:typeof i[0]=="function"?r={next:i[0],error:i[1],complete:i[2]}:r={next:i[1],error:i[2],complete:i[3]},{next:s=>{r.next&&r.next(e(s))},error:(t=r.error)===null||t===void 0?void 0:t.bind(r),complete:(n=r.complete)===null||n===void 0?void 0:n.bind(r)}}var Li=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new tn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Sd(this._delegate,e._delegate)}},zi=class extends Li{data(e){let t=this._delegate.data(e);return this._delegate._converter||og(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Bi=class i{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new qr(e)}where(e,t,n){try{return new i(this.firestore,wn(this._delegate,e0(e,t,n)))}catch(r){throw at(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new i(this.firestore,wn(this._delegate,t0(e,t)))}catch(n){throw at(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new i(this.firestore,wn(this._delegate,n0(e)))}catch(t){throw at(t,"limit()","Query.limit()")}}limitToLast(e){try{return new i(this.firestore,wn(this._delegate,i0(e)))}catch(t){throw at(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new i(this.firestore,wn(this._delegate,r0(...e)))}catch(t){throw at(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new i(this.firestore,wn(this._delegate,s0(...e)))}catch(t){throw at(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new i(this.firestore,wn(this._delegate,o0(...e)))}catch(t){throw at(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new i(this.firestore,wn(this._delegate,a0(...e)))}catch(t){throw at(t,"endAt()","Query.endAt()")}}isEqual(e){return Id(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=p0(this._delegate):e?.source==="server"?t=f0(this._delegate):t=m0(this._delegate),t.then(n=>new ho(this.firestore,new Ut(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){let t=S0(e),n=x0(e,r=>new ho(this.firestore,new Ut(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)));return Rd(this._delegate,t,n)}withConverter(e){return new i(this.firestore,e?this._delegate.withConverter(jr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},Od=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new zi(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},ho=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Bi(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new zi(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Od(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new zi(this._firestore,n))})}isEqual(e){return Sd(this._delegate,e._delegate)}},Gr=class i extends Bi{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new tn(this.firestore,e):null}doc(e){try{return e===void 0?new tn(this.firestore,uo(this._delegate)):new tn(this.firestore,uo(this._delegate,e))}catch(t){throw at(t,"doc()","CollectionReference.doc()")}}add(e){return _0(this._delegate,e).then(t=>new tn(this.firestore,t))}isEqual(e){return Td(this._delegate,e._delegate)}withConverter(e){return new i(this.firestore,e?this._delegate.withConverter(jr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Fi(i){return ue(i,ve)}var Nd=class i{constructor(...e){this._delegate=new Bt(...e)}static documentId(){return new i(Ve.keyField().canonicalString())}isEqual(e){return e=Ee(e),e instanceof Bt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Md=class i{constructor(e){this._delegate=e}static serverTimestamp(){let e=T0();return e._methodName="FieldValue.serverTimestamp",new i(e)}static delete(){let e=w0();return e._methodName="FieldValue.delete",new i(e)}static arrayUnion(...e){let t=I0(...e);return t._methodName="FieldValue.arrayUnion",new i(t)}static arrayRemove(...e){let t=E0(...e);return t._methodName="FieldValue.arrayRemove",new i(t)}static increment(e){let t=b0(e);return t._methodName="FieldValue.increment",new i(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var bw={Firestore:Pl,GeoPoint:Di,Timestamp:Ce,Blob:xl,Transaction:Rl,WriteBatch:Dl,DocumentReference:tn,DocumentSnapshot:Li,Query:Bi,QueryDocumentSnapshot:zi,QuerySnapshot:ho,CollectionReference:Gr,FieldPath:Nd,FieldValue:Md,setLogLevel:Ew,CACHE_SIZE_UNLIMITED:M_};function Cw(i,e){i.INTERNAL.registerComponent(new mi("firestore-compat",t=>{let n=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore").getImmediate();return e(n,r)},"PUBLIC").setServiceProps(Object.assign({},bw)))}function Aw(i){Cw(i,(e,t)=>new Pl(e,t,new Vd)),i.registerVersion(ww,Tw)}Aw(pt);function Sw(i,e=Fo){return new Ki(t=>{let n;return e!=null?e.schedule(()=>{n=i.onSnapshot({includeMetadataChanges:!0},t)}):n=i.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}function P0(i,e){return Sw(i,e)}function xw(i,e){return P0(i,e).pipe(Bo(void 0),Lo(),$e(t=>{let[n,r]=t;return r.exists?n?.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}}))}function Bd(i,e){return P0(i,e).pipe($e(t=>({payload:t,type:"query"})))}var kl=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let n=this.ref.collection(e),{ref:r,query:s}=O0(n,t);return new Ol(r,s,this.afs)}snapshotChanges(){return xw(this.ref,this.afs.schedulers.outsideAngular).pipe(ft)}valueChanges(e={}){return this.snapshotChanges().pipe($e(({payload:t})=>e.idField?lc(Vt({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Cn(this.ref.get(e)).pipe(ft)}};function Vl(i,e){return Bd(i,e).pipe(Bo(void 0),Lo(),$e(t=>{let[n,r]=t,s=r.payload.docChanges(),o=s.map(l=>({type:l.type,payload:l}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((l,c)=>{let h=s.find(f=>f.doc.ref.isEqual(l.ref)),m=n?.payload.docs.find(f=>f.ref.isEqual(l.ref));h&&JSON.stringify(h.doc.metadata)===JSON.stringify(l.metadata)||!h&&m&&JSON.stringify(m.metadata)===JSON.stringify(l.metadata)||o.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:l}})}),o}))}function R0(i,e,t){return Vl(i,t).pipe(zo((n,r)=>Pw(n,r.map(s=>s.payload),e),[]),Hm(),$e(n=>n.map(r=>({type:r.type,payload:r}))))}function Pw(i,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(i=Rw(i,n))}),i}function Ld(i,e,t,...n){let r=i.slice();return r.splice(e,t,...n),r}function Rw(i,e){switch(e.type){case"added":if(!(i[e.newIndex]&&i[e.newIndex].doc.ref.isEqual(e.doc.ref)))return Ld(i,e.newIndex,0,e);break;case"modified":if(i[e.oldIndex]==null||i[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=i.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return Ld(i,e.newIndex,1,e);break;case"removed":if(i[e.oldIndex]&&i[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Ld(i,e.oldIndex,1);break}return i}function D0(i){return(!i||i.length===0)&&(i=["added","removed","modified"]),i}var Ol=class{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=Vl(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe($e(n=>n.filter(r=>e.indexOf(r.type)>-1)))),t.pipe(Bo(void 0),Lo(),us(([n,r])=>r.length>0||!n),$e(([,n])=>n),ft)}auditTrail(e){return this.stateChanges(e).pipe(zo((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=D0(e);return R0(this.query,t,this.afs.schedulers.outsideAngular).pipe(ft)}valueChanges(e={}){return Bd(this.query,this.afs.schedulers.outsideAngular).pipe($e(t=>t.payload.docs.map(n=>e.idField?lc(Vt({},n.data()),{[e.idField]:n.id}):n.data())),ft)}get(e){return Cn(this.query.get(e)).pipe(ft)}add(e){return this.ref.add(e)}doc(e){return new kl(this.ref.doc(e),this.afs)}},zd=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Vl(this.query,this.afs.schedulers.outsideAngular).pipe(ft):Vl(this.query,this.afs.schedulers.outsideAngular).pipe($e(t=>t.filter(n=>e.indexOf(n.type)>-1)),us(t=>t.length>0),ft)}auditTrail(e){return this.stateChanges(e).pipe(zo((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=D0(e);return R0(this.query,t,this.afs.schedulers.outsideAngular).pipe(ft)}valueChanges(e={}){return Bd(this.query,this.afs.schedulers.outsideAngular).pipe($e(n=>n.payload.docs.map(r=>e.idField?Vt({[e.idField]:r.id},r.data()):r.data())),ft)}get(e){return Cn(this.query.get(e)).pipe(ft)}},k0=new He("angularfire2.enableFirestorePersistence"),V0=new He("angularfire2.firestore.persistenceSettings"),Dw=new He("angularfire2.firestore.settings"),kw=new He("angularfire2.firestore.use-emulator");function O0(i,e=t=>t){return{query:e(i),ref:i}}var Ud=(()=>{class i{schedulers;firestore;persistenceEnabled$;constructor(t,n,r,s,o,l,c,h,m,f,_,b,k,O,R,$,Q){this.schedulers=c;let z=bs(t,l,n),W=m;f&&Vc(z,l,_,k,O,R,b,$),[this.firestore,this.persistenceEnabled$]=ua(`${z.name}.firestore`,"AngularFirestore",z.name,()=>{let Z=l.runOutsideAngular(()=>z.firestore());if(s&&Z.settings(s),W&&Z.useEmulator(...W),r&&!Wo(o)){let ee=()=>{try{return Cn(Z.enablePersistence(h||void 0).then(()=>!0,()=>!1))}catch(w){return typeof console<"u"&&console.warn(w),An(!1)}};return[Z,l.runOutsideAngular(ee)]}else return[Z,An(!1)]},[s,W,r])}collection(t,n){let r;typeof t=="string"?r=this.firestore.collection(t):r=t;let{ref:s,query:o}=O0(r,n),l=this.schedulers.ngZone.run(()=>s);return new Ol(l,o,this)}collectionGroup(t,n){let r=n||(o=>o),s=this.firestore.collectionGroup(t);return new zd(r(s),this)}doc(t){let n;typeof t=="string"?n=this.firestore.doc(t):n=t;let r=this.schedulers.ngZone.run(()=>n);return new kl(r,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||i)(Y(nr),Y(ir,8),Y(k0,8),Y(Dw,8),Y(bt),Y(ut),Y(aa),Y(V0,8),Y(kw,8),Y(Jp,8),Y(Sc,8),Y(xc,8),Y(Pc,8),Y(Rc,8),Y(Dc,8),Y(kc,8),Y(pi,8))};static \u0275prov=lt({token:i,factory:i.\u0275fac,providedIn:"any"})}return i})(),N0=(()=>{class i{constructor(){pt.registerVersion("angularfire",tr.full,"fst-compat")}static enablePersistence(t){return{ngModule:i,providers:[{provide:k0,useValue:!0},{provide:V0,useValue:t}]}}static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ue({type:i});static \u0275inj=Be({providers:[Ud]})}return i})();var Nl=(()=>{class i{constructor(t){this.db=t,this.dbPath="/puzzledata",this.puzzleDataRef=this.db.collection(this.dbPath)}getAll(){return this.puzzleDataRef}create(t){return this.puzzleDataRef.add(Vt({},t))}update(t,n){return this.puzzleDataRef.doc(t).update(n)}delete(t){return this.puzzleDataRef.doc(t).delete()}static{this.\u0275fac=function(n){return new(n||i)(Y(Ud))}}static{this.\u0275prov=lt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Ml=(()=>{class i{constructor(){this.subjectItemUpdate=new $i}updatePerformedItem(t){this.subjectItemUpdate.next(t)}getUpdatedStageLevel(){return this.subjectItemUpdate.asObservable()}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=lt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var mo=(()=>{class i extends xt{static \u0275fac=(()=>{let t;return function(r){return(t||(t=Et(i)))(r||i)}})();static \u0275cmp=_e({type:i,selectors:[["CheckIcon"]],features:[Ct],decls:2,vars:5,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M4.86199 11.5948C4.78717 11.5923 4.71366 11.5745 4.64596 11.5426C4.57826 11.5107 4.51779 11.4652 4.46827 11.4091L0.753985 7.69483C0.683167 7.64891 0.623706 7.58751 0.580092 7.51525C0.536478 7.44299 0.509851 7.36177 0.502221 7.27771C0.49459 7.19366 0.506156 7.10897 0.536046 7.03004C0.565935 6.95111 0.613367 6.88 0.674759 6.82208C0.736151 6.76416 0.8099 6.72095 0.890436 6.69571C0.970973 6.67046 1.05619 6.66385 1.13966 6.67635C1.22313 6.68886 1.30266 6.72017 1.37226 6.76792C1.44186 6.81567 1.4997 6.8786 1.54141 6.95197L4.86199 10.2503L12.6397 2.49483C12.7444 2.42694 12.8689 2.39617 12.9932 2.40745C13.1174 2.41873 13.2343 2.47141 13.3251 2.55705C13.4159 2.64268 13.4753 2.75632 13.4938 2.87973C13.5123 3.00315 13.4888 3.1292 13.4271 3.23768L5.2557 11.4091C5.20618 11.4652 5.14571 11.5107 5.07801 11.5426C5.01031 11.5745 4.9368 11.5923 4.86199 11.5948Z","fill","currentColor"]],template:function(n,r){n&1&&(It(),L(0,"svg",0),X(1,"path",1),q()),n&2&&(xe(r.getClassNames()),re("aria-label",r.ariaLabel)("aria-hidden",r.ariaHidden)("role",r.role))},encapsulation:2})}return i})();var po=(()=>{class i extends xt{pathId;ngOnInit(){this.pathId="url(#"+rt()+")"}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Et(i)))(r||i)}})();static \u0275cmp=_e({type:i,selectors:[["ExclamationTriangleIcon"]],features:[Ct],decls:8,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M13.4018 13.1893H0.598161C0.49329 13.189 0.390283 13.1615 0.299143 13.1097C0.208003 13.0578 0.131826 12.9832 0.0780112 12.8932C0.0268539 12.8015 0 12.6982 0 12.5931C0 12.4881 0.0268539 12.3848 0.0780112 12.293L6.47985 1.08982C6.53679 1.00399 6.61408 0.933574 6.70484 0.884867C6.7956 0.836159 6.897 0.810669 7 0.810669C7.103 0.810669 7.2044 0.836159 7.29516 0.884867C7.38592 0.933574 7.46321 1.00399 7.52015 1.08982L13.922 12.293C13.9731 12.3848 14 12.4881 14 12.5931C14 12.6982 13.9731 12.8015 13.922 12.8932C13.8682 12.9832 13.792 13.0578 13.7009 13.1097C13.6097 13.1615 13.5067 13.189 13.4018 13.1893ZM1.63046 11.989H12.3695L7 2.59425L1.63046 11.989Z","fill","currentColor"],["d","M6.99996 8.78801C6.84143 8.78594 6.68997 8.72204 6.57787 8.60993C6.46576 8.49782 6.40186 8.34637 6.39979 8.18784V5.38703C6.39979 5.22786 6.46302 5.0752 6.57557 4.96265C6.68813 4.85009 6.84078 4.78686 6.99996 4.78686C7.15914 4.78686 7.31179 4.85009 7.42435 4.96265C7.5369 5.0752 7.60013 5.22786 7.60013 5.38703V8.18784C7.59806 8.34637 7.53416 8.49782 7.42205 8.60993C7.30995 8.72204 7.15849 8.78594 6.99996 8.78801Z","fill","currentColor"],["d","M6.99996 11.1887C6.84143 11.1866 6.68997 11.1227 6.57787 11.0106C6.46576 10.8985 6.40186 10.7471 6.39979 10.5885V10.1884C6.39979 10.0292 6.46302 9.87658 6.57557 9.76403C6.68813 9.65147 6.84078 9.58824 6.99996 9.58824C7.15914 9.58824 7.31179 9.65147 7.42435 9.76403C7.5369 9.87658 7.60013 10.0292 7.60013 10.1884V10.5885C7.59806 10.7471 7.53416 10.8985 7.42205 11.0106C7.30995 11.1227 7.15849 11.1866 6.99996 11.1887Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,r){n&1&&(It(),L(0,"svg",0)(1,"g"),X(2,"path",1)(3,"path",2)(4,"path",3),q(),L(5,"defs")(6,"clipPath",4),X(7,"rect",5),q()()()),n&2&&(xe(r.getClassNames()),re("aria-label",r.ariaLabel)("aria-hidden",r.ariaHidden)("role",r.role),N(),re("clip-path",r.pathId),N(5),M("id",r.pathId))},encapsulation:2})}return i})();var fo=(()=>{class i extends xt{pathId;ngOnInit(){this.pathId="url(#"+rt()+")"}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Et(i)))(r||i)}})();static \u0275cmp=_e({type:i,selectors:[["InfoCircleIcon"]],features:[Ct],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M3.11101 12.8203C4.26215 13.5895 5.61553 14 7 14C8.85652 14 10.637 13.2625 11.9497 11.9497C13.2625 10.637 14 8.85652 14 7C14 5.61553 13.5895 4.26215 12.8203 3.11101C12.0511 1.95987 10.9579 1.06266 9.67879 0.532846C8.3997 0.00303296 6.99224 -0.13559 5.63437 0.134506C4.2765 0.404603 3.02922 1.07129 2.05026 2.05026C1.07129 3.02922 0.404603 4.2765 0.134506 5.63437C-0.13559 6.99224 0.00303296 8.3997 0.532846 9.67879C1.06266 10.9579 1.95987 12.0511 3.11101 12.8203ZM3.75918 2.14976C4.71846 1.50879 5.84628 1.16667 7 1.16667C8.5471 1.16667 10.0308 1.78125 11.1248 2.87521C12.2188 3.96918 12.8333 5.45291 12.8333 7C12.8333 8.15373 12.4912 9.28154 11.8502 10.2408C11.2093 11.2001 10.2982 11.9478 9.23232 12.3893C8.16642 12.8308 6.99353 12.9463 5.86198 12.7212C4.73042 12.4962 3.69102 11.9406 2.87521 11.1248C2.05941 10.309 1.50384 9.26958 1.27876 8.13803C1.05367 7.00647 1.16919 5.83358 1.61071 4.76768C2.05222 3.70178 2.79989 2.79074 3.75918 2.14976ZM7.00002 4.8611C6.84594 4.85908 6.69873 4.79698 6.58977 4.68801C6.48081 4.57905 6.4187 4.43185 6.41669 4.27776V3.88888C6.41669 3.73417 6.47815 3.58579 6.58754 3.4764C6.69694 3.367 6.84531 3.30554 7.00002 3.30554C7.15473 3.30554 7.3031 3.367 7.4125 3.4764C7.52189 3.58579 7.58335 3.73417 7.58335 3.88888V4.27776C7.58134 4.43185 7.51923 4.57905 7.41027 4.68801C7.30131 4.79698 7.1541 4.85908 7.00002 4.8611ZM7.00002 10.6945C6.84594 10.6925 6.69873 10.6304 6.58977 10.5214C6.48081 10.4124 6.4187 10.2652 6.41669 10.1111V6.22225C6.41669 6.06754 6.47815 5.91917 6.58754 5.80977C6.69694 5.70037 6.84531 5.63892 7.00002 5.63892C7.15473 5.63892 7.3031 5.70037 7.4125 5.80977C7.52189 5.91917 7.58335 6.06754 7.58335 6.22225V10.1111C7.58134 10.2652 7.51923 10.4124 7.41027 10.5214C7.30131 10.6304 7.1541 10.6925 7.00002 10.6945Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,r){n&1&&(It(),L(0,"svg",0)(1,"g"),X(2,"path",1),q(),L(3,"defs")(4,"clipPath",2),X(5,"rect",3),q()()()),n&2&&(xe(r.getClassNames()),re("aria-label",r.ariaLabel)("aria-hidden",r.ariaHidden)("role",r.role),N(),re("clip-path",r.pathId),N(3),M("id",r.pathId))},encapsulation:2})}return i})();var go=(()=>{class i extends xt{pathId;ngOnInit(){this.pathId="url(#"+rt()+")"}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Et(i)))(r||i)}})();static \u0275cmp=_e({type:i,selectors:[["TimesCircleIcon"]],features:[Ct],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M7 14C5.61553 14 4.26215 13.5895 3.11101 12.8203C1.95987 12.0511 1.06266 10.9579 0.532846 9.67879C0.00303296 8.3997 -0.13559 6.99224 0.134506 5.63437C0.404603 4.2765 1.07129 3.02922 2.05026 2.05026C3.02922 1.07129 4.2765 0.404603 5.63437 0.134506C6.99224 -0.13559 8.3997 0.00303296 9.67879 0.532846C10.9579 1.06266 12.0511 1.95987 12.8203 3.11101C13.5895 4.26215 14 5.61553 14 7C14 8.85652 13.2625 10.637 11.9497 11.9497C10.637 13.2625 8.85652 14 7 14ZM7 1.16667C5.84628 1.16667 4.71846 1.50879 3.75918 2.14976C2.79989 2.79074 2.05222 3.70178 1.61071 4.76768C1.16919 5.83358 1.05367 7.00647 1.27876 8.13803C1.50384 9.26958 2.05941 10.309 2.87521 11.1248C3.69102 11.9406 4.73042 12.4962 5.86198 12.7212C6.99353 12.9463 8.16642 12.8308 9.23232 12.3893C10.2982 11.9478 11.2093 11.2001 11.8502 10.2408C12.4912 9.28154 12.8333 8.15373 12.8333 7C12.8333 5.45291 12.2188 3.96918 11.1248 2.87521C10.0308 1.78125 8.5471 1.16667 7 1.16667ZM4.66662 9.91668C4.58998 9.91704 4.51404 9.90209 4.44325 9.87271C4.37246 9.84333 4.30826 9.8001 4.2544 9.74557C4.14516 9.6362 4.0838 9.48793 4.0838 9.33335C4.0838 9.17876 4.14516 9.0305 4.2544 8.92113L6.17553 7L4.25443 5.07891C4.15139 4.96832 4.09529 4.82207 4.09796 4.67094C4.10063 4.51982 4.16185 4.37563 4.26872 4.26876C4.3756 4.16188 4.51979 4.10066 4.67091 4.09799C4.82204 4.09532 4.96829 4.15142 5.07887 4.25446L6.99997 6.17556L8.92106 4.25446C9.03164 4.15142 9.1779 4.09532 9.32903 4.09799C9.48015 4.10066 9.62434 4.16188 9.73121 4.26876C9.83809 4.37563 9.89931 4.51982 9.90198 4.67094C9.90464 4.82207 9.84855 4.96832 9.74551 5.07891L7.82441 7L9.74554 8.92113C9.85478 9.0305 9.91614 9.17876 9.91614 9.33335C9.91614 9.48793 9.85478 9.6362 9.74554 9.74557C9.69168 9.8001 9.62748 9.84333 9.55669 9.87271C9.4859 9.90209 9.40996 9.91704 9.33332 9.91668C9.25668 9.91704 9.18073 9.90209 9.10995 9.87271C9.03916 9.84333 8.97495 9.8001 8.9211 9.74557L6.99997 7.82444L5.07884 9.74557C5.02499 9.8001 4.96078 9.84333 4.88999 9.87271C4.81921 9.90209 4.74326 9.91704 4.66662 9.91668Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,r){n&1&&(It(),L(0,"svg",0)(1,"g"),X(2,"path",1),q(),L(3,"defs")(4,"clipPath",2),X(5,"rect",3),q()()()),n&2&&(xe(r.getClassNames()),re("aria-label",r.ariaLabel)("aria-hidden",r.ariaHidden)("role",r.role),N(),re("clip-path",r.pathId),N(3),M("id",r.pathId))},encapsulation:2})}return i})();var L0=["container"],Mw=i=>[i,"p-toast-message"],Fw=(i,e,t,n)=>({showTransformParams:i,hideTransformParams:e,showTransitionParams:t,hideTransitionParams:n}),Lw=i=>({value:"visible",params:i}),zw=(i,e)=>({$implicit:i,closeFn:e}),Bw=i=>({$implicit:i});function Uw(i,e){i&1&&on(0)}function qw(i,e){if(i&1&&(yt(0),ne(1,Uw,1,0,"ng-container",4),vt()),i&2){let t=H();N(),M("ngTemplateOutlet",t.headlessTemplate)("ngTemplateOutletContext",li(2,zw,t.message,t.onCloseIconClick))}}function jw(i,e){if(i&1&&X(0,"span"),i&2){let t=H(3);xe("p-toast-message-icon pi "+t.message.icon)}}function Gw(i,e){i&1&&X(0,"CheckIcon"),i&2&&re("aria-hidden",!0)("data-pc-section","icon")}function Kw(i,e){i&1&&X(0,"InfoCircleIcon"),i&2&&re("aria-hidden",!0)("data-pc-section","icon")}function $w(i,e){i&1&&X(0,"TimesCircleIcon"),i&2&&re("aria-hidden",!0)("data-pc-section","icon")}function Hw(i,e){i&1&&X(0,"ExclamationTriangleIcon"),i&2&&re("aria-hidden",!0)("data-pc-section","icon")}function Qw(i,e){if(i&1&&(L(0,"span",13),yt(1),ne(2,Gw,1,2,"CheckIcon",6)(3,Kw,1,2,"InfoCircleIcon",6)(4,$w,1,2,"TimesCircleIcon",6)(5,Hw,1,2,"ExclamationTriangleIcon",6),vt(),q()),i&2){let t=H(3);re("aria-hidden",!0)("data-pc-section","icon"),N(2),M("ngIf",t.message.severity==="success"),N(),M("ngIf",t.message.severity==="info"),N(),M("ngIf",t.message.severity==="error"),N(),M("ngIf",t.message.severity==="warn")}}function Ww(i,e){if(i&1&&(yt(0),ne(1,jw,1,2,"span",8)(2,Qw,6,6,"span",9),L(3,"div",10)(4,"div",11),ye(5),q(),L(6,"div",12),ye(7),q()(),vt()),i&2){let t=H(2);N(),M("ngIf",t.message.icon),N(),M("ngIf",!t.message.icon),N(),re("data-pc-section","text"),N(),re("data-pc-section","summary"),N(),xn(t.message.summary),N(),re("data-pc-section","detail"),N(),xn(t.message.detail)}}function Yw(i,e){i&1&&on(0)}function Xw(i,e){if(i&1&&X(0,"span"),i&2){let t=H(3);xe("pt-1 text-base p-toast-message-icon pi "+t.message.closeIcon)}}function Jw(i,e){i&1&&X(0,"TimesIcon",16),i&2&&(M("styleClass","p-toast-icon-close-icon"),re("aria-hidden",!0)("data-pc-section","closeicon"))}function Zw(i,e){if(i&1){let t=qe();L(0,"button",14),Pe("click",function(r){le(t);let s=H(2);return ce(s.onCloseIconClick(r))})("keydown.enter",function(r){le(t);let s=H(2);return ce(s.onCloseIconClick(r))}),ne(1,Xw,1,2,"span",8)(2,Jw,1,3,"TimesIcon",15),q()}if(i&2){let t=H(2);re("aria-label",t.closeAriaLabel)("data-pc-section","closebutton"),N(),M("ngIf",t.message.closeIcon),N(),M("ngIf",!t.message.closeIcon)}}function eT(i,e){if(i&1&&(L(0,"div",5),ne(1,Ww,8,7,"ng-container",6)(2,Yw,1,0,"ng-container",4)(3,Zw,3,4,"button",7),q()),i&2){let t=H();M("ngClass",t.message==null?null:t.message.contentStyleClass),re("data-pc-section","content"),N(),M("ngIf",!t.template),N(),M("ngTemplateOutlet",t.template)("ngTemplateOutletContext",Ot(6,Bw,t.message)),N(),M("ngIf",(t.message==null?null:t.message.closable)!==!1)}}function tT(i,e){if(i&1){let t=qe();L(0,"p-toastItem",3),Pe("onClose",function(r){le(t);let s=H();return ce(s.onMessageClose(r))})("@toastAnimation.start",function(r){le(t);let s=H();return ce(s.onAnimationStart(r))})("@toastAnimation.done",function(r){le(t);let s=H();return ce(s.onAnimationEnd(r))}),q()}if(i&2){let t=e.$implicit,n=e.index,r=H();M("message",t)("index",n)("life",r.life)("template",r.template)("headlessTemplate",r.headlessTemplate)("@toastAnimation",void 0)("showTransformOptions",r.showTransformOptions)("hideTransformOptions",r.hideTransformOptions)("showTransitionOptions",r.showTransitionOptions)("hideTransitionOptions",r.hideTransitionOptions)}}var nT=(()=>{class i{zone;config;message;index;life;template;headlessTemplate;showTransformOptions;hideTransformOptions;showTransitionOptions;hideTransitionOptions;onClose=new ct;containerViewChild;timeout;constructor(t,n){this.zone=t,this.config=n}ngAfterViewInit(){this.initTimeout()}initTimeout(){this.message?.sticky||this.zone.runOutsideAngular(()=>{this.timeout=setTimeout(()=>{this.onClose.emit({index:this.index,message:this.message})},this.message?.life||this.life||3e3)})}clearTimeout(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}onMouseEnter(){this.clearTimeout()}onMouseLeave(){this.initTimeout()}onCloseIconClick=t=>{this.clearTimeout(),this.onClose.emit({index:this.index,message:this.message}),t.preventDefault()};get closeAriaLabel(){return this.config.translation.aria?this.config.translation.aria.close:void 0}ngOnDestroy(){this.clearTimeout()}static \u0275fac=function(n){return new(n||i)(de(ut),de(_s))};static \u0275cmp=_e({type:i,selectors:[["p-toastItem"]],viewQuery:function(n,r){if(n&1&&an(L0,5),n&2){let s;ht(s=dt())&&(r.containerViewChild=s.first)}},hostAttrs:[1,"p-element"],inputs:{message:"message",index:[2,"index","index",ln],life:[2,"life","life",ln],template:"template",headlessTemplate:"headlessTemplate",showTransformOptions:"showTransformOptions",hideTransformOptions:"hideTransformOptions",showTransitionOptions:"showTransitionOptions",hideTransitionOptions:"hideTransitionOptions"},outputs:{onClose:"onClose"},standalone:!1,features:[Sn],decls:5,vars:18,consts:[["container",""],["notHeadless",""],["role","alert","aria-live","assertive","aria-atomic","true",3,"mouseenter","mouseleave","ngClass"],[4,"ngIf","ngIfElse"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"p-toast-message-content",3,"ngClass"],[4,"ngIf"],["type","button","class","p-toast-icon-close p-link","pRipple","",3,"click","keydown.enter",4,"ngIf"],[3,"class",4,"ngIf"],["class","p-toast-message-icon",4,"ngIf"],[1,"p-toast-message-text"],[1,"p-toast-summary"],[1,"p-toast-detail"],[1,"p-toast-message-icon"],["type","button","pRipple","",1,"p-toast-icon-close","p-link",3,"click","keydown.enter"],[3,"styleClass",4,"ngIf"],[3,"styleClass"]],template:function(n,r){if(n&1){let s=qe();L(0,"div",2,0),Pe("mouseenter",function(){return le(s),ce(r.onMouseEnter())})("mouseleave",function(){return le(s),ce(r.onMouseLeave())}),ne(2,qw,2,5,"ng-container",3)(3,eT,4,8,"ng-template",null,1,ms),q()}if(n&2){let s=ds(4);xe(r.message==null?null:r.message.styleClass),M("ngClass",Ot(9,Mw,"p-toast-message-"+(r.message==null?null:r.message.severity)))("@messageState",Ot(16,Lw,$o(11,Fw,r.showTransformOptions,r.hideTransformOptions,r.showTransitionOptions,r.hideTransitionOptions))),re("id",r.message==null?null:r.message.id)("data-pc-name","toast")("data-pc-section","root"),N(2),M("ngIf",r.headlessTemplate)("ngIfElse",s)}},dependencies:()=>[cn,Ho,Qo,Jo,mo,fo,go,po,Dn],encapsulation:2,data:{animation:[ui("messageState",[gs("visible",Gt({transform:"translateY(0)",opacity:1})),un("void => *",[Gt({transform:"{{showTransformParams}}",opacity:0}),Rn("{{showTransitionParams}}")]),un("* => void",[Rn("{{hideTransitionParams}}",Gt({height:0,opacity:0,transform:"{{hideTransformParams}}"}))])])]},changeDetection:0})}return i})(),z0=(()=>{class i{document;renderer;messageService;cd;config;key;autoZIndex=!0;baseZIndex=0;life=3e3;style;styleClass;get position(){return this._position}set position(t){this._position=t,this.cd.markForCheck()}preventOpenDuplicates=!1;preventDuplicates=!1;showTransformOptions="translateY(100%)";hideTransformOptions="translateY(-100%)";showTransitionOptions="300ms ease-out";hideTransitionOptions="250ms ease-in";breakpoints;onClose=new ct;containerViewChild;templates;messageSubscription;clearSubscription;messages;messagesArchieve;template;headlessTemplate;_position="top-right";constructor(t,n,r,s,o){this.document=t,this.renderer=n,this.messageService=r,this.cd=s,this.config=o}styleElement;id=rt();ngOnInit(){this.messageSubscription=this.messageService.messageObserver.subscribe(t=>{if(t)if(Array.isArray(t)){let n=t.filter(r=>this.canAdd(r));this.add(n)}else this.canAdd(t)&&this.add([t])}),this.clearSubscription=this.messageService.clearObserver.subscribe(t=>{t?this.key===t&&(this.messages=null):this.messages=null,this.cd.markForCheck()})}ngAfterViewInit(){this.breakpoints&&this.createStyle()}add(t){this.messages=this.messages?[...this.messages,...t]:[...t],this.preventDuplicates&&(this.messagesArchieve=this.messagesArchieve?[...this.messagesArchieve,...t]:[...t]),this.cd.markForCheck()}canAdd(t){let n=this.key===t.key;return n&&this.preventOpenDuplicates&&(n=!this.containsMessage(this.messages,t)),n&&this.preventDuplicates&&(n=!this.containsMessage(this.messagesArchieve,t)),n}containsMessage(t,n){return t?t.find(r=>r.summary===n.summary&&r.detail==n.detail&&r.severity===n.severity)!=null:!1}ngAfterContentInit(){this.templates?.forEach(t=>{switch(t.getType()){case"message":this.template=t.template;break;case"headless":this.headlessTemplate=t.template;break;default:this.template=t.template;break}})}onMessageClose(t){this.messages?.splice(t.index,1),this.onClose.emit({message:t.message}),this.cd.detectChanges()}onAnimationStart(t){t.fromState==="void"&&(this.renderer.setAttribute(this.containerViewChild?.nativeElement,this.id,""),this.autoZIndex&&this.containerViewChild?.nativeElement.style.zIndex===""&&hi.set("modal",this.containerViewChild?.nativeElement,this.baseZIndex||this.config.zIndex.modal))}onAnimationEnd(t){t.toState==="void"&&this.autoZIndex&&wp.isEmpty(this.messages)&&hi.clear(this.containerViewChild?.nativeElement)}createStyle(){if(!this.styleElement){this.styleElement=this.renderer.createElement("style"),this.styleElement.type="text/css",se.setAttribute(this.styleElement,"nonce",this.config?.csp()?.nonce),this.renderer.appendChild(this.document.head,this.styleElement);let t="";for(let n in this.breakpoints){let r="";for(let s in this.breakpoints[n])r+=s+":"+this.breakpoints[n][s]+" !important;";t+=`
                    @media screen and (max-width: ${n}) {
                        .p-toast[${this.id}] {
                           ${r}
                        }
                    }
                `}this.renderer.setProperty(this.styleElement,"innerHTML",t)}}destroyStyle(){this.styleElement&&(this.renderer.removeChild(this.document.head,this.styleElement),this.styleElement=null)}ngOnDestroy(){this.messageSubscription&&this.messageSubscription.unsubscribe(),this.containerViewChild&&this.autoZIndex&&hi.clear(this.containerViewChild.nativeElement),this.clearSubscription&&this.clearSubscription.unsubscribe(),this.destroyStyle()}static \u0275fac=function(n){return new(n||i)(de(jt),de(hs),de(Xi),de(ps),de(_s))};static \u0275cmp=_e({type:i,selectors:[["p-toast"]],contentQueries:function(n,r,s){if(n&1&&ai(s,ys,4),n&2){let o;ht(o=dt())&&(r.templates=o)}},viewQuery:function(n,r){if(n&1&&an(L0,5),n&2){let s;ht(s=dt())&&(r.containerViewChild=s.first)}},hostAttrs:[1,"p-element"],inputs:{key:"key",autoZIndex:[2,"autoZIndex","autoZIndex",De],baseZIndex:[2,"baseZIndex","baseZIndex",ln],life:[2,"life","life",ln],style:"style",styleClass:"styleClass",position:"position",preventOpenDuplicates:[2,"preventOpenDuplicates","preventOpenDuplicates",De],preventDuplicates:[2,"preventDuplicates","preventDuplicates",De],showTransformOptions:"showTransformOptions",hideTransformOptions:"hideTransformOptions",showTransitionOptions:"showTransitionOptions",hideTransitionOptions:"hideTransitionOptions",breakpoints:"breakpoints"},outputs:{onClose:"onClose"},standalone:!1,features:[Sn],decls:3,vars:5,consts:[["container",""],[1,"p-toast","p-component",3,"ngClass","ngStyle"],[3,"message","index","life","template","headlessTemplate","showTransformOptions","hideTransformOptions","showTransitionOptions","hideTransitionOptions","onClose",4,"ngFor","ngForOf"],[3,"onClose","message","index","life","template","headlessTemplate","showTransformOptions","hideTransformOptions","showTransitionOptions","hideTransitionOptions"]],template:function(n,r){n&1&&(L(0,"div",1,0),ne(2,tT,1,10,"p-toastItem",2),q()),n&2&&(xe(r.styleClass),M("ngClass","p-toast-"+r._position)("ngStyle",r.style),N(2),M("ngForOf",r.messages))},dependencies:[cn,up,Pn,nT],styles:[`@layer primeng{.p-toast{position:fixed;width:25rem}.p-toast-message{overflow:hidden}.p-toast-message-content{display:flex;align-items:flex-start}.p-toast-message-text{flex:1 1 auto}.p-toast-top-right{top:20px;right:20px}.p-toast-top-left{top:20px;left:20px}.p-toast-bottom-left{bottom:20px;left:20px}.p-toast-bottom-right{bottom:20px;right:20px}.p-toast-top-center{top:20px;left:50%;transform:translate(-50%)}.p-toast-bottom-center{bottom:20px;left:50%;transform:translate(-50%)}.p-toast-center{left:50%;top:50%;min-width:20vw;transform:translate(-50%,-50%)}.p-toast-icon-close{display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative;flex:none}.p-toast-icon-close.p-link{cursor:pointer}}
`],encapsulation:2,data:{animation:[ui("toastAnimation",[un(":enter, :leave",[yp("@*",_p())])])]},changeDetection:0})}return i})(),B0=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ue({type:i});static \u0275inj=Be({imports:[mt,Ji,mo,fo,go,po,Dn,di]})}return i})();var U0=(()=>{class i{pFocusTrapDisabled=!1;platformId=Qi(bt);host=Qi(Wi);document=Qi(jt);firstHiddenFocusableElement;lastHiddenFocusableElement;ngOnInit(){ci(this.platformId)&&!this.pFocusTrapDisabled&&!this.firstHiddenFocusableElement&&!this.lastHiddenFocusableElement&&this.createHiddenFocusableElements()}ngOnChanges(t){t.pFocusTrapDisabled&&ci(this.platformId)&&(t.pFocusTrapDisabled.currentValue?this.removeHiddenFocusableElements():this.createHiddenFocusableElements())}removeHiddenFocusableElements(){this.firstHiddenFocusableElement&&this.firstHiddenFocusableElement.parentNode&&this.firstHiddenFocusableElement.parentNode.removeChild(this.firstHiddenFocusableElement),this.lastHiddenFocusableElement&&this.lastHiddenFocusableElement.parentNode&&this.lastHiddenFocusableElement.parentNode.removeChild(this.lastHiddenFocusableElement)}getComputedSelector(t){return`:not(.p-hidden-focusable):not([data-p-hidden-focusable="true"])${t??""}`}createHiddenFocusableElements(){let t="0",n=r=>se.createElement("span",{class:"p-hidden-accessible p-hidden-focusable",tabindex:t,role:"presentation","data-p-hidden-accessible":!0,"data-p-hidden-focusable":!0,onFocus:r?.bind(this)});this.firstHiddenFocusableElement=n(this.onFirstHiddenElementFocus),this.lastHiddenFocusableElement=n(this.onLastHiddenElementFocus),this.firstHiddenFocusableElement.setAttribute("data-pc-section","firstfocusableelement"),this.lastHiddenFocusableElement.setAttribute("data-pc-section","lastfocusableelement"),this.host.nativeElement.prepend(this.firstHiddenFocusableElement),this.host.nativeElement.append(this.lastHiddenFocusableElement)}onFirstHiddenElementFocus(t){let{currentTarget:n,relatedTarget:r}=t,s=r===this.lastHiddenFocusableElement||!this.host.nativeElement?.contains(r)?se.getFirstFocusableElement(n.parentElement,":not(.p-hidden-focusable)"):this.lastHiddenFocusableElement;se.focus(s)}onLastHiddenElementFocus(t){let{currentTarget:n,relatedTarget:r}=t,s=r===this.firstHiddenFocusableElement||!this.host.nativeElement?.contains(r)?se.getLastFocusableElement(n.parentElement,":not(.p-hidden-focusable)"):this.firstHiddenFocusableElement;se.focus(s)}static \u0275fac=function(n){return new(n||i)};static \u0275dir=dc({type:i,selectors:[["","pFocusTrap",""]],hostAttrs:[1,"p-element"],inputs:{pFocusTrapDisabled:[2,"pFocusTrapDisabled","pFocusTrapDisabled",De]},standalone:!1,features:[Sn,Xm]})}return i})(),q0=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ue({type:i});static \u0275inj=Be({imports:[mt]})}return i})();var qd=(()=>{class i extends xt{pathId;ngOnInit(){this.pathId="url(#"+rt()+")"}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Et(i)))(r||i)}})();static \u0275cmp=_e({type:i,selectors:[["WindowMaximizeIcon"]],features:[Ct],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M7 14H11.8C12.3835 14 12.9431 13.7682 13.3556 13.3556C13.7682 12.9431 14 12.3835 14 11.8V2.2C14 1.61652 13.7682 1.05694 13.3556 0.644365C12.9431 0.231785 12.3835 0 11.8 0H2.2C1.61652 0 1.05694 0.231785 0.644365 0.644365C0.231785 1.05694 0 1.61652 0 2.2V7C0 7.15913 0.063214 7.31174 0.175736 7.42426C0.288258 7.53679 0.44087 7.6 0.6 7.6C0.75913 7.6 0.911742 7.53679 1.02426 7.42426C1.13679 7.31174 1.2 7.15913 1.2 7V2.2C1.2 1.93478 1.30536 1.68043 1.49289 1.49289C1.68043 1.30536 1.93478 1.2 2.2 1.2H11.8C12.0652 1.2 12.3196 1.30536 12.5071 1.49289C12.6946 1.68043 12.8 1.93478 12.8 2.2V11.8C12.8 12.0652 12.6946 12.3196 12.5071 12.5071C12.3196 12.6946 12.0652 12.8 11.8 12.8H7C6.84087 12.8 6.68826 12.8632 6.57574 12.9757C6.46321 13.0883 6.4 13.2409 6.4 13.4C6.4 13.5591 6.46321 13.7117 6.57574 13.8243C6.68826 13.9368 6.84087 14 7 14ZM9.77805 7.42192C9.89013 7.534 10.0415 7.59788 10.2 7.59995C10.3585 7.59788 10.5099 7.534 10.622 7.42192C10.7341 7.30985 10.798 7.15844 10.8 6.99995V3.94242C10.8066 3.90505 10.8096 3.86689 10.8089 3.82843C10.8079 3.77159 10.7988 3.7157 10.7824 3.6623C10.756 3.55552 10.701 3.45698 10.622 3.37798C10.5099 3.2659 10.3585 3.20202 10.2 3.19995H7.00002C6.84089 3.19995 6.68828 3.26317 6.57576 3.37569C6.46324 3.48821 6.40002 3.64082 6.40002 3.79995C6.40002 3.95908 6.46324 4.11169 6.57576 4.22422C6.68828 4.33674 6.84089 4.39995 7.00002 4.39995H8.80006L6.19997 7.00005C6.10158 7.11005 6.04718 7.25246 6.04718 7.40005C6.04718 7.54763 6.10158 7.69004 6.19997 7.80005C6.30202 7.91645 6.44561 7.98824 6.59997 8.00005C6.75432 7.98824 6.89791 7.91645 6.99997 7.80005L9.60002 5.26841V6.99995C9.6021 7.15844 9.66598 7.30985 9.77805 7.42192ZM1.4 14H3.8C4.17066 13.9979 4.52553 13.8498 4.78763 13.5877C5.04973 13.3256 5.1979 12.9707 5.2 12.6V10.2C5.1979 9.82939 5.04973 9.47452 4.78763 9.21242C4.52553 8.95032 4.17066 8.80215 3.8 8.80005H1.4C1.02934 8.80215 0.674468 8.95032 0.412371 9.21242C0.150274 9.47452 0.00210008 9.82939 0 10.2V12.6C0.00210008 12.9707 0.150274 13.3256 0.412371 13.5877C0.674468 13.8498 1.02934 13.9979 1.4 14ZM1.25858 10.0586C1.29609 10.0211 1.34696 10 1.4 10H3.8C3.85304 10 3.90391 10.0211 3.94142 10.0586C3.97893 10.0961 4 10.147 4 10.2V12.6C4 12.6531 3.97893 12.704 3.94142 12.7415C3.90391 12.779 3.85304 12.8 3.8 12.8H1.4C1.34696 12.8 1.29609 12.779 1.25858 12.7415C1.22107 12.704 1.2 12.6531 1.2 12.6V10.2C1.2 10.147 1.22107 10.0961 1.25858 10.0586Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,r){n&1&&(It(),L(0,"svg",0)(1,"g"),X(2,"path",1),q(),L(3,"defs")(4,"clipPath",2),X(5,"rect",3),q()()()),n&2&&(xe(r.getClassNames()),re("aria-label",r.ariaLabel)("aria-hidden",r.ariaHidden)("role",r.role),N(),re("clip-path",r.pathId),N(3),M("id",r.pathId))},encapsulation:2})}return i})();var jd=(()=>{class i extends xt{pathId;ngOnInit(){this.pathId="url(#"+rt()+")"}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Et(i)))(r||i)}})();static \u0275cmp=_e({type:i,selectors:[["WindowMinimizeIcon"]],features:[Ct],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M11.8 0H2.2C1.61652 0 1.05694 0.231785 0.644365 0.644365C0.231785 1.05694 0 1.61652 0 2.2V7C0 7.15913 0.063214 7.31174 0.175736 7.42426C0.288258 7.53679 0.44087 7.6 0.6 7.6C0.75913 7.6 0.911742 7.53679 1.02426 7.42426C1.13679 7.31174 1.2 7.15913 1.2 7V2.2C1.2 1.93478 1.30536 1.68043 1.49289 1.49289C1.68043 1.30536 1.93478 1.2 2.2 1.2H11.8C12.0652 1.2 12.3196 1.30536 12.5071 1.49289C12.6946 1.68043 12.8 1.93478 12.8 2.2V11.8C12.8 12.0652 12.6946 12.3196 12.5071 12.5071C12.3196 12.6946 12.0652 12.8 11.8 12.8H7C6.84087 12.8 6.68826 12.8632 6.57574 12.9757C6.46321 13.0883 6.4 13.2409 6.4 13.4C6.4 13.5591 6.46321 13.7117 6.57574 13.8243C6.68826 13.9368 6.84087 14 7 14H11.8C12.3835 14 12.9431 13.7682 13.3556 13.3556C13.7682 12.9431 14 12.3835 14 11.8V2.2C14 1.61652 13.7682 1.05694 13.3556 0.644365C12.9431 0.231785 12.3835 0 11.8 0ZM6.368 7.952C6.44137 7.98326 6.52025 7.99958 6.6 8H9.8C9.95913 8 10.1117 7.93678 10.2243 7.82426C10.3368 7.71174 10.4 7.55913 10.4 7.4C10.4 7.24087 10.3368 7.08826 10.2243 6.97574C10.1117 6.86321 9.95913 6.8 9.8 6.8H8.048L10.624 4.224C10.73 4.11026 10.7877 3.95982 10.7849 3.80438C10.7822 3.64894 10.7192 3.50063 10.6093 3.3907C10.4994 3.28077 10.3511 3.2178 10.1956 3.21506C10.0402 3.21232 9.88974 3.27002 9.776 3.376L7.2 5.952V4.2C7.2 4.04087 7.13679 3.88826 7.02426 3.77574C6.91174 3.66321 6.75913 3.6 6.6 3.6C6.44087 3.6 6.28826 3.66321 6.17574 3.77574C6.06321 3.88826 6 4.04087 6 4.2V7.4C6.00042 7.47975 6.01674 7.55862 6.048 7.632C6.07656 7.70442 6.11971 7.7702 6.17475 7.82524C6.2298 7.88029 6.29558 7.92344 6.368 7.952ZM1.4 8.80005H3.8C4.17066 8.80215 4.52553 8.95032 4.78763 9.21242C5.04973 9.47452 5.1979 9.82939 5.2 10.2V12.6C5.1979 12.9707 5.04973 13.3256 4.78763 13.5877C4.52553 13.8498 4.17066 13.9979 3.8 14H1.4C1.02934 13.9979 0.674468 13.8498 0.412371 13.5877C0.150274 13.3256 0.00210008 12.9707 0 12.6V10.2C0.00210008 9.82939 0.150274 9.47452 0.412371 9.21242C0.674468 8.95032 1.02934 8.80215 1.4 8.80005ZM3.94142 12.7415C3.97893 12.704 4 12.6531 4 12.6V10.2C4 10.147 3.97893 10.0961 3.94142 10.0586C3.90391 10.0211 3.85304 10 3.8 10H1.4C1.34696 10 1.29609 10.0211 1.25858 10.0586C1.22107 10.0961 1.2 10.147 1.2 10.2V12.6C1.2 12.6531 1.22107 12.704 1.25858 12.7415C1.29609 12.779 1.34696 12.8 1.4 12.8H3.8C3.85304 12.8 3.90391 12.779 3.94142 12.7415Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,r){n&1&&(It(),L(0,"svg",0)(1,"g"),X(2,"path",1),q(),L(3,"defs")(4,"clipPath",2),X(5,"rect",3),q()()()),n&2&&(xe(r.getClassNames()),re("aria-label",r.ariaLabel)("aria-hidden",r.ariaHidden)("role",r.role),N(),re("clip-path",r.pathId),N(3),M("id",r.pathId))},encapsulation:2})}return i})();var sT=["titlebar"],oT=["content"],aT=["footer"],lT=["*",[["p-header"]],[["p-footer"]]],cT=["*","p-header","p-footer"],uT=(i,e,t,n,r,s,o,l,c,h)=>({"p-dialog-mask":!0,"p-component-overlay p-component-overlay-enter":i,"p-dialog-mask-scrollblocker":e,"p-dialog-left":t,"p-dialog-right":n,"p-dialog-top":r,"p-dialog-top-left":s,"p-dialog-top-right":o,"p-dialog-bottom":l,"p-dialog-bottom-left":c,"p-dialog-bottom-right":h}),hT=(i,e,t,n)=>({"p-dialog p-component":!0,"p-dialog-rtl":i,"p-dialog-draggable":e,"p-dialog-resizable":t,"p-dialog-maximized":n}),dT=(i,e)=>({transform:i,transition:e}),mT=i=>({value:"visible",params:i}),pT=()=>({"p-dialog-header-icon p-dialog-header-maximize p-link":!0}),fT=()=>({"p-dialog-header-icon p-dialog-header-close p-link":!0}),gT=()=>({"min-width":0});function _T(i,e){i&1&&on(0)}function yT(i,e){if(i&1&&(yt(0),ne(1,_T,1,0,"ng-container",10),vt()),i&2){let t=H(3);N(),M("ngTemplateOutlet",t.headlessTemplate)}}function vT(i,e){if(i&1){let t=qe();L(0,"div",15),Pe("mousedown",function(r){le(t);let s=H(4);return ce(s.initResize(r))}),q()}}function wT(i,e){if(i&1&&(L(0,"span",21),ye(1),q()),i&2){let t=H(5);M("id",t.ariaLabelledBy),N(),xn(t.header)}}function TT(i,e){if(i&1&&(L(0,"span",21),Uo(1,1),q()),i&2){let t=H(5);M("id",t.ariaLabelledBy)}}function IT(i,e){i&1&&on(0)}function ET(i,e){if(i&1&&X(0,"span",25),i&2){let t=H(6);M("ngClass",t.maximized?t.minimizeIcon:t.maximizeIcon)}}function bT(i,e){i&1&&X(0,"WindowMaximizeIcon",27),i&2&&M("styleClass","p-dialog-header-maximize-icon")}function CT(i,e){i&1&&X(0,"WindowMinimizeIcon",27),i&2&&M("styleClass","p-dialog-header-maximize-icon")}function AT(i,e){if(i&1&&(yt(0),ne(1,bT,1,1,"WindowMaximizeIcon",26)(2,CT,1,1,"WindowMinimizeIcon",26),vt()),i&2){let t=H(6);N(),M("ngIf",!t.maximized&&!t.maximizeIconTemplate),N(),M("ngIf",t.maximized&&!t.minimizeIconTemplate)}}function ST(i,e){}function xT(i,e){i&1&&ne(0,ST,0,0,"ng-template")}function PT(i,e){if(i&1&&(yt(0),ne(1,xT,1,0,null,10),vt()),i&2){let t=H(6);N(),M("ngTemplateOutlet",t.maximizeIconTemplate)}}function RT(i,e){}function DT(i,e){i&1&&ne(0,RT,0,0,"ng-template")}function kT(i,e){if(i&1&&(yt(0),ne(1,DT,1,0,null,10),vt()),i&2){let t=H(6);N(),M("ngTemplateOutlet",t.minimizeIconTemplate)}}function VT(i,e){if(i&1){let t=qe();L(0,"button",22),Pe("click",function(){le(t);let r=H(5);return ce(r.maximize())})("keydown.enter",function(){le(t);let r=H(5);return ce(r.maximize())}),ne(1,ET,1,1,"span",23)(2,AT,3,2,"ng-container",24)(3,PT,2,1,"ng-container",24)(4,kT,2,1,"ng-container",24),q()}if(i&2){let t=H(5);M("ngClass",Ko(7,pT)),re("tabindex",t.maximizable?"0":"-1")("aria-label",t.maximizeLabel),N(),M("ngIf",t.maximizeIcon&&!t.maximizeIconTemplate&&!t.minimizeIconTemplate),N(),M("ngIf",!t.maximizeIcon),N(),M("ngIf",!t.maximized),N(),M("ngIf",t.maximized)}}function OT(i,e){if(i&1&&X(0,"span",30),i&2){let t=H(7);M("ngClass",t.closeIcon)}}function NT(i,e){i&1&&X(0,"TimesIcon",27),i&2&&M("styleClass","p-dialog-header-close-icon")}function MT(i,e){if(i&1&&(yt(0),ne(1,OT,1,1,"span",29)(2,NT,1,1,"TimesIcon",26),vt()),i&2){let t=H(6);N(),M("ngIf",t.closeIcon),N(),M("ngIf",!t.closeIcon)}}function FT(i,e){}function LT(i,e){i&1&&ne(0,FT,0,0,"ng-template")}function zT(i,e){if(i&1&&(L(0,"span"),ne(1,LT,1,0,null,10),q()),i&2){let t=H(6);N(),M("ngTemplateOutlet",t.closeIconTemplate)}}function BT(i,e){if(i&1){let t=qe();L(0,"button",28),Pe("click",function(r){le(t);let s=H(5);return ce(s.close(r))})("keydown.enter",function(r){le(t);let s=H(5);return ce(s.close(r))}),ne(1,MT,3,2,"ng-container",24)(2,zT,2,1,"span",24),q()}if(i&2){let t=H(5);M("ngClass",Ko(6,fT))("ngStyle",Ko(7,gT)),re("aria-label",t.closeAriaLabel)("tabindex",t.closeTabindex),N(),M("ngIf",!t.closeIconTemplate),N(),M("ngIf",t.closeIconTemplate)}}function UT(i,e){if(i&1){let t=qe();L(0,"div",16,3),Pe("mousedown",function(r){le(t);let s=H(4);return ce(s.initDrag(r))}),ne(2,wT,2,2,"span",17)(3,TT,2,1,"span",17)(4,IT,1,0,"ng-container",10),L(5,"div",18),ne(6,VT,5,8,"button",19)(7,BT,3,8,"button",20),q()()}if(i&2){let t=H(4);N(2),M("ngIf",!t.headerFacet&&!t.headerTemplate),N(),M("ngIf",t.headerFacet),N(),M("ngTemplateOutlet",t.headerTemplate),N(2),M("ngIf",t.maximizable),N(),M("ngIf",t.closable)}}function qT(i,e){i&1&&on(0)}function jT(i,e){i&1&&on(0)}function GT(i,e){if(i&1&&(L(0,"div",31,4),Uo(2,2),ne(3,jT,1,0,"ng-container",10),q()),i&2){let t=H(4);N(3),M("ngTemplateOutlet",t.footerTemplate)}}function KT(i,e){if(i&1&&(ne(0,vT,1,0,"div",11)(1,UT,8,5,"div",12),L(2,"div",13,2),Uo(4),ne(5,qT,1,0,"ng-container",10),q(),ne(6,GT,4,1,"div",14)),i&2){let t=H(3);M("ngIf",t.resizable),N(),M("ngIf",t.showHeader),N(),xe(t.contentStyleClass),M("ngClass","p-dialog-content")("ngStyle",t.contentStyle),N(3),M("ngTemplateOutlet",t.contentTemplate),N(),M("ngIf",t.footerFacet||t.footerTemplate)}}function $T(i,e){if(i&1){let t=qe();L(0,"div",8,0),Pe("@animation.start",function(r){le(t);let s=H(2);return ce(s.onAnimationStart(r))})("@animation.done",function(r){le(t);let s=H(2);return ce(s.onAnimationEnd(r))}),ne(2,yT,2,1,"ng-container",9)(3,KT,7,8,"ng-template",null,1,ms),q()}if(i&2){let t=ds(4),n=H(2);xe(n.styleClass),M("ngClass",$o(10,hT,n.rtl,n.draggable,n.resizable,n.maximized))("ngStyle",n.style)("pFocusTrapDisabled",n.focusTrap===!1)("@animation",Ot(18,mT,li(15,dT,n.transformOptions,n.transitionOptions))),re("aria-labelledby",n.ariaLabelledBy)("aria-modal",!0),N(2),M("ngIf",n.headlessTemplate)("ngIfElse",t)}}function HT(i,e){if(i&1&&(L(0,"div",6),ne(1,$T,5,20,"div",7),q()),i&2){let t=H();xe(t.maskStyleClass),M("ngStyle",t.maskStyle)("ngClass",sp(5,uT,[t.modal,t.modal||t.blockScroll,t.position==="left",t.position==="right",t.position==="top",t.position==="topleft"||t.position==="top-left",t.position==="topright"||t.position==="top-right",t.position==="bottom",t.position==="bottomleft"||t.position==="bottom-left",t.position==="bottomright"||t.position==="bottom-right"])),N(),M("ngIf",t.visible)}}var QT=pc([Gt({transform:"{{transform}}",opacity:0}),Rn("{{transition}}")]),WT=pc([Rn("{{transition}}",Gt({transform:"{{transform}}",opacity:0}))]),j0=(()=>{class i{document;platformId;el;renderer;zone;cd;config;header;draggable=!0;resizable=!0;get positionLeft(){return 0}set positionLeft(t){console.log("positionLeft property is deprecated.")}get positionTop(){return 0}set positionTop(t){console.log("positionTop property is deprecated.")}contentStyle;contentStyleClass;modal=!1;closeOnEscape=!0;dismissableMask=!1;rtl=!1;closable=!0;get responsive(){return!1}set responsive(t){console.log("Responsive property is deprecated.")}appendTo;breakpoints;styleClass;maskStyleClass;maskStyle;showHeader=!0;get breakpoint(){return 649}set breakpoint(t){console.log("Breakpoint property is not utilized and deprecated, use breakpoints or CSS media queries instead.")}blockScroll=!1;autoZIndex=!0;baseZIndex=0;minX=0;minY=0;focusOnShow=!0;maximizable=!1;keepInViewport=!0;focusTrap=!0;transitionOptions="150ms cubic-bezier(0, 0, 0.2, 1)";closeIcon;closeAriaLabel;closeTabindex="0";minimizeIcon;maximizeIcon;get visible(){return this._visible}set visible(t){this._visible=t,this._visible&&!this.maskVisible&&(this.maskVisible=!0)}get style(){return this._style}set style(t){t&&(this._style=Vt({},t),this.originalStyle=t)}get position(){return this._position}set position(t){switch(this._position=t,t){case"topleft":case"bottomleft":case"left":this.transformOptions="translate3d(-100%, 0px, 0px)";break;case"topright":case"bottomright":case"right":this.transformOptions="translate3d(100%, 0px, 0px)";break;case"bottom":this.transformOptions="translate3d(0px, 100%, 0px)";break;case"top":this.transformOptions="translate3d(0px, -100%, 0px)";break;default:this.transformOptions="scale(0.7)";break}}onShow=new ct;onHide=new ct;visibleChange=new ct;onResizeInit=new ct;onResizeEnd=new ct;onDragEnd=new ct;onMaximize=new ct;headerFacet;footerFacet;templates;headerViewChild;contentViewChild;footerViewChild;headerTemplate;contentTemplate;footerTemplate;maximizeIconTemplate;closeIconTemplate;minimizeIconTemplate;headlessTemplate;_visible=!1;maskVisible;container;wrapper;dragging;ariaLabelledBy=this.getAriaLabelledBy();documentDragListener;documentDragEndListener;resizing;documentResizeListener;documentResizeEndListener;documentEscapeListener;maskClickListener;lastPageX;lastPageY;preventVisibleChangePropagation;maximized;preMaximizeContentHeight;preMaximizeContainerWidth;preMaximizeContainerHeight;preMaximizePageX;preMaximizePageY;id=rt();_style={};_position="center";originalStyle;transformOptions="scale(0.7)";styleElement;window;get maximizeLabel(){return this.config.getTranslation(Ep.ARIA).maximizeLabel}constructor(t,n,r,s,o,l,c){this.document=t,this.platformId=n,this.el=r,this.renderer=s,this.zone=o,this.cd=l,this.config=c,this.window=this.document.defaultView}ngAfterContentInit(){this.templates?.forEach(t=>{switch(t.getType()){case"header":this.headerTemplate=t.template;break;case"content":this.contentTemplate=t.template;break;case"footer":this.footerTemplate=t.template;break;case"closeicon":this.closeIconTemplate=t.template;break;case"maximizeicon":this.maximizeIconTemplate=t.template;break;case"minimizeicon":this.minimizeIconTemplate=t.template;break;case"headless":this.headlessTemplate=t.template;break;default:this.contentTemplate=t.template;break}})}ngOnInit(){this.breakpoints&&this.createStyle()}getAriaLabelledBy(){return this.header!==null?rt()+"_header":null}parseDurationToMilliseconds(t){let n=/([\d\.]+)(ms|s)\b/g,r=0,s;for(;(s=n.exec(t))!==null;){let o=parseFloat(s[1]),l=s[2];l==="ms"?r+=o:l==="s"&&(r+=o*1e3)}if(r!==0)return r}focus(t=this.contentViewChild?.nativeElement){let n=this.parseDurationToMilliseconds(this.transitionOptions),r=se.getFocusableElement(t,"[autofocus]");if(r){this.zone.runOutsideAngular(()=>{setTimeout(()=>r.focus(),n||5)});return}let s=se.getFocusableElement(t);s?this.zone.runOutsideAngular(()=>{setTimeout(()=>s.focus(),n||5)}):this.footerViewChild&&t!==this.footerViewChild.nativeElement&&this.focus(this.footerViewChild.nativeElement)}close(t){this.visibleChange.emit(!1),t.preventDefault()}enableModality(){this.closable&&this.dismissableMask&&(this.maskClickListener=this.renderer.listen(this.wrapper,"mousedown",t=>{this.wrapper&&this.wrapper.isSameNode(t.target)&&this.close(t)})),this.modal&&se.blockBodyScroll()}disableModality(){if(this.wrapper){this.dismissableMask&&this.unbindMaskClickListener();let t=document.querySelectorAll(".p-dialog-mask-scrollblocker");this.modal&&t&&t.length==1&&se.unblockBodyScroll(),this.cd.destroyed||this.cd.detectChanges()}}maximize(){this.maximized=!this.maximized,!this.modal&&!this.blockScroll&&(this.maximized?se.blockBodyScroll():se.unblockBodyScroll()),this.onMaximize.emit({maximized:this.maximized})}unbindMaskClickListener(){this.maskClickListener&&(this.maskClickListener(),this.maskClickListener=null)}moveOnTop(){this.autoZIndex&&(hi.set("modal",this.container,this.baseZIndex+this.config.zIndex.modal),this.wrapper.style.zIndex=String(parseInt(this.container.style.zIndex,10)-1))}createStyle(){if(ci(this.platformId)&&!this.styleElement){this.styleElement=this.renderer.createElement("style"),this.styleElement.type="text/css",se.setAttribute(this.styleElement,"nonce",this.config?.csp()?.nonce),this.renderer.appendChild(this.document.head,this.styleElement);let t="";for(let n in this.breakpoints)t+=`
                        @media screen and (max-width: ${n}) {
                            .p-dialog[${this.id}]:not(.p-dialog-maximized) {
                                width: ${this.breakpoints[n]} !important;
                            }
                        }
                    `;this.renderer.setProperty(this.styleElement,"innerHTML",t)}}initDrag(t){se.hasClass(t.target,"p-dialog-header-icon")||se.hasClass(t.target,"p-dialog-header-close-icon")||se.hasClass(t.target.parentElement,"p-dialog-header-icon")||this.draggable&&(this.dragging=!0,this.lastPageX=t.pageX,this.lastPageY=t.pageY,this.container.style.margin="0",se.addClass(this.document.body,"p-unselectable-text"))}onDrag(t){if(this.dragging){let n=se.getOuterWidth(this.container),r=se.getOuterHeight(this.container),s=t.pageX-this.lastPageX,o=t.pageY-this.lastPageY,l=this.container.getBoundingClientRect(),c=getComputedStyle(this.container),h=parseFloat(c.marginLeft),m=parseFloat(c.marginTop),f=l.left+s-h,_=l.top+o-m,b=se.getViewport();this.container.style.position="fixed",this.keepInViewport?(f>=this.minX&&f+n<b.width&&(this._style.left=`${f}px`,this.lastPageX=t.pageX,this.container.style.left=`${f}px`),_>=this.minY&&_+r<b.height&&(this._style.top=`${_}px`,this.lastPageY=t.pageY,this.container.style.top=`${_}px`)):(this.lastPageX=t.pageX,this.container.style.left=`${f}px`,this.lastPageY=t.pageY,this.container.style.top=`${_}px`)}}endDrag(t){this.dragging&&(this.dragging=!1,se.removeClass(this.document.body,"p-unselectable-text"),this.cd.detectChanges(),this.onDragEnd.emit(t))}resetPosition(){this.container.style.position="",this.container.style.left="",this.container.style.top="",this.container.style.margin=""}center(){this.resetPosition()}initResize(t){this.resizable&&(this.resizing=!0,this.lastPageX=t.pageX,this.lastPageY=t.pageY,se.addClass(this.document.body,"p-unselectable-text"),this.onResizeInit.emit(t))}onResize(t){if(this.resizing){let n=t.pageX-this.lastPageX,r=t.pageY-this.lastPageY,s=se.getOuterWidth(this.container),o=se.getOuterHeight(this.container),l=se.getOuterHeight(this.contentViewChild?.nativeElement),c=s+n,h=o+r,m=this.container.style.minWidth,f=this.container.style.minHeight,_=this.container.getBoundingClientRect(),b=se.getViewport();(!parseInt(this.container.style.top)||!parseInt(this.container.style.left))&&(c+=n,h+=r),(!m||c>parseInt(m))&&_.left+c<b.width&&(this._style.width=c+"px",this.container.style.width=this._style.width),(!f||h>parseInt(f))&&_.top+h<b.height&&(this.contentViewChild.nativeElement.style.height=l+h-o+"px",this._style.height&&(this._style.height=h+"px",this.container.style.height=this._style.height)),this.lastPageX=t.pageX,this.lastPageY=t.pageY}}resizeEnd(t){this.resizing&&(this.resizing=!1,se.removeClass(this.document.body,"p-unselectable-text"),this.onResizeEnd.emit(t))}bindGlobalListeners(){this.draggable&&(this.bindDocumentDragListener(),this.bindDocumentDragEndListener()),this.resizable&&this.bindDocumentResizeListeners(),this.closeOnEscape&&this.closable&&this.bindDocumentEscapeListener()}unbindGlobalListeners(){this.unbindDocumentDragListener(),this.unbindDocumentDragEndListener(),this.unbindDocumentResizeListeners(),this.unbindDocumentEscapeListener()}bindDocumentDragListener(){this.documentDragListener||this.zone.runOutsideAngular(()=>{this.documentDragListener=this.renderer.listen(this.window,"mousemove",this.onDrag.bind(this))})}unbindDocumentDragListener(){this.documentDragListener&&(this.documentDragListener(),this.documentDragListener=null)}bindDocumentDragEndListener(){this.documentDragEndListener||this.zone.runOutsideAngular(()=>{this.documentDragEndListener=this.renderer.listen(this.window,"mouseup",this.endDrag.bind(this))})}unbindDocumentDragEndListener(){this.documentDragEndListener&&(this.documentDragEndListener(),this.documentDragEndListener=null)}bindDocumentResizeListeners(){!this.documentResizeListener&&!this.documentResizeEndListener&&this.zone.runOutsideAngular(()=>{this.documentResizeListener=this.renderer.listen(this.window,"mousemove",this.onResize.bind(this)),this.documentResizeEndListener=this.renderer.listen(this.window,"mouseup",this.resizeEnd.bind(this))})}unbindDocumentResizeListeners(){this.documentResizeListener&&this.documentResizeEndListener&&(this.documentResizeListener(),this.documentResizeEndListener(),this.documentResizeListener=null,this.documentResizeEndListener=null)}bindDocumentEscapeListener(){let t=this.el?this.el.nativeElement.ownerDocument:"document";this.documentEscapeListener=this.renderer.listen(t,"keydown",n=>{n.key=="Escape"&&this.close(n)})}unbindDocumentEscapeListener(){this.documentEscapeListener&&(this.documentEscapeListener(),this.documentEscapeListener=null)}appendContainer(){this.appendTo&&(this.appendTo==="body"?this.renderer.appendChild(this.document.body,this.wrapper):se.appendChild(this.wrapper,this.appendTo))}restoreAppend(){this.container&&this.appendTo&&this.renderer.appendChild(this.el.nativeElement,this.wrapper)}onAnimationStart(t){switch(t.toState){case"visible":this.container=t.element,this.wrapper=this.container?.parentElement,this.moveOnTop(),this.appendContainer(),this.bindGlobalListeners(),this.container?.setAttribute(this.id,""),this.modal&&this.enableModality(),!this.modal&&this.blockScroll&&se.addClass(this.document.body,"p-overflow-hidden"),this.focusOnShow&&this.focus();break;case"void":this.wrapper&&this.modal&&se.addClass(this.wrapper,"p-component-overlay-leave");break}}onAnimationEnd(t){switch(t.toState){case"void":this.onContainerDestroy(),this.onHide.emit({}),this.cd.markForCheck();break;case"visible":this.onShow.emit({});break}}onContainerDestroy(){this.unbindGlobalListeners(),this.dragging=!1,this.maskVisible=!1,this.maximized&&(se.removeClass(this.document.body,"p-overflow-hidden"),this.document.body.style.removeProperty("--scrollbar-width"),this.maximized=!1),this.modal&&this.disableModality(),this.blockScroll&&se.removeClass(this.document.body,"p-overflow-hidden"),this.container&&this.autoZIndex&&hi.clear(this.container),this.container=null,this.wrapper=null,this._style=this.originalStyle?Vt({},this.originalStyle):{}}destroyStyle(){this.styleElement&&(this.renderer.removeChild(this.document.head,this.styleElement),this.styleElement=null)}ngOnDestroy(){this.container&&(this.restoreAppend(),this.onContainerDestroy()),this.destroyStyle()}static \u0275fac=function(n){return new(n||i)(de(jt),de(bt),de(Wi),de(hs),de(ut),de(ps),de(_s))};static \u0275cmp=_e({type:i,selectors:[["p-dialog"]],contentQueries:function(n,r,s){if(n&1&&(ai(s,Tp,5),ai(s,Ip,5),ai(s,ys,4)),n&2){let o;ht(o=dt())&&(r.headerFacet=o.first),ht(o=dt())&&(r.footerFacet=o.first),ht(o=dt())&&(r.templates=o)}},viewQuery:function(n,r){if(n&1&&(an(sT,5),an(oT,5),an(aT,5)),n&2){let s;ht(s=dt())&&(r.headerViewChild=s.first),ht(s=dt())&&(r.contentViewChild=s.first),ht(s=dt())&&(r.footerViewChild=s.first)}},hostAttrs:[1,"p-element"],inputs:{header:"header",draggable:[2,"draggable","draggable",De],resizable:[2,"resizable","resizable",De],positionLeft:"positionLeft",positionTop:"positionTop",contentStyle:"contentStyle",contentStyleClass:"contentStyleClass",modal:[2,"modal","modal",De],closeOnEscape:[2,"closeOnEscape","closeOnEscape",De],dismissableMask:[2,"dismissableMask","dismissableMask",De],rtl:[2,"rtl","rtl",De],closable:[2,"closable","closable",De],responsive:"responsive",appendTo:"appendTo",breakpoints:"breakpoints",styleClass:"styleClass",maskStyleClass:"maskStyleClass",maskStyle:"maskStyle",showHeader:[2,"showHeader","showHeader",De],breakpoint:"breakpoint",blockScroll:[2,"blockScroll","blockScroll",De],autoZIndex:[2,"autoZIndex","autoZIndex",De],baseZIndex:[2,"baseZIndex","baseZIndex",ln],minX:[2,"minX","minX",ln],minY:[2,"minY","minY",ln],focusOnShow:[2,"focusOnShow","focusOnShow",De],maximizable:[2,"maximizable","maximizable",De],keepInViewport:[2,"keepInViewport","keepInViewport",De],focusTrap:[2,"focusTrap","focusTrap",De],transitionOptions:"transitionOptions",closeIcon:"closeIcon",closeAriaLabel:"closeAriaLabel",closeTabindex:"closeTabindex",minimizeIcon:"minimizeIcon",maximizeIcon:"maximizeIcon",visible:"visible",style:"style",position:"position"},outputs:{onShow:"onShow",onHide:"onHide",visibleChange:"visibleChange",onResizeInit:"onResizeInit",onResizeEnd:"onResizeEnd",onDragEnd:"onDragEnd",onMaximize:"onMaximize"},standalone:!1,features:[Sn],ngContentSelectors:cT,decls:1,vars:1,consts:[["container",""],["notHeadless",""],["content",""],["titlebar",""],["footer",""],[3,"class","ngStyle","ngClass",4,"ngIf"],[3,"ngStyle","ngClass"],["pFocusTrap","","role","dialog",3,"ngClass","ngStyle","class","pFocusTrapDisabled",4,"ngIf"],["pFocusTrap","","role","dialog",3,"ngClass","ngStyle","pFocusTrapDisabled"],[4,"ngIf","ngIfElse"],[4,"ngTemplateOutlet"],["class","p-resizable-handle",3,"mousedown",4,"ngIf"],["class","p-dialog-header",3,"mousedown",4,"ngIf"],[3,"ngClass","ngStyle"],["class","p-dialog-footer",4,"ngIf"],[1,"p-resizable-handle",3,"mousedown"],[1,"p-dialog-header",3,"mousedown"],["class","p-dialog-title",3,"id",4,"ngIf"],[1,"p-dialog-header-icons"],["role","button","type","button","pRipple","","pButton","",3,"ngClass","click","keydown.enter",4,"ngIf"],["type","button","pRipple","","pButton","",3,"ngClass","ngStyle","click","keydown.enter",4,"ngIf"],[1,"p-dialog-title",3,"id"],["role","button","type","button","pRipple","","pButton","",3,"click","keydown.enter","ngClass"],["class","p-dialog-header-maximize-icon",3,"ngClass",4,"ngIf"],[4,"ngIf"],[1,"p-dialog-header-maximize-icon",3,"ngClass"],[3,"styleClass",4,"ngIf"],[3,"styleClass"],["type","button","pRipple","","pButton","",3,"click","keydown.enter","ngClass","ngStyle"],["class","p-dialog-header-close-icon",3,"ngClass",4,"ngIf"],[1,"p-dialog-header-close-icon",3,"ngClass"],[1,"p-dialog-footer"]],template:function(n,r){n&1&&(np(lT),ne(0,HT,2,16,"div",5)),n&2&&M("ngIf",r.maskVisible)},dependencies:()=>[cn,Ho,Qo,Pn,U0,bp,Jo,Dn,qd,jd],styles:[`@layer primeng{.p-dialog-mask{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;pointer-events:none}.p-dialog-mask.p-component-overlay{pointer-events:auto}.p-dialog{display:flex;flex-direction:column;pointer-events:auto;max-height:90%;transform:scale(1);position:relative}.p-dialog-content{overflow-y:auto;flex-grow:1}.p-dialog-header{display:flex;align-items:center;justify-content:space-between;flex-shrink:0}.p-dialog-draggable .p-dialog-header{cursor:move}.p-dialog-footer{flex-shrink:0}.p-dialog .p-dialog-header-icons{display:flex;align-items:center}.p-dialog .p-dialog-header-icon{display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}.p-fluid .p-dialog-footer .p-button{width:auto}.p-dialog-top .p-dialog,.p-dialog-bottom .p-dialog,.p-dialog-left .p-dialog,.p-dialog-right .p-dialog,.p-dialog-top-left .p-dialog,.p-dialog-top-right .p-dialog,.p-dialog-bottom-left .p-dialog,.p-dialog-bottom-right .p-dialog{margin:.75rem;transform:translateZ(0)}.p-dialog-maximized{-webkit-transition:none;transition:none;transform:none;width:100vw!important;height:100vh!important;top:0!important;left:0!important;max-height:100%;height:100%}.p-dialog-maximized .p-dialog-content{flex-grow:1}.p-dialog-left{justify-content:flex-start}.p-dialog-right{justify-content:flex-end}.p-dialog-top{align-items:flex-start}.p-dialog-top-left{justify-content:flex-start;align-items:flex-start}.p-dialog-top-right{justify-content:flex-end;align-items:flex-start}.p-dialog-bottom{align-items:flex-end}.p-dialog-bottom-left{justify-content:flex-start;align-items:flex-end}.p-dialog-bottom-right{justify-content:flex-end;align-items:flex-end}.p-dialog .p-resizable-handle{position:absolute;font-size:.1px;display:block;cursor:se-resize;width:12px;height:12px;right:1px;bottom:1px}.p-confirm-dialog .p-dialog-content{display:flex;align-items:center}}
`],encapsulation:2,data:{animation:[ui("animation",[un("void => visible",[fc(QT)]),un("visible => void",[fc(WT)])])]},changeDetection:0})}return i})(),G0=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ue({type:i});static \u0275inj=Be({imports:[mt,q0,Cp,Ji,Dn,qd,jd,di]})}return i})();var XT=(i,e)=>({"stage-level-number-unselected":i,"stage-level-number-selected":e});function JT(i,e){if(i&1){let t=qe();L(0,"div",4),Pe("click",function(){le(t);let r=H();return ce(r.stageClick())}),L(1,"span",5),ye(2),q()()}if(i&2){let t=H();N(2),qt(" ",t.stageLevel.value," ")}}function ZT(i,e){if(i&1&&(yt(0,2),ye(1),vt()),i&2){let t=H();N(),qt(" ",t.stageLevel.value," ")}}function eI(i,e){i&1&&(L(0,"span",6),X(1,"i",7),q())}function tI(i,e){if(i&1&&(L(0,"div",3),At(1,eI,2,0,"span",6,oi),q()),i&2){let t=H();N(),St(t.stars)}}function nI(i,e){i&1&&(L(0,"span",8),X(1,"i",7),q())}function iI(i,e){if(i&1){let t=qe();L(0,"div",4),Pe("click",function(){le(t);let r=H(2);return ce(r.stageClick())}),At(1,nI,2,0,"span",8,oi),q()}if(i&2){let t=H(2);N(),St(t.stars)}}function rI(i,e){i&1&&(L(0,"span",9),X(1,"i",10),q())}function sI(i,e){if(i&1&&At(0,rI,2,0,"span",9,oi),i&2){let t=H(2);St(t.stars)}}function oI(i,e){if(i&1&&(L(0,"div",3),ne(1,iI,3,0,"div")(2,sI,2,0),q()),i&2){let t=H();N(),Yi(t.stageLevel.completed?1:2)}}var $0=(()=>{class i{constructor(t){this.stageCommunicationService=t,this.stars=new Array(1,2,3)}stageClick(){this.stageCommunicationService.updatePerformedItem(this.stageLevel),console.log("Stage Clicked")}static{this.\u0275fac=function(n){return new(n||i)(de(Ml))}}static{this.\u0275cmp=_e({type:i,selectors:[["app-stage-level"]],inputs:{stageLevel:"stageLevel"},standalone:!1,decls:7,vars:6,consts:[[1,"stage-level-layout"],[2,"text-align","center",3,"ngClass"],[1,"disable-stage-click"],[2,"display","flex","justify-content","center"],[3,"click"],[1,"stage-level-completed-value","enable-stage-click"],[1,"stage-level-asterisk-selected"],[1,"pi","pi-star-fill",2,"font-size","10px"],[1,"stage-level-asterisk-unselected","stage-level-completed","enable-stage-click"],[1,"stage-level-asterisk-unselected","disable-stage-click"],[1,"pi","pi-star",2,"font-size","10px"]],template:function(n,r){n&1&&(L(0,"div",0)(1,"div",1),ne(2,JT,3,1,"div")(3,ZT,2,1,"ng-container",2),q(),L(4,"div"),ne(5,tI,3,0,"div",3)(6,oI,3,1,"div",3),q()()),n&2&&(N(),M("ngClass",li(3,XT,!r.stageLevel.selected,r.stageLevel.selected)),N(),Yi(r.stageLevel.completed?2:3),N(3),Yi(r.stageLevel.selected?5:6))},dependencies:[cn,Yo],styles:[".stage-level-layout[_ngcontent-%COMP%]{padding-top:1px}.stage-level-layout[_ngcontent-%COMP%]   .enable-stage-click[_ngcontent-%COMP%]{cursor:pointer;pointer-events:auto}.stage-level-layout[_ngcontent-%COMP%]   .disable-stage-click[_ngcontent-%COMP%]{cursor:default;pointer-events:none}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-font[_ngcontent-%COMP%], .stage-level-layout[_ngcontent-%COMP%]   .stage-level-number-selected[_ngcontent-%COMP%], .stage-level-layout[_ngcontent-%COMP%]   .stage-level-number-unselected[_ngcontent-%COMP%]{font-size:17px}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-number-unselected[_ngcontent-%COMP%]{font-weight:450}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-number-selected[_ngcontent-%COMP%]{font-weight:600}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-asterisk-unselected[_ngcontent-%COMP%]{color:#00f}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-asterisk-selected[_ngcontent-%COMP%]{color:#ec09eb}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-completed[_ngcontent-%COMP%], .stage-level-layout[_ngcontent-%COMP%]   .stage-level-completed-value[_ngcontent-%COMP%]{color:green;opacity:.5}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-completed-value[_ngcontent-%COMP%]{font-weight:500;color:#000}"]})}}return i})();var lI=(i,e)=>e.index,cI=i=>({"border-bottom":i});function uI(i,e){i&1&&(L(0,"div")(1,"span",2),ye(2,"No stage levels defined!"),q()())}function hI(i,e){if(i&1&&(L(0,"div",3),X(1,"app-stage-level",4),q()),i&2){let t=e.$implicit;M("ngStyle",Ot(2,cI,t.selected?"none":"1px solid #d4d4d4")),N(),M("stageLevel",t)}}function dI(i,e){if(i&1&&(L(0,"div",1),At(1,hI,2,4,"div",3,lI),q()),i&2){let t=H();N(),St(t.stageLevels)}}var H0=(()=>{class i{constructor(){this.MAXSTAGE_LEVELS=5,this.NO_STAGE_LEVELS=!1,this.stageLevels=new Array}ngOnInit(){this.NO_STAGE_LEVELS=!this.stageLevels||this.stageLevels&&this.stageLevels.length!=this.MAXSTAGE_LEVELS}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=_e({type:i,selectors:[["app-game-stage-levels"]],inputs:{stageLevels:"stageLevels"},standalone:!1,decls:3,vars:1,consts:[[1,"game-stage-level-layout"],[1,"stage-levels"],[1,"warning-message"],[1,"stage-level",3,"ngStyle"],[3,"stageLevel"]],template:function(n,r){n&1&&(L(0,"div",0),ne(1,uI,3,0,"div")(2,dI,3,0,"div",1),q()),n&2&&(N(),Yi(r.NO_STAGE_LEVELS?1:2))},dependencies:[Pn,Xo,$0],styles:[".digit-font-settings[_ngcontent-%COMP%], .game-stage-level-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%]{font-size:17px;font-weight:500;line-height:17px;font-family:Courier New,Courier,monospace;letter-spacing:.03em}.digits-border-horizontal[_ngcontent-%COMP%], .game-stage-level-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%]{border-bottom:1px solid #d4d4d4;padding:12px 0}.game-stage-level-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%]{font-weight:500;font-size:17px;text-align:center;color:orange;padding-left:calc(50% - 115px)}.game-stage-level-layout[_ngcontent-%COMP%]   .stage-levels[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:center;align-items:center}.game-stage-level-layout[_ngcontent-%COMP%]   .stage-levels[_ngcontent-%COMP%]   .stage-level[_ngcontent-%COMP%]{border:1px solid #d4d4d4;padding:0 10px;order:0;flex:1 1 auto;align-self:auto}"]})}}return i})();var yo=class{constructor(e=1/0){this.capacity=e,this.itemStorage=[]}peekBy(e){return this.itemStorage[e]}clear(){this.itemStorage.splice(0,this.itemStorage.length)}push(e){if(this.size()===this.capacity)throw Error("Error: The Stack has reached maximum Capacity!");this.itemStorage.push(e)}pop(){return this.itemStorage.pop()}peek(){return this.itemStorage[this.size()-1]}size(){return this.itemStorage.length}};var vo=class{constructor(e,t,n){this.operands=e,this.operator=t,this.result=n}};var Q0=ui("operandButtonAnimationMove",[gs("buttonFromA",Gt({left:"{{ posALeft }}",top:"{{ posATop }}",width:"90px",height:"90px"}),{params:{posALeft:"1025px",posATop:"219px"}}),gs("buttonToB",Gt({left:"{{ posBLeft }}",top:"{{ posBTop }}",width:"90px",height:"90px"}),{params:{posBLeft:"805px",posBTop:"324px"}}),un("* => buttonToB",Rn("1.5s"))]);var W0=(i,e)=>e.id,pI=i=>({"background-color":i});function fI(i,e){if(i&1){let t=qe();L(0,"button",10),Pe("click",function(){let r=le(t).$implicit,s=H();return ce(s.onOperandButtonClick(r))}),ye(1),q()}if(i&2){let t=e.$implicit;M("disabled",t.disabled)("ngStyle",Ot(4,pI,t.selected?"rgb(190 209 253 / 59%)":""))("ngClass",!t.disabled&&!t.selected?"operator-content-button":"operator-content-button-disabled"),N(),qt("",t.value," ")}}function gI(i,e){if(i&1){let t=qe();L(0,"button",11),Pe("click",function(){let r=le(t).$implicit,s=H();return ce(s.onOperatorButtonClick(r))}),X(1,"mat-icon",12),q()}if(i&2){let t=e.$implicit,n=e.$index;M("ngClass",n===0?"revert-button":"arithmetic-operation-button"),N(),ip("svgIcon",t.icon)}}var Y0=(()=>{class i{constructor(t,n){this.githubLogoPath="assets/logos/GitHub-Mark-32px.png",this.operators=new Array({id:0,selected:!1,caption:pe.OPERATOR_REV,operator:pe.OPERATOR_REV,icon:"revert"},{id:1,selected:!1,caption:pe.OPERATOR_ADD,operator:pe.OPERATOR_ADD,icon:"addition"},{id:2,selected:!1,caption:pe.OPERATOR_SUB,operator:pe.OPERATOR_SUB,icon:"substraction"},{id:3,selected:!1,caption:pe.OPERATOR_MUL,operator:pe.OPERATOR_MUL,icon:"multiplication"},{id:4,selected:!1,caption:pe.OPERATOR_DIV,operator:pe.OPERATOR_DIV,icon:"division"}),this.expectedResultReached=new ct,this.invalidOperationExecuted=new ct,t.addSvgIcon("revert",n.bypassSecurityTrustResourceUrl("assets/icons/rotate-left-solid.svg")),t.addSvgIcon("addition",n.bypassSecurityTrustResourceUrl("assets/icons/plus-solid.svg")),t.addSvgIcon("substraction",n.bypassSecurityTrustResourceUrl("assets/icons/minus-solid.svg")),t.addSvgIcon("multiplication",n.bypassSecurityTrustResourceUrl("assets/icons/xmark-solid.svg")),t.addSvgIcon("division",n.bypassSecurityTrustResourceUrl("assets/icons/divide-solid.svg"))}getSelectedOperator(){return this.operators.find(t=>t.selected)}clearSelectionOfOperands(){this.gameParameters.operands.forEach(t=>{t.selected=!1})}isTheExpectedResultReached(t){return this.gameParameters.result===t}addStateToHistory(t){this.history.push(t)}clearSelectionOfOperators(){this.operators.forEach(t=>{t.selected=!1})}addGameOperationToOperationHistory(t){this.operationHistory?.push(t)}captureAnimationTriggerStartEvent(t){console.log("Animation trigger start ",t)}captureAnimationTriggerDoneEvent(t){console.log("Animation trigger done ",t)}ngOnInit(){this.history=new yo,this.operationHistory=new yo}revertLastOperation(){this.history.size()>0?this.gameParameters=this.history.pop():console.log("History is empty!"),this.clearSelectionOfOperators(),this.clearSelectionOfOperands(),this.selectedOperandA=null,this.selectedOperandB=null}enableOfAllOperands(){this.gameParameters.operands.forEach(t=>{t.disabled=!1})}clearHistory(){this.history?.clear()}removeLastOperation(){return this.history.pop()}onOperandButtonClick(t){if(t.selected=!t.selected,!t.selected){if(this.selectedOperandB&&this.selectedOperandB.id===t.id){this.selectedOperandB.selected=!1,this.selectedOperandB=null;return}else if(this.selectedOperandA&&this.selectedOperandA.id===t.id){this.selectedOperandA.selected=!1,this.selectedOperandA=null;return}}this.selectedOperandA?this.selectedOperandA.id!==t.id&&(this.selectedOperandB||(this.selectedOperandB=t)):this.selectedOperandA=t;var n=this.getSelectedOperator();if(this.selectedOperandA&&this.selectedOperandB&&!n)this.selectedOperandB.selected=!1,this.selectedOperandB=null;else if(this.selectedOperandA&&this.selectedOperandB&&n){let r=Nt.cloneGameParameters(this.gameParameters),s=Nt.evaluate(this.selectedOperandA.value,this.selectedOperandB.value,n.operator);if(this.addStateToHistory(r),s===Number.MIN_VALUE)this.invalidOperationExecuted.emit(s);else{let o=new Array(this.selectedOperandA.value,this.selectedOperandB.value),l=new vo(o,n.operator,s);this.addGameOperationToOperationHistory(l),this.isTheExpectedResultReached(s)&&this.expectedResultReached.emit(this.operationHistory),t.value=s;let c=this.gameParameters.operands.find(h=>h.id==this.selectedOperandA.id);c.disabled=!0,this.clearSelectionOfOperators(),this.clearSelectionOfOperands(),this.selectedOperandA=null,this.selectedOperandB=null}}console.log(`Value ${t.value} Selected ${t.selected}`)}onOperatorButtonClick(t){if(!this.selectedOperandA&&t.operator!==pe.OPERATOR_REV){t.selected=!1;return}if(t.selected=!t.selected,t.operator===pe.OPERATOR_REV){this.revertLastOperation();let n=Nt.cloneGameParameters(this.gameParameters),r=new Array;n.operands.forEach(o=>{r.push(o.value)});let s=new vo(r,t.operator,this.gameParameters.result);this.addGameOperationToOperationHistory(s)}console.log(`Caption ${t.caption} Selected ${t.selected}`)}ngOnDestroy(){this.history.clear(),this.history=void 0,this.operationHistory.clear(),this.operationHistory=void 0}static{this.\u0275fac=function(n){return new(n||i)(de(pp),de(dp))}}static{this.\u0275cmp=_e({type:i,selectors:[["app-game-arithmetic-operations"]],hostVars:1,hostBindings:function(n,r){n&1&&tp("@operandButtonAnimationMove.start",function(o){return r.captureAnimationTriggerStartEvent(o)})("@operandButtonAnimationMove.done",function(o){return r.captureAnimationTriggerDoneEvent(o)}),n&2&&ep("@operandButtonAnimationMove",r.operandButtonAnimation)},inputs:{gameParameters:"gameParameters"},outputs:{expectedResultReached:"expectedResultReached",invalidOperationExecuted:"invalidOperationExecuted"},standalone:!1,decls:15,vars:2,consts:[[1,"game-arithmetic-operations-layout"],[1,"usage-instruction"],[1,"expected-result"],[1,"operands-container"],[1,"three-operands"],["type","button",1,"operand",3,"disabled","ngStyle","ngClass"],[1,"operators-container"],["type","button",1,"operator-content",3,"ngClass"],["href","https://github.com/lkovari/LKovariHome/tree/master/src/app/digits/digits-game.component.ts"],["width","16","height","16",3,"src"],["type","button",1,"operand",3,"click","disabled","ngStyle","ngClass"],["type","button",1,"operator-content",3,"click","ngClass"],[1,"operator-content-icon",3,"svgIcon"]],template:function(n,r){n&1&&(L(0,"div",0)(1,"div",1),ye(2,"Use the any combination of number to reach the target:"),q(),L(3,"div")(4,"label",2),ye(5),q()(),L(6,"div",3)(7,"div",4),At(8,fI,2,6,"button",5,W0),q()(),L(10,"div",6),At(11,gI,2,2,"button",7,W0),q(),L(13,"a",8),X(14,"img",9),q()()),n&2&&(N(5),xn(r.gameParameters.result),N(3),St(r.gameParameters.operands),N(3),St(r.operators),N(3),M("src",r.githubLogoPath,Zm))},dependencies:[cn,Pn,Yo,Xo,fp],styles:[".game-arithmetic-operations-layout[_ngcontent-%COMP%]{text-align:center}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .usage-instruction[_ngcontent-%COMP%]{font-size:13px;font-weight:500;line-height:13px;letter-spacing:.02em;padding-bottom:20px;font-family:Arial,Helvetica,sans-serif}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .expected-result[_ngcontent-%COMP%]{text-align:center;font-size:55px;font-weight:500;padding-bottom:1rem}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operands-container[_ngcontent-%COMP%]{font-size:44px;font-weight:500}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operands-container[_ngcontent-%COMP%]   .three-operands[_ngcontent-%COMP%]{justify-content:center;display:flex;flex-direction:row;flex-wrap:wrap;width:371px;margin:7px auto}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operands-container[_ngcontent-%COMP%]   .three-operands[_ngcontent-%COMP%]   .operand[_ngcontent-%COMP%]{width:90px;height:90px;border:4px dashed blue;border-radius:50%;font-size:26px;font-weight:550;margin:4px 10px;font-family:Courier New,Courier,monospace}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operands-container[_ngcontent-%COMP%]   .three-operands[_ngcontent-%COMP%]   .operand[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]:hover{border:4px solid blue}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operators-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:center;align-content:center;align-items:center}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operator-content[_ngcontent-%COMP%]{order:0;flex:0 1 auto;align-self:auto;width:3.55rem;height:3.55rem;border:4px solid #6b6b6b;border-radius:50%;margin:3px;display:flex;justify-content:center;align-items:center;color:#00f}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operator-content-button[_ngcontent-%COMP%], .game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operator-content-button-disabled[_ngcontent-%COMP%]{background-color:#fff}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operator-content-button[_ngcontent-%COMP%]:hover{background-color:#e6fffa}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operator-content-icon[_ngcontent-%COMP%]{width:30px;height:30px;font-weight:500;vertical-align:middle}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .revert-button[_ngcontent-%COMP%]{background-color:#dbfbdd}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .revert-button[_ngcontent-%COMP%]:hover{background-color:#aae0ae}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .arithmetic-operation-button[_ngcontent-%COMP%]{background-color:#d9ecff}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .arithmetic-operation-button[_ngcontent-%COMP%]:hover{background-color:#aed7ff}"],data:{animation:[Q0]}})}}return i})();var yI=["arithmeticOperations"];function vI(i,e){if(i&1&&(L(0,"li",13),ye(1),q()),i&2){let t=e.$implicit;N(),qt(" ",t," ")}}function wI(i,e){if(i&1&&(L(0,"li",13),ye(1),q()),i&2){let t=e.$implicit;N(),qt(" ",t," ")}}var X0=(()=>{class i{constructor(t,n,r,s,o){this.messageService=t,this.cookieService=n,this.clipboardService=r,this.numbersFirestoreService=s,this.stageCommunicationService=o,this.COOKIE_LK_DIGITS="CookieLKNumbers",this.generateGameParameters=new na,this.currentDate=new Date,this.stageLevels=[],this.gameParameters=[],this.stageIndex=0,this.todayPuzzleDataItems=[],this.splashVisible=!1,this.gameCompletedModalMessages=[],this.gameCompletedModalVisible=!1,this.allGameCompletedModalMessage=[],this.allGameCompletedModalVisible=!1,this.splashWidth="80vw",this.destroyRef=Qi(Jm),this.defaultGameParameters={result:0,operands:[],stageIndex:0},this.updateStageLevel=this.stageCommunicationService.getUpdatedStageLevel().pipe(vp(this.destroyRef)).subscribe({next:l=>{console.log("StageLevel updated "+l.index)},error:l=>console.error("StageLevel updated "+l),complete:()=>console.info("StageLevel updated Complete")})}initializeStageLevels(){this.stageLevels=new Array({selected:!0,index:0,value:96,completed:!1,summary:""},{selected:!1,index:1,value:161,completed:!1,summary:""},{selected:!1,index:2,value:275,completed:!1,summary:""},{selected:!1,index:3,value:355,completed:!1,summary:""},{selected:!1,index:4,value:404,completed:!1,summary:""})}stageToCompleted(){this.stageLevels[this.stageIndex].completed=!0,this.stageLevels[this.stageIndex].selected=!1}formatOperations(t){let n=`Completed! Executed Operations:
`,r=t.size()-1;for(;r>=0;){let s=t.peekBy(r);n+=r+1+". "+s?.operands[0]+" "+s?.operator+" "+s?.operands[1]+" = "+s?.result+`
`,--r}return n}createSummaryOfTHeOperations(t,n){let r=this.stageLevels[t].value+" -> ";for(this.gameCompletedModalMessages=[];n.size()>0;){let s=n.pop();this.gameCompletedModalMessages.push(s?.operands[0]+" "+s.operator+" "+s?.operands[1]+" = "+s?.result),r+=""+s?.operator}return r+=`
`,r}showSuccessMessage(t){this.messageService.add({severity:"success",summary:"Congratulation!",detail:t})}showErrorMessage(t){this.messageService.add({severity:"error",summary:"Error!",detail:t})}setupStages(){let t=0;this.gameParameters.forEach(n=>{this.stageLevels[t].value=n.result,++t})}storeGameStateToCookie(){let t=new Ts;t.storeDate=new Date,t.stageIndex=this.stageIndex,t.stageLevels=this.stageLevels,t.completed=this.allGameCompleted()&&this.stageIndex===this.stageLevels.length-1,t.gameParameters=this.gameParameters;let n=t.cookieData2Text(),r=new Date;r.setHours(23,59,59,999),this.cookieService.set(this.COOKIE_LK_DIGITS,n,r)}restoreGameStateFromCookie(){let t=this.cookieService.get(this.COOKIE_LK_DIGITS),n;return!t||t==""?(console.log("INFO: Unable to retrieve the Game State"),n=null):(n=new Ts,n=n.text2CookieData(t)),n}mapPuzzleDataToGameParameters(t){t.stages.forEach(n=>{let r=this.gameParameters.find(s=>s.stageIndex===n.stageIndex);if(r){r.result=n.expectedValue;let s=0;r.operands.forEach(l=>{l.value=n.operands[s],s++}),this.initializeStageLevels();let o=this.stageLevels.find(l=>l.index===n.stageIndex);o&&o.value==n.expectedValue}})}mapGameParametersToPuzzleData(t){let n=new ra;return n.day=new Date,n.day.setHours(23,59,59,999),t.forEach(r=>{let s=new sa;s.stageIndex=r.stageIndex,s.expectedValue=r.result;let o=new Array;r.operands.forEach(l=>{o.push(l.value)}),s.operands=o,n.stages.push(s)}),n}isDateSame(t,n){return t.getFullYear()===n.getFullYear()&&t.getMonth()===n.getMonth()&&t.getDate()===n.getDate()}updatePuzzleDataInDb(t){this.firestorePuzzleData.data=JSON.stringify(t),this.numbersFirestoreService.update(this.firestorePuzzleData.id,{data:this.firestorePuzzleData.data}).then(()=>console.log("INFO: The Game Data was updated successfully in DB!")).catch(n=>console.log(n))}createPuzzleDataInDb(t){this.numbersFirestoreService.create(t).then(()=>{console.log("INFO: The Puzzle Data was created successfully in DB!")})}currentLocaleAlreadyStoredInDb(){let t=navigator.language;return this.firestorePuzzleDataItems.find(r=>r.locale===t)!==void 0}upsertGameDataInDb(t){if(this.currentLocaleAlreadyStoredInDb())this.updatePuzzleDataInDb(t);else{let n=new Is;n.locale=navigator.language,n.data=JSON.stringify(t),this.createPuzzleDataInDb(n)}}allGameCompleted(){let t=!0;return this.stageLevels.forEach(n=>{t=t&&n.completed}),t}collectAllOperations(){let t=this.allGameCompleted()&&this.stageIndex===this.stageLevels.length-1;if(t){let n=`Genius!
`;this.allGameCompletedModalMessage=[],this.stageLevels.forEach(r=>{n+=r.summary,this.allGameCompletedModalMessage.push(r.summary)}),this.clipboardService.copy(n),this.storeGameStateToCookie(),this.allGameCompletedModalVisible=!0}return t}generateNewGameAndStore(){this.gameParameters=this.generateGameParameters.generateStageNumbers(),this.storeGameStateToCookie(),this.setupStages();let t=this.mapGameParametersToPuzzleData(this.gameParameters);this.upsertGameDataInDb(t)}ngOnInit(){console.log(`Browser locale: ${navigator.language}`),this.initializeStageLevels();let t=this.restoreGameStateFromCookie();if(t){console.log("INFO: Game state restored from cookie");let n=new Date(t.storeDate);if(this.isDateSame(n,new Date))this.stageIndex=t.stageIndex,this.stageLevels=t.stageLevels,this.gameParameters=t.gameParameters,this.setupStages(),t.completed?this.collectAllOperations()&&console.log("INFO: All Games completed show completed modal"):(console.log("INFO: All Games incomplete show splash"),this.splashVisible=!0);else{this.gameParameters=this.generateGameParameters.generateStageNumbers(),this.storeGameStateToCookie(),this.setupStages();let r=this.mapGameParametersToPuzzleData(this.gameParameters);console.log("INFO: Date mismatch which restored from cookie "+r),this.upsertGameDataInDb(r)}}else{console.log("INFO: No game state in cookie, try to get if from DB."),this.gameParameters=this.generateGameParameters.generateStageNumbers();let n=navigator.language;this.numbersFirestoreService.getAll().snapshotChanges().pipe($e(r=>r.map(s=>Vt({id:s.payload.doc.id},s.payload.doc.data())))).subscribe(r=>{this.firestorePuzzleDataItems=r;let s=r.find(o=>o.locale===n);if(s){this.firestorePuzzleData=s,this.todayPuzzleData=JSON.parse(this.firestorePuzzleData.data),console.log("INFO: Game Data retrieved from DB.");let o=new Date,l=new Date(this.todayPuzzleData.day);if(this.todayPuzzleData.day&&this.isDateSame(l,o))console.log("INFO: Game Data day date is matched, apply Game data"),this.mapPuzzleDataToGameParameters(this.todayPuzzleData),this.storeGameStateToCookie(),this.setupStages();else{console.log("INFO: Game Data day of date is Not matched, generate new game parameters"),this.gameParameters=this.generateGameParameters.generateStageNumbers(),this.storeGameStateToCookie(),this.setupStages();let c=this.mapGameParametersToPuzzleData(this.gameParameters);this.upsertGameDataInDb(c)}}else{console.log("INFO: Game Data not found in the DB. by locale"),this.gameParameters=this.generateGameParameters.generateStageNumbers(),this.storeGameStateToCookie(),this.setupStages();let o=this.mapGameParametersToPuzzleData(this.gameParameters),l=new Is;l.locale=navigator.language,l.data=JSON.stringify(o),this.createPuzzleDataInDb(l)}})}}ngOnDestroy(){this.updateStageLevel.unsubscribe()}expectedResultReached(t){let n=this.formatOperations(t),r=this.createSummaryOfTHeOperations(this.stageIndex,t);this.stageLevels[this.stageIndex].summary=r,this.clipboardService.copy(n),this.showSuccessMessage("You are reach the expected result!"),this.stageToCompleted(),this.reachedValue=this.gameParameters[this.stageIndex].result,this.gameCompletedModalVisible=!0}hideGameCompletedDialog(){this.collectAllOperations()||(this.stageIndex++,this.stageLevels[this.stageIndex].selected=!0),this.storeGameStateToCookie(),this.arithmeticComponent.clearHistory()}invalidOperationExecuted(t){this.showErrorMessage("Invalid Operation Executed!"),this.arithmeticComponent.revertLastOperation(),console.log(t)}onDeleteCookie(){this.cookieService.deleteAll()}onUpdatePuzzleData(){this.generateNewGameAndStore()}static{this.\u0275fac=function(n){return new(n||i)(de(Xi),de(ia),de(Op),de(Nl),de(Ml))}}static{this.\u0275cmp=_e({type:i,selectors:[["app-digits-game"]],viewQuery:function(n,r){if(n&1&&an(yI,7),n&2){let s;ht(s=dt())&&(r.arithmeticComponent=s.first)}},standalone:!1,features:[rp([Xi,ia])],decls:31,vars:14,consts:[["arithmeticOperations",""],[1,"digits-game-layout"],["position","top-center","closable","true"],[1,"digits-game-title"],["href","https://www.nytimes.com/games/digits",1,"anchor-underline-off"],[1,"title-bar"],[1,"title-bar-name",3,"click"],[1,"title-bar-date",3,"click"],[1,"tool-bar"],[3,"stageLevels"],[3,"expectedResultReached","invalidOperationExecuted","gameParameters"],["id","splashscreen","header","Welcome to the Numbers Puzzle Game",3,"visibleChange","visible","modal"],["id","gameCompleted","header","Game Completed",3,"visibleChange","onHide","visible","modal"],[1,"li-no-bullet"],["id","allGamesCompleted","header","All Game Completed Genius!",3,"visibleChange","visible","modal","closable"]],template:function(n,r){if(n&1){let s=qe();L(0,"div",1),X(1,"p-toast",2),L(2,"div",3),ye(3," This is a daily numbers puzzle, similar to the "),L(4,"a",4),ye(5,"NY Times Digits"),q(),ye(6,", which unfortunately discontinued at August 8, 2023 "),q(),L(7,"div",5)(8,"div",6),Pe("click",function(){return le(s),ce(r.onDeleteCookie())}),ye(9," Numbers "),q(),L(10,"div",7),Pe("click",function(){return le(s),ce(r.onUpdatePuzzleData())}),ye(11),op(12,"date"),q()(),L(13,"div",8),X(14,"app-game-stage-levels",9),q(),L(15,"div")(16,"app-game-arithmetic-operations",10,0),Pe("expectedResultReached",function(l){return le(s),ce(r.expectedResultReached(l))})("invalidOperationExecuted",function(l){return le(s),ce(r.invalidOperationExecuted(l))}),q()()(),L(18,"p-dialog",11),Go("visibleChange",function(l){return le(s),jo(r.splashVisible,l)||(r.splashVisible=l),ce(l)}),L(19,"p"),ye(20,"It can improves your arithmetic combination ability."),q()(),L(21,"p-dialog",12),Go("visibleChange",function(l){return le(s),jo(r.gameCompletedModalVisible,l)||(r.gameCompletedModalVisible=l),ce(l)}),Pe("onHide",function(){return le(s),ce(r.hideGameCompletedDialog())}),L(22,"div"),ye(23),At(24,vI,2,1,"li",13,oi),q()(),L(26,"p-dialog",14),Go("visibleChange",function(l){return le(s),jo(r.allGameCompletedModalVisible,l)||(r.allGameCompletedModalVisible=l),ce(l)}),L(27,"div"),ye(28," Congratulation! Your Solutions: "),At(29,wI,2,1,"li",13,oi),q()()}if(n&2){let s;N(11),qt(" ",ap(12,11,r.currentDate,"MM/dd/yyyy")," "),N(3),M("stageLevels",r.stageLevels),N(2),M("gameParameters",(s=r.gameParameters[r.stageIndex])!==null&&s!==void 0?s:r.defaultGameParameters),N(2),qo("visible",r.splashVisible),M("modal",!0),N(3),qo("visible",r.gameCompletedModalVisible),M("modal",!0),N(2),qt(" Target ",r.reachedValue,". Your solution: "),N(),St(r.gameCompletedModalMessages),N(2),qo("visible",r.allGameCompletedModalVisible),M("modal",!0)("closable",!1),N(3),St(r.allGameCompletedModalMessage)}},dependencies:[z0,j0,H0,Y0,hp],styles:[".digit-font-settings[_ngcontent-%COMP%], .digits-game-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%], .digits-game-layout[_ngcontent-%COMP%]   .tool-bar[_ngcontent-%COMP%]{font-size:17px;font-weight:500;line-height:17px;font-family:Courier New,Courier,monospace;letter-spacing:.03em}.digits-border-horizontal[_ngcontent-%COMP%], .digits-game-layout[_ngcontent-%COMP%]   .digits-game-title[_ngcontent-%COMP%], .digits-game-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%]{border-bottom:1px solid #d4d4d4;padding:12px 0}.digits-game-layout[_ngcontent-%COMP%]{height:98vh;width:50vw;position:absolute;inset:0;margin:auto;background:#ebf9fd40;border:1px solid lightgray}.digits-game-layout[_ngcontent-%COMP%]   .digits-game-title[_ngcontent-%COMP%]{text-align:center}.digits-game-layout[_ngcontent-%COMP%]   .anchor-underline-off[_ngcontent-%COMP%]{text-decoration:none}.digits-game-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%]{font-weight:500;font-size:17px;text-align:center;color:orange}.digits-game-layout[_ngcontent-%COMP%]   .title-bar[_ngcontent-%COMP%]{padding:6px 0;display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-around;align-content:stretch;align-items:center;font-size:28px;font-weight:300;font-family:Arial,Helvetica,sans-serif}.digits-game-layout[_ngcontent-%COMP%]   .title-bar[_ngcontent-%COMP%]   .title-bar-name[_ngcontent-%COMP%], .digits-game-layout[_ngcontent-%COMP%]   .title-bar[_ngcontent-%COMP%]   .title-bar-date[_ngcontent-%COMP%]{order:0;flex:0 1 auto;align-self:auto;cursor:default}.digits-game-layout[_ngcontent-%COMP%]   .tool-bar[_ngcontent-%COMP%]{height:52px}@media only screen and (max-width: 600px){.digits-game-layout[_ngcontent-%COMP%]{height:90vh;width:99vw}.digits-game-layout[_ngcontent-%COMP%]     .p-dialog{width:80vw}}@media only screen and (min-width: 601px){  .p-dialog{width:20vw}.digits-game-layout[_ngcontent-%COMP%]{position:absolute;inset:0;margin:auto}}@media only screen and (max-width: 600px){  .p-dialog{width:80vw}}  .p-dialog{border:2px solid;border-radius:25px;border-color:#00bfff}  .p-dialog .p-dialog-header{background-color:#f0f8ff;background-image:none;border-top-right-radius:25px;border-top-left-radius:25px}  .p-dialog .p-dialog-content:last-of-type{background-color:#f0f8ff;background-image:none;border-bottom-right-radius:25px;border-bottom-left-radius:25px}  li.li-no-bullet{list-style-position:revert;list-style-image:initial;list-style-type:decimal-leading-zero}"]})}}return i})();var TI=[{path:"digits/digits-game",component:X0}],J0=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=Ue({type:i})}static{this.\u0275inj=Be({imports:[mt,fs.forChild(TI),fs]})}}return i})();var Z0=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ue({type:i});static \u0275inj=Be({imports:[mt,Ji,mo,fo,go,po,Dn,di,di]})}return i})();var a2=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=Ue({type:i})}static{this.\u0275inj=Be({providers:[Nl],imports:[mt,fs,B0,Z0,J0,mp,gp,Np,Xp.initializeApp(kp.firebasePuzzleData),N0,G0]})}}return i})();export{a2 as DigitsModule};
