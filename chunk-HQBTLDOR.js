import{a as Mf}from"./chunk-4WOZYAGK.js";import{c as Sf,d as xf,e as Dn}from"./chunk-QTPNGOZ5.js";import{a as Pf,b as Ji,c as Rf,d as vs,e as vc,f as ea,g as Df,h as kf,i as wc,j as Ee,k as $t,l as ta,m as ws,n as Vf,o as Of,p as kn,q as ft}from"./chunk-GVYULQYL.js";import{$ as bf,R as _f,S as yf,T as vf,U as Tf,V as Ef,W as rt,X as hi,Y as Yi,_ as _s,aa as Cf,ba as ys,ca as di,da as Af,ea as se,g as Xo,ga as xt,ha as Zo,i as Jo,ia as Xi,n as gf}from"./chunk-EA44OHEU.js";import{c as ui,d as Rn,f as Gt,g as gs,h as un,i as _c,j as wf,k as yc,l as If}from"./chunk-S35HUXPS.js";import{$a as vt,$b as Pn,Ab as li,B as Ym,C as zo,Cb as Ho,D as Bo,Ea as _e,Eb as lf,F as mc,Fa as Ue,Fb as cf,Ga as pc,H as Uo,Ha as Ct,Hb as uf,I as si,Ia as Sn,Ib as ms,J as fc,Ja as ne,Jb as hf,Kb as df,L as Xm,Lb as gc,Mb as fs,Na as re,O as lt,Oa as N,P as Be,Pb as De,Q as He,Qb as ln,R as Y,S as Hi,Sa as xe,T as Jm,Ta as Wi,Ua as oi,Va as At,W as Zm,Wa as St,Wb as jt,X as le,Xa as L,Y as ce,Ya as q,Yb as cn,Z as Tt,Za as X,Zb as mf,_ as Et,_a as yt,_b as Qo,ab as on,ac as Wo,b as Gi,ba as ef,bb as qe,c as $i,ca as ct,cc as ff,da as ut,db as nf,eb as Pe,ec as mt,f as Lo,fb as rf,fc as ci,g as Hm,ga as Qi,gb as H,gc as Yo,hb as sf,i as ri,ib as qo,j as Ki,ja as bt,jb as of,k as Cn,kb as ai,l as An,lb as an,mb as ht,n as Ke,nb as dt,nc as pf,qb as ds,rb as ye,s as Qm,sa as tf,sb as xn,sc as ps,t as us,tb as qt,ua as M,ub as jo,va as de,vb as Go,wb as $o,xb as af,ya as hs,yb as Ko,z as Wm,zb as Ot}from"./chunk-7W7GFG2S.js";import{a as Vt,b as hc,e as dc,f as P}from"./chunk-KT3CPUTC.js";var fe=(()=>{class i{static{this.OPERATOR_REV="\xAB"}static{this.OPERATOR_ADD="+"}static{this.OPERATOR_SUB="-"}static{this.OPERATOR_MUL="\xD7"}static{this.OPERATOR_DIV="/"}}return i})();var Zi=class{constructor(e,t,n,r){this.id=e,this.selected=t,this.disabled=n,this.value=r}};var er=class{constructor(){this.operands=[]}};var Mt=class{static evaluate(e,t,n){let r=Number.MIN_VALUE;switch(n){case fe.OPERATOR_ADD:{r=e+t;break}case fe.OPERATOR_SUB:{r=e>=t?e-t:Number.MIN_VALUE;break}case fe.OPERATOR_DIV:{r=e%t==0?e/t:Number.MIN_VALUE;break}case fe.OPERATOR_MUL:{r=e*t;break}}return r}static cloneGameParameters(e){let t=new er;return t.result=e.result,e.operands.forEach(n=>{let r=new Zi(n.id,!1,!1,-1);Object.assign(r,n),t.operands.push(r)}),t}};var na=class{constructor(){this.numbers=[]}generateNumber(e,t){let n=Math.floor(e+Math.random()*(t-e+1));for(;this.numbers.indexOf(n)>=0;)n=Math.floor(e+Math.random()*(t-e+1));this.numbers.push(n)}getGeneratedNumbers(){return this.numbers}clearGeneratedNumbers(){this.numbers=[]}};var ia=class{generateNumber(e,t){return Math.floor(e+Math.random()*(t-e+1))}choiceRandomOperation(){let e=this.generateNumber(0,4),t=fe.OPERATOR_ADD;switch(e){case 0:{t=fe.OPERATOR_ADD;break}case 1:{t=fe.OPERATOR_SUB;break}case 2:{t=fe.OPERATOR_MUL;break}case 3:{t=fe.OPERATOR_DIV;break}}return t}checkExecuteDivision(e,t){return e%t===0}checkExecuteSubstraction(e,t){return e>t}removeOperandByIndex(e,t){let n=t;return e<t&&(n=t-1),this.operands.splice(e,1),n}calculateResult(e){let t=this.operands.length,n=0,r=0,s=this.generateNumber(3,5),o=Number.MIN_VALUE;for(;r<s&&e.length>1;){let l=this.choiceRandomOperation(),c=this.generateNumber(0,t-1);for(o===Number.MIN_VALUE&&(o=this.generateNumber(0,t-1));o===c;)c=this.generateNumber(0,t-1);switch(l){case fe.OPERATOR_ADD:{e[o]=Mt.evaluate(e[o],e[c],l),o=this.removeOperandByIndex(c,o),--t,++r;break}case fe.OPERATOR_SUB:{if(this.checkExecuteSubstraction(e[o],e[c]))e[o]=Mt.evaluate(e[o],e[c],l),o=this.removeOperandByIndex(c,o),--t,++r;else continue;break}case fe.OPERATOR_MUL:{e[o]=Mt.evaluate(e[o],e[c],l),o=this.removeOperandByIndex(c,o),--t,++r;break}case fe.OPERATOR_DIV:{if(this.checkExecuteDivision(e[o],e[c]))e[o]=Mt.evaluate(e[o],e[c],l),o=this.removeOperandByIndex(c,o),--t,++r;else continue;break}}}return n=e[o],n}generateGameParameter(e){let t=new na;switch(e){case 0:{t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(5,10),t.generateNumber(10,25);break}case 1:{t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(5,10),t.generateNumber(10,15),t.generateNumber(10,25);break}case 2:{t.generateNumber(1,5),t.generateNumber(1,5),t.generateNumber(5,10),t.generateNumber(5,15),t.generateNumber(10,20),t.generateNumber(10,25);break}case 3:{t.generateNumber(1,5),t.generateNumber(5,10),t.generateNumber(5,15),t.generateNumber(10,15),t.generateNumber(10,20),t.generateNumber(10,25);break}case 4:{t.generateNumber(1,10),t.generateNumber(5,10),t.generateNumber(5,15),t.generateNumber(10,15),t.generateNumber(10,25),t.generateNumber(10,25);break}}let n=t.getGeneratedNumbers();n=n.sort((m,p)=>m-p);let r=new Array(n[0],n[1],n[2],n[3],n[4],n[5]);this.operands=new Array(n[0],n[1],n[2],n[3],n[4],n[5]),t.clearGeneratedNumbers();let s=0,o=0;switch(e){case 0:{s=30,o=100;break}case 1:{s=50,o=150;break}case 2:{s=100,o=200;break}case 3:{s=300,o=400;break}case 4:{s=400,o=550;break}}let l=this.calculateResult(this.operands);for(;s>l||l>o;)this.operands=new Array(n[0],n[1],n[2],n[3],n[4],n[5]),l=this.calculateResult(this.operands);let c=new er;c.result=l;let h=0;return r.forEach(m=>{let p=new Zi(h,!1,!1,m);c.operands.push(p),++h}),c}generateStageNumbers(){let e=new Array;for(let t=0;t<5;t++){let n=this.generateGameParameter(t);n.stageIndex=t,e.push(n)}return e=e.sort((t,n)=>t.result-n.result),e}};var Is=class{cookieData2Text(){return JSON.stringify(this)}text2CookieData(e){return JSON.parse(e)}};var ra=(()=>{class i{constructor(t,n){this.document=t,this.platformId=n,this.documentIsAccessible=ci(this.platformId)}static getCookieRegExp(t){let n=t.replace(/([\[\]{}()|=;+?,.*^$])/gi,"\\$1");return new RegExp("(?:^"+n+"|;\\s*"+n+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(t){try{return decodeURIComponent(t)}catch{return t}}check(t){return this.documentIsAccessible?(t=encodeURIComponent(t),i.getCookieRegExp(t).test(this.document.cookie)):!1}get(t){if(this.documentIsAccessible&&this.check(t)){t=encodeURIComponent(t);let r=i.getCookieRegExp(t).exec(this.document.cookie);return r[1]?i.safeDecodeURIComponent(r[1]):""}else return""}getAll(){if(!this.documentIsAccessible)return{};let t={},n=this.document;return n.cookie&&n.cookie!==""&&n.cookie.split(";").forEach(r=>{let[s,o]=r.split("=");t[i.safeDecodeURIComponent(s.replace(/^ /,""))]=i.safeDecodeURIComponent(o)}),t}set(t,n,r,s,o,l,c,h){if(!this.documentIsAccessible)return;if(typeof r=="number"||r instanceof Date||s||o||l||c){let _={expires:r,path:s,domain:o,secure:l,sameSite:c||"Lax",partitioned:h};this.set(t,n,_);return}let m=encodeURIComponent(t)+"="+encodeURIComponent(n)+";",p=r||{};if(p.expires)if(typeof p.expires=="number"){let _=new Date(new Date().getTime()+p.expires*1e3*60*60*24);m+="expires="+_.toUTCString()+";"}else m+="expires="+p.expires.toUTCString()+";";p.path&&(m+="path="+p.path+";"),p.domain&&(m+="domain="+p.domain+";"),p.secure===!1&&p.sameSite==="None"&&(p.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${t} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),p.secure&&(m+="secure;"),p.sameSite||(p.sameSite="Lax"),m+="sameSite="+p.sameSite+";",p.partitioned&&(m+="Partitioned;"),this.document.cookie=m}delete(t,n,r,s,o="Lax"){if(!this.documentIsAccessible)return;let l=new Date("Thu, 01 Jan 1970 00:00:01 GMT");this.set(t,"",{expires:l,path:n,domain:r,secure:s,sameSite:o})}deleteAll(t,n,r,s="Lax"){if(!this.documentIsAccessible)return;let o=this.getAll();for(let l in o)o.hasOwnProperty(l)&&this.delete(l,t,n,r,s)}static{this.\u0275fac=function(n){return new(n||i)(Y(jt),Y(bt))}}static{this.\u0275prov=lt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var sa=class{constructor(){this.stages=[]}};var oa=class{constructor(){this.operands=[]}};var Ts=class{};var Nf=new He("WindowToken",typeof window<"u"&&window.document?{providedIn:"root",factory:()=>window}:{providedIn:"root",factory:()=>{}});var Ff=(()=>{class i{constructor(t,n,r){this.ngZone=t,this.document=n,this.window=r,this.copySubject=new $i,this.copyResponse$=this.copySubject.asObservable(),this.config={}}configure(t){this.config=t}copy(t){if(!this.isSupported||!t)return this.pushCopyResponse({isSuccess:!1,content:t});let n=this.copyFromContent(t);return n?this.pushCopyResponse({content:t,isSuccess:n}):this.pushCopyResponse({isSuccess:!1,content:t})}get isSupported(){return!!this.document.queryCommandSupported&&!!this.document.queryCommandSupported("copy")&&!!this.window}isTargetValid(t){if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement){if(t.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');return!0}throw new Error("Target should be input or textarea")}copyFromInputElement(t,n=!0){try{this.selectTarget(t);let r=this.copyText();return this.clearSelection(n?t:void 0,this.window),r&&this.isCopySuccessInIE11()}catch{return!1}}isCopySuccessInIE11(){let t=this.window.clipboardData;return!(t&&t.getData&&!t.getData("Text"))}copyFromContent(t,n=this.document.body){if(this.tempTextArea&&!n.contains(this.tempTextArea)&&this.destroy(this.tempTextArea.parentElement||void 0),!this.tempTextArea){this.tempTextArea=this.createTempTextArea(this.document,this.window);try{n.appendChild(this.tempTextArea)}catch{throw new Error("Container should be a Dom element")}}this.tempTextArea.value=t;let r=this.copyFromInputElement(this.tempTextArea,!1);return this.config.cleanUpAfterCopy&&this.destroy(this.tempTextArea.parentElement||void 0),r}destroy(t=this.document.body){this.tempTextArea&&(t.removeChild(this.tempTextArea),this.tempTextArea=void 0)}selectTarget(t){return t.select(),t.setSelectionRange(0,t.value.length),t.value.length}copyText(){return this.document.execCommand("copy")}clearSelection(t,n){t&&t.focus(),n.getSelection()?.removeAllRanges()}createTempTextArea(t,n){let r=t.documentElement.getAttribute("dir")==="rtl",s;s=t.createElement("textarea"),s.style.fontSize="12pt",s.style.border="0",s.style.padding="0",s.style.margin="0",s.style.position="absolute",s.style[r?"right":"left"]="-9999px";let o=n.pageYOffset||t.documentElement.scrollTop;return s.style.top=o+"px",s.setAttribute("readonly",""),s}pushCopyResponse(t){this.copySubject.observers.length>0&&this.ngZone.run(()=>{this.copySubject.next(t)})}pushCopyReponse(t){this.pushCopyResponse(t)}}return i.\u0275fac=function(t){return new(t||i)(Y(ut),Y(jt),Y(Nf,8))},i.\u0275prov=lt({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Lf=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=Ue({type:i}),i.\u0275inj=Be({imports:[mt]}),i})();var Ly="firebase",zy="10.14.1";kn(Ly,zy,"app");var tr=new hf("ANGULARFIRE2_VERSION");var By=(i,e)=>{let t=e?[e]:Of(),n=[];return t.forEach(r=>{r.container.getProvider(i).instances.forEach(o=>{n.includes(o)||n.push(o)})}),n},mi=class{constructor(){return By(Uy)}},Uy="app-check";function Ic(){}var aa=class{zone;delegate;constructor(e,t=Hm){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){let r=this.zone,s=function(o){r.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,n)}},Tc=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Ic,{},Ic,Ic)),t.pipe(Xm({next:n,complete:n,error:n})).subscribe(e).add(n)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},la=(()=>{class i{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new aa(Zone.current)),this.insideAngular=t.run(()=>new aa(Zone.current,Lo)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(n){return new(n||i)(Y(ut))};static \u0275prov=lt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function qy(){let i=globalThis.\u0275AngularFireScheduler;if(!i)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return i}function pt(i){return jy(qy())(i)}function jy(i){return function(t){return t=t.lift(new Tc(i.ngZone)),t.pipe(Ki(i.outsideAngular),ri(i.insideAngular))}}var Es=class{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Ky=new Map,Hy={activated:!1,tokenObservers:[]},Qy={initialized:!1,enabled:!1};function Nt(i){return Ky.get(i)||Object.assign({},Hy)}function Gf(){return Qy}var Wy="https://content-firebaseappcheck.googleapis.com/v1";var Yy="exchangeDebugToken",Bf={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},yE=24*60*60*1e3;var bc=class{constructor(e,t,n,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return P(this,null,function*(){this.stop();try{this.pending=new Ji,this.pending.promise.catch(t=>{}),yield Xy(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Ji,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function Xy(i){return new Promise(e=>{setTimeout(e,i)})}var Jy={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Vn=new kf("appCheck","AppCheck",Jy);function $f(i){if(!Nt(i).activated)throw Vn.create("use-before-activation",{appName:i.name})}function Kf(n,r){return P(this,arguments,function*({url:i,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let b=yield o.getHeartbeatsHeader();b&&(s["X-Firebase-Client"]=b)}let l={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(i,l)}catch(b){throw Vn.create("fetch-network-error",{originalErrorMessage:b?.message})}if(c.status!==200)throw Vn.create("fetch-status-error",{httpStatus:c.status});let h;try{h=yield c.json()}catch(b){throw Vn.create("fetch-parse-error",{originalErrorMessage:b?.message})}let m=h.ttl.match(/^([\d.]+)(s)$/);if(!m||!m[2]||isNaN(Number(m[1])))throw Vn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${h.ttl}`});let p=Number(m[1])*1e3,_=Date.now();return{token:h.token,expireTimeMillis:_+p,issuedAtTimeMillis:_}})}function Hf(i,e){let{projectId:t,appId:n,apiKey:r}=i.options;return{url:`${Wy}/projects/${t}/apps/${n}:${Yy}?key=${r}`,body:{debug_token:e}}}var Zy="firebase-app-check-database",ev=1,Cc="firebase-app-check-store";var ca=null;function tv(){return ca||(ca=new Promise((i,e)=>{try{let t=indexedDB.open(Zy,ev);t.onsuccess=n=>{i(n.target.result)},t.onerror=n=>{var r;e(Vn.create("storage-open",{originalErrorMessage:(r=n.target.error)===null||r===void 0?void 0:r.message}))},t.onupgradeneeded=n=>{let r=n.target.result;switch(n.oldVersion){case 0:r.createObjectStore(Cc,{keyPath:"compositeKey"})}}}catch(t){e(Vn.create("storage-open",{originalErrorMessage:t?.message}))}}),ca)}function nv(i,e){return iv(rv(i),e)}function iv(i,e){return P(this,null,function*(){let n=(yield tv()).transaction(Cc,"readwrite"),s=n.objectStore(Cc).put({compositeKey:i,value:e});return new Promise((o,l)=>{s.onsuccess=c=>{o()},n.onerror=c=>{var h;l(Vn.create("storage-set",{originalErrorMessage:(h=c.target.error)===null||h===void 0?void 0:h.message}))}})})}function rv(i){return`${i.options.appId}-${i.name}`}var Ac=new ta("@firebase/app-check");function Ec(i,e){return ea()?nv(i,e).catch(t=>{Ac.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Qf(){return Gf().enabled}function Wf(){return P(this,null,function*(){let i=Gf();if(i.enabled&&i.token)return i.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var sv={error:"UNKNOWN_ERROR"};function ov(i){return Pf.encodeString(JSON.stringify(i),!1)}function Sc(i,e=!1){return P(this,null,function*(){let t=i.app;$f(t);let n=Nt(t),r=n.token,s;if(r&&!bs(r)&&(n.token=void 0,r=void 0),!r){let c=yield n.cachedTokenPromise;c&&(bs(c)?r=c:yield Ec(t,void 0))}if(!e&&r&&bs(r))return{token:r.token};let o=!1;if(Qf()){n.exchangeTokenPromise||(n.exchangeTokenPromise=Kf(Hf(t,yield Wf()),i.heartbeatServiceProvider).finally(()=>{n.exchangeTokenPromise=void 0}),o=!0);let c=yield n.exchangeTokenPromise;return yield Ec(t,c),n.token=c,{token:c.token}}try{n.exchangeTokenPromise||(n.exchangeTokenPromise=n.provider.getToken().finally(()=>{n.exchangeTokenPromise=void 0}),o=!0),r=yield Nt(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?Ac.warn(c.message):Ac.error(c),s=c}let l;return r?s?bs(r)?l={token:r.token,internalError:s}:l=qf(s):(l={token:r.token},n.token=r,yield Ec(t,r)):l=qf(s),o&&uv(t,l),l})}function av(i){return P(this,null,function*(){let e=i.app;$f(e);let{provider:t}=Nt(e);if(Qf()){let n=yield Wf(),{token:r}=yield Kf(Hf(e,n),i.heartbeatServiceProvider);return{token:r}}else{let{token:n}=yield t.getToken();return{token:n}}})}function lv(i,e,t,n){let{app:r}=i,s=Nt(r),o={next:t,error:n,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&bs(s.token)){let l=s.token;Promise.resolve().then(()=>{t({token:l.token}),Uf(i)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Uf(i))}function Yf(i,e){let t=Nt(i),n=t.tokenObservers.filter(r=>r.next!==e);n.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=n}function Uf(i){let{app:e}=i,t=Nt(e),n=t.tokenRefresher;n||(n=cv(i),t.tokenRefresher=n),!n.isRunning()&&t.isTokenAutoRefreshEnabled&&n.start()}function cv(i){let{app:e}=i;return new bc(()=>P(this,null,function*(){let t=Nt(e),n;if(t.token?n=yield Sc(i,!0):n=yield Sc(i),n.error)throw n.error;if(n.internalError)throw n.internalError}),()=>!0,()=>{let t=Nt(e);if(t.token){let n=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,r=t.token.expireTimeMillis-5*60*1e3;return n=Math.min(n,r),Math.max(0,n-Date.now())}else return 0},Bf.RETRIAL_MIN_WAIT,Bf.RETRIAL_MAX_WAIT)}function uv(i,e){let t=Nt(i).tokenObservers;for(let n of t)try{n.type==="EXTERNAL"&&e.error!=null?n.error(e.error):n.next(e)}catch{}}function bs(i){return i.expireTimeMillis-Date.now()>0}function qf(i){return{token:ov(sv),error:i}}var xc=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Nt(this.app);for(let t of e)Yf(this.app,t.next);return Promise.resolve()}};function hv(i,e){return new xc(i,e)}function dv(i){return{getToken:e=>Sc(i,e),getLimitedUseToken:()=>av(i),addTokenListener:e=>lv(i,"INTERNAL",e),removeTokenListener:e=>Yf(i.app,e)}}var mv="@firebase/app-check",fv="0.8.8";var pv="app-check",jf="app-check-internal";function gv(){ws(new Es(pv,i=>{let e=i.getProvider("app").getImmediate(),t=i.getProvider("heartbeat");return hv(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((i,e,t)=>{i.getProvider(jf).initialize()})),ws(new Es(jf,i=>{let e=i.getProvider("app-check").getImmediate();return dv(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),kn(mv,fv)}gv();var _v=["localhost","0.0.0.0","127.0.0.1"],RE=typeof window<"u"&&_v.includes(window.location.hostname);var yv="firebase",vv="10.14.1";ft.registerVersion(yv,vv,"app-compat");var wv=["ngOnDestroy"],Zf=(i,e,t,n={})=>new Proxy(i,{get:(r,s)=>t.runOutsideAngular(()=>{if(i[s])return n?.spy?.get&&n.spy.get(s,i[s]),i[s];if(wv.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(l=>{let c=l?.[s];return typeof c=="function"?c.bind(l):c?.then?c.then(h=>t.run(()=>h)):t.run(()=>c)});return new Proxy(()=>{},{get:(l,c)=>o[c],apply:(l,c,h)=>o.then(m=>{let p=m?.(...h);return n?.spy?.apply&&n.spy.apply(s,h,p),p})})})});var ua=class{constructor(e){return e}},nr=new He("angularfire2.app.options"),ir=new He("angularfire2.app.name");function Cs(i,e,t){let n=typeof t=="string"&&t||"[DEFAULT]",r=typeof t=="object"&&t||{};r.name=r.name||n;let o=ft.apps.filter(l=>l&&l.name===r.name)[0]||e.runOutsideAngular(()=>ft.initializeApp(i,r));try{if(JSON.stringify(i)!==JSON.stringify(o.options)){let l=!!module.hot;Iv("error",`${o.name} Firebase App already initialized with different options${l?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new ua(o)}var Iv=(i,...e)=>{gc()&&typeof console<"u"&&console[i](...e)},Tv={provide:ua,useFactory:Cs,deps:[nr,ut,[new Jm,ir]]},ep=(()=>{class i{static initializeApp(t,n){return{ngModule:i,providers:[{provide:nr,useValue:t},{provide:ir,useValue:n}]}}constructor(t){ft.registerVersion("angularfire",tr.full,"core"),ft.registerVersion("angularfire",tr.full,"app-compat"),ft.registerVersion("angular",df.full,t.toString())}static \u0275fac=function(n){return new(n||i)(Y(bt))};static \u0275mod=Ue({type:i});static \u0275inj=Be({providers:[Tv]})}return i})();function ha(i,e,t,n,r){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(l=>l[0]===i)||[];if(s)return Ev(r,o)||(Jf("error",`${e} was already initialized on the ${t} Firebase App with different settings.${bv?" You may need to reload as Firebase is not HMR aware.":""}`),Jf("warn",{is:r,was:o})),s;{let l=n();return globalThis.\u0275AngularfireInstanceCache.push([i,l,r]),l}}function Ev(i,e){try{return i.toString()===e.toString()}catch{return i===e}}var bv=typeof module<"u"&&!!module.hot,Jf=(i,...e)=>{gc()&&typeof console<"u"&&console[i](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Pc=new He("angularfire2.auth.use-emulator"),Rc=new He("angularfire2.auth.settings"),Dc=new He("angularfire2.auth.tenant-id"),kc=new He("angularfire2.auth.langugage-code"),Vc=new He("angularfire2.auth.use-device-language"),Oc=new He("angularfire.auth.persistence"),Mc=(i,e,t,n,r,s,o,l)=>ha(`${i.name}.auth`,"AngularFireAuth",i.name,()=>{let c=e.runOutsideAngular(()=>i.auth());if(t&&c.useEmulator(...t),n&&(c.tenantId=n),c.languageCode=r,s&&c.useDeviceLanguage(),o)for(let[h,m]of Object.entries(o))c.settings[h]=m;return l&&c.setPersistence(l),c},[t,n,r,s,o,l]),tp=(()=>{class i{authState;idToken;user;idTokenResult;credential;constructor(t,n,r,s,o,l,c,h,m,p,_,b){let k=new $i,O=An(void 0).pipe(ri(o.outsideAngular),si(()=>s.runOutsideAngular(()=>import("./chunk-HK2H3MXP.js"))),Ke(()=>Cs(t,s,n)),Ke(R=>Mc(R,s,l,h,m,p,c,_)),mc({bufferSize:1,refCount:!1}));if(Yo(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=An(null);else{O.pipe(Ym()).subscribe();let R=O.pipe(si(z=>z.getRedirectResult().then(W=>W,()=>null)),pt,mc({bufferSize:1,refCount:!1})),K=O.pipe(si(z=>new Gi(W=>({unsubscribe:s.runOutsideAngular(()=>z.onAuthStateChanged(Z=>W.next(Z),Z=>W.error(Z),()=>W.complete()))})))),Q=O.pipe(si(z=>new Gi(W=>({unsubscribe:s.runOutsideAngular(()=>z.onIdTokenChanged(Z=>W.next(Z),Z=>W.error(Z),()=>W.complete()))}))));this.authState=R.pipe(fc(K),Ki(o.outsideAngular),ri(o.insideAngular)),this.user=R.pipe(fc(Q),Ki(o.outsideAngular),ri(o.insideAngular)),this.idToken=this.user.pipe(si(z=>z?Cn(z.getIdToken()):An(null))),this.idTokenResult=this.user.pipe(si(z=>z?Cn(z.getIdTokenResult()):An(null))),this.credential=Qm(R,k,this.authState.pipe(us(z=>!z))).pipe(Ke(z=>z?.user?z:null),Ki(o.outsideAngular),ri(o.insideAngular))}return Zf(this,O,s,{spy:{apply:(R,K,Q)=>{(R.startsWith("signIn")||R.startsWith("createUser"))&&Q.then(z=>k.next(z))}}})}static \u0275fac=function(n){return new(n||i)(Y(nr),Y(ir,8),Y(bt),Y(ut),Y(la),Y(Pc,8),Y(Rc,8),Y(Dc,8),Y(kc,8),Y(Vc,8),Y(Oc,8),Y(mi,8))};static \u0275prov=lt({token:i,factory:i.\u0275fac,providedIn:"any"})}return i})();var da=class{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var np=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ip={};var On,Nc;(function(){var i;function e(w,g){function v(){}v.prototype=g.prototype,w.D=g.prototype,w.prototype=new v,w.prototype.constructor=w,w.C=function(I,T,C){for(var y=Array(arguments.length-2),nn=2;nn<arguments.length;nn++)y[nn-2]=arguments[nn];return g.prototype[T].apply(I,y)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(w,g,v){v||(v=0);var I=Array(16);if(typeof g=="string")for(var T=0;16>T;++T)I[T]=g.charCodeAt(v++)|g.charCodeAt(v++)<<8|g.charCodeAt(v++)<<16|g.charCodeAt(v++)<<24;else for(T=0;16>T;++T)I[T]=g[v++]|g[v++]<<8|g[v++]<<16|g[v++]<<24;g=w.g[0],v=w.g[1],T=w.g[2];var C=w.g[3],y=g+(C^v&(T^C))+I[0]+3614090360&4294967295;g=v+(y<<7&4294967295|y>>>25),y=C+(T^g&(v^T))+I[1]+3905402710&4294967295,C=g+(y<<12&4294967295|y>>>20),y=T+(v^C&(g^v))+I[2]+606105819&4294967295,T=C+(y<<17&4294967295|y>>>15),y=v+(g^T&(C^g))+I[3]+3250441966&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(C^v&(T^C))+I[4]+4118548399&4294967295,g=v+(y<<7&4294967295|y>>>25),y=C+(T^g&(v^T))+I[5]+1200080426&4294967295,C=g+(y<<12&4294967295|y>>>20),y=T+(v^C&(g^v))+I[6]+2821735955&4294967295,T=C+(y<<17&4294967295|y>>>15),y=v+(g^T&(C^g))+I[7]+4249261313&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(C^v&(T^C))+I[8]+1770035416&4294967295,g=v+(y<<7&4294967295|y>>>25),y=C+(T^g&(v^T))+I[9]+2336552879&4294967295,C=g+(y<<12&4294967295|y>>>20),y=T+(v^C&(g^v))+I[10]+4294925233&4294967295,T=C+(y<<17&4294967295|y>>>15),y=v+(g^T&(C^g))+I[11]+2304563134&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(C^v&(T^C))+I[12]+1804603682&4294967295,g=v+(y<<7&4294967295|y>>>25),y=C+(T^g&(v^T))+I[13]+4254626195&4294967295,C=g+(y<<12&4294967295|y>>>20),y=T+(v^C&(g^v))+I[14]+2792965006&4294967295,T=C+(y<<17&4294967295|y>>>15),y=v+(g^T&(C^g))+I[15]+1236535329&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(T^C&(v^T))+I[1]+4129170786&4294967295,g=v+(y<<5&4294967295|y>>>27),y=C+(v^T&(g^v))+I[6]+3225465664&4294967295,C=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(C^g))+I[11]+643717713&4294967295,T=C+(y<<14&4294967295|y>>>18),y=v+(C^g&(T^C))+I[0]+3921069994&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(T^C&(v^T))+I[5]+3593408605&4294967295,g=v+(y<<5&4294967295|y>>>27),y=C+(v^T&(g^v))+I[10]+38016083&4294967295,C=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(C^g))+I[15]+3634488961&4294967295,T=C+(y<<14&4294967295|y>>>18),y=v+(C^g&(T^C))+I[4]+3889429448&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(T^C&(v^T))+I[9]+568446438&4294967295,g=v+(y<<5&4294967295|y>>>27),y=C+(v^T&(g^v))+I[14]+3275163606&4294967295,C=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(C^g))+I[3]+4107603335&4294967295,T=C+(y<<14&4294967295|y>>>18),y=v+(C^g&(T^C))+I[8]+1163531501&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(T^C&(v^T))+I[13]+2850285829&4294967295,g=v+(y<<5&4294967295|y>>>27),y=C+(v^T&(g^v))+I[2]+4243563512&4294967295,C=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(C^g))+I[7]+1735328473&4294967295,T=C+(y<<14&4294967295|y>>>18),y=v+(C^g&(T^C))+I[12]+2368359562&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(v^T^C)+I[5]+4294588738&4294967295,g=v+(y<<4&4294967295|y>>>28),y=C+(g^v^T)+I[8]+2272392833&4294967295,C=g+(y<<11&4294967295|y>>>21),y=T+(C^g^v)+I[11]+1839030562&4294967295,T=C+(y<<16&4294967295|y>>>16),y=v+(T^C^g)+I[14]+4259657740&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(v^T^C)+I[1]+2763975236&4294967295,g=v+(y<<4&4294967295|y>>>28),y=C+(g^v^T)+I[4]+1272893353&4294967295,C=g+(y<<11&4294967295|y>>>21),y=T+(C^g^v)+I[7]+4139469664&4294967295,T=C+(y<<16&4294967295|y>>>16),y=v+(T^C^g)+I[10]+3200236656&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(v^T^C)+I[13]+681279174&4294967295,g=v+(y<<4&4294967295|y>>>28),y=C+(g^v^T)+I[0]+3936430074&4294967295,C=g+(y<<11&4294967295|y>>>21),y=T+(C^g^v)+I[3]+3572445317&4294967295,T=C+(y<<16&4294967295|y>>>16),y=v+(T^C^g)+I[6]+76029189&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(v^T^C)+I[9]+3654602809&4294967295,g=v+(y<<4&4294967295|y>>>28),y=C+(g^v^T)+I[12]+3873151461&4294967295,C=g+(y<<11&4294967295|y>>>21),y=T+(C^g^v)+I[15]+530742520&4294967295,T=C+(y<<16&4294967295|y>>>16),y=v+(T^C^g)+I[2]+3299628645&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(T^(v|~C))+I[0]+4096336452&4294967295,g=v+(y<<6&4294967295|y>>>26),y=C+(v^(g|~T))+I[7]+1126891415&4294967295,C=g+(y<<10&4294967295|y>>>22),y=T+(g^(C|~v))+I[14]+2878612391&4294967295,T=C+(y<<15&4294967295|y>>>17),y=v+(C^(T|~g))+I[5]+4237533241&4294967295,v=T+(y<<21&4294967295|y>>>11),y=g+(T^(v|~C))+I[12]+1700485571&4294967295,g=v+(y<<6&4294967295|y>>>26),y=C+(v^(g|~T))+I[3]+2399980690&4294967295,C=g+(y<<10&4294967295|y>>>22),y=T+(g^(C|~v))+I[10]+4293915773&4294967295,T=C+(y<<15&4294967295|y>>>17),y=v+(C^(T|~g))+I[1]+2240044497&4294967295,v=T+(y<<21&4294967295|y>>>11),y=g+(T^(v|~C))+I[8]+1873313359&4294967295,g=v+(y<<6&4294967295|y>>>26),y=C+(v^(g|~T))+I[15]+4264355552&4294967295,C=g+(y<<10&4294967295|y>>>22),y=T+(g^(C|~v))+I[6]+2734768916&4294967295,T=C+(y<<15&4294967295|y>>>17),y=v+(C^(T|~g))+I[13]+1309151649&4294967295,v=T+(y<<21&4294967295|y>>>11),y=g+(T^(v|~C))+I[4]+4149444226&4294967295,g=v+(y<<6&4294967295|y>>>26),y=C+(v^(g|~T))+I[11]+3174756917&4294967295,C=g+(y<<10&4294967295|y>>>22),y=T+(g^(C|~v))+I[2]+718787259&4294967295,T=C+(y<<15&4294967295|y>>>17),y=v+(C^(T|~g))+I[9]+3951481745&4294967295,w.g[0]=w.g[0]+g&4294967295,w.g[1]=w.g[1]+(T+(y<<21&4294967295|y>>>11))&4294967295,w.g[2]=w.g[2]+T&4294967295,w.g[3]=w.g[3]+C&4294967295}n.prototype.u=function(w,g){g===void 0&&(g=w.length);for(var v=g-this.blockSize,I=this.B,T=this.h,C=0;C<g;){if(T==0)for(;C<=v;)r(this,w,C),C+=this.blockSize;if(typeof w=="string"){for(;C<g;)if(I[T++]=w.charCodeAt(C++),T==this.blockSize){r(this,I),T=0;break}}else for(;C<g;)if(I[T++]=w[C++],T==this.blockSize){r(this,I),T=0;break}}this.h=T,this.o+=g},n.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var g=1;g<w.length-8;++g)w[g]=0;var v=8*this.o;for(g=w.length-8;g<w.length;++g)w[g]=v&255,v/=256;for(this.u(w),w=Array(16),g=v=0;4>g;++g)for(var I=0;32>I;I+=8)w[v++]=this.g[g]>>>I&255;return w};function s(w,g){var v=l;return Object.prototype.hasOwnProperty.call(v,w)?v[w]:v[w]=g(w)}function o(w,g){this.h=g;for(var v=[],I=!0,T=w.length-1;0<=T;T--){var C=w[T]|0;I&&C==g||(v[T]=C,I=!1)}this.g=v}var l={};function c(w){return-128<=w&&128>w?s(w,function(g){return new o([g|0],0>g?-1:0)}):new o([w|0],0>w?-1:0)}function h(w){if(isNaN(w)||!isFinite(w))return p;if(0>w)return R(h(-w));for(var g=[],v=1,I=0;w>=v;I++)g[I]=w/v|0,v*=4294967296;return new o(g,0)}function m(w,g){if(w.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(w.charAt(0)=="-")return R(m(w.substring(1),g));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=h(Math.pow(g,8)),I=p,T=0;T<w.length;T+=8){var C=Math.min(8,w.length-T),y=parseInt(w.substring(T,T+C),g);8>C?(C=h(Math.pow(g,C)),I=I.j(C).add(h(y))):(I=I.j(v),I=I.add(h(y)))}return I}var p=c(0),_=c(1),b=c(16777216);i=o.prototype,i.m=function(){if(O(this))return-R(this).m();for(var w=0,g=1,v=0;v<this.g.length;v++){var I=this.i(v);w+=(0<=I?I:4294967296+I)*g,g*=4294967296}return w},i.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(k(this))return"0";if(O(this))return"-"+R(this).toString(w);for(var g=h(Math.pow(w,6)),v=this,I="";;){var T=W(v,g).g;v=K(v,T.j(g));var C=((0<v.g.length?v.g[0]:v.h)>>>0).toString(w);if(v=T,k(v))return C+I;for(;6>C.length;)C="0"+C;I=C+I}},i.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function k(w){if(w.h!=0)return!1;for(var g=0;g<w.g.length;g++)if(w.g[g]!=0)return!1;return!0}function O(w){return w.h==-1}i.l=function(w){return w=K(this,w),O(w)?-1:k(w)?0:1};function R(w){for(var g=w.g.length,v=[],I=0;I<g;I++)v[I]=~w.g[I];return new o(v,~w.h).add(_)}i.abs=function(){return O(this)?R(this):this},i.add=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],I=0,T=0;T<=g;T++){var C=I+(this.i(T)&65535)+(w.i(T)&65535),y=(C>>>16)+(this.i(T)>>>16)+(w.i(T)>>>16);I=y>>>16,C&=65535,y&=65535,v[T]=y<<16|C}return new o(v,v[v.length-1]&-2147483648?-1:0)};function K(w,g){return w.add(R(g))}i.j=function(w){if(k(this)||k(w))return p;if(O(this))return O(w)?R(this).j(R(w)):R(R(this).j(w));if(O(w))return R(this.j(R(w)));if(0>this.l(b)&&0>w.l(b))return h(this.m()*w.m());for(var g=this.g.length+w.g.length,v=[],I=0;I<2*g;I++)v[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<w.g.length;T++){var C=this.i(I)>>>16,y=this.i(I)&65535,nn=w.i(T)>>>16,$r=w.i(T)&65535;v[2*I+2*T]+=y*$r,Q(v,2*I+2*T),v[2*I+2*T+1]+=C*$r,Q(v,2*I+2*T+1),v[2*I+2*T+1]+=y*nn,Q(v,2*I+2*T+1),v[2*I+2*T+2]+=C*nn,Q(v,2*I+2*T+2)}for(I=0;I<g;I++)v[I]=v[2*I+1]<<16|v[2*I];for(I=g;I<2*g;I++)v[I]=0;return new o(v,0)};function Q(w,g){for(;(w[g]&65535)!=w[g];)w[g+1]+=w[g]>>>16,w[g]&=65535,g++}function z(w,g){this.g=w,this.h=g}function W(w,g){if(k(g))throw Error("division by zero");if(k(w))return new z(p,p);if(O(w))return g=W(R(w),g),new z(R(g.g),R(g.h));if(O(g))return g=W(w,R(g)),new z(R(g.g),g.h);if(30<w.g.length){if(O(w)||O(g))throw Error("slowDivide_ only works with positive integers.");for(var v=_,I=g;0>=I.l(w);)v=Z(v),I=Z(I);var T=ee(v,1),C=ee(I,1);for(I=ee(I,2),v=ee(v,2);!k(I);){var y=C.add(I);0>=y.l(w)&&(T=T.add(v),C=y),I=ee(I,1),v=ee(v,1)}return g=K(w,T.j(g)),new z(T,g)}for(T=p;0<=w.l(g);){for(v=Math.max(1,Math.floor(w.m()/g.m())),I=Math.ceil(Math.log(v)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),C=h(v),y=C.j(g);O(y)||0<y.l(w);)v-=I,C=h(v),y=C.j(g);k(C)&&(C=_),T=T.add(C),w=K(w,y)}return new z(T,w)}i.A=function(w){return W(this,w).h},i.and=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],I=0;I<g;I++)v[I]=this.i(I)&w.i(I);return new o(v,this.h&w.h)},i.or=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],I=0;I<g;I++)v[I]=this.i(I)|w.i(I);return new o(v,this.h|w.h)},i.xor=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],I=0;I<g;I++)v[I]=this.i(I)^w.i(I);return new o(v,this.h^w.h)};function Z(w){for(var g=w.g.length+1,v=[],I=0;I<g;I++)v[I]=w.i(I)<<1|w.i(I-1)>>>31;return new o(v,w.h)}function ee(w,g){var v=g>>5;g%=32;for(var I=w.g.length-v,T=[],C=0;C<I;C++)T[C]=0<g?w.i(C+v)>>>g|w.i(C+v+1)<<32-g:w.i(C+v);return new o(T,w.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Nc=ip.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=m,On=ip.Integer=o}).apply(typeof np<"u"?np:typeof self<"u"?self:typeof window<"u"?window:{});var ma=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},hn={};var Fc,Av,rr,Lc,As,fa,zc,Bc,Uc;(function(){var i,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,u,d){return a==Array.prototype||a==Object.prototype||(a[u]=d.value),a};function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof ma=="object"&&ma];for(var u=0;u<a.length;++u){var d=a[u];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var n=t(this);function r(a,u){if(u)e:{var d=n;a=a.split(".");for(var f=0;f<a.length-1;f++){var E=a[f];if(!(E in d))break e;d=d[E]}a=a[a.length-1],f=d[a],u=u(f),u!=f&&u!=null&&e(d,a,{configurable:!0,writable:!0,value:u})}}function s(a,u){a instanceof String&&(a+="");var d=0,f=!1,E={next:function(){if(!f&&d<a.length){var S=d++;return{value:u(S,a[S]),done:!1}}return f=!0,{done:!0,value:void 0}}};return E[Symbol.iterator]=function(){return E},E}r("Array.prototype.values",function(a){return a||function(){return s(this,function(u,d){return d})}});var o=o||{},l=this||self;function c(a){var u=typeof a;return u=u!="object"?u:a?Array.isArray(a)?"array":u:"null",u=="array"||u=="object"&&typeof a.length=="number"}function h(a){var u=typeof a;return u=="object"&&a!=null||u=="function"}function m(a,u,d){return a.call.apply(a.bind,arguments)}function p(a,u,d){if(!a)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var E=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(E,f),a.apply(u,E)}}return function(){return a.apply(u,arguments)}}function _(a,u,d){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:p,_.apply(null,arguments)}function b(a,u){var d=Array.prototype.slice.call(arguments,1);return function(){var f=d.slice();return f.push.apply(f,arguments),a.apply(this,f)}}function k(a,u){function d(){}d.prototype=u.prototype,a.aa=u.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(f,E,S){for(var F=Array(arguments.length-2),pe=2;pe<arguments.length;pe++)F[pe-2]=arguments[pe];return u.prototype[E].apply(f,F)}}function O(a){let u=a.length;if(0<u){let d=Array(u);for(let f=0;f<u;f++)d[f]=a[f];return d}return[]}function R(a,u){for(let d=1;d<arguments.length;d++){let f=arguments[d];if(c(f)){let E=a.length||0,S=f.length||0;a.length=E+S;for(let F=0;F<S;F++)a[E+F]=f[F]}else a.push(f)}}class K{constructor(u,d){this.i=u,this.j=d,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function Q(a){return/^[\s\xa0]*$/.test(a)}function z(){var a=l.navigator;return a&&(a=a.userAgent)?a:""}function W(a){return W[" "](a),a}W[" "]=function(){};var Z=z().indexOf("Gecko")!=-1&&!(z().toLowerCase().indexOf("webkit")!=-1&&z().indexOf("Edge")==-1)&&!(z().indexOf("Trident")!=-1||z().indexOf("MSIE")!=-1)&&z().indexOf("Edge")==-1;function ee(a,u,d){for(let f in a)u.call(d,a[f],f,a)}function w(a,u){for(let d in a)u.call(void 0,a[d],d,a)}function g(a){let u={};for(let d in a)u[d]=a[d];return u}let v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(a,u){let d,f;for(let E=1;E<arguments.length;E++){f=arguments[E];for(d in f)a[d]=f[d];for(let S=0;S<v.length;S++)d=v[S],Object.prototype.hasOwnProperty.call(f,d)&&(a[d]=f[d])}}function T(a){var u=1;a=a.split(":");let d=[];for(;0<u&&a.length;)d.push(a.shift()),u--;return a.length&&d.push(a.join(":")),d}function C(a){l.setTimeout(()=>{throw a},0)}function y(){var a=Bl;let u=null;return a.g&&(u=a.g,a.g=a.g.next,a.g||(a.h=null),u.next=null),u}class nn{constructor(){this.h=this.g=null}add(u,d){let f=$r.get();f.set(u,d),this.h?this.h.next=f:this.g=f,this.h=f}}var $r=new K(()=>new ny,a=>a.reset());class ny{constructor(){this.next=this.g=this.h=null}set(u,d){this.h=u,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Kr,Hr=!1,Bl=new nn,Kd=()=>{let a=l.Promise.resolve(void 0);Kr=()=>{a.then(iy)}};var iy=()=>{for(var a;a=y();){try{a.h.call(a.g)}catch(d){C(d)}var u=$r;u.j(a),100>u.h&&(u.h++,a.next=u.g,u.g=a)}Hr=!1};function In(){this.s=this.s,this.C=this.C}In.prototype.s=!1,In.prototype.ma=function(){this.s||(this.s=!0,this.N())},In.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ye(a,u){this.type=a,this.g=this.target=u,this.defaultPrevented=!1}Ye.prototype.h=function(){this.defaultPrevented=!0};var ry=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,u=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};l.addEventListener("test",d,u),l.removeEventListener("test",d,u)}catch{}return a}();function Qr(a,u){if(Ye.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,f=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=u,u=a.relatedTarget){if(Z){e:{try{W(u.nodeName);var E=!0;break e}catch{}E=!1}E||(u=null)}}else d=="mouseover"?u=a.fromElement:d=="mouseout"&&(u=a.toElement);this.relatedTarget=u,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:sy[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Qr.aa.h.call(this)}}k(Qr,Ye);var sy={2:"touch",3:"pen",4:"mouse"};Qr.prototype.h=function(){Qr.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Wr="closure_listenable_"+(1e6*Math.random()|0),oy=0;function ay(a,u,d,f,E){this.listener=a,this.proxy=null,this.src=u,this.type=d,this.capture=!!f,this.ha=E,this.key=++oy,this.da=this.fa=!1}function Io(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function To(a){this.src=a,this.g={},this.h=0}To.prototype.add=function(a,u,d,f,E){var S=a.toString();a=this.g[S],a||(a=this.g[S]=[],this.h++);var F=ql(a,u,f,E);return-1<F?(u=a[F],d||(u.fa=!1)):(u=new ay(u,this.src,S,!!f,E),u.fa=d,a.push(u)),u};function Ul(a,u){var d=u.type;if(d in a.g){var f=a.g[d],E=Array.prototype.indexOf.call(f,u,void 0),S;(S=0<=E)&&Array.prototype.splice.call(f,E,1),S&&(Io(u),a.g[d].length==0&&(delete a.g[d],a.h--))}}function ql(a,u,d,f){for(var E=0;E<a.length;++E){var S=a[E];if(!S.da&&S.listener==u&&S.capture==!!d&&S.ha==f)return E}return-1}var jl="closure_lm_"+(1e6*Math.random()|0),Gl={};function Hd(a,u,d,f,E){if(f&&f.once)return Wd(a,u,d,f,E);if(Array.isArray(u)){for(var S=0;S<u.length;S++)Hd(a,u[S],d,f,E);return null}return d=Ql(d),a&&a[Wr]?a.K(u,d,h(f)?!!f.capture:!!f,E):Qd(a,u,d,!1,f,E)}function Qd(a,u,d,f,E,S){if(!u)throw Error("Invalid event type");var F=h(E)?!!E.capture:!!E,pe=Kl(a);if(pe||(a[jl]=pe=new To(a)),d=pe.add(u,d,f,F,S),d.proxy)return d;if(f=ly(),d.proxy=f,f.src=a,f.listener=d,a.addEventListener)ry||(E=F),E===void 0&&(E=!1),a.addEventListener(u.toString(),f,E);else if(a.attachEvent)a.attachEvent(Xd(u.toString()),f);else if(a.addListener&&a.removeListener)a.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return d}function ly(){function a(d){return u.call(a.src,a.listener,d)}let u=cy;return a}function Wd(a,u,d,f,E){if(Array.isArray(u)){for(var S=0;S<u.length;S++)Wd(a,u[S],d,f,E);return null}return d=Ql(d),a&&a[Wr]?a.L(u,d,h(f)?!!f.capture:!!f,E):Qd(a,u,d,!0,f,E)}function Yd(a,u,d,f,E){if(Array.isArray(u))for(var S=0;S<u.length;S++)Yd(a,u[S],d,f,E);else f=h(f)?!!f.capture:!!f,d=Ql(d),a&&a[Wr]?(a=a.i,u=String(u).toString(),u in a.g&&(S=a.g[u],d=ql(S,d,f,E),-1<d&&(Io(S[d]),Array.prototype.splice.call(S,d,1),S.length==0&&(delete a.g[u],a.h--)))):a&&(a=Kl(a))&&(u=a.g[u.toString()],a=-1,u&&(a=ql(u,d,f,E)),(d=-1<a?u[a]:null)&&$l(d))}function $l(a){if(typeof a!="number"&&a&&!a.da){var u=a.src;if(u&&u[Wr])Ul(u.i,a);else{var d=a.type,f=a.proxy;u.removeEventListener?u.removeEventListener(d,f,a.capture):u.detachEvent?u.detachEvent(Xd(d),f):u.addListener&&u.removeListener&&u.removeListener(f),(d=Kl(u))?(Ul(d,a),d.h==0&&(d.src=null,u[jl]=null)):Io(a)}}}function Xd(a){return a in Gl?Gl[a]:Gl[a]="on"+a}function cy(a,u){if(a.da)a=!0;else{u=new Qr(u,this);var d=a.listener,f=a.ha||a.src;a.fa&&$l(a),a=d.call(f,u)}return a}function Kl(a){return a=a[jl],a instanceof To?a:null}var Hl="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ql(a){return typeof a=="function"?a:(a[Hl]||(a[Hl]=function(u){return a.handleEvent(u)}),a[Hl])}function Xe(){In.call(this),this.i=new To(this),this.M=this,this.F=null}k(Xe,In),Xe.prototype[Wr]=!0,Xe.prototype.removeEventListener=function(a,u,d,f){Yd(this,a,u,d,f)};function nt(a,u){var d,f=a.F;if(f)for(d=[];f;f=f.F)d.push(f);if(a=a.M,f=u.type||u,typeof u=="string")u=new Ye(u,a);else if(u instanceof Ye)u.target=u.target||a;else{var E=u;u=new Ye(f,a),I(u,E)}if(E=!0,d)for(var S=d.length-1;0<=S;S--){var F=u.g=d[S];E=Eo(F,f,!0,u)&&E}if(F=u.g=a,E=Eo(F,f,!0,u)&&E,E=Eo(F,f,!1,u)&&E,d)for(S=0;S<d.length;S++)F=u.g=d[S],E=Eo(F,f,!1,u)&&E}Xe.prototype.N=function(){if(Xe.aa.N.call(this),this.i){var a=this.i,u;for(u in a.g){for(var d=a.g[u],f=0;f<d.length;f++)Io(d[f]);delete a.g[u],a.h--}}this.F=null},Xe.prototype.K=function(a,u,d,f){return this.i.add(String(a),u,!1,d,f)},Xe.prototype.L=function(a,u,d,f){return this.i.add(String(a),u,!0,d,f)};function Eo(a,u,d,f){if(u=a.i.g[String(u)],!u)return!0;u=u.concat();for(var E=!0,S=0;S<u.length;++S){var F=u[S];if(F&&!F.da&&F.capture==d){var pe=F.listener,$e=F.ha||F.src;F.fa&&Ul(a.i,F),E=pe.call($e,f)!==!1&&E}}return E&&!f.defaultPrevented}function Jd(a,u,d){if(typeof a=="function")d&&(a=_(a,d));else if(a&&typeof a.handleEvent=="function")a=_(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:l.setTimeout(a,u||0)}function Zd(a){a.g=Jd(()=>{a.g=null,a.i&&(a.i=!1,Zd(a))},a.l);let u=a.h;a.h=null,a.m.apply(null,u)}class uy extends In{constructor(u,d){super(),this.m=u,this.l=d,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:Zd(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Yr(a){In.call(this),this.h=a,this.g={}}k(Yr,In);var em=[];function tm(a){ee(a.g,function(u,d){this.g.hasOwnProperty(d)&&$l(u)},a),a.g={}}Yr.prototype.N=function(){Yr.aa.N.call(this),tm(this)},Yr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Wl=l.JSON.stringify,hy=l.JSON.parse,dy=class{stringify(a){return l.JSON.stringify(a,void 0)}parse(a){return l.JSON.parse(a,void 0)}};function Yl(){}Yl.prototype.h=null;function nm(a){return a.h||(a.h=a.i())}function im(){}var Xr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Xl(){Ye.call(this,"d")}k(Xl,Ye);function Jl(){Ye.call(this,"c")}k(Jl,Ye);var ei={},rm=null;function bo(){return rm=rm||new Xe}ei.La="serverreachability";function sm(a){Ye.call(this,ei.La,a)}k(sm,Ye);function Jr(a){let u=bo();nt(u,new sm(u))}ei.STAT_EVENT="statevent";function om(a,u){Ye.call(this,ei.STAT_EVENT,a),this.stat=u}k(om,Ye);function it(a){let u=bo();nt(u,new om(u,a))}ei.Ma="timingevent";function am(a,u){Ye.call(this,ei.Ma,a),this.size=u}k(am,Ye);function Zr(a,u){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){a()},u)}function es(){this.g=!0}es.prototype.xa=function(){this.g=!1};function my(a,u,d,f,E,S){a.info(function(){if(a.g)if(S)for(var F="",pe=S.split("&"),$e=0;$e<pe.length;$e++){var he=pe[$e].split("=");if(1<he.length){var Je=he[0];he=he[1];var Ze=Je.split("_");F=2<=Ze.length&&Ze[1]=="type"?F+(Je+"="+he+"&"):F+(Je+"=redacted&")}}else F=null;else F=S;return"XMLHTTP REQ ("+f+") [attempt "+E+"]: "+u+`
`+d+`
`+F})}function fy(a,u,d,f,E,S,F){a.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+E+"]: "+u+`
`+d+`
`+S+" "+F})}function Bi(a,u,d,f){a.info(function(){return"XMLHTTP TEXT ("+u+"): "+gy(a,d)+(f?" "+f:"")})}function py(a,u){a.info(function(){return"TIMEOUT: "+u})}es.prototype.info=function(){};function gy(a,u){if(!a.g)return u;if(!u)return null;try{var d=JSON.parse(u);if(d){for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var f=d[a];if(!(2>f.length)){var E=f[1];if(Array.isArray(E)&&!(1>E.length)){var S=E[0];if(S!="noop"&&S!="stop"&&S!="close")for(var F=1;F<E.length;F++)E[F]=""}}}}return Wl(d)}catch{return u}}var Co={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},lm={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Zl;function Ao(){}k(Ao,Yl),Ao.prototype.g=function(){return new XMLHttpRequest},Ao.prototype.i=function(){return{}},Zl=new Ao;function Tn(a,u,d,f){this.j=a,this.i=u,this.l=d,this.R=f||1,this.U=new Yr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new cm}function cm(){this.i=null,this.g="",this.h=!1}var um={},ec={};function tc(a,u,d){a.L=1,a.v=Ro(rn(u)),a.m=d,a.P=!0,hm(a,null)}function hm(a,u){a.F=Date.now(),So(a),a.A=rn(a.v);var d=a.A,f=a.R;Array.isArray(f)||(f=[String(f)]),Cm(d.i,"t",f),a.C=0,d=a.j.J,a.h=new cm,a.g=jm(a.j,d?u:null,!a.m),0<a.O&&(a.M=new uy(_(a.Y,a,a.g),a.O)),u=a.U,d=a.g,f=a.ca;var E="readystatechange";Array.isArray(E)||(E&&(em[0]=E.toString()),E=em);for(var S=0;S<E.length;S++){var F=Hd(d,E[S],f||u.handleEvent,!1,u.h||u);if(!F)break;u.g[F.key]=F}u=a.H?g(a.H):{},a.m?(a.u||(a.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,u)):(a.u="GET",a.g.ea(a.A,a.u,null,u)),Jr(),my(a.i,a.u,a.A,a.l,a.R,a.m)}Tn.prototype.ca=function(a){a=a.target;let u=this.M;u&&sn(a)==3?u.j():this.Y(a)},Tn.prototype.Y=function(a){try{if(a==this.g)e:{let Ze=sn(this.g);var u=this.g.Ba();let ji=this.g.Z();if(!(3>Ze)&&(Ze!=3||this.g&&(this.h.h||this.g.oa()||km(this.g)))){this.J||Ze!=4||u==7||(u==8||0>=ji?Jr(3):Jr(2)),nc(this);var d=this.g.Z();this.X=d;t:if(dm(this)){var f=km(this.g);a="";var E=f.length,S=sn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ti(this),ts(this);var F="";break t}this.h.i=new l.TextDecoder}for(u=0;u<E;u++)this.h.h=!0,a+=this.h.i.decode(f[u],{stream:!(S&&u==E-1)});f.length=0,this.h.g+=a,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=d==200,fy(this.i,this.u,this.A,this.l,this.R,Ze,d),this.o){if(this.T&&!this.K){t:{if(this.g){var pe,$e=this.g;if((pe=$e.g?$e.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Q(pe)){var he=pe;break t}}he=null}if(d=he)Bi(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ic(this,d);else{this.o=!1,this.s=3,it(12),ti(this),ts(this);break e}}if(this.P){d=!0;let kt;for(;!this.J&&this.C<F.length;)if(kt=_y(this,F),kt==ec){Ze==4&&(this.s=4,it(14),d=!1),Bi(this.i,this.l,null,"[Incomplete Response]");break}else if(kt==um){this.s=4,it(15),Bi(this.i,this.l,F,"[Invalid Chunk]"),d=!1;break}else Bi(this.i,this.l,kt,null),ic(this,kt);if(dm(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ze!=4||F.length!=0||this.h.h||(this.s=1,it(16),d=!1),this.o=this.o&&d,!d)Bi(this.i,this.l,F,"[Invalid Chunked Response]"),ti(this),ts(this);else if(0<F.length&&!this.W){this.W=!0;var Je=this.j;Je.g==this&&Je.ba&&!Je.M&&(Je.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),cc(Je),Je.M=!0,it(11))}}else Bi(this.i,this.l,F,null),ic(this,F);Ze==4&&ti(this),this.o&&!this.J&&(Ze==4?zm(this.j,this):(this.o=!1,So(this)))}else Oy(this.g),d==400&&0<F.indexOf("Unknown SID")?(this.s=3,it(12)):(this.s=0,it(13)),ti(this),ts(this)}}}catch{}finally{}};function dm(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function _y(a,u){var d=a.C,f=u.indexOf(`
`,d);return f==-1?ec:(d=Number(u.substring(d,f)),isNaN(d)?um:(f+=1,f+d>u.length?ec:(u=u.slice(f,f+d),a.C=f+d,u)))}Tn.prototype.cancel=function(){this.J=!0,ti(this)};function So(a){a.S=Date.now()+a.I,mm(a,a.I)}function mm(a,u){if(a.B!=null)throw Error("WatchDog timer not null");a.B=Zr(_(a.ba,a),u)}function nc(a){a.B&&(l.clearTimeout(a.B),a.B=null)}Tn.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(py(this.i,this.A),this.L!=2&&(Jr(),it(17)),ti(this),this.s=2,ts(this)):mm(this,this.S-a)};function ts(a){a.j.G==0||a.J||zm(a.j,a)}function ti(a){nc(a);var u=a.M;u&&typeof u.ma=="function"&&u.ma(),a.M=null,tm(a.U),a.g&&(u=a.g,a.g=null,u.abort(),u.ma())}function ic(a,u){try{var d=a.j;if(d.G!=0&&(d.g==a||rc(d.h,a))){if(!a.K&&rc(d.h,a)&&d.G==3){try{var f=d.Da.g.parse(u)}catch{f=null}if(Array.isArray(f)&&f.length==3){var E=f;if(E[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<a.F)Mo(d),Vo(d);else break e;lc(d),it(18)}}else d.za=E[1],0<d.za-d.T&&37500>E[2]&&d.F&&d.v==0&&!d.C&&(d.C=Zr(_(d.Za,d),6e3));if(1>=gm(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else ii(d,11)}else if((a.K||d.g==a)&&Mo(d),!Q(u))for(E=d.Da.g.parse(u),u=0;u<E.length;u++){let he=E[u];if(d.T=he[0],he=he[1],d.G==2)if(he[0]=="c"){d.K=he[1],d.ia=he[2];let Je=he[3];Je!=null&&(d.la=Je,d.j.info("VER="+d.la));let Ze=he[4];Ze!=null&&(d.Aa=Ze,d.j.info("SVER="+d.Aa));let ji=he[5];ji!=null&&typeof ji=="number"&&0<ji&&(f=1.5*ji,d.L=f,d.j.info("backChannelRequestTimeoutMs_="+f)),f=d;let kt=a.g;if(kt){let Fo=kt.g?kt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Fo){var S=f.h;S.g||Fo.indexOf("spdy")==-1&&Fo.indexOf("quic")==-1&&Fo.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(sc(S,S.h),S.h=null))}if(f.D){let uc=kt.g?kt.g.getResponseHeader("X-HTTP-Session-Id"):null;uc&&(f.ya=uc,we(f.I,f.D,uc))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms")),f=d;var F=a;if(f.qa=qm(f,f.J?f.ia:null,f.W),F.K){_m(f.h,F);var pe=F,$e=f.L;$e&&(pe.I=$e),pe.B&&(nc(pe),So(pe)),f.g=F}else Fm(f);0<d.i.length&&Oo(d)}else he[0]!="stop"&&he[0]!="close"||ii(d,7);else d.G==3&&(he[0]=="stop"||he[0]=="close"?he[0]=="stop"?ii(d,7):ac(d):he[0]!="noop"&&d.l&&d.l.ta(he),d.v=0)}}Jr(4)}catch{}}var yy=class{constructor(a,u){this.g=a,this.map=u}};function fm(a){this.l=a||10,l.PerformanceNavigationTiming?(a=l.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function pm(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function gm(a){return a.h?1:a.g?a.g.size:0}function rc(a,u){return a.h?a.h==u:a.g?a.g.has(u):!1}function sc(a,u){a.g?a.g.add(u):a.h=u}function _m(a,u){a.h&&a.h==u?a.h=null:a.g&&a.g.has(u)&&a.g.delete(u)}fm.prototype.cancel=function(){if(this.i=ym(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function ym(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let u=a.i;for(let d of a.g.values())u=u.concat(d.D);return u}return O(a.i)}function vy(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(c(a)){for(var u=[],d=a.length,f=0;f<d;f++)u.push(a[f]);return u}u=[],d=0;for(f in a)u[d++]=a[f];return u}function wy(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(c(a)||typeof a=="string"){var u=[];a=a.length;for(var d=0;d<a;d++)u.push(d);return u}u=[],d=0;for(let f in a)u[d++]=f;return u}}}function vm(a,u){if(a.forEach&&typeof a.forEach=="function")a.forEach(u,void 0);else if(c(a)||typeof a=="string")Array.prototype.forEach.call(a,u,void 0);else for(var d=wy(a),f=vy(a),E=f.length,S=0;S<E;S++)u.call(void 0,f[S],d&&d[S],a)}var wm=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Iy(a,u){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var f=a[d].indexOf("="),E=null;if(0<=f){var S=a[d].substring(0,f);E=a[d].substring(f+1)}else S=a[d];u(S,E?decodeURIComponent(E.replace(/\+/g," ")):"")}}}function ni(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof ni){this.h=a.h,xo(this,a.j),this.o=a.o,this.g=a.g,Po(this,a.s),this.l=a.l;var u=a.i,d=new rs;d.i=u.i,u.g&&(d.g=new Map(u.g),d.h=u.h),Im(this,d),this.m=a.m}else a&&(u=String(a).match(wm))?(this.h=!1,xo(this,u[1]||"",!0),this.o=ns(u[2]||""),this.g=ns(u[3]||"",!0),Po(this,u[4]),this.l=ns(u[5]||"",!0),Im(this,u[6]||"",!0),this.m=ns(u[7]||"")):(this.h=!1,this.i=new rs(null,this.h))}ni.prototype.toString=function(){var a=[],u=this.j;u&&a.push(is(u,Tm,!0),":");var d=this.g;return(d||u=="file")&&(a.push("//"),(u=this.o)&&a.push(is(u,Tm,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&a.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(is(d,d.charAt(0)=="/"?by:Ey,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",is(d,Ay)),a.join("")};function rn(a){return new ni(a)}function xo(a,u,d){a.j=d?ns(u,!0):u,a.j&&(a.j=a.j.replace(/:$/,""))}function Po(a,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);a.s=u}else a.s=null}function Im(a,u,d){u instanceof rs?(a.i=u,Sy(a.i,a.h)):(d||(u=is(u,Cy)),a.i=new rs(u,a.h))}function we(a,u,d){a.i.set(u,d)}function Ro(a){return we(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function ns(a,u){return a?u?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function is(a,u,d){return typeof a=="string"?(a=encodeURI(a).replace(u,Ty),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Ty(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Tm=/[#\/\?@]/g,Ey=/[#\?:]/g,by=/[#\?]/g,Cy=/[#\?@]/g,Ay=/#/g;function rs(a,u){this.h=this.g=null,this.i=a||null,this.j=!!u}function En(a){a.g||(a.g=new Map,a.h=0,a.i&&Iy(a.i,function(u,d){a.add(decodeURIComponent(u.replace(/\+/g," ")),d)}))}i=rs.prototype,i.add=function(a,u){En(this),this.i=null,a=Ui(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(u),this.h+=1,this};function Em(a,u){En(a),u=Ui(a,u),a.g.has(u)&&(a.i=null,a.h-=a.g.get(u).length,a.g.delete(u))}function bm(a,u){return En(a),u=Ui(a,u),a.g.has(u)}i.forEach=function(a,u){En(this),this.g.forEach(function(d,f){d.forEach(function(E){a.call(u,E,f,this)},this)},this)},i.na=function(){En(this);let a=Array.from(this.g.values()),u=Array.from(this.g.keys()),d=[];for(let f=0;f<u.length;f++){let E=a[f];for(let S=0;S<E.length;S++)d.push(u[f])}return d},i.V=function(a){En(this);let u=[];if(typeof a=="string")bm(this,a)&&(u=u.concat(this.g.get(Ui(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)u=u.concat(a[d])}return u},i.set=function(a,u){return En(this),this.i=null,a=Ui(this,a),bm(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[u]),this.h+=1,this},i.get=function(a,u){return a?(a=this.V(a),0<a.length?String(a[0]):u):u};function Cm(a,u,d){Em(a,u),0<d.length&&(a.i=null,a.g.set(Ui(a,u),O(d)),a.h+=d.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],u=Array.from(this.g.keys());for(var d=0;d<u.length;d++){var f=u[d];let S=encodeURIComponent(String(f)),F=this.V(f);for(f=0;f<F.length;f++){var E=S;F[f]!==""&&(E+="="+encodeURIComponent(String(F[f]))),a.push(E)}}return this.i=a.join("&")};function Ui(a,u){return u=String(u),a.j&&(u=u.toLowerCase()),u}function Sy(a,u){u&&!a.j&&(En(a),a.i=null,a.g.forEach(function(d,f){var E=f.toLowerCase();f!=E&&(Em(this,f),Cm(this,E,d))},a)),a.j=u}function xy(a,u){let d=new es;if(l.Image){let f=new Image;f.onload=b(bn,d,"TestLoadImage: loaded",!0,u,f),f.onerror=b(bn,d,"TestLoadImage: error",!1,u,f),f.onabort=b(bn,d,"TestLoadImage: abort",!1,u,f),f.ontimeout=b(bn,d,"TestLoadImage: timeout",!1,u,f),l.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=a}else u(!1)}function Py(a,u){let d=new es,f=new AbortController,E=setTimeout(()=>{f.abort(),bn(d,"TestPingServer: timeout",!1,u)},1e4);fetch(a,{signal:f.signal}).then(S=>{clearTimeout(E),S.ok?bn(d,"TestPingServer: ok",!0,u):bn(d,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(E),bn(d,"TestPingServer: error",!1,u)})}function bn(a,u,d,f,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),f(d)}catch{}}function Ry(){this.g=new dy}function Dy(a,u,d){let f=d||"";try{vm(a,function(E,S){let F=E;h(E)&&(F=Wl(E)),u.push(f+S+"="+encodeURIComponent(F))})}catch(E){throw u.push(f+"type="+encodeURIComponent("_badmap")),E}}function ss(a){this.l=a.Ub||null,this.j=a.eb||!1}k(ss,Yl),ss.prototype.g=function(){return new Do(this.l,this.j)},ss.prototype.i=function(a){return function(){return a}}({});function Do(a,u){Xe.call(this),this.D=a,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(Do,Xe),i=Do.prototype,i.open=function(a,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=u,this.readyState=1,as(this)},i.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(u.body=a),(this.D||l).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,os(this)),this.readyState=0},i.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,as(this)),this.g&&(this.readyState=3,as(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Am(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function Am(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}i.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var u=a.value?a.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!a.done}))&&(this.response=this.responseText+=u)}a.done?os(this):as(this),this.readyState==3&&Am(this)}},i.Ra=function(a){this.g&&(this.response=this.responseText=a,os(this))},i.Qa=function(a){this.g&&(this.response=a,os(this))},i.ga=function(){this.g&&os(this)};function os(a){a.readyState=4,a.l=null,a.j=null,a.v=null,as(a)}i.setRequestHeader=function(a,u){this.u.append(a,u)},i.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],u=this.h.entries();for(var d=u.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=u.next();return a.join(`\r
`)};function as(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Do.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function Sm(a){let u="";return ee(a,function(d,f){u+=f,u+=":",u+=d,u+=`\r
`}),u}function oc(a,u,d){e:{for(f in d){var f=!1;break e}f=!0}f||(d=Sm(d),typeof a=="string"?d!=null&&encodeURIComponent(String(d)):we(a,u,d))}function Se(a){Xe.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(Se,Xe);var ky=/^https?$/i,Vy=["POST","PUT"];i=Se.prototype,i.Ha=function(a){this.J=a},i.ea=function(a,u,d,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);u=u?u.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Zl.g(),this.v=this.o?nm(this.o):nm(Zl),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(u,String(a),!0),this.B=!1}catch(S){xm(this,S);return}if(a=d||"",d=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var E in f)d.set(E,f[E]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let S of f.keys())d.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(d.keys()).find(S=>S.toLowerCase()=="content-type"),E=l.FormData&&a instanceof l.FormData,!(0<=Array.prototype.indexOf.call(Vy,u,void 0))||f||E||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,F]of d)this.g.setRequestHeader(S,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Dm(this),this.u=!0,this.g.send(a),this.u=!1}catch(S){xm(this,S)}};function xm(a,u){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=u,a.m=5,Pm(a),ko(a)}function Pm(a){a.A||(a.A=!0,nt(a,"complete"),nt(a,"error"))}i.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,nt(this,"complete"),nt(this,"abort"),ko(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ko(this,!0)),Se.aa.N.call(this)},i.Ea=function(){this.s||(this.B||this.u||this.j?Rm(this):this.bb())},i.bb=function(){Rm(this)};function Rm(a){if(a.h&&typeof o<"u"&&(!a.v[1]||sn(a)!=4||a.Z()!=2)){if(a.u&&sn(a)==4)Jd(a.Ea,0,a);else if(nt(a,"readystatechange"),sn(a)==4){a.h=!1;try{let F=a.Z();e:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var d;if(!(d=u)){var f;if(f=F===0){var E=String(a.D).match(wm)[1]||null;!E&&l.self&&l.self.location&&(E=l.self.location.protocol.slice(0,-1)),f=!ky.test(E?E.toLowerCase():"")}d=f}if(d)nt(a,"complete"),nt(a,"success");else{a.m=6;try{var S=2<sn(a)?a.g.statusText:""}catch{S=""}a.l=S+" ["+a.Z()+"]",Pm(a)}}finally{ko(a)}}}}function ko(a,u){if(a.g){Dm(a);let d=a.g,f=a.v[0]?()=>{}:null;a.g=null,a.v=null,u||nt(a,"ready");try{d.onreadystatechange=f}catch{}}}function Dm(a){a.I&&(l.clearTimeout(a.I),a.I=null)}i.isActive=function(){return!!this.g};function sn(a){return a.g?a.g.readyState:0}i.Z=function(){try{return 2<sn(this)?this.g.status:-1}catch{return-1}},i.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.Oa=function(a){if(this.g){var u=this.g.responseText;return a&&u.indexOf(a)==0&&(u=u.substring(a.length)),hy(u)}};function km(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function Oy(a){let u={};a=(a.g&&2<=sn(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<a.length;f++){if(Q(a[f]))continue;var d=T(a[f]);let E=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let S=u[E]||[];u[E]=S,S.push(d)}w(u,function(f){return f.join(", ")})}i.Ba=function(){return this.m},i.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ls(a,u,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||u}function Vm(a){this.Aa=0,this.i=[],this.j=new es,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ls("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ls("baseRetryDelayMs",5e3,a),this.cb=ls("retryDelaySeedMs",1e4,a),this.Wa=ls("forwardChannelMaxRetries",2,a),this.wa=ls("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new fm(a&&a.concurrentRequestLimit),this.Da=new Ry,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}i=Vm.prototype,i.la=8,i.G=1,i.connect=function(a,u,d,f){it(0),this.W=a,this.H=u||{},d&&f!==void 0&&(this.H.OSID=d,this.H.OAID=f),this.F=this.X,this.I=qm(this,null,this.W),Oo(this)};function ac(a){if(Om(a),a.G==3){var u=a.U++,d=rn(a.I);if(we(d,"SID",a.K),we(d,"RID",u),we(d,"TYPE","terminate"),cs(a,d),u=new Tn(a,a.j,u),u.L=2,u.v=Ro(rn(d)),d=!1,l.navigator&&l.navigator.sendBeacon)try{d=l.navigator.sendBeacon(u.v.toString(),"")}catch{}!d&&l.Image&&(new Image().src=u.v,d=!0),d||(u.g=jm(u.j,null),u.g.ea(u.v)),u.F=Date.now(),So(u)}Um(a)}function Vo(a){a.g&&(cc(a),a.g.cancel(),a.g=null)}function Om(a){Vo(a),a.u&&(l.clearTimeout(a.u),a.u=null),Mo(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&l.clearTimeout(a.s),a.s=null)}function Oo(a){if(!pm(a.h)&&!a.s){a.s=!0;var u=a.Ga;Kr||Kd(),Hr||(Kr(),Hr=!0),Bl.add(u,a),a.B=0}}function My(a,u){return gm(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=u.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=Zr(_(a.Ga,a,u),Bm(a,a.B)),a.B++,!0)}i.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let E=new Tn(this,this.j,a),S=this.o;if(this.S&&(S?(S=g(S),I(S,this.S)):S=this.S),this.m!==null||this.O||(E.H=S,S=null),this.P)e:{for(var u=0,d=0;d<this.i.length;d++){t:{var f=this.i[d];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(u+=f,4096<u){u=d;break e}if(u===4096||d===this.i.length-1){u=d+1;break e}}u=1e3}else u=1e3;u=Nm(this,E,u),d=rn(this.I),we(d,"RID",a),we(d,"CVER",22),this.D&&we(d,"X-HTTP-Session-Id",this.D),cs(this,d),S&&(this.O?u="headers="+encodeURIComponent(String(Sm(S)))+"&"+u:this.m&&oc(d,this.m,S)),sc(this.h,E),this.Ua&&we(d,"TYPE","init"),this.P?(we(d,"$req",u),we(d,"SID","null"),E.T=!0,tc(E,d,null)):tc(E,d,u),this.G=2}}else this.G==3&&(a?Mm(this,a):this.i.length==0||pm(this.h)||Mm(this))};function Mm(a,u){var d;u?d=u.l:d=a.U++;let f=rn(a.I);we(f,"SID",a.K),we(f,"RID",d),we(f,"AID",a.T),cs(a,f),a.m&&a.o&&oc(f,a.m,a.o),d=new Tn(a,a.j,d,a.B+1),a.m===null&&(d.H=a.o),u&&(a.i=u.D.concat(a.i)),u=Nm(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),sc(a.h,d),tc(d,f,u)}function cs(a,u){a.H&&ee(a.H,function(d,f){we(u,f,d)}),a.l&&vm({},function(d,f){we(u,f,d)})}function Nm(a,u,d){d=Math.min(a.i.length,d);var f=a.l?_(a.l.Na,a.l,a):null;e:{var E=a.i;let S=-1;for(;;){let F=["count="+d];S==-1?0<d?(S=E[0].g,F.push("ofs="+S)):S=0:F.push("ofs="+S);let pe=!0;for(let $e=0;$e<d;$e++){let he=E[$e].g,Je=E[$e].map;if(he-=S,0>he)S=Math.max(0,E[$e].g-100),pe=!1;else try{Dy(Je,F,"req"+he+"_")}catch{f&&f(Je)}}if(pe){f=F.join("&");break e}}}return a=a.i.splice(0,d),u.D=a,f}function Fm(a){if(!a.g&&!a.u){a.Y=1;var u=a.Fa;Kr||Kd(),Hr||(Kr(),Hr=!0),Bl.add(u,a),a.v=0}}function lc(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=Zr(_(a.Fa,a),Bm(a,a.v)),a.v++,!0)}i.Fa=function(){if(this.u=null,Lm(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Zr(_(this.ab,this),a)}},i.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,it(10),Vo(this),Lm(this))};function cc(a){a.A!=null&&(l.clearTimeout(a.A),a.A=null)}function Lm(a){a.g=new Tn(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var u=rn(a.qa);we(u,"RID","rpc"),we(u,"SID",a.K),we(u,"AID",a.T),we(u,"CI",a.F?"0":"1"),!a.F&&a.ja&&we(u,"TO",a.ja),we(u,"TYPE","xmlhttp"),cs(a,u),a.m&&a.o&&oc(u,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=Ro(rn(u)),d.m=null,d.P=!0,hm(d,a)}i.Za=function(){this.C!=null&&(this.C=null,Vo(this),lc(this),it(19))};function Mo(a){a.C!=null&&(l.clearTimeout(a.C),a.C=null)}function zm(a,u){var d=null;if(a.g==u){Mo(a),cc(a),a.g=null;var f=2}else if(rc(a.h,u))d=u.D,_m(a.h,u),f=1;else return;if(a.G!=0){if(u.o)if(f==1){d=u.m?u.m.length:0,u=Date.now()-u.F;var E=a.B;f=bo(),nt(f,new am(f,d)),Oo(a)}else Fm(a);else if(E=u.s,E==3||E==0&&0<u.X||!(f==1&&My(a,u)||f==2&&lc(a)))switch(d&&0<d.length&&(u=a.h,u.i=u.i.concat(d)),E){case 1:ii(a,5);break;case 4:ii(a,10);break;case 3:ii(a,6);break;default:ii(a,2)}}}function Bm(a,u){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*u}function ii(a,u){if(a.j.info("Error code "+u),u==2){var d=_(a.fb,a),f=a.Xa;let E=!f;f=new ni(f||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||xo(f,"https"),Ro(f),E?xy(f.toString(),d):Py(f.toString(),d)}else it(2);a.G=0,a.l&&a.l.sa(u),Um(a),Om(a)}i.fb=function(a){a?(this.j.info("Successfully pinged google.com"),it(2)):(this.j.info("Failed to ping google.com"),it(1))};function Um(a){if(a.G=0,a.ka=[],a.l){let u=ym(a.h);(u.length!=0||a.i.length!=0)&&(R(a.ka,u),R(a.ka,a.i),a.h.i.length=0,O(a.i),a.i.length=0),a.l.ra()}}function qm(a,u,d){var f=d instanceof ni?rn(d):new ni(d);if(f.g!="")u&&(f.g=u+"."+f.g),Po(f,f.s);else{var E=l.location;f=E.protocol,u=u?u+"."+E.hostname:E.hostname,E=+E.port;var S=new ni(null);f&&xo(S,f),u&&(S.g=u),E&&Po(S,E),d&&(S.l=d),f=S}return d=a.D,u=a.ya,d&&u&&we(f,d,u),we(f,"VER",a.la),cs(a,f),f}function jm(a,u,d){if(u&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=a.Ca&&!a.pa?new Se(new ss({eb:d})):new Se(a.pa),u.Ha(a.J),u}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function Gm(){}i=Gm.prototype,i.ua=function(){},i.ta=function(){},i.sa=function(){},i.ra=function(){},i.isActive=function(){return!0},i.Na=function(){};function No(){}No.prototype.g=function(a,u){return new _t(a,u)};function _t(a,u){Xe.call(this),this.g=new Vm(u),this.l=a,this.h=u&&u.messageUrlParams||null,a=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(a?a["X-WebChannel-Content-Type"]=u.messageContentType:a={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(a?a["X-WebChannel-Client-Profile"]=u.va:a={"X-WebChannel-Client-Profile":u.va}),this.g.S=a,(a=u&&u.Sb)&&!Q(a)&&(this.g.m=a),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!Q(u)&&(this.g.D=u,a=this.h,a!==null&&u in a&&(a=this.h,u in a&&delete a[u])),this.j=new qi(this)}k(_t,Xe),_t.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},_t.prototype.close=function(){ac(this.g)},_t.prototype.o=function(a){var u=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.u&&(d={},d.__data__=Wl(a),a=d);u.i.push(new yy(u.Ya++,a)),u.G==3&&Oo(u)},_t.prototype.N=function(){this.g.l=null,delete this.j,ac(this.g),delete this.g,_t.aa.N.call(this)};function $m(a){Xl.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var u=a.__sm__;if(u){e:{for(let d in u){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,u=u!==null&&a in u?u[a]:void 0),this.data=u}else this.data=a}k($m,Xl);function Km(){Jl.call(this),this.status=1}k(Km,Jl);function qi(a){this.g=a}k(qi,Gm),qi.prototype.ua=function(){nt(this.g,"a")},qi.prototype.ta=function(a){nt(this.g,new $m(a))},qi.prototype.sa=function(a){nt(this.g,new Km)},qi.prototype.ra=function(){nt(this.g,"b")},No.prototype.createWebChannel=No.prototype.g,_t.prototype.send=_t.prototype.o,_t.prototype.open=_t.prototype.m,_t.prototype.close=_t.prototype.close,Uc=hn.createWebChannelTransport=function(){return new No},Bc=hn.getStatEventTarget=function(){return bo()},zc=hn.Event=ei,fa=hn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Co.NO_ERROR=0,Co.TIMEOUT=8,Co.HTTP_ERROR=6,As=hn.ErrorCode=Co,lm.COMPLETE="complete",Lc=hn.EventType=lm,im.EventType=Xr,Xr.OPEN="a",Xr.CLOSE="b",Xr.ERROR="c",Xr.MESSAGE="d",Xe.prototype.listen=Xe.prototype.K,rr=hn.WebChannel=im,Av=hn.FetchXmlHttpFactory=ss,Se.prototype.listenOnce=Se.prototype.L,Se.prototype.getLastError=Se.prototype.Ka,Se.prototype.getLastErrorCode=Se.prototype.Ba,Se.prototype.getStatus=Se.prototype.Z,Se.prototype.getResponseJson=Se.prototype.Oa,Se.prototype.getResponseText=Se.prototype.oa,Se.prototype.send=Se.prototype.ea,Se.prototype.setWithCredentials=Se.prototype.Ha,Fc=hn.XhrIo=Se}).apply(typeof ma<"u"?ma:typeof self<"u"?self:typeof window<"u"?window:{});var rp="@firebase/firestore";var Le=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Le.UNAUTHENTICATED=new Le(null),Le.GOOGLE_CREDENTIALS=new Le("google-credentials-uid"),Le.FIRST_PARTY=new Le("first-party-uid"),Le.MOCK_USER=new Le("mock-user");var Mr="10.14.0";var Un=new ta("@firebase/firestore");function cr(){return Un.logLevel}function ag(i){Un.setLogLevel(i)}function V(i,...e){if(Un.logLevel<=$t.DEBUG){let t=e.map(Kh);Un.debug(`Firestore (${Mr}): ${i}`,...t)}}function ke(i,...e){if(Un.logLevel<=$t.ERROR){let t=e.map(Kh);Un.error(`Firestore (${Mr}): ${i}`,...t)}}function Ft(i,...e){if(Un.logLevel<=$t.WARN){let t=e.map(Kh);Un.warn(`Firestore (${Mr}): ${i}`,...t)}}function Kh(i){if(typeof i=="string")return i;try{return function(t){return JSON.stringify(t)}(i)}catch{return i}}function j(i="Unexpected state"){let e=`FIRESTORE (${Mr}) INTERNAL ASSERTION FAILED: `+i;throw ke(e),new Error(e)}function G(i,e){i||j()}function lg(i,e){i||j()}function B(i,e){return i}var x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},D=class extends Df{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var je=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var ba=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Hc=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Le.UNAUTHENTICATED))}shutdown(){}},Qc=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Wc=class{constructor(e){this.t=e,this.currentUser=Le.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){G(this.o===void 0);let n=this.i,r=c=>this.i!==n?(n=this.i,t(c)):Promise.resolve(),s=new je;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new je,e.enqueueRetryable(()=>r(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(()=>P(this,null,function*(){yield c.promise,yield r(this.currentUser)}))},l=c=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?l(c):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new je)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(G(typeof n.accessToken=="string"),new ba(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return G(e===null||typeof e=="string"),new Le(e)}},Yc=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Le.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Xc=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Yc(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Le.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Jc=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Zc=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){G(this.o===void 0);let n=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,V("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};let r=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?r(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(G(typeof t.token=="string"),this.R=t.token,new Jc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Sv(i){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<i;n++)t[n]=Math.floor(256*Math.random());return t}var Ca=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let r=Sv(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<t&&(n+=e.charAt(r[s]%e.length))}return n}};function J(i,e){return i<e?-1:i>e?1:0}function yr(i,e,t){return i.length===e.length&&i.every((n,r)=>t(n,e[r]))}function cg(i){return i+"\0"}var Ce=class i{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new D(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return i.fromMillis(Date.now())}static fromDate(e){return i.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new i(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var $=class i{constructor(e){this.timestamp=e}static fromTimestamp(e){return new i(e)}static min(){return new i(new Ce(0,0))}static max(){return new i(new Ce(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Aa=class i{constructor(e,t,n){t===void 0?t=0:t>e.length&&j(),n===void 0?n=e.length-t:n>e.length-t&&j(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return i.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof i?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let s=e.get(r),o=t.get(r);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ae=class i extends Aa{construct(e,t,n){return new i(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new D(x.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(r=>r.length>0))}return new i(t)}static emptyPath(){return new i([])}},xv=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ve=class i extends Aa{construct(e,t,n){return new i(e,t,n)}static isValidIdentifier(e){return xv.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),i.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new i(["__name__"])}static fromServerFormat(e){let t=[],n="",r=0,s=()=>{if(n.length===0)throw new D(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},o=!1;for(;r<e.length;){let l=e[r];if(l==="\\"){if(r+1===e.length)throw new D(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[r+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new D(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,r+=2}else l==="`"?(o=!o,r++):l!=="."||o?(n+=l,r++):(s(),r++)}if(s(),o)throw new D(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new i(t)}static emptyPath(){return new i([])}};var U=class i{constructor(e){this.path=e}static fromPath(e){return new i(ae.fromString(e))}static fromName(e){return new i(ae.fromString(e).popFirst(5))}static empty(){return new i(ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ae.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new i(new ae(e.slice()))}};var vr=class{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}};function eu(i){return i.fields.find(e=>e.kind===2)}function pi(i){return i.fields.filter(e=>e.kind!==2)}vr.UNKNOWN_ID=-1;var pr=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Ls=class i{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new i(0,Rt.min())}};function ug(i,e){let t=i.toTimestamp().seconds,n=i.toTimestamp().nanoseconds+1,r=$.fromTimestamp(n===1e9?new Ce(t+1,0):new Ce(t,n));return new Rt(r,U.empty(),e)}function hg(i){return new Rt(i.readTime,i.key,-1)}var Rt=class i{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new i($.min(),U.empty(),-1)}static max(){return new i($.max(),U.empty(),-1)}};function Hh(i,e){let t=i.readTime.compareTo(e.readTime);return t!==0?t:(t=U.comparator(i.documentKey,e.documentKey),t!==0?t:J(i.largestBatchId,e.largestBatchId))}var dg="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Sa=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Xn(i){return P(this,null,function*(){if(i.code!==x.FAILED_PRECONDITION||i.message!==dg)throw i;V("LocalStore","Unexpectedly lost primary lease")})}var A=class i{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&j(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new i((n,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof i?t:i.resolve(t)}catch(t){return i.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):i.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):i.reject(t)}static resolve(e){return new i((t,n)=>{t(e)})}static reject(e){return new i((t,n)=>{n(e)})}static waitFor(e){return new i((t,n)=>{let r=0,s=0,o=!1;e.forEach(l=>{++r,l.next(()=>{++s,o&&s===r&&t()},c=>n(c))}),o=!0,s===r&&t()})}static or(e){let t=i.resolve(!1);for(let n of e)t=t.next(r=>r?i.resolve(r):n());return t}static forEach(e,t){let n=[];return e.forEach((r,s)=>{n.push(t.call(this,r,s))}),this.waitFor(n)}static mapArray(e,t){return new i((n,r)=>{let s=e.length,o=new Array(s),l=0;for(let c=0;c<s;c++){let h=c;t(e[h]).next(m=>{o[h]=m,++l,l===s&&n(o)},m=>r(m))}})}static doWhile(e,t){return new i((n,r)=>{let s=()=>{e()===!0?t().next(()=>{s()},r):n()};s()})}};var xa=class i{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new je,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ii(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{let r=Qh(n.target.error);this.V.reject(new Ii(e,r))}}static open(e,t,n,r){try{return new i(t,e.transaction(r,n))}catch(s){throw new Ii(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(V("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new nu(t)}},qn=class i{constructor(e,t,n){this.name=e,this.version=t,this.p=n,i.S(vs())===12.2&&ke("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return V("SimpleDb","Removing database:",e),gi(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!ea())return!1;if(i.v())return!0;let e=vs(),t=i.S(e),n=0<t&&t<10,r=mg(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){return P(this,null,function*(){return this.db||(V("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=s=>{let o=s.target.result;t(o)},r.onblocked=()=>{n(new Ii(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=s=>{let o=s.target.error;o.name==="VersionError"?n(new D(x.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?n(new D(x.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):n(new Ii(e,o))},r.onupgradeneeded=s=>{V("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,r.transaction,s.oldVersion,this.version).next(()=>{V("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,r){return P(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let l=xa.open(this.db,e,s?"readonly":"readwrite",n),c=r(l).next(h=>(l.g(),h)).catch(h=>(l.abort(h),A.reject(h))).toPromise();return c.catch(()=>{}),yield l.m,c}catch(l){let c=l,h=c.name!=="FirebaseError"&&o<3;if(V("SimpleDb","Transaction failed with error:",c.message,"Retrying:",h),this.close(),!h)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function mg(i){let e=i.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var tu=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return gi(this.B.delete())}},Ii=class extends D{constructor(e,t){super(x.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Jn(i){return i.name==="IndexedDbTransactionError"}var nu=class{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(V("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(V("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),gi(n)}add(e){return V("SimpleDb","ADD",this.store.name,e,e),gi(this.store.add(e))}get(e){return gi(this.store.get(e)).next(t=>(t===void 0&&(t=null),V("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return V("SimpleDb","DELETE",this.store.name,e),gi(this.store.delete(e))}count(){return V("SimpleDb","COUNT",this.store.name),gi(this.store.count())}U(e,t){let n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if(typeof r.getAll=="function"){let s=r.getAll(n.range);return new A((o,l)=>{s.onerror=c=>{l(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(n),o=[];return this.W(s,(l,c)=>{o.push(c)}).next(()=>o)}}G(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new A((r,s)=>{n.onerror=o=>{s(o.target.error)},n.onsuccess=o=>{r(o.target.result)}})}j(e,t){V("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.H=!1;let r=this.cursor(n);return this.W(r,(s,o,l)=>l.delete())}J(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.W(r,t)}Y(e){let t=this.cursor({});return new A((n,r)=>{t.onerror=s=>{let o=Qh(s.target.error);r(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(l=>{l?o.continue():n()}):n()}})}W(e,t){let n=[];return new A((r,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let l=o.target.result;if(!l)return void r();let c=new tu(l),h=t(l.primaryKey,l.value,c);if(h instanceof A){let m=h.catch(p=>(c.done(),A.reject(p)));n.push(m)}c.isDone?r():c.K===null?l.continue():l.continue(c.K)}}).next(()=>A.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function gi(i){return new A((e,t)=>{i.onsuccess=n=>{let r=n.target.result;e(r)},i.onerror=n=>{let r=Qh(n.target.error);t(r)}})}var sp=!1;function Qh(i){let e=qn.S(vs());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(i.message.indexOf(t)>=0){let n=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return sp||(sp=!0,setTimeout(()=>{throw n},0)),n}}return i}var iu=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){V("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>P(this,null,function*(){this.task=null;try{V("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){Jn(t)?V("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield Xn(t)}yield this.X(6e4)}))}},ru=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return P(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let n=new Set,r=t,s=!0;return A.doWhile(()=>s===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!n.has(o))return V("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,r).next(l=>{r-=l,n.add(o)});s=!1})).next(()=>t-r)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(r,s)).next(l=>(V("IndexBackfiller",`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,t,l))).next(()=>o.size)}))}re(e,t){let n=e;return t.changes.forEach((r,s)=>{let o=hg(s);Hh(o,n)>0&&(n=o)}),new Rt(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}};var wt=(()=>{class i{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return i.oe=-1,i})();function so(i){return i==null}function zs(i){return i===0&&1/i==-1/0}function fg(i){return typeof i=="number"&&Number.isInteger(i)&&!zs(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}function st(i){let e="";for(let t=0;t<i.length;t++)e.length>0&&(e=op(e)),e=Pv(i.get(t),e);return op(e)}function Pv(i,e){let t=e,n=i.length;for(let r=0;r<n;r++){let s=i.charAt(r);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function op(i){return i+""}function Kt(i){let e=i.length;if(G(e>=2),e===2)return G(i.charAt(0)===""&&i.charAt(1)===""),ae.emptyPath();let t=e-2,n=[],r="";for(let s=0;s<e;){let o=i.indexOf("",s);switch((o<0||o>t)&&j(),i.charAt(o+1)){case"":let l=i.substring(s,o),c;r.length===0?c=l:(r+=l,c=r,r=""),n.push(c);break;case"":r+=i.substring(s,o),r+="\0";break;case"":r+=i.substring(s,o+1);break;default:j()}s=o+2}return new ae(n)}var ap=["userId","batchId"];function va(i,e){return[i,st(e)]}function pg(i,e,t){return[i,st(e),t]}var Rv={},Dv=["prefixPath","collectionGroup","readTime","documentId"],kv=["prefixPath","collectionGroup","documentId"],Vv=["collectionGroup","readTime","prefixPath","documentId"],Ov=["canonicalId","targetId"],Mv=["targetId","path"],Nv=["path","targetId"],Fv=["collectionId","parent"],Lv=["indexId","uid"],zv=["uid","sequenceNumber"],Bv=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Uv=["indexId","uid","orderedDocumentKey"],qv=["userId","collectionPath","documentId"],jv=["userId","collectionPath","largestBatchId"],Gv=["userId","collectionGroup","largestBatchId"],gg=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],$v=[...gg,"documentOverlays"],_g=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],yg=_g,Wh=[...yg,"indexConfiguration","indexState","indexEntries"],Kv=Wh,Hv=[...Wh,"globals"];var Bs=class extends Sa{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function Ge(i,e){let t=B(i);return qn.F(t._e,e)}function lp(i){let e=0;for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&e++;return e}function Vi(i,e){for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&e(t,i[t])}function vg(i){for(let e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}var Ie=class i{constructor(e,t){this.comparator=e,this.root=t||Qt.EMPTY}insert(e,t){return new i(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Qt.BLACK,null,null))}remove(e){return new i(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Qt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(r===0)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new fr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new fr(this.root,e,this.comparator,!1)}getReverseIterator(){return new fr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new fr(this.root,e,this.comparator,!0)}},fr=class{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Qt=class i{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=n??i.RED,this.left=r??i.EMPTY,this.right=s??i.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new i(e??this.key,t??this.value,n??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return i.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return i.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,i.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,i.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw j();let e=this.left.check();if(e!==this.right.check())throw j();return e+(this.isRed()?0:1)}};Qt.EMPTY=null,Qt.RED=!0,Qt.BLACK=!1;Qt.EMPTY=new class{constructor(){this.size=0}get key(){throw j()}get value(){throw j()}get color(){throw j()}get left(){throw j()}get right(){throw j()}copy(e,t,n,r,s){return this}insert(e,t,n){return new Qt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var ge=class i{constructor(e){this.comparator=e,this.data=new Ie(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Pa(this.data.getIterator())}getIteratorFrom(e){return new Pa(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof i)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=n.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new i(this.comparator);return t.data=e,t}},Pa=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function sr(i){return i.hasNext()?i.getNext():void 0}var It=class i{constructor(e){this.fields=e,e.sort(Ve.comparator)}static empty(){return new i([])}unionWith(e){let t=new ge(Ve.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new i(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return yr(this.fields,e.fields,(t,n)=>t.isEqual(n))}};var Ra=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function wg(){return typeof atob<"u"}var Me=class i{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ra("Invalid base64 string: "+s):s}}(e);return new i(t)}static fromUint8Array(e){let t=function(r){let s="";for(let o=0;o<r.length;++o)s+=String.fromCharCode(r[o]);return s}(e);return new i(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return J(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Me.EMPTY_BYTE_STRING=new Me("");var Qv=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fn(i){if(G(!!i),typeof i=="string"){let e=0,t=Qv.exec(i);if(G(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}let n=new Date(i);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Te(i.seconds),nanos:Te(i.nanos)}}function Te(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function jn(i){return typeof i=="string"?Me.fromBase64String(i):Me.fromUint8Array(i)}function Il(i){var e,t;return((t=(((e=i?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Yh(i){let e=i.mapValue.fields.__previous_value__;return Il(e)?Yh(e):e}function Us(i){let e=fn(i.mapValue.fields.__local_write_time__.timestampValue);return new Ce(e.seconds,e.nanos)}var su=class{constructor(e,t,n,r,s,o,l,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=h}},Gn=class i{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new i("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof i&&e.projectId===this.projectId&&e.database===this.database}};var zn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},wa={nullValue:"NULL_VALUE"};function Ti(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?Il(i)?4:Ig(i)?9007199254740991:Tl(i)?10:11:j()}function Xt(i,e){if(i===e)return!0;let t=Ti(i);if(t!==Ti(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===e.booleanValue;case 4:return Us(i).isEqual(Us(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;let o=fn(r.timestampValue),l=fn(s.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(i,e);case 5:return i.stringValue===e.stringValue;case 6:return function(r,s){return jn(r.bytesValue).isEqual(jn(s.bytesValue))}(i,e);case 7:return i.referenceValue===e.referenceValue;case 8:return function(r,s){return Te(r.geoPointValue.latitude)===Te(s.geoPointValue.latitude)&&Te(r.geoPointValue.longitude)===Te(s.geoPointValue.longitude)}(i,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return Te(r.integerValue)===Te(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){let o=Te(r.doubleValue),l=Te(s.doubleValue);return o===l?zs(o)===zs(l):isNaN(o)&&isNaN(l)}return!1}(i,e);case 9:return yr(i.arrayValue.values||[],e.arrayValue.values||[],Xt);case 10:case 11:return function(r,s){let o=r.mapValue.fields||{},l=s.mapValue.fields||{};if(lp(o)!==lp(l))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!Xt(o[c],l[c])))return!1;return!0}(i,e);default:return j()}}function qs(i,e){return(i.values||[]).find(t=>Xt(t,e))!==void 0}function $n(i,e){if(i===e)return 0;let t=Ti(i),n=Ti(e);if(t!==n)return J(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return J(i.booleanValue,e.booleanValue);case 2:return function(s,o){let l=Te(s.integerValue||s.doubleValue),c=Te(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(i,e);case 3:return cp(i.timestampValue,e.timestampValue);case 4:return cp(Us(i),Us(e));case 5:return J(i.stringValue,e.stringValue);case 6:return function(s,o){let l=jn(s),c=jn(o);return l.compareTo(c)}(i.bytesValue,e.bytesValue);case 7:return function(s,o){let l=s.split("/"),c=o.split("/");for(let h=0;h<l.length&&h<c.length;h++){let m=J(l[h],c[h]);if(m!==0)return m}return J(l.length,c.length)}(i.referenceValue,e.referenceValue);case 8:return function(s,o){let l=J(Te(s.latitude),Te(o.latitude));return l!==0?l:J(Te(s.longitude),Te(o.longitude))}(i.geoPointValue,e.geoPointValue);case 9:return up(i.arrayValue,e.arrayValue);case 10:return function(s,o){var l,c,h,m;let p=s.fields||{},_=o.fields||{},b=(l=p.value)===null||l===void 0?void 0:l.arrayValue,k=(c=_.value)===null||c===void 0?void 0:c.arrayValue,O=J(((h=b?.values)===null||h===void 0?void 0:h.length)||0,((m=k?.values)===null||m===void 0?void 0:m.length)||0);return O!==0?O:up(b,k)}(i.mapValue,e.mapValue);case 11:return function(s,o){if(s===zn.mapValue&&o===zn.mapValue)return 0;if(s===zn.mapValue)return 1;if(o===zn.mapValue)return-1;let l=s.fields||{},c=Object.keys(l),h=o.fields||{},m=Object.keys(h);c.sort(),m.sort();for(let p=0;p<c.length&&p<m.length;++p){let _=J(c[p],m[p]);if(_!==0)return _;let b=$n(l[c[p]],h[m[p]]);if(b!==0)return b}return J(c.length,m.length)}(i.mapValue,e.mapValue);default:throw j()}}function cp(i,e){if(typeof i=="string"&&typeof e=="string"&&i.length===e.length)return J(i,e);let t=fn(i),n=fn(e),r=J(t.seconds,n.seconds);return r!==0?r:J(t.nanos,n.nanos)}function up(i,e){let t=i.values||[],n=e.values||[];for(let r=0;r<t.length&&r<n.length;++r){let s=$n(t[r],n[r]);if(s)return s}return J(t.length,n.length)}function wr(i){return ou(i)}function ou(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?function(t){let n=fn(t);return`time(${n.seconds},${n.nanos})`}(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?function(t){return jn(t).toBase64()}(i.bytesValue):"referenceValue"in i?function(t){return U.fromName(t).toString()}(i.referenceValue):"geoPointValue"in i?function(t){return`geo(${t.latitude},${t.longitude})`}(i.geoPointValue):"arrayValue"in i?function(t){let n="[",r=!0;for(let s of t.values||[])r?r=!1:n+=",",n+=ou(s);return n+"]"}(i.arrayValue):"mapValue"in i?function(t){let n=Object.keys(t.fields||{}).sort(),r="{",s=!0;for(let o of n)s?s=!1:r+=",",r+=`${o}:${ou(t.fields[o])}`;return r+"}"}(i.mapValue):j()}function Ei(i,e){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${e.path.canonicalString()}`}}function au(i){return!!i&&"integerValue"in i}function js(i){return!!i&&"arrayValue"in i}function hp(i){return!!i&&"nullValue"in i}function dp(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function Ia(i){return!!i&&"mapValue"in i}function Tl(i){var e,t;return((t=(((e=i?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Vs(i){if(i.geoPointValue)return{geoPointValue:Object.assign({},i.geoPointValue)};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:Object.assign({},i.timestampValue)};if(i.mapValue){let e={mapValue:{fields:{}}};return Vi(i.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Vs(n)),e}if(i.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(i.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Vs(i.arrayValue.values[t]);return e}return Object.assign({},i)}function Ig(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var Tg={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function Wv(i){return"nullValue"in i?wa:"booleanValue"in i?{booleanValue:!1}:"integerValue"in i||"doubleValue"in i?{doubleValue:NaN}:"timestampValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in i?{stringValue:""}:"bytesValue"in i?{bytesValue:""}:"referenceValue"in i?Ei(Gn.empty(),U.empty()):"geoPointValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in i?{arrayValue:{}}:"mapValue"in i?Tl(i)?Tg:{mapValue:{}}:j()}function Yv(i){return"nullValue"in i?{booleanValue:!1}:"booleanValue"in i?{doubleValue:NaN}:"integerValue"in i||"doubleValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in i?{stringValue:""}:"stringValue"in i?{bytesValue:""}:"bytesValue"in i?Ei(Gn.empty(),U.empty()):"referenceValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in i?{arrayValue:{}}:"arrayValue"in i?Tg:"mapValue"in i?Tl(i)?{mapValue:{}}:zn:j()}function mp(i,e){let t=$n(i.value,e.value);return t!==0?t:i.inclusive&&!e.inclusive?-1:!i.inclusive&&e.inclusive?1:0}function fp(i,e){let t=$n(i.value,e.value);return t!==0?t:i.inclusive&&!e.inclusive?1:!i.inclusive&&e.inclusive?-1:0}var tt=class i{constructor(e){this.value=e}static empty(){return new i({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ia(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Vs(t)}setAll(e){let t=Ve.emptyPath(),n={},r=[];e.forEach((o,l)=>{if(!t.isImmediateParentOf(l)){let c=this.getFieldsMap(t);this.applyChanges(c,n,r),n={},r=[],t=l.popLast()}o?n[l.lastSegment()]=Vs(o):r.push(l.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,n,r)}delete(e){let t=this.field(e.popLast());Ia(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Xt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Ia(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Vi(t,(r,s)=>e[r]=s);for(let r of n)delete e[r]}clone(){return new i(Vs(this.value))}};function Eg(i){let e=[];return Vi(i.fields,(t,n)=>{let r=new Ve([t]);if(Ia(n)){let s=Eg(n.mapValue).fields;if(s.length===0)e.push(r);else for(let o of s)e.push(r.child(o))}else e.push(r)}),new It(e)}var ze=class i{constructor(e,t,n,r,s,o,l){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=o,this.documentState=l}static newInvalidDocument(e){return new i(e,0,$.min(),$.min(),$.min(),tt.empty(),0)}static newFoundDocument(e,t,n,r){return new i(e,1,t,$.min(),n,r,0)}static newNoDocument(e,t){return new i(e,2,t,$.min(),$.min(),tt.empty(),0)}static newUnknownDocument(e,t){return new i(e,3,t,$.min(),$.min(),tt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=tt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=tt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof i&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new i(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Jt=class{constructor(e,t){this.position=e,this.inclusive=t}};function pp(i,e,t){let n=0;for(let r=0;r<i.position.length;r++){let s=e[r],o=i.position[r];if(s.field.isKeyField()?n=U.comparator(U.fromName(o.referenceValue),t.key):n=$n(o,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function gp(i,e){if(i===null)return e===null;if(e===null||i.inclusive!==e.inclusive||i.position.length!==e.position.length)return!1;for(let t=0;t<i.position.length;t++)if(!Xt(i.position[t],e.position[t]))return!1;return!0}var bi=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function Xv(i,e){return i.dir===e.dir&&i.field.isEqual(e.field)}var Da=class{},ie=class i extends Da{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new uu(e,t,n):t==="array-contains"?new mu(e,n):t==="in"?new ka(e,n):t==="not-in"?new fu(e,n):t==="array-contains-any"?new pu(e,n):new i(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new hu(e,n):new du(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison($n(t,this.value)):t!==null&&Ti(this.value)===Ti(t)&&this.matchesComparison($n(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return j()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},me=class i extends Da{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new i(e,t)}matches(e){return Ir(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Ir(i){return i.op==="and"}function lu(i){return i.op==="or"}function Xh(i){return bg(i)&&Ir(i)}function bg(i){for(let e of i.filters)if(e instanceof me)return!1;return!0}function cu(i){if(i instanceof ie)return i.field.canonicalString()+i.op.toString()+wr(i.value);if(Xh(i))return i.filters.map(e=>cu(e)).join(",");{let e=i.filters.map(t=>cu(t)).join(",");return`${i.op}(${e})`}}function Cg(i,e){return i instanceof ie?function(n,r){return r instanceof ie&&n.op===r.op&&n.field.isEqual(r.field)&&Xt(n.value,r.value)}(i,e):i instanceof me?function(n,r){return r instanceof me&&n.op===r.op&&n.filters.length===r.filters.length?n.filters.reduce((s,o,l)=>s&&Cg(o,r.filters[l]),!0):!1}(i,e):void j()}function Ag(i,e){let t=i.filters.concat(e);return me.create(t,i.op)}function Sg(i){return i instanceof ie?function(t){return`${t.field.canonicalString()} ${t.op} ${wr(t.value)}`}(i):i instanceof me?function(t){return t.op.toString()+" {"+t.getFilters().map(Sg).join(" ,")+"}"}(i):"Filter"}var uu=class extends ie{constructor(e,t,n){super(e,t,n),this.key=U.fromName(n.referenceValue)}matches(e){let t=U.comparator(e.key,this.key);return this.matchesComparison(t)}},hu=class extends ie{constructor(e,t){super(e,"in",t),this.keys=xg("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},du=class extends ie{constructor(e,t){super(e,"not-in",t),this.keys=xg("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function xg(i,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>U.fromName(n.referenceValue))}var mu=class extends ie{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return js(t)&&qs(t.arrayValue,this.value)}},ka=class extends ie{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&qs(this.value.arrayValue,t)}},fu=class extends ie{constructor(e,t){super(e,"not-in",t)}matches(e){if(qs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!qs(this.value.arrayValue,t)}},pu=class extends ie{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!js(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>qs(this.value.arrayValue,n))}};var gu=class{constructor(e,t=null,n=[],r=[],s=null,o=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=o,this.endAt=l,this.ue=null}};function _u(i,e=null,t=[],n=[],r=null,s=null,o=null){return new gu(i,e,t,n,r,s,o)}function Ci(i){let e=B(i);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>cu(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),so(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>wr(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>wr(n)).join(",")),e.ue=t}return e.ue}function oo(i,e){if(i.limit!==e.limit||i.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<i.orderBy.length;t++)if(!Xv(i.orderBy[t],e.orderBy[t]))return!1;if(i.filters.length!==e.filters.length)return!1;for(let t=0;t<i.filters.length;t++)if(!Cg(i.filters[t],e.filters[t]))return!1;return i.collectionGroup===e.collectionGroup&&!!i.path.isEqual(e.path)&&!!gp(i.startAt,e.startAt)&&gp(i.endAt,e.endAt)}function Va(i){return U.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}function Oa(i,e){return i.filters.filter(t=>t instanceof ie&&t.field.isEqual(e))}function _p(i,e,t){let n=wa,r=!0;for(let s of Oa(i,e)){let o=wa,l=!0;switch(s.op){case"<":case"<=":o=Wv(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,l=!1;break;case"!=":case"not-in":o=wa}mp({value:n,inclusive:r},{value:o,inclusive:l})<0&&(n=o,r=l)}if(t!==null){for(let s=0;s<i.orderBy.length;++s)if(i.orderBy[s].field.isEqual(e)){let o=t.position[s];mp({value:n,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(n=o,r=t.inclusive);break}}return{value:n,inclusive:r}}function yp(i,e,t){let n=zn,r=!0;for(let s of Oa(i,e)){let o=zn,l=!0;switch(s.op){case">=":case">":o=Yv(s.value),l=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,l=!1;break;case"!=":case"not-in":o=zn}fp({value:n,inclusive:r},{value:o,inclusive:l})>0&&(n=o,r=l)}if(t!==null){for(let s=0;s<i.orderBy.length;++s)if(i.orderBy[s].field.isEqual(e)){let o=t.position[s];fp({value:n,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(n=o,r=t.inclusive);break}}return{value:n,inclusive:r}}var Lt=class{constructor(e,t=null,n=[],r=[],s=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=o,this.startAt=l,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function Pg(i,e,t,n,r,s,o,l){return new Lt(i,e,t,n,r,s,o,l)}function Nr(i){return new Lt(i)}function vp(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function Jh(i){return i.collectionGroup!==null}function gr(i){let e=B(i);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new ge(Ve.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(l=l.add(h.field))})}),l})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new bi(s,n))}),t.has(Ve.keyField().canonicalString())||e.ce.push(new bi(Ve.keyField(),n))}return e.ce}function ot(i){let e=B(i);return e.le||(e.le=Jv(e,gr(i))),e.le}function Jv(i,e){if(i.limitType==="F")return _u(i.path,i.collectionGroup,e,i.filters,i.limit,i.startAt,i.endAt);{e=e.map(r=>{let s=r.dir==="desc"?"asc":"desc";return new bi(r.field,s)});let t=i.endAt?new Jt(i.endAt.position,i.endAt.inclusive):null,n=i.startAt?new Jt(i.startAt.position,i.startAt.inclusive):null;return _u(i.path,i.collectionGroup,e,i.filters,i.limit,t,n)}}function yu(i,e){let t=i.filters.concat([e]);return new Lt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),t,i.limit,i.limitType,i.startAt,i.endAt)}function Ma(i,e,t){return new Lt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),e,t,i.startAt,i.endAt)}function ao(i,e){return oo(ot(i),ot(e))&&i.limitType===e.limitType}function Rg(i){return`${Ci(ot(i))}|lt:${i.limitType}`}function ur(i){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(r=>Sg(r)).join(", ")}]`),so(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(r=>wr(r)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(r=>wr(r)).join(",")),`Target(${n})`}(ot(i))}; limitType=${i.limitType})`}function lo(i,e){return e.isFoundDocument()&&function(n,r){let s=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):U.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(i,e)&&function(n,r){for(let s of gr(n))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(i,e)&&function(n,r){for(let s of n.filters)if(!s.matches(r))return!1;return!0}(i,e)&&function(n,r){return!(n.startAt&&!function(o,l,c){let h=pp(o,l,c);return o.inclusive?h<=0:h<0}(n.startAt,gr(n),r)||n.endAt&&!function(o,l,c){let h=pp(o,l,c);return o.inclusive?h>=0:h>0}(n.endAt,gr(n),r))}(i,e)}function Dg(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function kg(i){return(e,t)=>{let n=!1;for(let r of gr(i)){let s=Zv(r,e,t);if(s!==0)return s;n=n||r.field.isKeyField()}return 0}}function Zv(i,e,t){let n=i.field.isKeyField()?U.comparator(e.key,t.key):function(s,o,l){let c=o.data.field(s),h=l.data.field(s);return c!==null&&h!==null?$n(c,h):j()}(i.field,e,t);switch(i.dir){case"asc":return n;case"desc":return-1*n;default:return j()}}var Zt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[r,s]of n)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return n.length===1?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Vi(this.inner,(t,n)=>{for(let[r,s]of n)e(r,s)})}isEmpty(){return vg(this.inner)}size(){return this.innerSize}};var e1=new Ie(U.comparator);function gt(){return e1}var Vg=new Ie(U.comparator);function Ds(...i){let e=Vg;for(let t of i)e=e.insert(t.key,t);return e}function Og(i){let e=Vg;return i.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Ht(){return Os()}function Mg(){return Os()}function Os(){return new Zt(i=>i.toString(),(i,e)=>i.isEqual(e))}var t1=new Ie(U.comparator),n1=new ge(U.comparator);function te(...i){let e=n1;for(let t of i)e=e.add(t);return e}var i1=new ge(J);function Zh(){return i1}function ed(i,e){if(i.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zs(e)?"-0":e}}function Ng(i){return{integerValue:""+i}}function Fg(i,e){return fg(e)?Ng(e):ed(i,e)}var Tr=class{constructor(){this._=void 0}};function r1(i,e,t){return i instanceof Kn?function(r,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&Il(s)&&(s=Yh(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):i instanceof pn?zg(i,e):i instanceof gn?Bg(i,e):function(r,s){let o=Lg(r,s),l=wp(o)+wp(r.Pe);return au(o)&&au(r.Pe)?Ng(l):ed(r.serializer,l)}(i,e)}function s1(i,e,t){return i instanceof pn?zg(i,e):i instanceof gn?Bg(i,e):t}function Lg(i,e){return i instanceof Hn?function(n){return au(n)||function(s){return!!s&&"doubleValue"in s}(n)}(e)?e:{integerValue:0}:null}var Kn=class extends Tr{},pn=class extends Tr{constructor(e){super(),this.elements=e}};function zg(i,e){let t=Ug(e);for(let n of i.elements)t.some(r=>Xt(r,n))||t.push(n);return{arrayValue:{values:t}}}var gn=class extends Tr{constructor(e){super(),this.elements=e}};function Bg(i,e){let t=Ug(e);for(let n of i.elements)t=t.filter(r=>!Xt(r,n));return{arrayValue:{values:t}}}var Hn=class extends Tr{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function wp(i){return Te(i.integerValue||i.doubleValue)}function Ug(i){return js(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}var Ai=class{constructor(e,t){this.field=e,this.transform=t}};function o1(i,e){return i.field.isEqual(e.field)&&function(n,r){return n instanceof pn&&r instanceof pn||n instanceof gn&&r instanceof gn?yr(n.elements,r.elements,Xt):n instanceof Hn&&r instanceof Hn?Xt(n.Pe,r.Pe):n instanceof Kn&&r instanceof Kn}(i.transform,e.transform)}var vu=class{constructor(e,t){this.version=e,this.transformResults=t}},Re=class i{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new i}static exists(e){return new i(void 0,e)}static updateTime(e){return new i(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Ta(i,e){return i.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(i.updateTime):i.exists===void 0||i.exists===e.isFoundDocument()}var Er=class{};function qg(i,e){if(!i.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return i.isNoDocument()?new Wn(i.key,Re.none()):new Qn(i.key,i.data,Re.none());{let t=i.data,n=tt.empty(),r=new ge(Ve.comparator);for(let s of e.fields)if(!r.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?n.delete(s):n.set(s,o),r=r.add(s)}return new zt(i.key,n,new It(r.toArray()),Re.none())}}function a1(i,e,t){i instanceof Qn?function(r,s,o){let l=r.value.clone(),c=Tp(r.fieldTransforms,s,o.transformResults);l.setAll(c),s.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(i,e,t):i instanceof zt?function(r,s,o){if(!Ta(r.precondition,s))return void s.convertToUnknownDocument(o.version);let l=Tp(r.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(jg(r)),c.setAll(l),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(i,e,t):function(r,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Ms(i,e,t,n){return i instanceof Qn?function(s,o,l,c){if(!Ta(s.precondition,o))return l;let h=s.value.clone(),m=Ep(s.fieldTransforms,c,o);return h.setAll(m),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(i,e,t,n):i instanceof zt?function(s,o,l,c){if(!Ta(s.precondition,o))return l;let h=Ep(s.fieldTransforms,c,o),m=o.data;return m.setAll(jg(s)),m.setAll(h),o.convertToFoundDocument(o.version,m).setHasLocalMutations(),l===null?null:l.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(i,e,t,n):function(s,o,l){return Ta(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(i,e,t)}function l1(i,e){let t=null;for(let n of i.fieldTransforms){let r=e.data.field(n.field),s=Lg(n.transform,r||null);s!=null&&(t===null&&(t=tt.empty()),t.set(n.field,s))}return t||null}function Ip(i,e){return i.type===e.type&&!!i.key.isEqual(e.key)&&!!i.precondition.isEqual(e.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&yr(n,r,(s,o)=>o1(s,o))}(i.fieldTransforms,e.fieldTransforms)&&(i.type===0?i.value.isEqual(e.value):i.type!==1||i.data.isEqual(e.data)&&i.fieldMask.isEqual(e.fieldMask))}var Qn=class extends Er{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}},zt=class extends Er{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function jg(i){let e=new Map;return i.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=i.data.field(t);e.set(t,n)}}),e}function Tp(i,e,t){let n=new Map;G(i.length===t.length);for(let r=0;r<t.length;r++){let s=i[r],o=s.transform,l=e.data.field(s.field);n.set(s.field,s1(o,l,t[r]))}return n}function Ep(i,e,t){let n=new Map;for(let r of i){let s=r.transform,o=t.data.field(r.field);n.set(r.field,r1(s,o,e))}return n}var Wn=class extends Er{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Gs=class extends Er{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var $s=class{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){let s=this.mutations[r];s.key.isEqual(e.key)&&a1(s,e,n[r])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ms(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=Ms(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=Mg();return this.mutations.forEach(r=>{let s=e.get(r.key),o=s.overlayedDocument,l=this.applyToLocalView(o,s.mutatedFields);l=t.has(r.key)?null:l;let c=qg(o,l);c!==null&&n.set(r.key,c),o.isValidDocument()||o.convertToNoDocument($.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),te())}isEqual(e){return this.batchId===e.batchId&&yr(this.mutations,e.mutations,(t,n)=>Ip(t,n))&&yr(this.baseMutations,e.baseMutations,(t,n)=>Ip(t,n))}},wu=class i{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){G(e.mutations.length===n.length);let r=function(){return t1}(),s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,n[o].version);return new i(e,t,n,r)}};var Ks=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Iu=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Ne,oe;function Gg(i){switch(i){default:return j();case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0}}function $g(i){if(i===void 0)return ke("GRPC error has no .code"),x.UNKNOWN;switch(i){case Ne.OK:return x.OK;case Ne.CANCELLED:return x.CANCELLED;case Ne.UNKNOWN:return x.UNKNOWN;case Ne.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case Ne.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case Ne.INTERNAL:return x.INTERNAL;case Ne.UNAVAILABLE:return x.UNAVAILABLE;case Ne.UNAUTHENTICATED:return x.UNAUTHENTICATED;case Ne.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case Ne.NOT_FOUND:return x.NOT_FOUND;case Ne.ALREADY_EXISTS:return x.ALREADY_EXISTS;case Ne.PERMISSION_DENIED:return x.PERMISSION_DENIED;case Ne.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case Ne.ABORTED:return x.ABORTED;case Ne.OUT_OF_RANGE:return x.OUT_OF_RANGE;case Ne.UNIMPLEMENTED:return x.UNIMPLEMENTED;case Ne.DATA_LOSS:return x.DATA_LOSS;default:return j()}}(oe=Ne||(Ne={}))[oe.OK=0]="OK",oe[oe.CANCELLED=1]="CANCELLED",oe[oe.UNKNOWN=2]="UNKNOWN",oe[oe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",oe[oe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",oe[oe.NOT_FOUND=5]="NOT_FOUND",oe[oe.ALREADY_EXISTS=6]="ALREADY_EXISTS",oe[oe.PERMISSION_DENIED=7]="PERMISSION_DENIED",oe[oe.UNAUTHENTICATED=16]="UNAUTHENTICATED",oe[oe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",oe[oe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",oe[oe.ABORTED=10]="ABORTED",oe[oe.OUT_OF_RANGE=11]="OUT_OF_RANGE",oe[oe.UNIMPLEMENTED=12]="UNIMPLEMENTED",oe[oe.INTERNAL=13]="INTERNAL",oe[oe.UNAVAILABLE=14]="UNAVAILABLE",oe[oe.DATA_LOSS=15]="DATA_LOSS";var bp=null;function Kg(){return new TextEncoder}var c1=new On([4294967295,4294967295],0);function Cp(i){let e=Kg().encode(i),t=new Nc;return t.update(e),new Uint8Array(t.digest())}function Ap(i){let e=new DataView(i.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new On([t,n],0),new On([r,s],0)]}var Tu=class i{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new wi(`Invalid padding: ${t}`);if(n<0)throw new wi(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new wi(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new wi(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=On.fromNumber(this.Ie)}Ee(e,t,n){let r=e.add(t.multiply(On.fromNumber(n)));return r.compare(c1)===1&&(r=new On([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=Cp(e),[n,r]=Ap(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(n,r,s);if(!this.de(o))return!1}return!0}static create(e,t,n){let r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new i(s,r,t);return n.forEach(l=>o.insert(l)),o}insert(e){if(this.Ie===0)return;let t=Cp(e),[n,r]=Ap(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(n,r,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},wi=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Hs=class i{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,Qs.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new i($.min(),r,new Ie(J),gt(),te())}},Qs=class i{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new i(n,t,te(),te(),te())}};var _r=class{constructor(e,t,n,r){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=r}},Na=class{constructor(e,t){this.targetId=e,this.me=t}},Fa=class{constructor(e,t,n=Me.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}},La=class{constructor(){this.fe=0,this.ge=xp(),this.pe=Me.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=te(),t=te(),n=te();return this.ge.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:j()}}),new Qs(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=xp()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,G(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Eu=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=gt(),this.qe=Sp(),this.Qe=new Ie(J)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:j()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,r)=>{this.ze(r)&&t(r)})}He(e){let t=e.targetId,n=e.me.count,r=this.Je(t);if(r){let s=r.target;if(Va(s))if(n===0){let o=new U(s.path);this.Ue(t,o,ze.newNoDocument(o,$.min()))}else G(n===1);else{let o=this.Ye(t);if(o!==n){let l=this.Ze(e),c=l?this.Xe(l,e,o):1;if(c!==0){this.je(t);let h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,h)}bp?.et(function(m,p,_,b,k){var O,R,K,Q,z,W;let Z={localCacheCount:m,existenceFilterCount:p.count,databaseId:_.database,projectId:_.projectId},ee=p.unchangedNames;return ee&&(Z.bloomFilter={applied:k===0,hashCount:(O=ee?.hashCount)!==null&&O!==void 0?O:0,bitmapLength:(Q=(K=(R=ee?.bits)===null||R===void 0?void 0:R.bitmap)===null||K===void 0?void 0:K.length)!==null&&Q!==void 0?Q:0,padding:(W=(z=ee?.bits)===null||z===void 0?void 0:z.padding)!==null&&W!==void 0?W:0,mightContain:w=>{var g;return(g=b?.mightContain(w))!==null&&g!==void 0&&g}}),Z}(o,e.me,this.Le.tt(),l,c))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=t,o,l;try{o=jn(n).toUint8Array()}catch(c){if(c instanceof Ra)return Ft("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new Tu(o,r,s)}catch(c){return Ft(c instanceof wi?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.Ie===0?null:l}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){let n=this.Le.getRemoteKeysForTarget(t),r=0;return n.forEach(s=>{let o=this.Le.tt(),l=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(l)||(this.Ue(t,s,null),r++)}),r}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let l=this.Je(o);if(l){if(s.current&&Va(l.target)){let c=new U(l.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,ze.newNoDocument(c,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let n=te();this.qe.forEach((s,o)=>{let l=!0;o.forEachWhile(c=>{let h=this.Je(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(n=n.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let r=new Hs(e,t,this.Qe,this.ke,n);return this.ke=gt(),this.qe=Sp(),this.Qe=new Ie(J),r}$e(e,t){if(!this.ze(e))return;let n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;let r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new La,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ge(J),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new La),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function Sp(){return new Ie(U.comparator)}function xp(){return new Ie(U.comparator)}var u1={asc:"ASCENDING",desc:"DESCENDING"},h1={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},d1={and:"AND",or:"OR"},bu=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Cu(i,e){return i.useProto3Json||so(e)?e:{value:e}}function br(i,e){return i.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Hg(i,e){return i.useProto3Json?e.toBase64():e.toUint8Array()}function m1(i,e){return br(i,e.toTimestamp())}function Oe(i){return G(!!i),$.fromTimestamp(function(t){let n=fn(t);return new Ce(n.seconds,n.nanos)}(i))}function td(i,e){return Au(i,e).canonicalString()}function Au(i,e){let t=function(r){return new ae(["projects",r.projectId,"databases",r.database])}(i).child("documents");return e===void 0?t:t.child(e)}function Qg(i){let e=ae.fromString(i);return G(r_(e)),e}function Ws(i,e){return td(i.databaseId,e.path)}function Wt(i,e){let t=Qg(e);if(t.get(1)!==i.databaseId.projectId)throw new D(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+i.databaseId.projectId);if(t.get(3)!==i.databaseId.database)throw new D(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+i.databaseId.database);return new U(Xg(t))}function Wg(i,e){return td(i.databaseId,e)}function Yg(i){let e=Qg(i);return e.length===4?ae.emptyPath():Xg(e)}function Su(i){return new ae(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function Xg(i){return G(i.length>4&&i.get(4)==="documents"),i.popFirst(5)}function Pp(i,e,t){return{name:Ws(i,e),fields:t.value.mapValue.fields}}function Jg(i,e,t){let n=Wt(i,e.name),r=Oe(e.updateTime),s=e.createTime?Oe(e.createTime):$.min(),o=new tt({mapValue:{fields:e.fields}}),l=ze.newFoundDocument(n,r,s,o);return t&&l.setHasCommittedMutations(),t?l.setHasCommittedMutations():l}function f1(i,e){return"found"in e?function(n,r){G(!!r.found),r.found.name,r.found.updateTime;let s=Wt(n,r.found.name),o=Oe(r.found.updateTime),l=r.found.createTime?Oe(r.found.createTime):$.min(),c=new tt({mapValue:{fields:r.found.fields}});return ze.newFoundDocument(s,o,l,c)}(i,e):"missing"in e?function(n,r){G(!!r.missing),G(!!r.readTime);let s=Wt(n,r.missing),o=Oe(r.readTime);return ze.newNoDocument(s,o)}(i,e):j()}function p1(i,e){let t;if("targetChange"in e){e.targetChange;let n=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:j()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(h,m){return h.useProto3Json?(G(m===void 0||typeof m=="string"),Me.fromBase64String(m||"")):(G(m===void 0||m instanceof Buffer||m instanceof Uint8Array),Me.fromUint8Array(m||new Uint8Array))}(i,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(h){let m=h.code===void 0?x.UNKNOWN:$g(h.code);return new D(m,h.message||"")}(o);t=new Fa(n,r,s,l||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let r=Wt(i,n.document.name),s=Oe(n.document.updateTime),o=n.document.createTime?Oe(n.document.createTime):$.min(),l=new tt({mapValue:{fields:n.document.fields}}),c=ze.newFoundDocument(r,s,o,l),h=n.targetIds||[],m=n.removedTargetIds||[];t=new _r(h,m,c.key,c)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let r=Wt(i,n.document),s=n.readTime?Oe(n.readTime):$.min(),o=ze.newNoDocument(r,s),l=n.removedTargetIds||[];t=new _r([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let r=Wt(i,n.document),s=n.removedTargetIds||[];t=new _r([],s,r,null)}else{if(!("filter"in e))return j();{e.filter;let n=e.filter;n.targetId;let{count:r=0,unchangedNames:s}=n,o=new Iu(r,s),l=n.targetId;t=new Na(l,o)}}return t}function Ys(i,e){let t;if(e instanceof Qn)t={update:Pp(i,e.key,e.value)};else if(e instanceof Wn)t={delete:Ws(i,e.key)};else if(e instanceof zt)t={update:Pp(i,e.key,e.data),updateMask:I1(e.fieldMask)};else{if(!(e instanceof Gs))return j();t={verify:Ws(i,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,o){let l=o.transform;if(l instanceof Kn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof pn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof gn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Hn)return{fieldPath:o.field.canonicalString(),increment:l.Pe};throw j()}(0,n))),e.precondition.isNone||(t.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:m1(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:j()}(i,e.precondition)),t}function xu(i,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?Re.updateTime(Oe(s.updateTime)):s.exists!==void 0?Re.exists(s.exists):Re.none()}(e.currentDocument):Re.none(),n=e.updateTransforms?e.updateTransforms.map(r=>function(o,l){let c=null;if("setToServerValue"in l)G(l.setToServerValue==="REQUEST_TIME"),c=new Kn;else if("appendMissingElements"in l){let m=l.appendMissingElements.values||[];c=new pn(m)}else if("removeAllFromArray"in l){let m=l.removeAllFromArray.values||[];c=new gn(m)}else"increment"in l?c=new Hn(o,l.increment):j();let h=Ve.fromServerFormat(l.fieldPath);return new Ai(h,c)}(i,r)):[];if(e.update){e.update.name;let r=Wt(i,e.update.name),s=new tt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(c){let h=c.fieldPaths||[];return new It(h.map(m=>Ve.fromServerFormat(m)))}(e.updateMask);return new zt(r,s,o,t,n)}return new Qn(r,s,t,n)}if(e.delete){let r=Wt(i,e.delete);return new Wn(r,t)}if(e.verify){let r=Wt(i,e.verify);return new Gs(r,t)}return j()}function g1(i,e){return i&&i.length>0?(G(e!==void 0),i.map(t=>function(r,s){let o=r.updateTime?Oe(r.updateTime):Oe(s);return o.isEqual($.min())&&(o=Oe(s)),new vu(o,r.transformResults||[])}(t,e))):[]}function Zg(i,e){return{documents:[Wg(i,e.path)]}}function e_(i,e){let t={structuredQuery:{}},n=e.path,r;e.collectionGroup!==null?(r=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Wg(i,r);let s=function(h){if(h.length!==0)return i_(me.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(h){if(h.length!==0)return h.map(m=>function(_){return{field:hr(_.field),direction:y1(_.dir)}}(m))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let l=Cu(i,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:r}}function t_(i){let e=Yg(i.parent),t=i.structuredQuery,n=t.from?t.from.length:0,r=null;if(n>0){G(n===1);let m=t.from[0];m.allDescendants?r=m.collectionId:e=e.child(m.collectionId)}let s=[];t.where&&(s=function(p){let _=n_(p);return _ instanceof me&&Xh(_)?_.getFilters():[_]}(t.where));let o=[];t.orderBy&&(o=function(p){return p.map(_=>function(k){return new bi(dr(k.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(_))}(t.orderBy));let l=null;t.limit&&(l=function(p){let _;return _=typeof p=="object"?p.value:p,so(_)?null:_}(t.limit));let c=null;t.startAt&&(c=function(p){let _=!!p.before,b=p.values||[];return new Jt(b,_)}(t.startAt));let h=null;return t.endAt&&(h=function(p){let _=!p.before,b=p.values||[];return new Jt(b,_)}(t.endAt)),Pg(e,r,o,s,l,"F",c,h)}function _1(i,e){let t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return j()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function n_(i){return i.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=dr(t.unaryFilter.field);return ie.create(n,"==",{doubleValue:NaN});case"IS_NULL":let r=dr(t.unaryFilter.field);return ie.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=dr(t.unaryFilter.field);return ie.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=dr(t.unaryFilter.field);return ie.create(o,"!=",{nullValue:"NULL_VALUE"});default:return j()}}(i):i.fieldFilter!==void 0?function(t){return ie.create(dr(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return j()}}(t.fieldFilter.op),t.fieldFilter.value)}(i):i.compositeFilter!==void 0?function(t){return me.create(t.compositeFilter.filters.map(n=>n_(n)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return j()}}(t.compositeFilter.op))}(i):j()}function y1(i){return u1[i]}function v1(i){return h1[i]}function w1(i){return d1[i]}function hr(i){return{fieldPath:i.canonicalString()}}function dr(i){return Ve.fromServerFormat(i.fieldPath)}function i_(i){return i instanceof ie?function(t){if(t.op==="=="){if(dp(t.value))return{unaryFilter:{field:hr(t.field),op:"IS_NAN"}};if(hp(t.value))return{unaryFilter:{field:hr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(dp(t.value))return{unaryFilter:{field:hr(t.field),op:"IS_NOT_NAN"}};if(hp(t.value))return{unaryFilter:{field:hr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hr(t.field),op:v1(t.op),value:t.value}}}(i):i instanceof me?function(t){let n=t.getFilters().map(r=>i_(r));return n.length===1?n[0]:{compositeFilter:{op:w1(t.op),filters:n}}}(i):j()}function I1(i){let e=[];return i.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function r_(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}var Cr=class i{constructor(e,t,n,r,s=$.min(),o=$.min(),l=Me.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new i(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var za=class{constructor(e){this.ct=e}};function T1(i,e){let t;if(e.document)t=Jg(i.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let n=U.fromSegments(e.noDocument.path),r=xi(e.noDocument.readTime);t=ze.newNoDocument(n,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return j();{let n=U.fromSegments(e.unknownDocument.path),r=xi(e.unknownDocument.version);t=ze.newUnknownDocument(n,r)}}return e.readTime&&t.setReadTime(function(r){let s=new Ce(r[0],r[1]);return $.fromTimestamp(s)}(e.readTime)),t}function Rp(i,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ba(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(s,o){return{name:Ws(s,o.key),fields:o.data.value.mapValue.fields,updateTime:br(s,o.version.toTimestamp()),createTime:br(s,o.createTime.toTimestamp())}}(i.ct,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:Si(e.version)};else{if(!e.isUnknownDocument())return j();n.unknownDocument={path:t.path.toArray(),version:Si(e.version)}}return n}function Ba(i){let e=i.toTimestamp();return[e.seconds,e.nanoseconds]}function Si(i){let e=i.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function xi(i){let e=new Ce(i.seconds,i.nanoseconds);return $.fromTimestamp(e)}function _i(i,e){let t=(e.baseMutations||[]).map(s=>xu(i.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let n=e.mutations.map(s=>xu(i.ct,s)),r=Ce.fromMillis(e.localWriteTimeMs);return new $s(e.batchId,r,t,n)}function ks(i){let e=xi(i.readTime),t=i.lastLimboFreeSnapshotVersion!==void 0?xi(i.lastLimboFreeSnapshotVersion):$.min(),n;return n=function(s){return s.documents!==void 0}(i.query)?function(s){return G(s.documents.length===1),ot(Nr(Yg(s.documents[0])))}(i.query):function(s){return ot(t_(s))}(i.query),new Cr(n,i.targetId,"TargetPurposeListen",i.lastListenSequenceNumber,e,t,Me.fromBase64String(i.resumeToken))}function s_(i,e){let t=Si(e.snapshotVersion),n=Si(e.lastLimboFreeSnapshotVersion),r;r=Va(e.target)?Zg(i.ct,e.target):e_(i.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ci(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:r}}function nd(i){let e=t_({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?Ma(e,e.limit,"L"):e}function qc(i,e){return new Ks(e.largestBatchId,xu(i.ct,e.overlayMutation))}function Dp(i,e){let t=e.path.lastSegment();return[i,st(e.path.popLast()),t]}function kp(i,e,t,n){return{indexId:i,uid:e,sequenceNumber:t,readTime:Si(n.readTime),documentKey:st(n.documentKey.path),largestBatchId:n.largestBatchId}}var Pu=class{getBundleMetadata(e,t){return Vp(e).get(t).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:xi(s.createTime),version:s.version}}(n)})}saveBundleMetadata(e,t){return Vp(e).put(function(r){return{bundleId:r.id,createTime:Si(Oe(r.createTime)),version:r.version}}(t))}getNamedQuery(e,t){return Op(e).get(t).next(n=>{if(n)return function(s){return{name:s.name,query:nd(s.bundledQuery),readTime:xi(s.readTime)}}(n)})}saveNamedQuery(e,t){return Op(e).put(function(r){return{name:r.name,readTime:Si(Oe(r.readTime)),bundledQuery:r.bundledQuery}}(t))}};function Vp(i){return Ge(i,"bundles")}function Op(i){return Ge(i,"namedQueries")}var Ua=class i{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let n=t.uid||"";return new i(e,n)}getOverlay(e,t){return Ss(e).get(Dp(this.userId,t)).next(n=>n?qc(this.serializer,n):null)}getOverlays(e,t){let n=Ht();return A.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&n.set(r,s)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((s,o)=>{let l=new Ks(t,o);r.push(this.ht(e,l))}),A.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(o=>r.add(st(o.getCollectionPath())));let s=[];return r.forEach(o=>{let l=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,n+1],!1,!0);s.push(Ss(e).j("collectionPathOverlayIndex",l))}),A.waitFor(s)}getOverlaysForCollection(e,t,n){let r=Ht(),s=st(t),o=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Ss(e).U("collectionPathOverlayIndex",o).next(l=>{for(let c of l){let h=qc(this.serializer,c);r.set(h.getKey(),h)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let s=Ht(),o,l=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ss(e).J({index:"collectionGroupOverlayIndex",range:l},(c,h,m)=>{let p=qc(this.serializer,h);s.size()<r||p.largestBatchId===o?(s.set(p.getKey(),p),o=p.largestBatchId):m.done()}).next(()=>s)}ht(e,t){return Ss(e).put(function(r,s,o){let[l,c,h]=Dp(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Ys(r.ct,o.mutation)}}(this.serializer,this.userId,t))}};function Ss(i){return Ge(i,"documentOverlays")}var Ru=class{Pt(e){return Ge(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let n=t?.value;return n?Me.fromUint8Array(n):Me.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var dn=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Te(e.integerValue));else if("doubleValue"in e){let n=Te(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),zs(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),typeof n=="string"&&(n=fn(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(jn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?Ig(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Tl(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):j()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let n=e.fields||{};this.dt(t,55);for(let r of Object.keys(n))this.Vt(r,t),this.Tt(n[r],t)}wt(e,t){var n,r;let s=e.fields||{};this.dt(t,53);let o="value",l=((r=(n=s[o].arrayValue)===null||n===void 0?void 0:n.values)===null||r===void 0?void 0:r.length)||0;this.dt(t,15),t.At(Te(l)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let n=e.values||[];this.dt(t,50);for(let r of n)this.Tt(r,t)}yt(e,t){this.dt(t,37),U.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};dn.vt=new dn;function E1(i){if(i===0)return 8;let e=0;return!(i>>4)&&(e+=4,i<<=4),!(i>>6)&&(e+=2,i<<=2),!(i>>7)&&(e+=1),e}function Mp(i){let e=64-function(n){let r=0;for(let s=0;s<8;++s){let o=E1(255&n[s]);if(r+=o,o!==8)break}return r}(i);return Math.ceil(e/8)}var Du=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{let r=t.codePointAt(0);this.Ft(240|r>>>18),this.Ft(128|63&r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r)}}this.Mt()}Bt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{let r=t.codePointAt(0);this.Ot(240|r>>>18),this.Ot(128|63&r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r)}}this.Nt()}kt(e){let t=this.qt(e),n=Mp(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Kt(e){let t=this.qt(e),n=Mp(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}},ku=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},Vu=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},yi=class{constructor(){this.jt=new Du,this.Ht=new ku(this.jt),this.Jt=new Vu(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var vi=class i{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new i(this.indexId,this.documentKey,this.arrayValue,n)}};function Mn(i,e){let t=i.indexId-e.indexId;return t!==0?t:(t=Np(i.arrayValue,e.arrayValue),t!==0?t:(t=Np(i.directionalValue,e.directionalValue),t!==0?t:U.comparator(i.documentKey,e.documentKey)))}function Np(i,e){for(let t=0;t<i.length&&t<e.length;++t){let n=i[t]-e[t];if(n!==0)return n}return i.length-e.length}var qa=class{constructor(e){this.Xt=new ge((t,n)=>Ve.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(G(e.collectionGroup===this.collectionId),this.nn)return!1;let t=eu(e);if(t!==void 0&&!this.sn(t))return!1;let n=pi(e),r=new Set,s=0,o=0;for(;s<n.length&&this.sn(n[s]);++s)r=r.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Xt.size>0){let l=this.Xt.getIterator().getNext();if(!r.has(l.field.canonicalString())){let c=n[s];if(!this.on(l,c)||!this._n(this.en[o++],c))return!1}++s}for(;s<n.length;++s){let l=n[s];if(o>=this.en.length||!this._n(this.en[o++],l))return!1}return!0}an(){if(this.nn)return null;let e=new ge(Ve.comparator),t=[];for(let n of this.tn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new pr(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new pr(n.field,0))}for(let n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new pr(n.field,n.dir==="asc"?0:1)));return new vr(vr.UNKNOWN_ID,this.collectionId,t,Ls.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function o_(i){var e,t;if(G(i instanceof ie||i instanceof me),i instanceof ie){if(i instanceof ka){let r=((t=(e=i.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ie.create(i.field,"==",s)))||[];return me.create(r,"or")}return i}let n=i.filters.map(r=>o_(r));return me.create(n,i.op)}function b1(i){if(i.getFilters().length===0)return[];let e=Nu(o_(i));return G(a_(e)),Ou(e)||Mu(e)?[e]:e.getFilters()}function Ou(i){return i instanceof ie}function Mu(i){return i instanceof me&&Xh(i)}function a_(i){return Ou(i)||Mu(i)||function(t){if(t instanceof me&&lu(t)){for(let n of t.getFilters())if(!Ou(n)&&!Mu(n))return!1;return!0}return!1}(i)}function Nu(i){if(G(i instanceof ie||i instanceof me),i instanceof ie)return i;if(i.filters.length===1)return Nu(i.filters[0]);let e=i.filters.map(n=>Nu(n)),t=me.create(e,i.op);return t=ja(t),a_(t)?t:(G(t instanceof me),G(Ir(t)),G(t.filters.length>1),t.filters.reduce((n,r)=>id(n,r)))}function id(i,e){let t;return G(i instanceof ie||i instanceof me),G(e instanceof ie||e instanceof me),t=i instanceof ie?e instanceof ie?function(r,s){return me.create([r,s],"and")}(i,e):Fp(i,e):e instanceof ie?Fp(e,i):function(r,s){if(G(r.filters.length>0&&s.filters.length>0),Ir(r)&&Ir(s))return Ag(r,s.getFilters());let o=lu(r)?r:s,l=lu(r)?s:r,c=o.filters.map(h=>id(h,l));return me.create(c,"or")}(i,e),ja(t)}function Fp(i,e){if(Ir(e))return Ag(e,i.getFilters());{let t=e.filters.map(n=>id(i,n));return me.create(t,"or")}}function ja(i){if(G(i instanceof ie||i instanceof me),i instanceof ie)return i;let e=i.getFilters();if(e.length===1)return ja(e[0]);if(bg(i))return i;let t=e.map(r=>ja(r)),n=[];return t.forEach(r=>{r instanceof ie?n.push(r):r instanceof me&&(r.op===i.op?n.push(...r.filters):n.push(r))}),n.length===1?n[0]:me.create(n,i.op)}var Fu=class{constructor(){this.un=new Xs}addToCollectionParentIndex(e,t){return this.un.add(t),A.resolve()}getCollectionParents(e,t){return A.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return A.resolve()}deleteFieldIndex(e,t){return A.resolve()}deleteAllFieldIndexes(e){return A.resolve()}createTargetIndexes(e,t){return A.resolve()}getDocumentsMatchingTarget(e,t){return A.resolve(null)}getIndexType(e,t){return A.resolve(0)}getFieldIndexes(e,t){return A.resolve([])}getNextCollectionGroupToUpdate(e){return A.resolve(null)}getMinOffset(e,t){return A.resolve(Rt.min())}getMinOffsetFromCollectionGroup(e,t){return A.resolve(Rt.min())}updateCollectionGroup(e,t,n){return A.resolve()}updateIndexEntries(e,t){return A.resolve()}},Xs=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new ge(ae.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new ge(ae.comparator)).toArray()}};var pa=new Uint8Array(0),Lu=class{constructor(e,t){this.databaseId=t,this.cn=new Xs,this.ln=new Zt(n=>Ci(n),(n,r)=>oo(n,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let s={collectionId:n,parent:st(r)};return Lp(e).put(s)}return A.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[cg(t),""],!1,!0);return Lp(e).U(r).next(s=>{for(let o of s){if(o.collectionId!==t)break;n.push(Kt(o.parent))}return n})}addFieldIndex(e,t){let n=xs(e),r=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete r.indexId;let s=n.add(r);if(t.indexState){let o=ar(e);return s.next(l=>{o.put(kp(l,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let n=xs(e),r=ar(e),s=or(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=xs(e),n=or(e),r=ar(e);return t.j().next(()=>n.j()).next(()=>r.j())}createTargetIndexes(e,t){return A.forEach(this.hn(t),n=>this.getIndexType(e,n).next(r=>{if(r===0||r===1){let s=new qa(n).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let n=or(e),r=!0,s=new Map;return A.forEach(this.hn(t),o=>this.Pn(e,o).next(l=>{r&&(r=!!l),s.set(o,l)})).next(()=>{if(r){let o=te(),l=[];return A.forEach(s,(c,h)=>{V("IndexedDbIndexManager",`Using index ${function(z){return`id=${z.indexId}|cg=${z.collectionGroup}|f=${z.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`}(c)} to execute ${Ci(t)}`);let m=function(z,W){let Z=eu(W);if(Z===void 0)return null;for(let ee of Oa(z,Z.fieldPath))switch(ee.op){case"array-contains-any":return ee.value.arrayValue.values||[];case"array-contains":return[ee.value]}return null}(h,c),p=function(z,W){let Z=new Map;for(let ee of pi(W))for(let w of Oa(z,ee.fieldPath))switch(w.op){case"==":case"in":Z.set(ee.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return Z.set(ee.fieldPath.canonicalString(),w.value),Array.from(Z.values())}return null}(h,c),_=function(z,W){let Z=[],ee=!0;for(let w of pi(W)){let g=w.kind===0?_p(z,w.fieldPath,z.startAt):yp(z,w.fieldPath,z.startAt);Z.push(g.value),ee&&(ee=g.inclusive)}return new Jt(Z,ee)}(h,c),b=function(z,W){let Z=[],ee=!0;for(let w of pi(W)){let g=w.kind===0?yp(z,w.fieldPath,z.endAt):_p(z,w.fieldPath,z.endAt);Z.push(g.value),ee&&(ee=g.inclusive)}return new Jt(Z,ee)}(h,c),k=this.In(c,h,_),O=this.In(c,h,b),R=this.Tn(c,h,p),K=this.En(c.indexId,m,k,_.inclusive,O,b.inclusive,R);return A.forEach(K,Q=>n.G(Q,t.limit).next(z=>{z.forEach(W=>{let Z=U.fromSegments(W.documentKey);o.has(Z)||(o=o.add(Z),l.push(Z))})}))}).next(()=>l)}return A.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=b1(me.create(e.filters,"and")).map(n=>_u(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,r,s,o,l){let c=(t!=null?t.length:1)*Math.max(n.length,s.length),h=c/(t!=null?t.length:1),m=[];for(let p=0;p<c;++p){let _=t?this.dn(t[p/h]):pa,b=this.An(e,_,n[p%h],r),k=this.Rn(e,_,s[p%h],o),O=l.map(R=>this.An(e,_,R,!0));m.push(...this.createRange(b,k,O))}return m}An(e,t,n,r){let s=new vi(e,U.empty(),t,n);return r?s:s.Zt()}Rn(e,t,n,r){let s=new vi(e,U.empty(),t,n);return r?s.Zt():s}Pn(e,t){let n=new qa(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(s=>{let o=null;for(let l of s)n.rn(l)&&(!o||l.fields.length>o.fields.length)&&(o=l);return o})}getIndexType(e,t){let n=2,r=this.hn(t);return A.forEach(r,s=>this.Pn(e,s).next(o=>{o?n!==0&&o.fields.length<function(c){let h=new ge(Ve.comparator),m=!1;for(let p of c.filters)for(let _ of p.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?m=!0:h=h.add(_.field));for(let p of c.orderBy)p.field.isKeyField()||(h=h.add(p.field));return h.size+(m?1:0)}(s)&&(n=1):n=0})).next(()=>function(o){return o.limit!==null}(t)&&r.length>1&&n===2?1:n)}Vn(e,t){let n=new yi;for(let r of pi(e)){let s=t.data.field(r.fieldPath);if(s==null)return null;let o=n.Yt(r.kind);dn.vt.It(s,o)}return n.zt()}dn(e){let t=new yi;return dn.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let n=new yi;return dn.vt.It(Ei(this.databaseId,t),n.Yt(function(s){let o=pi(s);return o.length===0?0:o[o.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(n===null)return[];let r=[];r.push(new yi);let s=0;for(let o of pi(e)){let l=n[s++];for(let c of r)if(this.fn(t,o.fieldPath)&&js(l))r=this.gn(r,o,l);else{let h=c.Yt(o.kind);dn.vt.It(l,h)}}return this.pn(r)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){let r=[...e],s=[];for(let o of n.arrayValue.values||[])for(let l of r){let c=new yi;c.seed(l.zt()),dn.vt.It(o,c.Yt(t.kind)),s.push(c)}return s}fn(e,t){return!!e.filters.find(n=>n instanceof ie&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=xs(e),r=ar(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{let o=[];return A.forEach(s,l=>r.get([l.indexId,this.uid]).next(c=>{o.push(function(m,p){let _=p?new Ls(p.sequenceNumber,new Rt(xi(p.readTime),new U(Kt(p.documentKey)),p.largestBatchId)):Ls.empty(),b=m.fields.map(([k,O])=>new pr(Ve.fromServerFormat(k),O));return new vr(m.indexId,m.collectionGroup,b,_)}(l,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,r)=>{let s=n.indexState.sequenceNumber-r.indexState.sequenceNumber;return s!==0?s:J(n.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=xs(e),s=ar(e);return this.yn(e).next(o=>r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(l=>A.forEach(l,c=>s.put(kp(c.indexId,this.uid,o,n)))))}updateIndexEntries(e,t){let n=new Map;return A.forEach(t,(r,s)=>{let o=n.get(r.collectionGroup);return(o?A.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(l=>(n.set(r.collectionGroup,l),A.forEach(l,c=>this.wn(e,r,c).next(h=>{let m=this.Sn(s,c);return h.isEqual(m)?A.resolve():this.bn(e,s,c,h,m)}))))})}Dn(e,t,n,r){return or(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,r){return or(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){let r=or(e),s=new ge(Mn);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(o,l)=>{s=s.add(new vi(n.indexId,t,l.arrayValue,l.directionalValue))}).next(()=>s)}Sn(e,t){let n=new ge(Mn),r=this.Vn(t,e);if(r==null)return n;let s=eu(t);if(s!=null){let o=e.data.field(s.fieldPath);if(js(o))for(let l of o.arrayValue.values||[])n=n.add(new vi(t.indexId,e.key,this.dn(l),r))}else n=n.add(new vi(t.indexId,e.key,pa,r));return n}bn(e,t,n,r,s){V("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(c,h,m,p,_){let b=c.getIterator(),k=h.getIterator(),O=sr(b),R=sr(k);for(;O||R;){let K=!1,Q=!1;if(O&&R){let z=m(O,R);z<0?Q=!0:z>0&&(K=!0)}else O!=null?Q=!0:K=!0;K?(p(R),R=sr(k)):Q?(_(O),O=sr(b)):(O=sr(b),R=sr(k))}}(r,s,Mn,l=>{o.push(this.Dn(e,t,n,l))},l=>{o.push(this.vn(e,t,n,l))}),A.waitFor(o)}yn(e){let t=1;return ar(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,r,s)=>{s.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((o,l)=>Mn(o,l)).filter((o,l,c)=>!l||Mn(o,c[l-1])!==0);let r=[];r.push(e);for(let o of n){let l=Mn(o,e),c=Mn(o,t);if(l===0)r[0]=e.Zt();else if(l>0&&c<0)r.push(o),r.push(o.Zt());else if(c>0)break}r.push(t);let s=[];for(let o=0;o<r.length;o+=2){if(this.Cn(r[o],r[o+1]))return[];let l=[r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,pa,[]],c=[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,pa,[]];s.push(IDBKeyRange.bound(l,c))}return s}Cn(e,t){return Mn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(zp)}getMinOffset(e,t){return A.mapArray(this.hn(t),n=>this.Pn(e,n).next(r=>r||j())).next(zp)}};function Lp(i){return Ge(i,"collectionParents")}function or(i){return Ge(i,"indexEntries")}function xs(i){return Ge(i,"indexConfiguration")}function ar(i){return Ge(i,"indexState")}function zp(i){G(i.length!==0);let e=i[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<i.length;n++){let r=i[n].indexState.offset;Hh(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new Rt(e.readTime,e.documentKey,t)}var Bp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Pt=class i{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new i(e,i.DEFAULT_COLLECTION_PERCENTILE,i.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function l_(i,e,t){let n=i.store("mutations"),r=i.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),l=0,c=n.J({range:o},(m,p,_)=>(l++,_.delete()));s.push(c.next(()=>{G(l===1)}));let h=[];for(let m of t.mutations){let p=pg(e,m.key.path,t.batchId);s.push(r.delete(p)),h.push(m.key)}return A.waitFor(s).next(()=>h)}function Ga(i){if(!i)return 0;let e;if(i.document)e=i.document;else if(i.unknownDocument)e=i.unknownDocument;else{if(!i.noDocument)throw j();e=i.noDocument}return JSON.stringify(e).length}Pt.DEFAULT_COLLECTION_PERCENTILE=10,Pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pt.DEFAULT=new Pt(41943040,Pt.DEFAULT_COLLECTION_PERCENTILE,Pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pt.DISABLED=new Pt(-1,0,0);var $a=class i{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Fn={}}static lt(e,t,n,r){G(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new i(s,t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Nn(e).J({index:"userMutationsIndex",range:n},(r,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let s=mr(e),o=Nn(e);return o.add({}).next(l=>{G(typeof l=="number");let c=new $s(l,t,n,r),h=function(b,k,O){let R=O.baseMutations.map(Q=>Ys(b.ct,Q)),K=O.mutations.map(Q=>Ys(b.ct,Q));return{userId:k,batchId:O.batchId,localWriteTimeMs:O.localWriteTime.toMillis(),baseMutations:R,mutations:K}}(this.serializer,this.userId,c),m=[],p=new ge((_,b)=>J(_.canonicalString(),b.canonicalString()));for(let _ of r){let b=pg(this.userId,_.key.path,l);p=p.add(_.key.path.popLast()),m.push(o.put(h)),m.push(s.put(b,Rv))}return p.forEach(_=>{m.push(this.indexManager.addToCollectionParentIndex(e,_))}),e.addOnCommittedListener(()=>{this.Fn[l]=c.keys()}),A.waitFor(m).next(()=>c)})}lookupMutationBatch(e,t){return Nn(e).get(t).next(n=>n?(G(n.userId===this.userId),_i(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?A.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let r=n.keys();return this.Fn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),s=null;return Nn(e).J({index:"userMutationsIndex",range:r},(o,l,c)=>{l.userId===this.userId&&(G(l.batchId>=n),s=_i(this.serializer,l)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Nn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(r,s,o)=>{n=s.batchId,o.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Nn(e).U("userMutationsIndex",t).next(n=>n.map(r=>_i(this.serializer,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=va(this.userId,t.path),r=IDBKeyRange.lowerBound(n),s=[];return mr(e).J({range:r},(o,l,c)=>{let[h,m,p]=o,_=Kt(m);if(h===this.userId&&t.path.isEqual(_))return Nn(e).get(p).next(b=>{if(!b)throw j();G(b.userId===this.userId),s.push(_i(this.serializer,b))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ge(J),r=[];return t.forEach(s=>{let o=va(this.userId,s.path),l=IDBKeyRange.lowerBound(o),c=mr(e).J({range:l},(h,m,p)=>{let[_,b,k]=h,O=Kt(b);_===this.userId&&s.path.isEqual(O)?n=n.add(k):p.done()});r.push(c)}),A.waitFor(r).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,s=va(this.userId,n),o=IDBKeyRange.lowerBound(s),l=new ge(J);return mr(e).J({range:o},(c,h,m)=>{let[p,_,b]=c,k=Kt(_);p===this.userId&&n.isPrefixOf(k)?k.length===r&&(l=l.add(b)):m.done()}).next(()=>this.xn(e,l))}xn(e,t){let n=[],r=[];return t.forEach(s=>{r.push(Nn(e).get(s).next(o=>{if(o===null)throw j();G(o.userId===this.userId),n.push(_i(this.serializer,o))}))}),A.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return l_(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),A.forEach(n,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return A.resolve();let n=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),r=[];return mr(e).J({range:n},(s,o,l)=>{if(s[0]===this.userId){let c=Kt(s[1]);r.push(c)}else l.done()}).next(()=>{G(r.length===0)})})}containsKey(e,t){return c_(e,this.userId,t)}Nn(e){return u_(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function c_(i,e,t){let n=va(e,t.path),r=n[1],s=IDBKeyRange.lowerBound(n),o=!1;return mr(i).J({range:s,H:!0},(l,c,h)=>{let[m,p,_]=l;m===e&&p===r&&(o=!0),h.done()}).next(()=>o)}function Nn(i){return Ge(i,"mutations")}function mr(i){return Ge(i,"documentMutations")}function u_(i){return Ge(i,"mutationQueues")}var Ar=class i{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new i(0)}static kn(){return new i(-1)}};var zu=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let n=new Ar(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>$.fromTimestamp(new Ce(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Qn(e,r)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>lr(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(G(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let r=0,s=[];return lr(e).J((o,l)=>{let c=ks(l);c.sequenceNumber<=t&&n.get(c.targetId)===null&&(r++,s.push(this.removeTargetData(e,c)))}).next(()=>A.waitFor(s)).next(()=>r)}forEachTarget(e,t){return lr(e).J((n,r)=>{let s=ks(r);t(s)})}qn(e){return Up(e).get("targetGlobalKey").next(t=>(G(t!==null),t))}Qn(e,t){return Up(e).put("targetGlobalKey",t)}Kn(e,t){return lr(e).put(s_(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let n=Ci(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return lr(e).J({range:r,index:"queryTargetsIndex"},(o,l,c)=>{let h=ks(l);oo(t,h.target)&&(s=h,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){let r=[],s=Fn(e);return t.forEach(o=>{let l=st(o.path);r.push(s.put({targetId:n,path:l})),r.push(this.referenceDelegate.addReference(e,n,o))}),A.waitFor(r)}removeMatchingKeys(e,t,n){let r=Fn(e);return A.forEach(t,s=>{let o=st(s.path);return A.waitFor([r.delete([n,o]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){let n=Fn(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Fn(e),s=te();return r.J({range:n,H:!0},(o,l,c)=>{let h=Kt(o[1]),m=new U(h);s=s.add(m)}).next(()=>s)}containsKey(e,t){let n=st(t.path),r=IDBKeyRange.bound([n],[cg(n)],!1,!0),s=0;return Fn(e).J({index:"documentTargetsIndex",H:!0,range:r},([o,l],c,h)=>{o!==0&&(s++,h.done())}).next(()=>s>0)}ot(e,t){return lr(e).get(t).next(n=>n?ks(n):null)}};function lr(i){return Ge(i,"targets")}function Up(i){return Ge(i,"targetGlobal")}function Fn(i){return Ge(i,"targetDocuments")}function qp([i,e],[t,n]){let r=J(i,t);return r===0?J(e,n):r}var Bu=class{constructor(e){this.Un=e,this.buffer=new ge(qp),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();qp(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},Uu=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){V("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>P(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Jn(t)?V("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield Xn(t)}yield this.Hn(3e5)}))}},qu=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return A.resolve(wt.oe);let n=new Bu(t);return this.Jn.forEachTarget(e,r=>n.zn(r.sequenceNumber)).next(()=>this.Jn.Zn(e,r=>n.zn(r))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),A.resolve(Bp)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Bp):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,r,s,o,l,c,h,m=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),r=this.params.maximumSequenceNumbersToCollect):r=p,o=Date.now(),this.nthSequenceNumber(e,r))).next(p=>(n=p,l=Date.now(),this.removeTargets(e,n,t))).next(p=>(s=p,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(p=>(h=Date.now(),cr()<=$t.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-m}ms
	Determined least recently used ${r} in `+(l-o)+`ms
	Removed ${s} targets in `+(c-l)+`ms
	Removed ${p} documents in `+(h-c)+`ms
Total Duration: ${h-m}ms`),A.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:p})))}};function C1(i,e){return new qu(i,e)}var ju=class{constructor(e,t){this.db=e,this.garbageCollector=C1(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(r=>n+r))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,r)=>t(r))}addReference(e,t,n){return ga(e,n)}removeReference(e,t,n){return ga(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return ga(e,t)}nr(e,t){return function(r,s){let o=!1;return u_(r).Y(l=>c_(r,l,s).next(c=>(c&&(o=!0),A.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],s=0;return this.tr(e,(o,l)=>{if(l<=t){let c=this.nr(e,o).next(h=>{if(!h)return s++,n.getEntry(e,o).next(()=>(n.removeEntry(o,$.min()),Fn(e).delete(function(p){return[0,st(p.path)]}(o))))});r.push(c)}}).next(()=>A.waitFor(r)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return ga(e,t)}tr(e,t){let n=Fn(e),r,s=wt.oe;return n.J({index:"documentTargetsIndex"},([o,l],{path:c,sequenceNumber:h})=>{o===0?(s!==wt.oe&&t(new U(Kt(r)),s),s=h,r=c):s=wt.oe}).next(()=>{s!==wt.oe&&t(new U(Kt(r)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function ga(i,e){return Fn(i).put(function(n,r){return{targetId:0,path:st(n.path),sequenceNumber:r}}(e,i.currentSequenceNumber))}var Ka=class{constructor(){this.changes=new Zt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ze.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?A.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Gu=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return fi(e).put(n)}removeEntry(e,t,n){return fi(e).delete(function(s,o){let l=s.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],Ba(o),l[l.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=ze.newInvalidDocument(t);return fi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ps(t))},(r,s)=>{n=this.ir(t,s)}).next(()=>n)}sr(e,t){let n={size:0,document:ze.newInvalidDocument(t)};return fi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ps(t))},(r,s)=>{n={document:this.ir(t,s),size:Ga(s)}}).next(()=>n)}getEntries(e,t){let n=gt();return this._r(e,t,(r,s)=>{let o=this.ir(r,s);n=n.insert(r,o)}).next(()=>n)}ar(e,t){let n=gt(),r=new Ie(U.comparator);return this._r(e,t,(s,o)=>{let l=this.ir(s,o);n=n.insert(s,l),r=r.insert(s,Ga(o))}).next(()=>({documents:n,ur:r}))}_r(e,t,n){if(t.isEmpty())return A.resolve();let r=new ge($p);t.forEach(c=>r=r.add(c));let s=IDBKeyRange.bound(Ps(r.first()),Ps(r.last())),o=r.getIterator(),l=o.getNext();return fi(e).J({index:"documentKeyIndex",range:s},(c,h,m)=>{let p=U.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;l&&$p(l,p)<0;)n(l,null),l=o.getNext();l&&l.isEqual(p)&&(n(l,h),l=o.hasNext()?o.getNext():null),l?m.$(Ps(l)):m.done()}).next(()=>{for(;l;)n(l,null),l=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,s){let o=t.path,l=[o.popLast().toArray(),o.lastSegment(),Ba(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return fi(e).U(IDBKeyRange.bound(l,c,!0)).next(h=>{s?.incrementDocumentReadCount(h.length);let m=gt();for(let p of h){let _=this.ir(U.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);_.isFoundDocument()&&(lo(t,_)||r.has(_.key))&&(m=m.insert(_.key,_))}return m})}getAllFromCollectionGroup(e,t,n,r){let s=gt(),o=Gp(t,n),l=Gp(t,Rt.max());return fi(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,l,!0)},(c,h,m)=>{let p=this.ir(U.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(p.key,p),s.size===r&&m.done()}).next(()=>s)}newChangeBuffer(e){return new $u(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return jp(e).get("remoteDocumentGlobalKey").next(t=>(G(!!t),t))}rr(e,t){return jp(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let n=T1(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual($.min())))return n}return ze.newInvalidDocument(e)}};function h_(i){return new Gu(i)}var $u=class extends Ka{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Zt(n=>n.toString(),(n,r)=>n.isEqual(r))}applyChanges(e){let t=[],n=0,r=new ge((s,o)=>J(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let l=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,l.readTime)),o.isValidDocument()){let c=Rp(this.cr.serializer,o);r=r.add(s.path.popLast());let h=Ga(c);n+=h-l.size,t.push(this.cr.addEntry(e,s,c))}else if(n-=l.size,this.trackRemovals){let c=Rp(this.cr.serializer,o.convertToNoDocument($.min()));t.push(this.cr.addEntry(e,s,c))}}),r.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,n)),A.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:r})=>(r.forEach((s,o)=>{this.lr.set(s,{size:o,readTime:n.get(s).readTime})}),n))}};function jp(i){return Ge(i,"remoteDocumentGlobal")}function fi(i){return Ge(i,"remoteDocumentsV14")}function Ps(i){let e=i.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Gp(i,e){let t=e.documentKey.path.toArray();return[i,Ba(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function $p(i,e){let t=i.path.toArray(),n=e.path.toArray(),r=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(r=J(t[s],n[s]),r)return r;return r=J(t.length,n.length),r||(r=J(t[t.length-2],n[n.length-2]),r||J(t[t.length-1],n[n.length-1]))}var Ku=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Ha=class{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(n!==null&&Ms(n.mutation,r,It.empty(),Ce.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,te()).next(()=>n))}getLocalViewOfDocuments(e,t,n=te()){let r=Ht();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(s=>{let o=Ds();return s.forEach((l,c)=>{o=o.insert(l,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let n=Ht();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,te()))}populateOverlays(e,t,n){let r=[];return n.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((o,l)=>{t.set(o,l)})})}computeViews(e,t,n,r){let s=gt(),o=Os(),l=function(){return Os()}();return t.forEach((c,h)=>{let m=n.get(h.key);r.has(h.key)&&(m===void 0||m.mutation instanceof zt)?s=s.insert(h.key,h):m!==void 0?(o.set(h.key,m.mutation.getFieldMask()),Ms(m.mutation,h,m.mutation.getFieldMask(),Ce.now())):o.set(h.key,It.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((h,m)=>o.set(h,m)),t.forEach((h,m)=>{var p;return l.set(h,new Ku(m,(p=o.get(h))!==null&&p!==void 0?p:null))}),l))}recalculateAndSaveOverlays(e,t){let n=Os(),r=new Ie((o,l)=>o-l),s=te();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let l of o)l.keys().forEach(c=>{let h=t.get(c);if(h===null)return;let m=n.get(c)||It.empty();m=l.applyToLocalView(h,m),n.set(c,m);let p=(r.get(l.batchId)||te()).add(c);r=r.insert(l.batchId,p)})}).next(()=>{let o=[],l=r.getReverseIterator();for(;l.hasNext();){let c=l.getNext(),h=c.key,m=c.value,p=Mg();m.forEach(_=>{if(!s.has(_)){let b=qg(t.get(_),n.get(_));b!==null&&p.set(_,b),s=s.add(_)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,p))}return A.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,r){return function(o){return U.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Jh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(s=>{let o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-s.size):A.resolve(Ht()),l=-1,c=s;return o.next(h=>A.forEach(h,(m,p)=>(l<p.largestBatchId&&(l=p.largestBatchId),s.get(m)?A.resolve():this.remoteDocumentCache.getEntry(e,m).next(_=>{c=c.insert(m,_)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,c,h,te())).next(m=>({batchId:l,changes:Og(m)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next(n=>{let r=Ds();return n.isFoundDocument()&&(r=r.insert(n.key,n)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let s=t.collectionGroup,o=Ds();return this.indexManager.getCollectionParents(e,s).next(l=>A.forEach(l,c=>{let h=function(p,_){return new Lt(_,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,n,r).next(m=>{m.forEach((p,_)=>{o=o.insert(p,_)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,r))).next(o=>{s.forEach((c,h)=>{let m=h.getKey();o.get(m)===null&&(o=o.insert(m,ze.newInvalidDocument(m)))});let l=Ds();return o.forEach((c,h)=>{let m=s.get(c);m!==void 0&&Ms(m.mutation,h,It.empty(),Ce.now()),lo(t,h)&&(l=l.insert(c,h))}),l})}};var Hu=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return A.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:Oe(r.createTime)}}(t)),A.resolve()}getNamedQuery(e,t){return A.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(r){return{name:r.name,query:nd(r.bundledQuery),readTime:Oe(r.readTime)}}(t)),A.resolve()}};var Qu=class{constructor(){this.overlays=new Ie(U.comparator),this.Ir=new Map}getOverlay(e,t){return A.resolve(this.overlays.get(t))}getOverlays(e,t){let n=Ht();return A.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&n.set(r,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((r,s)=>{this.ht(e,t,s)}),A.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.Ir.get(n);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(n)),A.resolve()}getOverlaysForCollection(e,t,n){let r=Ht(),s=t.length+1,o=new U(t.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){let c=l.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>n&&r.set(c.getKey(),c)}return A.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let s=new Ie((h,m)=>h-m),o=this.overlays.getIterator();for(;o.hasNext();){let h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let m=s.get(h.largestBatchId);m===null&&(m=Ht(),s=s.insert(h.largestBatchId,m)),m.set(h.getKey(),h)}}let l=Ht(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,m)=>l.set(h,m)),!(l.size()>=r)););return A.resolve(l)}ht(e,t,n){let r=this.overlays.get(n.key);if(r!==null){let o=this.Ir.get(r.largestBatchId).delete(n.key);this.Ir.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new Ks(t,n));let s=this.Ir.get(t);s===void 0&&(s=te(),this.Ir.set(t,s)),this.Ir.set(t,s.add(n.key))}};var Wu=class{constructor(){this.sessionToken=Me.EMPTY_BYTE_STRING}getSessionToken(e){return A.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,A.resolve()}};var Js=class{constructor(){this.Tr=new ge(Fe.Er),this.dr=new ge(Fe.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let n=new Fe(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Fe(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){let t=new U(new ae([])),n=new Fe(t,e),r=new Fe(t,e+1),s=[];return this.dr.forEachInRange([n,r],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new U(new ae([])),n=new Fe(t,e),r=new Fe(t,e+1),s=te();return this.dr.forEachInRange([n,r],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Fe(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},Fe=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return U.comparator(e.key,t.key)||J(e.wr,t.wr)}static Ar(e,t){return J(e.wr,t.wr)||U.comparator(e.key,t.key)}};var Yu=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new ge(Fe.Er)}checkEmpty(e){return A.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,r){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new $s(s,t,n,r);this.mutationQueue.push(o);for(let l of r)this.br=this.br.add(new Fe(l.key,s)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return A.resolve(o)}lookupMutationBatch(e,t){return A.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=this.vr(n),s=r<0?0:r;return A.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return A.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return A.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new Fe(t,0),r=new Fe(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([n,r],o=>{let l=this.Dr(o.wr);s.push(l)}),A.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ge(J);return t.forEach(r=>{let s=new Fe(r,0),o=new Fe(r,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],l=>{n=n.add(l.wr)})}),A.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,s=n;U.isDocumentKey(s)||(s=s.child(""));let o=new Fe(new U(s),0),l=new ge(J);return this.br.forEachWhile(c=>{let h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===r&&(l=l.add(c.wr)),!0)},o),A.resolve(this.Cr(l))}Cr(e){let t=[];return e.forEach(n=>{let r=this.Dr(n);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){G(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return A.forEach(t.mutations,r=>{let s=new Fe(r.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){let n=new Fe(t,0),r=this.br.firstAfterOrEqual(n);return A.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,A.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Xu=class{constructor(e){this.Mr=e,this.docs=function(){return new Ie(U.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),s=r?r.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return A.resolve(n?n.document.mutableCopy():ze.newInvalidDocument(t))}getEntries(e,t){let n=gt();return t.forEach(r=>{let s=this.docs.get(r);n=n.insert(r,s?s.document.mutableCopy():ze.newInvalidDocument(r))}),A.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let s=gt(),o=t.path,l=new U(o.child("")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){let{key:h,value:{document:m}}=c.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Hh(hg(m),n)<=0||(r.has(m.key)||lo(t,m))&&(s=s.insert(m.key,m.mutableCopy()))}return A.resolve(s)}getAllFromCollectionGroup(e,t,n,r){j()}Or(e,t){return A.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Ju(this)}getSize(e){return A.resolve(this.size)}},Ju=class extends Ka{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(n)}),A.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var Zu=class{constructor(e){this.persistence=e,this.Nr=new Zt(t=>Ci(t),oo),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Js,this.targetCount=0,this.kr=Ar.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,r)=>t(r)),A.resolve()}getLastRemoteSnapshotVersion(e){return A.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return A.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),A.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),A.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new Ar(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,A.resolve()}updateTargetData(e,t){return this.Kn(t),A.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,A.resolve()}removeTargets(e,t,n){let r=0,s=[];return this.Nr.forEach((o,l)=>{l.sequenceNumber<=t&&n.get(l.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,l.targetId)),r++)}),A.waitFor(s).next(()=>r)}getTargetCount(e){return A.resolve(this.targetCount)}getTargetData(e,t){let n=this.Nr.get(t)||null;return A.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),A.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);let r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),A.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),A.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Br.yr(t);return A.resolve(n)}containsKey(e,t){return A.resolve(this.Br.containsKey(t))}};var Qa=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new wt(0),this.Kr=!1,this.Kr=!0,this.$r=new Wu,this.referenceDelegate=e(this),this.Ur=new Zu(this),this.indexManager=new Fu,this.remoteDocumentCache=function(r){return new Xu(r)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new za(t),this.Gr=new Hu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Qu,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Yu(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){V("MemoryPersistence","Starting transaction:",e);let r=new eh(this.Qr.next());return this.referenceDelegate.zr(),n(r).next(s=>this.referenceDelegate.jr(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Hr(e,t){return A.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}},eh=class extends Sa{constructor(e){super(),this.currentSequenceNumber=e}},Wa=class i{constructor(e){this.persistence=e,this.Jr=new Js,this.Yr=null}static Zr(e){return new i(e)}get Xr(){if(this.Yr)return this.Yr;throw j()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),A.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),A.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),A.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(r=>this.Xr.add(r.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.Xr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return A.forEach(this.Xr,n=>{let r=U.fromPath(n);return this.ei(e,r).next(s=>{s||t.removeEntry(r,$.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return A.or([()=>A.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var th=class{constructor(e){this.serializer=e}O(e,t,n,r){let s=new xa("createOrUpgrade",t);n<1&&r>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ap,{unique:!0}),c.createObjectStore("documentMutations")}(e),Kp(e),function(c){c.createObjectStore("remoteDocuments")}(e));let o=A.resolve();return n<3&&r>=3&&(n!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),Kp(e)),o=o.next(()=>function(c){let h=c.store("targetGlobal"),m={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:$.min().toTimestamp(),targetCount:0};return h.put("targetGlobalKey",m)}(s))),n<4&&r>=4&&(n!==0&&(o=o.next(()=>function(c,h){return h.store("mutations").U().next(m=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ap,{unique:!0});let p=h.store("mutations"),_=m.map(b=>p.put(b));return A.waitFor(_)})}(e,s))),o=o.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),n<5&&r>=5&&(o=o.next(()=>this.ni(s))),n<6&&r>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),n<7&&r>=7&&(o=o.next(()=>this.ii(s))),n<8&&r>=8&&(o=o.next(()=>this.si(e,s))),n<9&&r>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&r>=10&&(o=o.next(()=>this.oi(s))),n<11&&r>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&r>=12&&(o=o.next(()=>{(function(c){let h=c.createObjectStore("documentOverlays",{keyPath:qv});h.createIndex("collectionPathOverlayIndex",jv,{unique:!1}),h.createIndex("collectionGroupOverlayIndex",Gv,{unique:!1})})(e)})),n<13&&r>=13&&(o=o.next(()=>function(c){let h=c.createObjectStore("remoteDocumentsV14",{keyPath:Dv});h.createIndex("documentKeyIndex",kv),h.createIndex("collectionGroupIndex",Vv)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&r>=14&&(o=o.next(()=>this.ai(e,s))),n<15&&r>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:Lv}).createIndex("sequenceNumberIndex",zv,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:Bv}).createIndex("documentKeyIndex",Uv,{unique:!1})}(e))),n<16&&r>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&r>=17&&(o=o.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((n,r)=>{t+=Ga(r)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(r=>A.forEach(r,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",o).next(l=>A.forEach(l,c=>{G(c.userId===s.userId);let h=_i(this.serializer,c);return l_(e,s.userId,h).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(r=>{let s=[];return n.J((o,l)=>{let c=new ae(o),h=function(p){return[0,st(p)]}(c);s.push(t.get(h).next(m=>m?A.resolve():(p=>t.put({targetId:0,path:st(p),sequenceNumber:r.highestListenSequenceNumber}))(c)))}).next(()=>A.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:Fv});let n=t.store("collectionParents"),r=new Xs,s=o=>{if(r.add(o)){let l=o.lastSegment(),c=o.popLast();return n.put({collectionId:l,parent:st(c)})}};return t.store("remoteDocuments").J({H:!0},(o,l)=>{let c=new ae(o);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,l,c],h)=>{let m=Kt(l);return s(m.popLast())}))}oi(e){let t=e.store("targets");return t.J((n,r)=>{let s=ks(r),o=s_(this.serializer,s);return t.put(o)})}_i(e,t){let n=t.store("remoteDocuments"),r=[];return n.J((s,o)=>{let l=t.store("remoteDocumentsV14"),c=function(p){return p.document?new U(ae.fromString(p.document.name).popFirst(5)):p.noDocument?U.fromSegments(p.noDocument.path):p.unknownDocument?U.fromSegments(p.unknownDocument.path):j()}(o).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(l.put(h))}).next(()=>A.waitFor(r))}ai(e,t){let n=t.store("mutations"),r=h_(this.serializer),s=new Qa(Wa.Zr,this.serializer.ct);return n.U().next(o=>{let l=new Map;return o.forEach(c=>{var h;let m=(h=l.get(c.userId))!==null&&h!==void 0?h:te();_i(this.serializer,c).keys().forEach(p=>m=m.add(p)),l.set(c.userId,m)}),A.forEach(l,(c,h)=>{let m=new Le(h),p=Ua.lt(this.serializer,m),_=s.getIndexManager(m),b=$a.lt(m,this.serializer,_,s.referenceDelegate);return new Ha(r,b,p,_).recalculateAndSaveOverlaysForDocumentKeys(new Bs(t,wt.oe),c).next()})})}};function Kp(i){i.createObjectStore("targetDocuments",{keyPath:Mv}).createIndex("documentTargetsIndex",Nv,{unique:!0}),i.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Ov,{unique:!0}),i.createObjectStore("targetGlobal")}var jc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",nh=class i{constructor(e,t,n,r,s,o,l,c,h,m,p=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=s,this.window=o,this.document=l,this.ci=h,this.li=m,this.hi=p,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=_=>Promise.resolve(),!i.D())throw new D(x.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ju(this,r),this.Ai=t+"main",this.serializer=new za(c),this.Ri=new qn(this.Ai,this.hi,new th(this.serializer)),this.$r=new Ru,this.Ur=new zu(this.referenceDelegate,this.serializer),this.remoteDocumentCache=h_(this.serializer),this.Gr=new Pu,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,m===!1&&ke("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(x.FAILED_PRECONDITION,jc);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new wt(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>P(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>P(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>P(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>_a(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Jn(e))return V("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return V("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Rs(e).get("owner").next(t=>A.resolve(this.vi(t)))}Ci(e){return _a(e).delete(this.clientId)}Fi(){return P(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=Ge(t,"clientMetadata");return n.U().next(r=>{let s=this.xi(r,18e5),o=r.filter(l=>s.indexOf(l)===-1);return A.forEach(o,l=>n.delete(l.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?A.resolve(!0):Rs(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new D(x.FAILED_PRECONDITION,jc);return!1}}return!(!this.networkEnabled||!this.inForeground)||_a(e).U().next(n=>this.xi(n,5e3).find(r=>{if(this.clientId!==r.clientId){let s=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,l=this.networkEnabled===r.networkEnabled;if(s||o&&l)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&V("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return P(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new Bs(e,wt.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>_a(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return $a.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Lu(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Ua.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){V("IndexedDbPersistence","Starting transaction:",e);let r=t==="readonly"?"readonly":"readwrite",s=function(c){return c===17?Hv:c===16?Kv:c===15?Wh:c===14?yg:c===13?_g:c===12?$v:c===11?gg:void j()}(this.hi),o;return this.Ri.runTransaction(e,r,s,l=>(o=new Bs(l,this.Qr?this.Qr.next():wt.oe),t==="readwrite-primary"?this.wi(o).next(c=>!!c||this.Si(o)).next(c=>{if(!c)throw ke(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new D(x.FAILED_PRECONDITION,dg);return n(o)}).next(c=>this.Di(o).next(()=>c)):this.Ki(o).next(()=>n(o)))).then(l=>(o.raiseOnCommittedEvent(),l))}Ki(e){return Rs(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(x.FAILED_PRECONDITION,jc)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Rs(e).put("owner",t)}static D(){return qn.D()}bi(e){let t=Rs(e);return t.get("owner").next(n=>this.vi(n)?(V("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):A.resolve())}Mi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(ke(`Detected an update time that is in the future: ${e} > ${n}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;vc()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let n=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return V("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ke("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){ke("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Rs(i){return Ge(i,"owner")}function _a(i){return Ge(i,"clientMetadata")}function rd(i,e){let t=i.projectId;return i.isDefaultDatabase||(t+="."+i.database),"firestore/"+e+"/"+t+"/"}var ih=class i{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=r}static Wi(e,t){let n=te(),r=te();for(let s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new i(e,t.fromCache,n,r)}};var rh=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Ya=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return vc()?8:mg(vs())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,r){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,r,n).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new rh;return this.Xi(e,t,o).next(l=>{if(s.result=l,this.zi)return this.es(e,t,o,l.size)})}).next(()=>s.result)}es(e,t,n,r){return n.documentReadCount<this.ji?(cr()<=$t.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",ur(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),A.resolve()):(cr()<=$t.DEBUG&&V("QueryEngine","Query:",ur(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Hi*r?(cr()<=$t.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",ur(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ot(t))):A.resolve())}Yi(e,t){if(vp(t))return A.resolve(null);let n=ot(t);return this.indexManager.getIndexType(e,n).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=Ma(t,null,"F"),n=ot(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{let o=te(...s);return this.Ji.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,n).next(c=>{let h=this.ts(t,l);return this.ns(t,h,o,c.readTime)?this.Yi(e,Ma(t,null,"F")):this.rs(e,h,t,c)}))})))}Zi(e,t,n,r){return vp(t)||r.isEqual($.min())?A.resolve(null):this.Ji.getDocuments(e,n).next(s=>{let o=this.ts(t,s);return this.ns(t,o,n,r)?A.resolve(null):(cr()<=$t.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ur(t)),this.rs(e,o,t,ug(r,-1)).next(l=>l))})}ts(e,t){let n=new ge(kg(e));return t.forEach((r,s)=>{lo(e,s)&&(n=n.add(s))}),n}ns(e,t,n,r){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Xi(e,t,n){return cr()<=$t.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",ur(t)),this.Ji.getDocumentsMatchingQuery(e,t,Rt.min(),n)}rs(e,t,n,r){return this.Ji.getDocumentsMatchingQuery(e,n,r).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var sh=class{constructor(e,t,n,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new Ie(J),this._s=new Zt(s=>Ci(s),oo),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ha(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function d_(i,e,t,n){return new sh(i,e,t,n)}function m_(i,e){return P(this,null,function*(){let t=B(i);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let r;return t.mutationQueue.getAllMutationBatches(n).next(s=>(r=s,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{let o=[],l=[],c=te();for(let h of r){o.push(h.batchId);for(let m of h.mutations)c=c.add(m.key)}for(let h of s){l.push(h.batchId);for(let m of h.mutations)c=c.add(m.key)}return t.localDocuments.getDocuments(n,c).next(h=>({hs:h,removedBatchIds:o,addedBatchIds:l}))})})})}function A1(i,e){let t=B(i);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let r=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(l,c,h,m){let p=h.batch,_=p.keys(),b=A.resolve();return _.forEach(k=>{b=b.next(()=>m.getEntry(c,k)).next(O=>{let R=h.docVersions.get(k);G(R!==null),O.version.compareTo(R)<0&&(p.applyToRemoteDocument(O,h),O.isValidDocument()&&(O.setReadTime(h.commitVersion),m.addEntry(O)))})}),b.next(()=>l.mutationQueue.removeMutationBatch(c,p))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(l){let c=te();for(let h=0;h<l.mutationResults.length;++h)l.mutationResults[h].transformResults.length>0&&(c=c.add(l.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,r))})}function f_(i){let e=B(i);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function S1(i,e){let t=B(i),n=e.snapshotVersion,r=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});r=t.os;let l=[];e.targetChanges.forEach((m,p)=>{let _=r.get(p);if(!_)return;l.push(t.Ur.removeMatchingKeys(s,m.removedDocuments,p).next(()=>t.Ur.addMatchingKeys(s,m.addedDocuments,p)));let b=_.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?b=b.withResumeToken(Me.EMPTY_BYTE_STRING,$.min()).withLastLimboFreeSnapshotVersion($.min()):m.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(m.resumeToken,n)),r=r.insert(p,b),function(O,R,K){return O.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-O.snapshotVersion.toMicroseconds()>=3e8?!0:K.addedDocuments.size+K.modifiedDocuments.size+K.removedDocuments.size>0}(_,b,m)&&l.push(t.Ur.updateTargetData(s,b))});let c=gt(),h=te();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(s,m))}),l.push(p_(s,o,e.documentUpdates).next(m=>{c=m.Ps,h=m.Is})),!n.isEqual($.min())){let m=t.Ur.getLastRemoteSnapshotVersion(s).next(p=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,n));l.push(m)}return A.waitFor(l).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,h)).next(()=>c)}).then(s=>(t.os=r,s))}function p_(i,e,t){let n=te(),r=te();return t.forEach(s=>n=n.add(s)),e.getEntries(i,n).next(s=>{let o=gt();return t.forEach((l,c)=>{let h=s.get(l);c.isFoundDocument()!==h.isFoundDocument()&&(r=r.add(l)),c.isNoDocument()&&c.version.isEqual($.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):V("LocalStore","Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",c.version)}),{Ps:o,Is:r}})}function x1(i,e){let t=B(i);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Sr(i,e){let t=B(i);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return t.Ur.getTargetData(n,e).next(s=>s?(r=s,A.resolve(r)):t.Ur.allocateTargetId(n).next(o=>(r=new Cr(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=t.os.get(n.targetId);return(r===null||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}function xr(i,e,t){return P(this,null,function*(){let n=B(i),r=n.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,o=>n.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!Jn(o))throw o;V("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(r.target)})}function Xa(i,e,t){let n=B(i),r=$.min(),s=te();return n.persistence.runTransaction("Execute query","readwrite",o=>function(c,h,m){let p=B(c),_=p._s.get(m);return _!==void 0?A.resolve(p.os.get(_)):p.Ur.getTargetData(h,m)}(n,o,ot(e)).next(l=>{if(l)return r=l.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,l.targetId).next(c=>{s=c})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?r:$.min(),t?s:te())).next(l=>(y_(n,Dg(e),l),{documents:l,Ts:s})))}function g_(i,e){let t=B(i),n=B(t.Ur),r=t.os.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(o=>o?o.target:null))}function __(i,e){let t=B(i),n=t.us.get(e)||$.min();return t.persistence.runTransaction("Get new document changes","readonly",r=>t.cs.getAllFromCollectionGroup(r,e,ug(n,-1),Number.MAX_SAFE_INTEGER)).then(r=>(y_(t,e,r),r))}function y_(i,e,t){let n=i.us.get(e)||$.min();t.forEach((r,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),i.us.set(e,n)}function P1(i,e,t,n){return P(this,null,function*(){let r=B(i),s=te(),o=gt();for(let h of t){let m=e.Es(h.metadata.name);h.document&&(s=s.add(m));let p=e.ds(h);p.setReadTime(e.As(h.metadata.readTime)),o=o.insert(m,p)}let l=r.cs.newChangeBuffer({trackRemovals:!0}),c=yield Sr(r,function(m){return ot(Nr(ae.fromString(`__bundle__/docs/${m}`)))}(n));return r.persistence.runTransaction("Apply bundle documents","readwrite",h=>p_(h,l,o).next(m=>(l.apply(h),m)).next(m=>r.Ur.removeMatchingKeysForTargetId(h,c.targetId).next(()=>r.Ur.addMatchingKeys(h,s,c.targetId)).next(()=>r.localDocuments.getLocalViewOfDocuments(h,m.Ps,m.Is)).next(()=>m.Ps)))})}function R1(n,r){return P(this,arguments,function*(i,e,t=te()){let s=yield Sr(i,ot(nd(e.bundledQuery))),o=B(i);return o.persistence.runTransaction("Save named query","readwrite",l=>{let c=Oe(e.readTime);if(s.snapshotVersion.compareTo(c)>=0)return o.Gr.saveNamedQuery(l,e);let h=s.withResumeToken(Me.EMPTY_BYTE_STRING,c);return o.os=o.os.insert(h.targetId,h),o.Ur.updateTargetData(l,h).next(()=>o.Ur.removeMatchingKeysForTargetId(l,s.targetId)).next(()=>o.Ur.addMatchingKeys(l,t,s.targetId)).next(()=>o.Gr.saveNamedQuery(l,e))})})}function Hp(i,e){return`firestore_clients_${i}_${e}`}function Qp(i,e,t){let n=`firestore_mutations_${i}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function Gc(i,e){return`firestore_targets_${i}_${e}`}var Ja=class i{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Rs(e,t,n){let r=JSON.parse(n),s,o=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return o&&r.error&&(o=typeof r.error.message=="string"&&typeof r.error.code=="string",o&&(s=new D(r.error.code,r.error.message))),o?new i(e,t,r.state,s):(ke("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Ns=class i{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){let n=JSON.parse(t),r,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(r=new D(n.error.code,n.error.message))),s?new i(e,n.state,r):(ke("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Za=class i{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let n=JSON.parse(t),r=typeof n=="object"&&n.activeTargetIds instanceof Array,s=Zh();for(let o=0;r&&o<n.activeTargetIds.length;++o)r=fg(n.activeTargetIds[o]),s=s.add(n.activeTargetIds[o]);return r?new i(e,s):(ke("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},oh=class i{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new i(t.clientId,t.onlineState):(ke("SharedClientState",`Failed to parse online state: ${e}`),null)}},Zs=class{constructor(){this.activeTargetIds=Zh()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Fs=class{constructor(e,t,n,r,s){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Ie(J),this.started=!1,this.bs=[];let o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=Hp(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Zs),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return P(this,null,function*(){let e=yield this.syncEngine.Qi();for(let n of e){if(n===this.ps)continue;let r=this.getItem(Hp(this.persistenceKey,n));if(r){let s=Za.Rs(n,r);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let n=this.Ls(t);n&&this.Bs(n)}for(let n of this.bs)this.ws(n);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(Gc(this.persistenceKey,e));if(r){let s=Ns.Rs(e,r);s&&(n=s.state)}}return t&&this.Ks.fs(e),this.Ns(),n}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Gc(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(r=>{this.Qs(r)}),this.currentUser=e,n.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return V("SharedClientState","READ",e,t),t}setItem(e,t){V("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){V("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(V("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void ke("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>P(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let n=this.Gs(t.key);return this.zs(n,null)}{let n=this.js(t.key,t.newValue);if(n)return this.zs(n.clientId,n)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let n=this.Hs(t.key,t.newValue);if(n)return this.Js(n)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let n=this.Ys(t.key,t.newValue);if(n)return this.Zs(n)}}else if(t.key===this.xs){if(t.newValue!==null){let n=this.Ls(t.newValue);if(n)return this.Bs(n)}}else if(t.key===this.vs){let n=function(s){let o=wt.oe;if(s!=null)try{let l=JSON.parse(s);G(typeof l=="number"),o=l}catch(l){ke("SharedClientState","Failed to read sequence number from WebStorage",l)}return o}(t.newValue);n!==wt.oe&&this.sequenceNumberHandler(n)}else if(t.key===this.Os){let n=this.Xs(t.newValue);yield Promise.all(n.map(r=>this.syncEngine.eo(r)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){let r=new Ja(this.currentUser,e,t,n),s=Qp(this.persistenceKey,this.currentUser,e);this.setItem(s,r.Vs())}Qs(e){let t=Qp(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,n){let r=Gc(this.persistenceKey,e),s=new Ns(e,t,n);this.setItem(r,s.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let n=this.Gs(e);return Za.Rs(n,t)}Hs(e,t){let n=this.Fs.exec(e),r=Number(n[1]),s=n[2]!==void 0?n[2]:null;return Ja.Rs(new Le(s),r,t)}Ys(e,t){let n=this.Ms.exec(e),r=Number(n[1]);return Ns.Rs(r,t)}Ls(e){return oh.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return P(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);V("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let n=t?this.Ss.insert(e,t):this.Ss.remove(e),r=this.ks(this.Ss),s=this.ks(n),o=[],l=[];return s.forEach(c=>{r.has(c)||o.push(c)}),r.forEach(c=>{s.has(c)||l.push(c)}),this.syncEngine.io(o,l).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Zh();return e.forEach((n,r)=>{t=t.unionWith(r.activeTargetIds)}),t}},el=class{constructor(){this.so=new Zs,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Zs,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var ah=class{_o(e){}shutdown(){}};var tl=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){V("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){V("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var ya=null;function $c(){return ya===null?ya=function(){return 268435456+Math.round(2147483648*Math.random())}():ya++,"0x"+ya.toString(16)}var D1={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var lh=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var et="WebChannelConnection",ch=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let n=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${r}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${s}`}get Fo(){return!1}Mo(t,n,r,s,o){let l=$c(),c=this.xo(t,n.toUriEncodedString());V("RestConnection",`Sending RPC '${t}' ${l}:`,c,r);let h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,s,o),this.No(t,c,h,r).then(m=>(V("RestConnection",`Received RPC '${t}' ${l}: `,m),m),m=>{throw Ft("RestConnection",`RPC '${t}' ${l} failed with error: `,m,"url: ",c,"request:",r),m})}Lo(t,n,r,s,o,l){return this.Mo(t,n,r,s,o)}Oo(t,n,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Mr}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,o)=>t[o]=s),r&&r.headers.forEach((s,o)=>t[o]=s)}xo(t,n){let r=D1[t];return`${this.Do}/v1/${n}:${r}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,r){let s=$c();return new Promise((o,l)=>{let c=new Fc;c.setWithCredentials(!0),c.listenOnce(Lc.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case As.NO_ERROR:let m=c.getResponseJson();V(et,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(m)),o(m);break;case As.TIMEOUT:V(et,`RPC '${e}' ${s} timed out`),l(new D(x.DEADLINE_EXCEEDED,"Request time out"));break;case As.HTTP_ERROR:let p=c.getStatus();if(V(et,`RPC '${e}' ${s} failed with status:`,p,"response text:",c.getResponseText()),p>0){let _=c.getResponseJson();Array.isArray(_)&&(_=_[0]);let b=_?.error;if(b&&b.status&&b.message){let k=function(R){let K=R.toLowerCase().replace(/_/g,"-");return Object.values(x).indexOf(K)>=0?K:x.UNKNOWN}(b.status);l(new D(k,b.message))}else l(new D(x.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new D(x.UNAVAILABLE,"Connection failed."));break;default:j()}}finally{V(et,`RPC '${e}' ${s} completed.`)}});let h=JSON.stringify(r);V(et,`RPC '${e}' ${s} sending request:`,r),c.send(t,"POST",h,n,15)})}Bo(e,t,n){let r=$c(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Uc(),l=Bc(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;let m=s.join("");V(et,`Creating RPC '${e}' stream ${r}: ${m}`,c);let p=o.createWebChannel(m,c),_=!1,b=!1,k=new lh({Io:R=>{b?V(et,`Not sending because RPC '${e}' stream ${r} is closed:`,R):(_||(V(et,`Opening RPC '${e}' stream ${r} transport.`),p.open(),_=!0),V(et,`RPC '${e}' stream ${r} sending:`,R),p.send(R))},To:()=>p.close()}),O=(R,K,Q)=>{R.listen(K,z=>{try{Q(z)}catch(W){setTimeout(()=>{throw W},0)}})};return O(p,rr.EventType.OPEN,()=>{b||(V(et,`RPC '${e}' stream ${r} transport opened.`),k.yo())}),O(p,rr.EventType.CLOSE,()=>{b||(b=!0,V(et,`RPC '${e}' stream ${r} transport closed`),k.So())}),O(p,rr.EventType.ERROR,R=>{b||(b=!0,Ft(et,`RPC '${e}' stream ${r} transport errored:`,R),k.So(new D(x.UNAVAILABLE,"The operation could not be completed")))}),O(p,rr.EventType.MESSAGE,R=>{var K;if(!b){let Q=R.data[0];G(!!Q);let z=Q,W=z.error||((K=z[0])===null||K===void 0?void 0:K.error);if(W){V(et,`RPC '${e}' stream ${r} received error:`,W);let Z=W.status,ee=function(v){let I=Ne[v];if(I!==void 0)return $g(I)}(Z),w=W.message;ee===void 0&&(ee=x.INTERNAL,w="Unknown error status: "+Z+" with message "+W.message),b=!0,k.So(new D(ee,w)),p.close()}else V(et,`RPC '${e}' stream ${r} received:`,Q),k.bo(Q)}}),O(l,zc.STAT_EVENT,R=>{R.stat===fa.PROXY?V(et,`RPC '${e}' stream ${r} detected buffering proxy`):R.stat===fa.NOPROXY&&V(et,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{k.wo()},0),k}};function v_(){return typeof window<"u"?window:null}function Ea(){return typeof document<"u"?document:null}function co(i){return new bu(i,!0)}var eo=class{constructor(e,t,n=1e3,r=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=r,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-n);r>0&&V("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var nl=class{constructor(e,t,n,r,s,o,l,c){this.ui=e,this.Ho=n,this.Jo=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new eo(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return P(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return P(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return P(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===x.RESOURCE_EXHAUSTED?(ke(t.toString()),ke("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===x.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,r])=>{this.Yo===t&&this.P_(n,r)},n=>{e(()=>{let r=new D(x.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(r)})})}P_(e,t){let n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(r=>{n(()=>this.I_(r))}),this.stream.onMessage(r=>{n(()=>++this.e_==1?this.E_(r):this.onNext(r))})}i_(){this.state=5,this.t_.Go(()=>P(this,null,function*(){this.state=0,this.start()}))}I_(e){return V("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(V("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},uh=class extends nl{constructor(e,t,n,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=p1(this.serializer,e),n=function(s){if(!("targetChange"in s))return $.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?$.min():o.readTime?Oe(o.readTime):$.min()}(e);return this.listener.d_(t,n)}A_(e){let t={};t.database=Su(this.serializer),t.addTarget=function(s,o){let l,c=o.target;if(l=Va(c)?{documents:Zg(s,c)}:{query:e_(s,c)._t},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=Hg(s,o.resumeToken);let h=Cu(s,o.expectedCount);h!==null&&(l.expectedCount=h)}else if(o.snapshotVersion.compareTo($.min())>0){l.readTime=br(s,o.snapshotVersion.toTimestamp());let h=Cu(s,o.expectedCount);h!==null&&(l.expectedCount=h)}return l}(this.serializer,e);let n=_1(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){let t={};t.database=Su(this.serializer),t.removeTarget=e,this.a_(t)}},hh=class extends nl{constructor(e,t,n,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return G(!!e.streamToken),this.lastStreamToken=e.streamToken,G(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){G(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=g1(e.writeResults,e.commitTime),n=Oe(e.commitTime);return this.listener.g_(n,t)}p_(){let e={};e.database=Su(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>Ys(this.serializer,n))};this.a_(t)}};var dh=class extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new D(x.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,Au(t,n),r,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new D(x.UNKNOWN,s.toString())})}Lo(e,t,n,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Lo(e,Au(t,n),r,o,l,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new D(x.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},mh=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(ke(t),this.D_=!1):V("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var fh=class{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{n.enqueueAndForget(()=>P(this,null,function*(){Zn(this)&&(V("RemoteStore","Restarting streams for network reachability change."),yield function(c){return P(this,null,function*(){let h=B(c);h.L_.add(4),yield Fr(h),h.q_.set("Unknown"),h.L_.delete(4),yield uo(h)})}(this))}))}),this.q_=new mh(n,r)}};function uo(i){return P(this,null,function*(){if(Zn(i))for(let e of i.B_)yield e(!0)})}function Fr(i){return P(this,null,function*(){for(let e of i.B_)yield e(!1)})}function El(i,e){let t=B(i);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),ad(t)?od(t):zr(t).r_()&&sd(t,e))}function Pr(i,e){let t=B(i),n=zr(t);t.N_.delete(e),n.r_()&&w_(t,e),t.N_.size===0&&(n.r_()?n.o_():Zn(t)&&t.q_.set("Unknown"))}function sd(i,e){if(i.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($.min())>0){let t=i.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}zr(i).A_(e)}function w_(i,e){i.Q_.xe(e),zr(i).R_(e)}function od(i){i.Q_=new Eu({getRemoteKeysForTarget:e=>i.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>i.N_.get(e)||null,tt:()=>i.datastore.serializer.databaseId}),zr(i).start(),i.q_.v_()}function ad(i){return Zn(i)&&!zr(i).n_()&&i.N_.size>0}function Zn(i){return B(i).L_.size===0}function I_(i){i.Q_=void 0}function k1(i){return P(this,null,function*(){i.q_.set("Online")})}function V1(i){return P(this,null,function*(){i.N_.forEach((e,t)=>{sd(i,e)})})}function O1(i,e){return P(this,null,function*(){I_(i),ad(i)?(i.q_.M_(e),od(i)):i.q_.set("Unknown")})}function M1(i,e,t){return P(this,null,function*(){if(i.q_.set("Online"),e instanceof Fa&&e.state===2&&e.cause)try{yield function(r,s){return P(this,null,function*(){let o=s.cause;for(let l of s.targetIds)r.N_.has(l)&&(yield r.remoteSyncer.rejectListen(l,o),r.N_.delete(l),r.Q_.removeTarget(l))})}(i,e)}catch(n){V("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield il(i,n)}else if(e instanceof _r?i.Q_.Ke(e):e instanceof Na?i.Q_.He(e):i.Q_.We(e),!t.isEqual($.min()))try{let n=yield f_(i.localStore);t.compareTo(n)>=0&&(yield function(s,o){let l=s.Q_.rt(o);return l.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){let m=s.N_.get(h);m&&s.N_.set(h,m.withResumeToken(c.resumeToken,o))}}),l.targetMismatches.forEach((c,h)=>{let m=s.N_.get(c);if(!m)return;s.N_.set(c,m.withResumeToken(Me.EMPTY_BYTE_STRING,m.snapshotVersion)),w_(s,c);let p=new Cr(m.target,c,h,m.sequenceNumber);sd(s,p)}),s.remoteSyncer.applyRemoteEvent(l)}(i,t))}catch(n){V("RemoteStore","Failed to raise snapshot:",n),yield il(i,n)}})}function il(i,e,t){return P(this,null,function*(){if(!Jn(e))throw e;i.L_.add(1),yield Fr(i),i.q_.set("Offline"),t||(t=()=>f_(i.localStore)),i.asyncQueue.enqueueRetryable(()=>P(this,null,function*(){V("RemoteStore","Retrying IndexedDB access"),yield t(),i.L_.delete(1),yield uo(i)}))})}function T_(i,e){return e().catch(t=>il(i,t,e))}function Lr(i){return P(this,null,function*(){let e=B(i),t=Yn(e),n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;N1(e);)try{let r=yield x1(e.localStore,n);if(r===null){e.O_.length===0&&t.o_();break}n=r.batchId,F1(e,r)}catch(r){yield il(e,r)}E_(e)&&b_(e)})}function N1(i){return Zn(i)&&i.O_.length<10}function F1(i,e){i.O_.push(e);let t=Yn(i);t.r_()&&t.V_&&t.m_(e.mutations)}function E_(i){return Zn(i)&&!Yn(i).n_()&&i.O_.length>0}function b_(i){Yn(i).start()}function L1(i){return P(this,null,function*(){Yn(i).p_()})}function z1(i){return P(this,null,function*(){let e=Yn(i);for(let t of i.O_)e.m_(t.mutations)})}function B1(i,e,t){return P(this,null,function*(){let n=i.O_.shift(),r=wu.from(n,e,t);yield T_(i,()=>i.remoteSyncer.applySuccessfulWrite(r)),yield Lr(i)})}function U1(i,e){return P(this,null,function*(){e&&Yn(i).V_&&(yield function(n,r){return P(this,null,function*(){if(function(o){return Gg(o)&&o!==x.ABORTED}(r.code)){let s=n.O_.shift();Yn(n).s_(),yield T_(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,r)),yield Lr(n)}})}(i,e)),E_(i)&&b_(i)})}function Wp(i,e){return P(this,null,function*(){let t=B(i);t.asyncQueue.verifyOperationInProgress(),V("RemoteStore","RemoteStore received new credentials");let n=Zn(t);t.L_.add(3),yield Fr(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield uo(t)})}function ph(i,e){return P(this,null,function*(){let t=B(i);e?(t.L_.delete(2),yield uo(t)):e||(t.L_.add(2),yield Fr(t),t.q_.set("Unknown"))})}function zr(i){return i.K_||(i.K_=function(t,n,r){let s=B(t);return s.w_(),new uh(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(i.datastore,i.asyncQueue,{Eo:k1.bind(null,i),Ro:V1.bind(null,i),mo:O1.bind(null,i),d_:M1.bind(null,i)}),i.B_.push(e=>P(this,null,function*(){e?(i.K_.s_(),ad(i)?od(i):i.q_.set("Unknown")):(yield i.K_.stop(),I_(i))}))),i.K_}function Yn(i){return i.U_||(i.U_=function(t,n,r){let s=B(t);return s.w_(),new hh(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(i.datastore,i.asyncQueue,{Eo:()=>Promise.resolve(),Ro:L1.bind(null,i),mo:U1.bind(null,i),f_:z1.bind(null,i),g_:B1.bind(null,i)}),i.B_.push(e=>P(this,null,function*(){e?(i.U_.s_(),yield Lr(i)):(yield i.U_.stop(),i.O_.length>0&&(V("RemoteStore",`Stopping write stream with ${i.O_.length} pending writes`),i.O_=[]))}))),i.U_}var gh=class i{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new je,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,s){let o=Date.now()+n,l=new i(e,t,o,r,s);return l.start(n),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Br(i,e){if(ke("AsyncQueue",`${e}: ${i}`),Jn(i))return new D(x.UNAVAILABLE,`${e}: ${i}`);throw i}var rl=class i{constructor(e){this.comparator=e?(t,n)=>e(t,n)||U.comparator(t.key,n.key):(t,n)=>U.comparator(t.key,n.key),this.keyedMap=Ds(),this.sortedSet=new Ie(this.comparator)}static emptySet(e){return new i(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof i)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=n.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new i;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};var sl=class{constructor(){this.W_=new Ie(U.comparator)}track(e){let t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):j():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}},Rr=class i{constructor(e,t,n,r,s,o,l,c,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,r,s){let o=[];return t.forEach(l=>{o.push({type:0,doc:l})}),new i(e,t,rl.emptySet(t),o,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ao(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}};var _h=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},yh=class{constructor(){this.queries=Yp(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){let r=B(t),s=r.queries;r.queries=Yp(),s.forEach((o,l)=>{for(let c of l.j_)c.onError(n)})})(this,new D(x.ABORTED,"Firestore shutting down"))}};function Yp(){return new Zt(i=>Rg(i),ao)}function ld(i,e){return P(this,null,function*(){let t=B(i),n=3,r=e.query,s=t.queries.get(r);s?!s.H_()&&e.J_()&&(n=2):(s=new _h,n=e.J_()?0:1);try{switch(n){case 0:s.z_=yield t.onListen(r,!0);break;case 1:s.z_=yield t.onListen(r,!1);break;case 2:yield t.onFirstRemoteStoreListen(r)}}catch(o){let l=Br(o,`Initialization of query '${ur(e.query)}' failed`);return void e.onError(l)}t.queries.set(r,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&ud(t)})}function cd(i,e){return P(this,null,function*(){let t=B(i),n=e.query,r=3,s=t.queries.get(n);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?r=e.J_()?0:1:!s.H_()&&e.J_()&&(r=2))}switch(r){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function q1(i,e){let t=B(i),n=!1;for(let r of e){let s=r.query,o=t.queries.get(s);if(o){for(let l of o.j_)l.X_(r)&&(n=!0);o.z_=r}}n&&ud(t)}function j1(i,e,t){let n=B(i),r=n.queries.get(e);if(r)for(let s of r.j_)s.onError(t);n.queries.delete(e)}function ud(i){i.Y_.forEach(e=>{e.next()})}var vh,Xp;(Xp=vh||(vh={})).ea="default",Xp.Cache="cache";var to=class{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){let n=[];for(let r of e.docChanges)r.type!==3&&n.push(r);e=new Rr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Rr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==vh.Cache}};var wh=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var ol=class{constructor(e){this.serializer=e}Es(e){return Wt(this.serializer,e)}ds(e){return e.metadata.exists?Jg(this.serializer,e.document,!1):ze.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Oe(e)}},Ih=class{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=C_(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let n=ae.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,n=new ol(this.serializer);for(let r of e)if(r.metadata.queries){let s=n.Es(r.metadata.name);for(let o of r.metadata.queries){let l=(t.get(o)||te()).add(s);t.set(o,l)}}return t}complete(){return P(this,null,function*(){let e=yield P1(this.localStore,new ol(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let n of this.queries)yield R1(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function C_(i){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}}var al=class{constructor(e){this.key=e}},ll=class{constructor(e){this.key=e}},cl=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=te(),this.mutatedKeys=te(),this.Aa=kg(e),this.Ra=new rl(this.Aa)}get Va(){return this.Ta}ma(e,t){let n=t?t.fa:new sl,r=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=r,l=!1,c=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,h=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((m,p)=>{let _=r.get(m),b=lo(this.query,p)?p:null,k=!!_&&this.mutatedKeys.has(_.key),O=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations),R=!1;_&&b?_.data.isEqual(b.data)?k!==O&&(n.track({type:3,doc:b}),R=!0):this.ga(_,b)||(n.track({type:2,doc:b}),R=!0,(c&&this.Aa(b,c)>0||h&&this.Aa(b,h)<0)&&(l=!0)):!_&&b?(n.track({type:0,doc:b}),R=!0):_&&!b&&(n.track({type:1,doc:_}),R=!0,(c||h)&&(l=!0)),R&&(b?(o=o.add(b),s=O?s.add(m):s.delete(m)):(o=o.delete(m),s=s.delete(m)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let m=this.query.limitType==="F"?o.last():o.first();o=o.delete(m.key),s=s.delete(m.key),n.track({type:1,doc:m})}return{Ra:o,fa:n,ns:l,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((m,p)=>function(b,k){let O=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return j()}};return O(b)-O(k)}(m.type,p.type)||this.Aa(m.doc,p.doc)),this.pa(n),r=r!=null&&r;let l=t&&!r?this.ya():[],c=this.da.size===0&&this.current&&!r?1:0,h=c!==this.Ea;return this.Ea=c,o.length!==0||h?{snapshot:new Rr(this.query,e.Ra,s,o,e.mutatedKeys,c===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new sl,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=te(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});let t=[];return e.forEach(n=>{this.da.has(n)||t.push(new ll(n))}),this.da.forEach(n=>{e.has(n)||t.push(new al(n))}),t}ba(e){this.Ta=e.Ts,this.da=te();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Rr.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},Th=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},Eh=class{constructor(e){this.key=e,this.va=!1}},bh=class{constructor(e,t,n,r,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Zt(l=>Rg(l),ao),this.Ma=new Map,this.xa=new Set,this.Oa=new Ie(U.comparator),this.Na=new Map,this.La=new Js,this.Ba={},this.ka=new Map,this.qa=Ar.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function G1(i,e,t=!0){return P(this,null,function*(){let n=bl(i),r,s=n.Fa.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.Da()):r=yield A_(n,e,t,!0),r})}function $1(i,e){return P(this,null,function*(){let t=bl(i);yield A_(t,e,!0,!1)})}function A_(i,e,t,n){return P(this,null,function*(){let r=yield Sr(i.localStore,ot(e)),s=r.targetId,o=i.sharedClientState.addLocalQueryTarget(s,t),l;return n&&(l=yield hd(i,e,s,o==="current",r.resumeToken)),i.isPrimaryClient&&t&&El(i.remoteStore,r),l})}function hd(i,e,t,n,r){return P(this,null,function*(){i.Ka=(p,_,b)=>function(O,R,K,Q){return P(this,null,function*(){let z=R.view.ma(K);z.ns&&(z=yield Xa(O.localStore,R.query,!1).then(({documents:w})=>R.view.ma(w,z)));let W=Q&&Q.targetChanges.get(R.targetId),Z=Q&&Q.targetMismatches.get(R.targetId)!=null,ee=R.view.applyChanges(z,O.isPrimaryClient,W,Z);return Ch(O,R.targetId,ee.wa),ee.snapshot})}(i,p,_,b);let s=yield Xa(i.localStore,e,!0),o=new cl(e,s.Ts),l=o.ma(s.documents),c=Qs.createSynthesizedTargetChangeForCurrentChange(t,n&&i.onlineState!=="Offline",r),h=o.applyChanges(l,i.isPrimaryClient,c);Ch(i,t,h.wa);let m=new Th(e,t,o);return i.Fa.set(e,m),i.Ma.has(t)?i.Ma.get(t).push(e):i.Ma.set(t,[e]),h.snapshot})}function K1(i,e,t){return P(this,null,function*(){let n=B(i),r=n.Fa.get(e),s=n.Ma.get(r.targetId);if(s.length>1)return n.Ma.set(r.targetId,s.filter(o=>!ao(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||(yield xr(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),t&&Pr(n.remoteStore,r.targetId),Dr(n,r.targetId)}).catch(Xn))):(Dr(n,r.targetId),yield xr(n.localStore,r.targetId,!0))})}function H1(i,e){return P(this,null,function*(){let t=B(i),n=t.Fa.get(e),r=t.Ma.get(n.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Pr(t.remoteStore,n.targetId))})}function Q1(i,e,t){return P(this,null,function*(){let n=pd(i);try{let r=yield function(o,l){let c=B(o),h=Ce.now(),m=l.reduce((b,k)=>b.add(k.key),te()),p,_;return c.persistence.runTransaction("Locally write mutations","readwrite",b=>{let k=gt(),O=te();return c.cs.getEntries(b,m).next(R=>{k=R,k.forEach((K,Q)=>{Q.isValidDocument()||(O=O.add(K))})}).next(()=>c.localDocuments.getOverlayedDocuments(b,k)).next(R=>{p=R;let K=[];for(let Q of l){let z=l1(Q,p.get(Q.key).overlayedDocument);z!=null&&K.push(new zt(Q.key,z,Eg(z.value.mapValue),Re.exists(!0)))}return c.mutationQueue.addMutationBatch(b,h,K,l)}).next(R=>{_=R;let K=R.applyToLocalDocumentSet(p,O);return c.documentOverlayCache.saveOverlays(b,R.batchId,K)})}).then(()=>({batchId:_.batchId,changes:Og(p)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(r.batchId),function(o,l,c){let h=o.Ba[o.currentUser.toKey()];h||(h=new Ie(J)),h=h.insert(l,c),o.Ba[o.currentUser.toKey()]=h}(n,r.batchId,t),yield vn(n,r.changes),yield Lr(n.remoteStore)}catch(r){let s=Br(r,"Failed to persist write");t.reject(s)}})}function S_(i,e){return P(this,null,function*(){let t=B(i);try{let n=yield S1(t.localStore,e);e.targetChanges.forEach((r,s)=>{let o=t.Na.get(s);o&&(G(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.va=!0:r.modifiedDocuments.size>0?G(o.va):r.removedDocuments.size>0&&(G(o.va),o.va=!1))}),yield vn(t,n,e)}catch(n){yield Xn(n)}})}function Jp(i,e,t){let n=B(i);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let r=[];n.Fa.forEach((s,o)=>{let l=o.view.Z_(e);l.snapshot&&r.push(l.snapshot)}),function(o,l){let c=B(o);c.onlineState=l;let h=!1;c.queries.forEach((m,p)=>{for(let _ of p.j_)_.Z_(l)&&(h=!0)}),h&&ud(c)}(n.eventManager,e),r.length&&n.Ca.d_(r),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function W1(i,e,t){return P(this,null,function*(){let n=B(i);n.sharedClientState.updateQueryState(e,"rejected",t);let r=n.Na.get(e),s=r&&r.key;if(s){let o=new Ie(U.comparator);o=o.insert(s,ze.newNoDocument(s,$.min()));let l=te().add(s),c=new Hs($.min(),new Map,new Ie(J),o,l);yield S_(n,c),n.Oa=n.Oa.remove(s),n.Na.delete(e),fd(n)}else yield xr(n.localStore,e,!1).then(()=>Dr(n,e,t)).catch(Xn)})}function Y1(i,e){return P(this,null,function*(){let t=B(i),n=e.batch.batchId;try{let r=yield A1(t.localStore,e);md(t,n,null),dd(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield vn(t,r)}catch(r){yield Xn(r)}})}function X1(i,e,t){return P(this,null,function*(){let n=B(i);try{let r=yield function(o,l){let c=B(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let m;return c.mutationQueue.lookupMutationBatch(h,l).next(p=>(G(p!==null),m=p.keys(),c.mutationQueue.removeMutationBatch(h,p))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,m,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,m)).next(()=>c.localDocuments.getDocuments(h,m))})}(n.localStore,e);md(n,e,t),dd(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield vn(n,r)}catch(r){yield Xn(r)}})}function J1(i,e){return P(this,null,function*(){let t=B(i);Zn(t.remoteStore)||V("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(o){let l=B(o);return l.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>l.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(n===-1)return void e.resolve();let r=t.ka.get(n)||[];r.push(e),t.ka.set(n,r)}catch(n){let r=Br(n,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}})}function dd(i,e){(i.ka.get(e)||[]).forEach(t=>{t.resolve()}),i.ka.delete(e)}function md(i,e,t){let n=B(i),r=n.Ba[n.currentUser.toKey()];if(r){let s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),n.Ba[n.currentUser.toKey()]=r}}function Dr(i,e,t=null){i.sharedClientState.removeLocalQueryTarget(e);for(let n of i.Ma.get(e))i.Fa.delete(n),t&&i.Ca.$a(n,t);i.Ma.delete(e),i.isPrimaryClient&&i.La.gr(e).forEach(n=>{i.La.containsKey(n)||x_(i,n)})}function x_(i,e){i.xa.delete(e.path.canonicalString());let t=i.Oa.get(e);t!==null&&(Pr(i.remoteStore,t),i.Oa=i.Oa.remove(e),i.Na.delete(t),fd(i))}function Ch(i,e,t){for(let n of t)n instanceof al?(i.La.addReference(n.key,e),Z1(i,n)):n instanceof ll?(V("SyncEngine","Document no longer in limbo: "+n.key),i.La.removeReference(n.key,e),i.La.containsKey(n.key)||x_(i,n.key)):j()}function Z1(i,e){let t=e.key,n=t.path.canonicalString();i.Oa.get(t)||i.xa.has(n)||(V("SyncEngine","New document in limbo: "+t),i.xa.add(n),fd(i))}function fd(i){for(;i.xa.size>0&&i.Oa.size<i.maxConcurrentLimboResolutions;){let e=i.xa.values().next().value;i.xa.delete(e);let t=new U(ae.fromString(e)),n=i.qa.next();i.Na.set(n,new Eh(t)),i.Oa=i.Oa.insert(t,n),El(i.remoteStore,new Cr(ot(Nr(t.path)),n,"TargetPurposeLimboResolution",wt.oe))}}function vn(i,e,t){return P(this,null,function*(){let n=B(i),r=[],s=[],o=[];n.Fa.isEmpty()||(n.Fa.forEach((l,c)=>{o.push(n.Ka(c,e,t).then(h=>{var m;if((h||t)&&n.isPrimaryClient){let p=h?!h.fromCache:(m=t?.targetChanges.get(c.targetId))===null||m===void 0?void 0:m.current;n.sharedClientState.updateQueryState(c.targetId,p?"current":"not-current")}if(h){r.push(h);let p=ih.Wi(c.targetId,h);s.push(p)}}))}),yield Promise.all(o),n.Ca.d_(r),yield function(c,h){return P(this,null,function*(){let m=B(c);try{yield m.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>A.forEach(h,_=>A.forEach(_.$i,b=>m.persistence.referenceDelegate.addReference(p,_.targetId,b)).next(()=>A.forEach(_.Ui,b=>m.persistence.referenceDelegate.removeReference(p,_.targetId,b)))))}catch(p){if(!Jn(p))throw p;V("LocalStore","Failed to update sequence numbers: "+p)}for(let p of h){let _=p.targetId;if(!p.fromCache){let b=m.os.get(_),k=b.snapshotVersion,O=b.withLastLimboFreeSnapshotVersion(k);m.os=m.os.insert(_,O)}}})}(n.localStore,s))})}function ew(i,e){return P(this,null,function*(){let t=B(i);if(!t.currentUser.isEqual(e)){V("SyncEngine","User change. New user:",e.toKey());let n=yield m_(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(l=>{l.forEach(c=>{c.reject(new D(x.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield vn(t,n.hs)}})}function tw(i,e){let t=B(i),n=t.Na.get(e);if(n&&n.va)return te().add(n.key);{let r=te(),s=t.Ma.get(e);if(!s)return r;for(let o of s){let l=t.Fa.get(o);r=r.unionWith(l.view.Va)}return r}}function nw(i,e){return P(this,null,function*(){let t=B(i),n=yield Xa(t.localStore,e.query,!0),r=e.view.ba(n);return t.isPrimaryClient&&Ch(t,e.targetId,r.wa),r})}function iw(i,e){return P(this,null,function*(){let t=B(i);return __(t.localStore,e).then(n=>vn(t,n))})}function rw(i,e,t,n){return P(this,null,function*(){let r=B(i),s=yield function(l,c){let h=B(l),m=B(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",p=>m.Mn(p,c).next(_=>_?h.localDocuments.getDocuments(p,_):A.resolve(null)))}(r.localStore,e);s!==null?(t==="pending"?yield Lr(r.remoteStore):t==="acknowledged"||t==="rejected"?(md(r,e,n||null),dd(r,e),function(l,c){B(B(l).mutationQueue).On(c)}(r.localStore,e)):j(),yield vn(r,s)):V("SyncEngine","Cannot apply mutation batch with id: "+e)})}function sw(i,e){return P(this,null,function*(){let t=B(i);if(bl(t),pd(t),e===!0&&t.Qa!==!0){let n=t.sharedClientState.getAllActiveQueryTargets(),r=yield Zp(t,n.toArray());t.Qa=!0,yield ph(t.remoteStore,!0);for(let s of r)El(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){let n=[],r=Promise.resolve();t.Ma.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?n.push(o):r=r.then(()=>(Dr(t,o),xr(t.localStore,o,!0))),Pr(t.remoteStore,o)}),yield r,yield Zp(t,n),function(o){let l=B(o);l.Na.forEach((c,h)=>{Pr(l.remoteStore,h)}),l.La.pr(),l.Na=new Map,l.Oa=new Ie(U.comparator)}(t),t.Qa=!1,yield ph(t.remoteStore,!1)}})}function Zp(i,e,t){return P(this,null,function*(){let n=B(i),r=[],s=[];for(let o of e){let l,c=n.Ma.get(o);if(c&&c.length!==0){l=yield Sr(n.localStore,ot(c[0]));for(let h of c){let m=n.Fa.get(h),p=yield nw(n,m);p.snapshot&&s.push(p.snapshot)}}else{let h=yield g_(n.localStore,o);l=yield Sr(n.localStore,h),yield hd(n,P_(h),o,!1,l.resumeToken)}r.push(l)}return n.Ca.d_(s),r})}function P_(i){return Pg(i.path,i.collectionGroup,i.orderBy,i.filters,i.limit,"F",i.startAt,i.endAt)}function ow(i){return function(t){return B(B(t).persistence).Qi()}(B(i).localStore)}function aw(i,e,t,n){return P(this,null,function*(){let r=B(i);if(r.Qa)return void V("SyncEngine","Ignoring unexpected query state notification.");let s=r.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield __(r.localStore,Dg(s[0])),l=Hs.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Me.EMPTY_BYTE_STRING);yield vn(r,o,l);break}case"rejected":yield xr(r.localStore,e,!0),Dr(r,e,n);break;default:j()}})}function lw(i,e,t){return P(this,null,function*(){let n=bl(i);if(n.Qa){for(let r of e){if(n.Ma.has(r)&&n.sharedClientState.isActiveQueryTarget(r)){V("SyncEngine","Adding an already active target "+r);continue}let s=yield g_(n.localStore,r),o=yield Sr(n.localStore,s);yield hd(n,P_(s),o.targetId,!1,o.resumeToken),El(n.remoteStore,o)}for(let r of t)n.Ma.has(r)&&(yield xr(n.localStore,r,!1).then(()=>{Pr(n.remoteStore,r),Dr(n,r)}).catch(Xn))}})}function bl(i){let e=B(i);return e.remoteStore.remoteSyncer.applyRemoteEvent=S_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=tw.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=W1.bind(null,e),e.Ca.d_=q1.bind(null,e.eventManager),e.Ca.$a=j1.bind(null,e.eventManager),e}function pd(i){let e=B(i);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Y1.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=X1.bind(null,e),e}function cw(i,e,t){let n=B(i);(function(s,o,l){return P(this,null,function*(){try{let c=yield o.getMetadata();if(yield function(b,k){let O=B(b),R=Oe(k.createTime);return O.persistence.runTransaction("hasNewerBundle","readonly",K=>O.Gr.getBundleMetadata(K,k.id)).then(K=>!!K&&K.createTime.compareTo(R)>=0)}(s.localStore,c))return yield o.close(),l._completeWith(function(b){return{taskState:"Success",documentsLoaded:b.totalDocuments,bytesLoaded:b.totalBytes,totalDocuments:b.totalDocuments,totalBytes:b.totalBytes}}(c)),Promise.resolve(new Set);l._updateProgress(C_(c));let h=new Ih(c,s.localStore,o.serializer),m=yield o.Ua();for(;m;){let _=yield h.la(m);_&&l._updateProgress(_),m=yield o.Ua()}let p=yield h.complete();return yield vn(s,p.Ia,void 0),yield function(b,k){let O=B(b);return O.persistence.runTransaction("Save bundle","readwrite",R=>O.Gr.saveBundleMetadata(R,k))}(s.localStore,c),l._completeWith(p.progress),Promise.resolve(p.Pa)}catch(c){return Ft("SyncEngine",`Loading bundle failed with ${c}`),l._failWith(c),Promise.resolve(new Set)}})})(n,e,t).then(r=>{n.sharedClientState.notifyBundleLoaded(r)})}var Ah=(()=>{class i{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return P(this,null,function*(){this.serializer=co(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,n){return null}Ha(t,n){return null}za(t){return d_(this.persistence,new Ya,t.initialUser,this.serializer)}Ga(t){return new Qa(Wa.Zr,this.serializer)}Wa(t){return new el}terminate(){return P(this,null,function*(){var t,n;(t=this.gcScheduler)===null||t===void 0||t.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return i.provider={build:()=>new i},i})();var ul=class i extends Ah{constructor(e,t,n){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return P(this,null,function*(){yield dc(i.prototype,this,"initialize").call(this,e),yield this.Ja.initialize(this,e),yield pd(this.Ja.syncEngine),yield Lr(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(e){return d_(this.persistence,new Ya,e.initialUser,this.serializer)}ja(e,t){let n=this.persistence.referenceDelegate.garbageCollector;return new Uu(n,e.asyncQueue,t)}Ha(e,t){let n=new ru(t,this.persistence);return new iu(e.asyncQueue,n)}Ga(e){let t=rd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Pt.withCacheSize(this.cacheSizeBytes):Pt.DEFAULT;return new nh(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,v_(),Ea(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new el}},Sh=class i extends ul{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return P(this,null,function*(){yield dc(i.prototype,this,"initialize").call(this,e);let t=this.Ja.syncEngine;this.sharedClientState instanceof Fs&&(this.sharedClientState.syncEngine={no:rw.bind(null,t),ro:aw.bind(null,t),io:lw.bind(null,t),Qi:ow.bind(null,t),eo:iw.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(n=>P(this,null,function*(){yield sw(this.Ja.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}Wa(e){let t=v_();if(!Fs.D(t))throw new D(x.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=rd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Fs(t,e.asyncQueue,n,e.clientId,e.initialUser)}},gd=(()=>{class i{initialize(t,n){return P(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Jp(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=ew.bind(null,this.syncEngine),yield ph(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new yh}()}createDatastore(t){let n=co(t.databaseInfo.databaseId),r=function(o){return new ch(o)}(t.databaseInfo);return function(o,l,c,h){return new dh(o,l,c,h)}(t.authCredentials,t.appCheckCredentials,r,n)}createRemoteStore(t){return function(r,s,o,l,c){return new fh(r,s,o,l,c)}(this.localStore,this.datastore,t.asyncQueue,n=>Jp(this.syncEngine,n,0),function(){return tl.D()?new tl:new ah}())}createSyncEngine(t,n){return function(s,o,l,c,h,m,p){let _=new bh(s,o,l,c,h,m);return p&&(_.Qa=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){return P(this,null,function*(){var t,n;yield function(s){return P(this,null,function*(){let o=B(s);V("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield Fr(o),o.k_.shutdown(),o.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return i.provider={build:()=>new i},i})();function eg(i,e=10240){let t=0;return{read(){return P(this,null,function*(){if(t<i.byteLength){let r={value:i.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})},cancel(){return P(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var kr=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):ke("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var xh=class{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new je,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.aa)}`))},n=>this.metadata.reject(n))}close(){return this.Xa.cancel()}getMetadata(){return P(this,null,function*(){return this.metadata.promise})}Ua(){return P(this,null,function*(){return yield this.getMetadata(),this.tu()})}tu(){return P(this,null,function*(){let e=yield this.nu();if(e===null)return null;let t=this.eu.decode(e),n=Number(t);isNaN(n)&&this.ru(`length string (${t}) is not valid number`);let r=yield this.iu(n);return new wh(JSON.parse(r),e.length+n)})}su(){return this.buffer.findIndex(e=>e===123)}nu(){return P(this,null,function*(){for(;this.su()<0&&!(yield this.ou()););if(this.buffer.length===0)return null;let e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}iu(e){return P(this,null,function*(){for(;this.buffer.length<e;)(yield this.ou())&&this.ru("Reached the end of bundle when more is expected.");let t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}ou(){return P(this,null,function*(){let e=yield this.Xa.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Ph=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return P(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new D(x.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(r,s){return P(this,null,function*(){let o=B(r),l={documents:s.map(p=>Ws(o.serializer,p))},c=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,ae.emptyPath(),l,s.length),h=new Map;c.forEach(p=>{let _=f1(o.serializer,p);h.set(_.key.toString(),_)});let m=[];return s.forEach(p=>{let _=h.get(p.toString());G(!!_),m.push(_)}),m})}(this.datastore,e);return t.forEach(n=>this.recordVersion(n)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new Wn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return P(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,n)=>{let r=U.fromPath(n);this.mutations.push(new Gs(r,this.precondition(r)))}),yield function(n,r){return P(this,null,function*(){let s=B(n),o={writes:r.map(l=>Ys(s.serializer,l))};yield s.Mo("Commit",s.serializer.databaseId,ae.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw j();t=$.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new D(x.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual($.min())?Re.exists(!1):Re.updateTime(t):Re.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual($.min()))throw new D(x.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Re.updateTime(t)}return Re.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Rh=class{constructor(e,t,n,r,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=s,this._u=n.maxAttempts,this.t_=new eo(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(()=>P(this,null,function*(){let e=new Ph(this.datastore),t=this.cu(e);t&&t.then(n=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(n)}).catch(r=>{this.lu(r)}))}).catch(n=>{this.lu(n)})}))}cu(e){try{let t=this.updateFunction(e);return!so(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Gg(t)}return!1}};var Dh=class{constructor(e,t,n,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Le.UNAUTHENTICATED,this.clientId=Ca.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,o=>P(this,null,function*(){V("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(n,o=>(V("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new je;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>P(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=Br(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};function Kc(i,e){return P(this,null,function*(){i.asyncQueue.verifyOperationInProgress(),V("FirestoreClient","Initializing OfflineComponentProvider");let t=i.configuration;yield e.initialize(t);let n=t.initialUser;i.setCredentialChangeListener(r=>P(this,null,function*(){n.isEqual(r)||(yield m_(e.localStore,r),n=r)})),e.persistence.setDatabaseDeletedListener(()=>i.terminate()),i._offlineComponents=e})}function tg(i,e){return P(this,null,function*(){i.asyncQueue.verifyOperationInProgress();let t=yield _d(i);V("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,i.configuration),i.setCredentialChangeListener(n=>Wp(e.remoteStore,n)),i.setAppCheckTokenChangeListener((n,r)=>Wp(e.remoteStore,r)),i._onlineComponents=e})}function _d(i){return P(this,null,function*(){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){V("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Kc(i,i._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(r){return r.name==="FirebaseError"?r.code===x.FAILED_PRECONDITION||r.code===x.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;Ft("Error using user provided cache. Falling back to memory cache: "+t),yield Kc(i,new Ah)}}else V("FirestoreClient","Using default OfflineComponentProvider"),yield Kc(i,new Ah);return i._offlineComponents})}function Cl(i){return P(this,null,function*(){return i._onlineComponents||(i._uninitializedComponentsProvider?(V("FirestoreClient","Using user provided OnlineComponentProvider"),yield tg(i,i._uninitializedComponentsProvider._online)):(V("FirestoreClient","Using default OnlineComponentProvider"),yield tg(i,new gd))),i._onlineComponents})}function R_(i){return _d(i).then(e=>e.persistence)}function yd(i){return _d(i).then(e=>e.localStore)}function D_(i){return Cl(i).then(e=>e.remoteStore)}function vd(i){return Cl(i).then(e=>e.syncEngine)}function uw(i){return Cl(i).then(e=>e.datastore)}function Vr(i){return P(this,null,function*(){let e=yield Cl(i),t=e.eventManager;return t.onListen=G1.bind(null,e.syncEngine),t.onUnlisten=K1.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=$1.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=H1.bind(null,e.syncEngine),t})}function hw(i){return i.asyncQueue.enqueue(()=>P(this,null,function*(){let e=yield R_(i),t=yield D_(i);return e.setNetworkEnabled(!0),function(r){let s=B(r);return s.L_.delete(0),uo(s)}(t)}))}function dw(i){return i.asyncQueue.enqueue(()=>P(this,null,function*(){let e=yield R_(i),t=yield D_(i);return e.setNetworkEnabled(!1),function(r){return P(this,null,function*(){let s=B(r);s.L_.add(0),yield Fr(s),s.q_.set("Offline")})}(t)}))}function mw(i,e){let t=new je;return i.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(r,s,o){return P(this,null,function*(){try{let l=yield function(h,m){let p=B(h);return p.persistence.runTransaction("read document","readonly",_=>p.localDocuments.getDocument(_,m))}(r,s);l.isFoundDocument()?o.resolve(l):l.isNoDocument()?o.resolve(null):o.reject(new D(x.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(l){let c=Br(l,`Failed to get document '${s} from cache`);o.reject(c)}})}(yield yd(i),e,t)})),t.promise}function k_(i,e,t={}){let n=new je;return i.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(s,o,l,c,h){let m=new kr({next:_=>{m.Za(),o.enqueueAndForget(()=>cd(s,p));let b=_.docs.has(l);!b&&_.fromCache?h.reject(new D(x.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&_.fromCache&&c&&c.source==="server"?h.reject(new D(x.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(_)},error:_=>h.reject(_)}),p=new to(Nr(l.path),m,{includeMetadataChanges:!0,_a:!0});return ld(s,p)}(yield Vr(i),i.asyncQueue,e,t,n)})),n.promise}function fw(i,e){let t=new je;return i.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(r,s,o){return P(this,null,function*(){try{let l=yield Xa(r,s,!0),c=new cl(s,l.Ts),h=c.ma(l.documents),m=c.applyChanges(h,!1);o.resolve(m.snapshot)}catch(l){let c=Br(l,`Failed to execute query '${s} against cache`);o.reject(c)}})}(yield yd(i),e,t)})),t.promise}function V_(i,e,t={}){let n=new je;return i.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(s,o,l,c,h){let m=new kr({next:_=>{m.Za(),o.enqueueAndForget(()=>cd(s,p)),_.fromCache&&c.source==="server"?h.reject(new D(x.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),p=new to(l,m,{includeMetadataChanges:!0,_a:!0});return ld(s,p)}(yield Vr(i),i.asyncQueue,e,t,n)})),n.promise}function pw(i,e){let t=new kr(e);return i.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(r,s){B(r).Y_.add(s),s.next()}(yield Vr(i),t)})),()=>{t.Za(),i.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(r,s){B(r).Y_.delete(s)}(yield Vr(i),t)}))}}function gw(i,e,t,n){let r=function(o,l){let c;return c=typeof o=="string"?Kg().encode(o):o,function(m,p){return new xh(m,p)}(function(m,p){if(m instanceof Uint8Array)return eg(m,p);if(m instanceof ArrayBuffer)return eg(new Uint8Array(m),p);if(m instanceof ReadableStream)return m.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),l)}(t,co(e));i.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){cw(yield vd(i),r,n)}))}function _w(i,e){return i.asyncQueue.enqueue(()=>P(this,null,function*(){return function(n,r){let s=B(n);return s.persistence.runTransaction("Get named query","readonly",o=>s.Gr.getNamedQuery(o,r))}(yield yd(i),e)}))}function O_(i){let e={};return i.timeoutSeconds!==void 0&&(e.timeoutSeconds=i.timeoutSeconds),e}var ng=new Map;function wd(i,e,t){if(!t)throw new D(x.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${e}.`)}function Id(i,e,t,n){if(e===!0&&n===!0)throw new D(x.INVALID_ARGUMENT,`${i} and ${t} cannot be used together.`)}function ig(i){if(!U.isDocumentKey(i))throw new D(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function rg(i){if(U.isDocumentKey(i))throw new D(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function Al(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(i);return e?`a custom ${e} object`:"an object"}}return typeof i=="function"?"a function":j()}function ue(i,e){if("_delegate"in i&&(i=i._delegate),!(i instanceof e)){if(e.name===i.constructor.name)throw new D(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Al(i);throw new D(x.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return i}function M_(i,e){if(e<=0)throw new D(x.INVALID_ARGUMENT,`Function ${i}() requires a positive number, but it was: ${e}.`)}var hl=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new D(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new D(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Id("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=O_((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new D(x.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new D(x.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new D(x.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,r){return n.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Pi=class{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hl({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new D(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hl(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Hc;switch(n.type){case"firstParty":return new Xc(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new D(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return P(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let n=ng.get(t);n&&(V("ComponentProvider","Removing Datastore"),ng.delete(t),n.terminate())}(this),Promise.resolve()}};function N_(i,e,t,n={}){var r;let s=(i=ue(i,Pi))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Ft("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),i._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),n.mockUserToken){let l,c;if(typeof n.mockUserToken=="string")l=n.mockUserToken,c=Le.MOCK_USER;else{l=Rf(n.mockUserToken,(r=i._app)===null||r===void 0?void 0:r.options.projectId);let h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new D(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Le(h)}i._authCredentials=new Qc(new ba(l,c))}}var Qe=class i{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new i(this.firestore,e,this._query)}},ve=class i{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Yt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new i(this.firestore,e,this._key)}},Yt=class i extends Qe{constructor(e,t,n){super(e,t,Nr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ve(this.firestore,null,new U(e))}withConverter(e){return new i(this.firestore,e,this._path)}};function Td(i,e,...t){if(i=Ee(i),wd("collection","path",e),i instanceof Pi){let n=ae.fromString(e,...t);return rg(n),new Yt(i,null,n)}{if(!(i instanceof ve||i instanceof Yt))throw new D(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=i._path.child(ae.fromString(e,...t));return rg(n),new Yt(i.firestore,null,n)}}function F_(i,e){if(i=ue(i,Pi),wd("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new D(x.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Qe(i,null,function(n){return new Lt(ae.emptyPath(),n)}(e))}function ho(i,e,...t){if(i=Ee(i),arguments.length===1&&(e=Ca.newId()),wd("doc","path",e),i instanceof Pi){let n=ae.fromString(e,...t);return ig(n),new ve(i,null,new U(n))}{if(!(i instanceof ve||i instanceof Yt))throw new D(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=i._path.child(ae.fromString(e,...t));return ig(n),new ve(i.firestore,i instanceof Yt?i.converter:null,new U(n))}}function Ed(i,e){return i=Ee(i),e=Ee(e),(i instanceof ve||i instanceof Yt)&&(e instanceof ve||e instanceof Yt)&&i.firestore===e.firestore&&i.path===e.path&&i.converter===e.converter}function bd(i,e){return i=Ee(i),e=Ee(e),i instanceof Qe&&e instanceof Qe&&i.firestore===e.firestore&&ao(i._query,e._query)&&i.converter===e.converter}var dl=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new eo(this,"async_queue_retry"),this.Vu=()=>{let n=Ea();n&&V("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;let t=Ea();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=Ea();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new je;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return P(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Jn(e))throw e;V("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;let r=function(o){let l=o.message||"";return o.stack&&(l=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),l}(n);throw ke("INTERNAL UNHANDLED ERROR: ",r),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let r=gh.createAndSchedule(this,e,t,n,s=>this.yu(s));return this.Tu.push(r),r}fu(){this.Eu&&j()}verifyOperationInProgress(){}wu(){return P(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function kh(i){return function(t,n){if(typeof t!="object"||t===null)return!1;let r=t;for(let s of n)if(s in r&&typeof r[s]=="function")return!0;return!1}(i,["next","error","complete"])}var Vh=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new je,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var L_=-1,Ae=class extends Pi{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new dl,this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return P(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new dl(e),this._firestoreClient=void 0,yield e}})}};function We(i){if(i._terminated)throw new D(x.FAILED_PRECONDITION,"The client has already been terminated.");return i._firestoreClient||z_(i),i._firestoreClient}function z_(i){var e,t,n;let r=i._freezeSettings(),s=function(l,c,h,m){return new su(l,c,h,m.host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,O_(m.experimentalLongPollingOptions),m.useFetchStreams)}(i._databaseId,((e=i._app)===null||e===void 0?void 0:e.options.appId)||"",i._persistenceKey,r);i._componentsProvider||!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=r.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(i._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),i._firestoreClient=new Dh(i._authCredentials,i._appCheckCredentials,i._queue,s,i._componentsProvider&&function(l){let c=l?._online.build();return{_offline:l?._offline.build(c),_online:c}}(i._componentsProvider))}function B_(i,e){Ft("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=i._freezeSettings();return q_(i,gd.provider,{build:n=>new ul(n,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function U_(i){return P(this,null,function*(){Ft("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=i._freezeSettings();q_(i,gd.provider,{build:t=>new Sh(t,e.cacheSizeBytes)})})}function q_(i,e,t){if((i=ue(i,Ae))._firestoreClient||i._terminated)throw new D(x.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(i._componentsProvider||i._getSettings().localCache)throw new D(x.FAILED_PRECONDITION,"SDK cache is already specified.");i._componentsProvider={_online:e,_offline:t},z_(i)}function j_(i){if(i._initialized&&!i._terminated)throw new D(x.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new je;return i._queue.enqueueAndForgetEvenWhileRestricted(()=>P(this,null,function*(){try{yield function(n){return P(this,null,function*(){if(!qn.D())return Promise.resolve();let r=n+"main";yield qn.delete(r)})}(rd(i._databaseId,i._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function G_(i){return function(t){let n=new je;return t.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return J1(yield vd(t),n)})),n.promise}(We(i=ue(i,Ae)))}function $_(i){return hw(We(i=ue(i,Ae)))}function K_(i){return dw(We(i=ue(i,Ae)))}function H_(i,e){let t=We(i=ue(i,Ae)),n=new Vh;return gw(t,i._databaseId,e,n),n}function Q_(i,e){return _w(We(i=ue(i,Ae)),e).then(t=>t?new Qe(i,null,t.query):null)}var en=class i{constructor(e){this._byteString=e}static fromBase64String(e){try{return new i(Me.fromBase64String(e))}catch(t){throw new D(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new i(Me.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Bt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ve(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var _n=class{constructor(e){this._methodName=e}};var Ri=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return J(this._lat,e._lat)||J(this._long,e._long)}};var no=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,r){if(n.length!==r.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==r[s])return!1;return!0}(this._values,e._values)}};var yw=/^__.*__$/,Oh=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new zt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Qn(e,this.data,t,this.fieldTransforms)}},ml=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new zt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function W_(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw j()}}var fl=class i{constructor(e,t,n,r,s,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new i(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.Ou(e),r}Nu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return pl(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(W_(this.Cu)&&yw.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},Mh=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||co(e)}Qu(e,t,n,r=!1){return new fl({Cu:e,methodName:t,qu:n,path:Ve.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Oi(i){let e=i._freezeSettings(),t=co(i._databaseId);return new Mh(i._databaseId,!!e.ignoreUndefinedProperties,t)}function Sl(i,e,t,n,r,s={}){let o=i.Qu(s.merge||s.mergeFields?2:0,e,t,r);Sd("Data must be an object, but it was:",o,n);let l=J_(n,o),c,h;if(s.merge)c=new It(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){let m=[];for(let p of s.mergeFields){let _=Bh(e,p,t);if(!o.contains(_))throw new D(x.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);e0(m,_)||m.push(_)}c=new It(m),h=o.fieldTransforms.filter(p=>c.covers(p.field))}else c=null,h=o.fieldTransforms;return new Oh(new tt(l),c,h)}var io=class i extends _n{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof i}};function Y_(i,e,t){return new fl({Cu:3,qu:e.settings.qu,methodName:i._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Nh=class i extends _n{_toFieldTransform(e){return new Ai(e.path,new Kn)}isEqual(e){return e instanceof i}},Fh=class i extends _n{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=Y_(this,e,!0),n=this.Ku.map(s=>Mi(s,t)),r=new pn(n);return new Ai(e.path,r)}isEqual(e){return e instanceof i&&wc(this.Ku,e.Ku)}},Lh=class i extends _n{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=Y_(this,e,!0),n=this.Ku.map(s=>Mi(s,t)),r=new gn(n);return new Ai(e.path,r)}isEqual(e){return e instanceof i&&wc(this.Ku,e.Ku)}},zh=class i extends _n{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){let t=new Hn(e.serializer,Fg(e.serializer,this.$u));return new Ai(e.path,t)}isEqual(e){return e instanceof i&&this.$u===e.$u}};function Cd(i,e,t,n){let r=i.Qu(1,e,t);Sd("Data must be an object, but it was:",r,n);let s=[],o=tt.empty();Vi(n,(c,h)=>{let m=xd(e,c,t);h=Ee(h);let p=r.Nu(m);if(h instanceof io)s.push(m);else{let _=Mi(h,p);_!=null&&(s.push(m),o.set(m,_))}});let l=new It(s);return new ml(o,l,r.fieldTransforms)}function Ad(i,e,t,n,r,s){let o=i.Qu(1,e,t),l=[Bh(e,n,t)],c=[r];if(s.length%2!=0)throw new D(x.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)l.push(Bh(e,s[_])),c.push(s[_+1]);let h=[],m=tt.empty();for(let _=l.length-1;_>=0;--_)if(!e0(h,l[_])){let b=l[_],k=c[_];k=Ee(k);let O=o.Nu(b);if(k instanceof io)h.push(b);else{let R=Mi(k,O);R!=null&&(h.push(b),m.set(b,R))}}let p=new It(h);return new ml(m,p,o.fieldTransforms)}function X_(i,e,t,n=!1){return Mi(t,i.Qu(n?4:3,e))}function Mi(i,e){if(Z_(i=Ee(i)))return Sd("Unsupported field value:",e,i),J_(i,e);if(i instanceof _n)return function(n,r){if(!W_(r.Cu))throw r.Bu(`${n._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Bu(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(i,e),null;if(i===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,r){let s=[],o=0;for(let l of n){let c=Mi(l,r.Lu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(i,e)}return function(n,r){if((n=Ee(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Fg(r.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=Ce.fromDate(n);return{timestampValue:br(r.serializer,s)}}if(n instanceof Ce){let s=new Ce(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:br(r.serializer,s)}}if(n instanceof Ri)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof en)return{bytesValue:Hg(r.serializer,n._byteString)};if(n instanceof ve){let s=r.databaseId,o=n.firestore._databaseId;if(!o.isEqual(s))throw r.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:td(n.firestore._databaseId||r.databaseId,n._key.path)}}if(n instanceof no)return function(o,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw l.Bu("VectorValues must only contain numeric values.");return ed(l.serializer,c)})}}}}}}(n,r);throw r.Bu(`Unsupported field value: ${Al(n)}`)}(i,e)}function J_(i,e){let t={};return vg(i)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Vi(i,(n,r)=>{let s=Mi(r,e.Mu(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function Z_(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof Ce||i instanceof Ri||i instanceof en||i instanceof ve||i instanceof _n||i instanceof no)}function Sd(i,e,t){if(!Z_(t)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(t)){let n=Al(t);throw n==="an object"?e.Bu(i+" a custom object"):e.Bu(i+" "+n)}}function Bh(i,e,t){if((e=Ee(e))instanceof Bt)return e._internalPath;if(typeof e=="string")return xd(i,e);throw pl("Field path arguments must be of type string or ",i,!1,void 0,t)}var vw=new RegExp("[~\\*/\\[\\]]");function xd(i,e,t){if(e.search(vw)>=0)throw pl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,t);try{return new Bt(...e.split("."))._internalPath}catch{throw pl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,t)}}function pl(i,e,t,n,r){let s=n&&!n.isEmpty(),o=r!==void 0,l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${n}`),o&&(c+=` in document ${r}`),c+=")"),new D(x.INVALID_ARGUMENT,l+i+c)}function e0(i,e){return i.some(t=>t.isEqual(e))}var Di=class{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ve(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Uh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(xl("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Uh=class extends Di{data(){return super.data()}};function xl(i,e){return typeof e=="string"?xd(i,e):e instanceof Bt?e._internalPath:e._delegate._internalPath}function t0(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new D(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ro=class{},ki=class extends ro{};function wn(i,e,...t){let n=[];e instanceof ro&&n.push(e),n=n.concat(t),function(s){let o=s.filter(c=>c instanceof qh).length,l=s.filter(c=>c instanceof gl).length;if(o>1||o>0&&l>0)throw new D(x.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let r of n)i=r._apply(i);return i}var gl=class i extends ki{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=this._parse(e);return h0(e._query,t),new Qe(e.firestore,e.converter,yu(e._query,t))}_parse(e){let t=Oi(e.firestore);return function(s,o,l,c,h,m,p){let _;if(h.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new D(x.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){og(p,m);let b=[];for(let k of p)b.push(sg(c,s,k));_={arrayValue:{values:b}}}else _=sg(c,s,p)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||og(p,m),_=X_(l,o,p,m==="in"||m==="not-in");return ie.create(h,m,_)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function n0(i,e,t){let n=e,r=xl("where",i);return gl._create(r,n,t)}var qh=class i extends ro{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new i(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:me.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(r,s){let o=r,l=s.getFlattenedFilters();for(let c of l)h0(o,c),o=yu(o,c)}(e._query,t),new Qe(e.firestore,e.converter,yu(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var jh=class i extends ki{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new i(e,t)}_apply(e){let t=function(r,s,o){if(r.startAt!==null)throw new D(x.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new D(x.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new bi(s,o)}(e._query,this._field,this._direction);return new Qe(e.firestore,e.converter,function(r,s){let o=r.explicitOrderBy.concat([s]);return new Lt(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}};function i0(i,e="asc"){let t=e,n=xl("orderBy",i);return jh._create(n,t)}var _l=class i extends ki{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new i(e,t,n)}_apply(e){return new Qe(e.firestore,e.converter,Ma(e._query,this._limit,this._limitType))}};function r0(i){return M_("limit",i),_l._create("limit",i,"F")}function s0(i){return M_("limitToLast",i),_l._create("limitToLast",i,"L")}var yl=class i extends ki{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=u0(e,this.type,this._docOrFields,this._inclusive);return new Qe(e.firestore,e.converter,function(r,s){return new Lt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)}(e._query,t))}};function o0(...i){return yl._create("startAt",i,!0)}function a0(...i){return yl._create("startAfter",i,!1)}var vl=class i extends ki{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=u0(e,this.type,this._docOrFields,this._inclusive);return new Qe(e.firestore,e.converter,function(r,s){return new Lt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)}(e._query,t))}};function l0(...i){return vl._create("endBefore",i,!1)}function c0(...i){return vl._create("endAt",i,!0)}function u0(i,e,t,n){if(t[0]=Ee(t[0]),t[0]instanceof Di)return function(s,o,l,c,h){if(!c)throw new D(x.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${l}().`);let m=[];for(let p of gr(s))if(p.field.isKeyField())m.push(Ei(o,c.key));else{let _=c.data.field(p.field);if(Il(_))throw new D(x.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let b=p.field.canonicalString();throw new D(x.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${b}' (used as the orderBy) does not exist.`)}m.push(_)}return new Jt(m,h)}(i._query,i.firestore._databaseId,e,t[0]._document,n);{let r=Oi(i.firestore);return function(o,l,c,h,m,p){let _=o.explicitOrderBy;if(m.length>_.length)throw new D(x.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let b=[];for(let k=0;k<m.length;k++){let O=m[k];if(_[k].field.isKeyField()){if(typeof O!="string")throw new D(x.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof O}`);if(!Jh(o)&&O.indexOf("/")!==-1)throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${O}' contains a slash.`);let R=o.path.child(ae.fromString(O));if(!U.isDocumentKey(R))throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);let K=new U(R);b.push(Ei(l,K))}else{let R=X_(c,h,O);b.push(R)}}return new Jt(b,p)}(i._query,i.firestore._databaseId,r,e,t,n)}}function sg(i,e,t){if(typeof(t=Ee(t))=="string"){if(t==="")throw new D(x.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Jh(e)&&t.indexOf("/")!==-1)throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(ae.fromString(t));if(!U.isDocumentKey(n))throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Ei(i,new U(n))}if(t instanceof ve)return Ei(i,t._key);throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Al(t)}.`)}function og(i,e){if(!Array.isArray(i)||i.length===0)throw new D(x.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function h0(i,e){let t=function(r,s){for(let o of r)for(let l of o.getFlattenedFilters())if(s.indexOf(l.op)>=0)return l.op;return null}(i.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new D(x.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(x.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Or=class{convertValue(e,t="none"){switch(Ti(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Te(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(jn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw j()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return Vi(e,(r,s)=>{n[r]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,r;let s=(r=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||r===void 0?void 0:r.map(o=>Te(o.doubleValue));return new no(s)}convertGeoPoint(e){return new Ri(Te(e.latitude),Te(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=Yh(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Us(e));default:return null}}convertTimestamp(e){let t=fn(e);return new Ce(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=ae.fromString(e);G(r_(n));let r=new Gn(n.get(1),n.get(3)),s=new U(n.popFirst(5));return r.isEqual(t)||ke(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Pl(i,e,t){let n;return n=i?t&&(t.merge||t.mergeFields)?i.toFirestore(e,t):i.toFirestore(e):e,n}var Gh=class extends Or{constructor(e){super(),this.firestore=e}convertBytes(e){return new en(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ve(this.firestore,null,t)}};var mn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Dt=class extends Di{constructor(e,t,n,r,s,o){super(e,t,n,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Bn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(xl("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}},Bn=class extends Dt{data(e={}){return super.data(e)}},Ut=class{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new mn(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Bn(this._firestore,this._userDataWriter,n.key,n,new mn(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(l=>{let c=new Bn(r._firestore,r._userDataWriter,l.doc.key,l.doc,new mn(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(l=>s||l.type!==3).map(l=>{let c=new Bn(r._firestore,r._userDataWriter,l.doc.key,l.doc,new mn(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter),h=-1,m=-1;return l.type!==0&&(h=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),m=o.indexOf(l.doc.key)),{type:ww(l.type),doc:c,oldIndex:h,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function ww(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return j()}}function Pd(i,e){return i instanceof Dt&&e instanceof Dt?i._firestore===e._firestore&&i._key.isEqual(e._key)&&(i._document===null?e._document===null:i._document.isEqual(e._document))&&i._converter===e._converter:i instanceof Ut&&e instanceof Ut&&i._firestore===e._firestore&&bd(i.query,e.query)&&i.metadata.isEqual(e.metadata)&&i._snapshot.isEqual(e._snapshot)}function d0(i){i=ue(i,ve);let e=ue(i.firestore,Ae);return k_(We(e),i._key).then(t=>Vd(e,i,t))}var yn=class extends Or{constructor(e){super(),this.firestore=e}convertBytes(e){return new en(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ve(this.firestore,null,t)}};function m0(i){i=ue(i,ve);let e=ue(i.firestore,Ae),t=We(e),n=new yn(e);return mw(t,i._key).then(r=>new Dt(e,n,i._key,r,new mn(r!==null&&r.hasLocalMutations,!0),i.converter))}function f0(i){i=ue(i,ve);let e=ue(i.firestore,Ae);return k_(We(e),i._key,{source:"server"}).then(t=>Vd(e,i,t))}function p0(i){i=ue(i,Qe);let e=ue(i.firestore,Ae),t=We(e),n=new yn(e);return t0(i._query),V_(t,i._query).then(r=>new Ut(e,n,i,r))}function g0(i){i=ue(i,Qe);let e=ue(i.firestore,Ae),t=We(e),n=new yn(e);return fw(t,i._query).then(r=>new Ut(e,n,i,r))}function _0(i){i=ue(i,Qe);let e=ue(i.firestore,Ae),t=We(e),n=new yn(e);return V_(t,i._query,{source:"server"}).then(r=>new Ut(e,n,i,r))}function Rd(i,e,t){i=ue(i,ve);let n=ue(i.firestore,Ae),r=Pl(i.converter,e,t);return Ur(n,[Sl(Oi(n),"setDoc",i._key,r,i.converter!==null,t).toMutation(i._key,Re.none())])}function Dd(i,e,t,...n){i=ue(i,ve);let r=ue(i.firestore,Ae),s=Oi(r),o;return o=typeof(e=Ee(e))=="string"||e instanceof Bt?Ad(s,"updateDoc",i._key,e,t,n):Cd(s,"updateDoc",i._key,e),Ur(r,[o.toMutation(i._key,Re.exists(!0))])}function y0(i){return Ur(ue(i.firestore,Ae),[new Wn(i._key,Re.none())])}function v0(i,e){let t=ue(i.firestore,Ae),n=ho(i),r=Pl(i.converter,e);return Ur(t,[Sl(Oi(i.firestore),"addDoc",n._key,r,i.converter!==null,{}).toMutation(n._key,Re.exists(!1))]).then(()=>n)}function kd(i,...e){var t,n,r;i=Ee(i);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||kh(e[o])||(s=e[o],o++);let l={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(kh(e[o])){let p=e[o];e[o]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[o+1]=(n=p.error)===null||n===void 0?void 0:n.bind(p),e[o+2]=(r=p.complete)===null||r===void 0?void 0:r.bind(p)}let c,h,m;if(i instanceof ve)h=ue(i.firestore,Ae),m=Nr(i._key.path),c={next:p=>{e[o]&&e[o](Vd(h,i,p))},error:e[o+1],complete:e[o+2]};else{let p=ue(i,Qe);h=ue(p.firestore,Ae),m=p._query;let _=new yn(h);c={next:b=>{e[o]&&e[o](new Ut(h,_,p,b))},error:e[o+1],complete:e[o+2]},t0(i._query)}return function(_,b,k,O){let R=new kr(O),K=new to(b,R,k);return _.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return ld(yield Vr(_),K)})),()=>{R.Za(),_.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return cd(yield Vr(_),K)}))}}(We(h),m,l,c)}function w0(i,e){return pw(We(i=ue(i,Ae)),kh(e)?e:{next:e})}function Ur(i,e){return function(n,r){let s=new je;return n.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return Q1(yield vd(n),r,s)})),s.promise}(We(i),e)}function Vd(i,e,t){let n=t.docs.get(e._key),r=new yn(i);return new Dt(i,r,e._key,n,new mn(t.hasPendingWrites,t.fromCache),e.converter)}var Iw={maxAttempts:5};var wl=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Oi(e)}set(e,t,n){this._verifyNotCommitted();let r=Ln(e,this._firestore),s=Pl(r.converter,t,n),o=Sl(this._dataReader,"WriteBatch.set",r._key,s,r.converter!==null,n);return this._mutations.push(o.toMutation(r._key,Re.none())),this}update(e,t,n,...r){this._verifyNotCommitted();let s=Ln(e,this._firestore),o;return o=typeof(t=Ee(t))=="string"||t instanceof Bt?Ad(this._dataReader,"WriteBatch.update",s._key,t,n,r):Cd(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Re.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Ln(e,this._firestore);return this._mutations=this._mutations.concat(new Wn(t._key,Re.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(x.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ln(i,e){if((i=Ee(i)).firestore!==e)throw new D(x.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return i}var $h=class extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=Oi(t)}get(t){let n=Ln(t,this._firestore),r=new Gh(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||s.length!==1)return j();let o=s[0];if(o.isFoundDocument())return new Di(this._firestore,r,o.key,o,n.converter);if(o.isNoDocument())return new Di(this._firestore,r,n._key,null,n.converter);throw j()})}set(t,n,r){let s=Ln(t,this._firestore),o=Pl(s.converter,n,r),l=Sl(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,r);return this._transaction.set(s._key,l),this}update(t,n,r,...s){let o=Ln(t,this._firestore),l;return l=typeof(n=Ee(n))=="string"||n instanceof Bt?Ad(this._dataReader,"Transaction.update",o._key,n,r,s):Cd(this._dataReader,"Transaction.update",o._key,n),this._transaction.update(o._key,l),this}delete(t){let n=Ln(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Ln(e,this._firestore),n=new yn(this._firestore);return super.get(e).then(r=>new Dt(this._firestore,n,t._key,r._document,new mn(!1,!1),t.converter))}};function I0(i,e,t){i=ue(i,Ae);let n=Object.assign(Object.assign({},Iw),t);return function(s){if(s.maxAttempts<1)throw new D(x.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,o,l){let c=new je;return s.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){let h=yield uw(s);new Rh(s.asyncQueue,h,l,o,c).au()})),c.promise}(We(i),r=>e(new $h(i,r)),n)}function T0(){return new io("deleteField")}function E0(){return new Nh("serverTimestamp")}function b0(...i){return new Fh("arrayUnion",i)}function C0(...i){return new Lh("arrayRemove",i)}function A0(i){return new zh("increment",i)}(function(e,t=!0){(function(r){Mr=r})(Vf),ws(new da("firestore",(n,{instanceIdentifier:r,options:s})=>{let o=n.getProvider("app").getImmediate(),l=new Ae(new Wc(n.getProvider("auth-internal")),new Zc(n.getProvider("app-check-internal")),function(h,m){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new D(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Gn(h.options.projectId,m)}(o,r),o);return s=Object.assign({useFetchStreams:t},s),l._setSettings(s),l},"PUBLIC").setMultipleInstances(!0)),kn(rp,"4.7.3",e),kn(rp,"4.7.3","esm2017")})();var Rl=class{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Tw="@firebase/firestore-compat",Ew="0.3.38";function zd(i,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new D("invalid-argument",`Invalid options passed to function ${i}(): You cannot specify both "merge" and "mergeFields".`);return e}function S0(){if(typeof Uint8Array>"u")throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function x0(){if(!wg())throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Dl=class i{constructor(e){this._delegate=e}static fromBase64String(e){return x0(),new i(en.fromBase64String(e))}static fromUint8Array(e){return S0(),new i(en.fromUint8Array(e))}toBase64(){return x0(),this._delegate.toBase64()}toUint8Array(){return S0(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Od(i){return bw(i,["next","error","complete"])}function bw(i,e){if(typeof i!="object"||i===null)return!1;let t=i;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}var Md=class{enableIndexedDbPersistence(e,t){return B_(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return U_(e._delegate)}clearIndexedDbPersistence(e){return j_(e._delegate)}},kl=class{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Gn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ft("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){N_(this._delegate,e,t,n)}enableNetwork(){return $_(this._delegate)}disableNetwork(){return K_(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Id("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return G_(this._delegate)}onSnapshotsInSync(e){return w0(this._delegate,e)}get app(){if(!this._appCompat)throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Gr(this,Td(this._delegate,e))}catch(t){throw at(t,"collection()","Firestore.collection()")}}doc(e){try{return new tn(this,ho(this._delegate,e))}catch(t){throw at(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new zi(this,F_(this._delegate,e))}catch(t){throw at(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return I0(this._delegate,t=>e(new Vl(this,t)))}batch(){return We(this._delegate),new Ol(new wl(this._delegate,e=>Ur(this._delegate,e)))}loadBundle(e){return H_(this._delegate,e)}namedQuery(e){return Q_(this._delegate,e).then(t=>t?new zi(this,t):null)}},qr=class extends Or{constructor(e){super(),this.firestore=e}convertBytes(e){return new Dl(new en(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return tn.forKey(t,this.firestore,null)}};function Cw(i){ag(i)}var Vl=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new qr(e)}get(e){let t=Ni(e);return this._delegate.get(t).then(n=>new Fi(this._firestore,new Dt(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){let r=Ni(e);return n?(zd("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){let s=Ni(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...r),this}delete(e){let t=Ni(e);return this._delegate.delete(t),this}},Ol=class{constructor(e){this._delegate=e}set(e,t,n){let r=Ni(e);return n?(zd("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){let s=Ni(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...r),this}delete(e){let t=Ni(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},jr=class i{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new Bn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Li(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=i.INSTANCES,r=n.get(e);r||(r=new WeakMap,n.set(e,r));let s=r.get(t);return s||(s=new i(e,new qr(e),t),r.set(t,s)),s}};jr.INSTANCES=new WeakMap;var tn=class i{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new qr(e)}static forPath(e,t,n){if(e.length%2!==0)throw new D("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new i(t,new ve(t._delegate,n,new U(e)))}static forKey(e,t,n){return new i(t,new ve(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Gr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Gr(this.firestore,Td(this._delegate,e))}catch(t){throw at(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=Ee(e),e instanceof ve?Ed(this._delegate,e):!1}set(e,t){t=zd("DocumentReference.set",t);try{return t?Rd(this._delegate,e,t):Rd(this._delegate,e)}catch(n){throw at(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return arguments.length===1?Dd(this._delegate,e):Dd(this._delegate,e,t,...n)}catch(r){throw at(r,"updateDoc()","DocumentReference.update()")}}delete(){return y0(this._delegate)}onSnapshot(...e){let t=P0(e),n=R0(e,r=>new Fi(this.firestore,new Dt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)));return kd(this._delegate,t,n)}get(e){let t;return e?.source==="cache"?t=m0(this._delegate):e?.source==="server"?t=f0(this._delegate):t=d0(this._delegate),t.then(n=>new Fi(this.firestore,new Dt(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new i(this.firestore,e?this._delegate.withConverter(jr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function at(i,e,t){return i.message=i.message.replace(e,t),i}function P0(i){for(let e of i)if(typeof e=="object"&&!Od(e))return e;return{}}function R0(i,e){var t,n;let r;return Od(i[0])?r=i[0]:Od(i[1])?r=i[1]:typeof i[0]=="function"?r={next:i[0],error:i[1],complete:i[2]}:r={next:i[1],error:i[2],complete:i[3]},{next:s=>{r.next&&r.next(e(s))},error:(t=r.error)===null||t===void 0?void 0:t.bind(r),complete:(n=r.complete)===null||n===void 0?void 0:n.bind(r)}}var Fi=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new tn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Pd(this._delegate,e._delegate)}},Li=class extends Fi{data(e){let t=this._delegate.data(e);return this._delegate._converter||lg(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},zi=class i{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new qr(e)}where(e,t,n){try{return new i(this.firestore,wn(this._delegate,n0(e,t,n)))}catch(r){throw at(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new i(this.firestore,wn(this._delegate,i0(e,t)))}catch(n){throw at(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new i(this.firestore,wn(this._delegate,r0(e)))}catch(t){throw at(t,"limit()","Query.limit()")}}limitToLast(e){try{return new i(this.firestore,wn(this._delegate,s0(e)))}catch(t){throw at(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new i(this.firestore,wn(this._delegate,o0(...e)))}catch(t){throw at(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new i(this.firestore,wn(this._delegate,a0(...e)))}catch(t){throw at(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new i(this.firestore,wn(this._delegate,l0(...e)))}catch(t){throw at(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new i(this.firestore,wn(this._delegate,c0(...e)))}catch(t){throw at(t,"endAt()","Query.endAt()")}}isEqual(e){return bd(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=g0(this._delegate):e?.source==="server"?t=_0(this._delegate):t=p0(this._delegate),t.then(n=>new mo(this.firestore,new Ut(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){let t=P0(e),n=R0(e,r=>new mo(this.firestore,new Ut(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)));return kd(this._delegate,t,n)}withConverter(e){return new i(this.firestore,e?this._delegate.withConverter(jr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},Nd=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Li(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},mo=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new zi(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Li(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Nd(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new Li(this._firestore,n))})}isEqual(e){return Pd(this._delegate,e._delegate)}},Gr=class i extends zi{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new tn(this.firestore,e):null}doc(e){try{return e===void 0?new tn(this.firestore,ho(this._delegate)):new tn(this.firestore,ho(this._delegate,e))}catch(t){throw at(t,"doc()","CollectionReference.doc()")}}add(e){return v0(this._delegate,e).then(t=>new tn(this.firestore,t))}isEqual(e){return Ed(this._delegate,e._delegate)}withConverter(e){return new i(this.firestore,e?this._delegate.withConverter(jr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Ni(i){return ue(i,ve)}var Fd=class i{constructor(...e){this._delegate=new Bt(...e)}static documentId(){return new i(Ve.keyField().canonicalString())}isEqual(e){return e=Ee(e),e instanceof Bt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Ld=class i{constructor(e){this._delegate=e}static serverTimestamp(){let e=E0();return e._methodName="FieldValue.serverTimestamp",new i(e)}static delete(){let e=T0();return e._methodName="FieldValue.delete",new i(e)}static arrayUnion(...e){let t=b0(...e);return t._methodName="FieldValue.arrayUnion",new i(t)}static arrayRemove(...e){let t=C0(...e);return t._methodName="FieldValue.arrayRemove",new i(t)}static increment(e){let t=A0(e);return t._methodName="FieldValue.increment",new i(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var Aw={Firestore:kl,GeoPoint:Ri,Timestamp:Ce,Blob:Dl,Transaction:Vl,WriteBatch:Ol,DocumentReference:tn,DocumentSnapshot:Fi,Query:zi,QueryDocumentSnapshot:Li,QuerySnapshot:mo,CollectionReference:Gr,FieldPath:Fd,FieldValue:Ld,setLogLevel:Cw,CACHE_SIZE_UNLIMITED:L_};function Sw(i,e){i.INTERNAL.registerComponent(new Rl("firestore-compat",t=>{let n=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore").getImmediate();return e(n,r)},"PUBLIC").setServiceProps(Object.assign({},Aw)))}function xw(i){Sw(i,(e,t)=>new kl(e,t,new Md)),i.registerVersion(Tw,Ew)}xw(ft);function Pw(i,e=Lo){return new Gi(t=>{let n;return e!=null?e.schedule(()=>{n=i.onSnapshot({includeMetadataChanges:!0},t)}):n=i.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}function D0(i,e){return Pw(i,e)}function Rw(i,e){return D0(i,e).pipe(Uo(void 0),zo(),Ke(t=>{let[n,r]=t;return r.exists?n?.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}}))}function qd(i,e){return D0(i,e).pipe(Ke(t=>({payload:t,type:"query"})))}var Ml=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let n=this.ref.collection(e),{ref:r,query:s}=N0(n,t);return new Fl(r,s,this.afs)}snapshotChanges(){return Rw(this.ref,this.afs.schedulers.outsideAngular).pipe(pt)}valueChanges(e={}){return this.snapshotChanges().pipe(Ke(({payload:t})=>e.idField?hc(Vt({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Cn(this.ref.get(e)).pipe(pt)}};function Nl(i,e){return qd(i,e).pipe(Uo(void 0),zo(),Ke(t=>{let[n,r]=t,s=r.payload.docChanges(),o=s.map(l=>({type:l.type,payload:l}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((l,c)=>{let h=s.find(p=>p.doc.ref.isEqual(l.ref)),m=n?.payload.docs.find(p=>p.ref.isEqual(l.ref));h&&JSON.stringify(h.doc.metadata)===JSON.stringify(l.metadata)||!h&&m&&JSON.stringify(m.metadata)===JSON.stringify(l.metadata)||o.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:l}})}),o}))}function k0(i,e,t){return Nl(i,t).pipe(Bo((n,r)=>Dw(n,r.map(s=>s.payload),e),[]),Wm(),Ke(n=>n.map(r=>({type:r.type,payload:r}))))}function Dw(i,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(i=kw(i,n))}),i}function Bd(i,e,t,...n){let r=i.slice();return r.splice(e,t,...n),r}function kw(i,e){switch(e.type){case"added":if(!(i[e.newIndex]&&i[e.newIndex].doc.ref.isEqual(e.doc.ref)))return Bd(i,e.newIndex,0,e);break;case"modified":if(i[e.oldIndex]==null||i[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=i.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return Bd(i,e.newIndex,1,e);break;case"removed":if(i[e.oldIndex]&&i[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Bd(i,e.oldIndex,1);break}return i}function V0(i){return(!i||i.length===0)&&(i=["added","removed","modified"]),i}var Fl=class{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=Nl(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Ke(n=>n.filter(r=>e.indexOf(r.type)>-1)))),t.pipe(Uo(void 0),zo(),us(([n,r])=>r.length>0||!n),Ke(([,n])=>n),pt)}auditTrail(e){return this.stateChanges(e).pipe(Bo((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=V0(e);return k0(this.query,t,this.afs.schedulers.outsideAngular).pipe(pt)}valueChanges(e={}){return qd(this.query,this.afs.schedulers.outsideAngular).pipe(Ke(t=>t.payload.docs.map(n=>e.idField?hc(Vt({},n.data()),{[e.idField]:n.id}):n.data())),pt)}get(e){return Cn(this.query.get(e)).pipe(pt)}add(e){return this.ref.add(e)}doc(e){return new Ml(this.ref.doc(e),this.afs)}},Ud=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Nl(this.query,this.afs.schedulers.outsideAngular).pipe(pt):Nl(this.query,this.afs.schedulers.outsideAngular).pipe(Ke(t=>t.filter(n=>e.indexOf(n.type)>-1)),us(t=>t.length>0),pt)}auditTrail(e){return this.stateChanges(e).pipe(Bo((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=V0(e);return k0(this.query,t,this.afs.schedulers.outsideAngular).pipe(pt)}valueChanges(e={}){return qd(this.query,this.afs.schedulers.outsideAngular).pipe(Ke(n=>n.payload.docs.map(r=>e.idField?Vt({[e.idField]:r.id},r.data()):r.data())),pt)}get(e){return Cn(this.query.get(e)).pipe(pt)}},O0=new He("angularfire2.enableFirestorePersistence"),M0=new He("angularfire2.firestore.persistenceSettings"),Vw=new He("angularfire2.firestore.settings"),Ow=new He("angularfire2.firestore.use-emulator");function N0(i,e=t=>t){return{query:e(i),ref:i}}var jd=(()=>{class i{schedulers;firestore;persistenceEnabled$;constructor(t,n,r,s,o,l,c,h,m,p,_,b,k,O,R,K,Q){this.schedulers=c;let z=Cs(t,l,n),W=m;p&&Mc(z,l,_,k,O,R,b,K),[this.firestore,this.persistenceEnabled$]=ha(`${z.name}.firestore`,"AngularFirestore",z.name,()=>{let Z=l.runOutsideAngular(()=>z.firestore());if(s&&Z.settings(s),W&&Z.useEmulator(...W),r&&!Yo(o)){let ee=()=>{try{return Cn(Z.enablePersistence(h||void 0).then(()=>!0,()=>!1))}catch(w){return typeof console<"u"&&console.warn(w),An(!1)}};return[Z,l.runOutsideAngular(ee)]}else return[Z,An(!1)]},[s,W,r])}collection(t,n){let r;typeof t=="string"?r=this.firestore.collection(t):r=t;let{ref:s,query:o}=N0(r,n),l=this.schedulers.ngZone.run(()=>s);return new Fl(l,o,this)}collectionGroup(t,n){let r=n||(o=>o),s=this.firestore.collectionGroup(t);return new Ud(r(s),this)}doc(t){let n;typeof t=="string"?n=this.firestore.doc(t):n=t;let r=this.schedulers.ngZone.run(()=>n);return new Ml(r,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||i)(Y(nr),Y(ir,8),Y(O0,8),Y(Vw,8),Y(bt),Y(ut),Y(la),Y(M0,8),Y(Ow,8),Y(tp,8),Y(Pc,8),Y(Rc,8),Y(Dc,8),Y(kc,8),Y(Vc,8),Y(Oc,8),Y(mi,8))};static \u0275prov=lt({token:i,factory:i.\u0275fac,providedIn:"any"})}return i})(),F0=(()=>{class i{constructor(){ft.registerVersion("angularfire",tr.full,"fst-compat")}static enablePersistence(t){return{ngModule:i,providers:[{provide:O0,useValue:!0},{provide:M0,useValue:t}]}}static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ue({type:i});static \u0275inj=Be({providers:[jd]})}return i})();var Ll=(()=>{class i{constructor(t){this.db=t,this.dbPath="/puzzledata",this.puzzleDataRef=this.db.collection(this.dbPath)}getAll(){return this.puzzleDataRef}create(t){return this.puzzleDataRef.add(Vt({},t))}update(t,n){return this.puzzleDataRef.doc(t).update(n)}delete(t){return this.puzzleDataRef.doc(t).delete()}static{this.\u0275fac=function(n){return new(n||i)(Y(jd))}}static{this.\u0275prov=lt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var zl=(()=>{class i{constructor(){this.subjectItemUpdate=new $i}updatePerformedItem(t){this.subjectItemUpdate.next(t)}getUpdatedStageLevel(){return this.subjectItemUpdate.asObservable()}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=lt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var fo=(()=>{class i extends xt{static \u0275fac=(()=>{let t;return function(r){return(t||(t=Et(i)))(r||i)}})();static \u0275cmp=_e({type:i,selectors:[["CheckIcon"]],features:[Ct],decls:2,vars:5,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M4.86199 11.5948C4.78717 11.5923 4.71366 11.5745 4.64596 11.5426C4.57826 11.5107 4.51779 11.4652 4.46827 11.4091L0.753985 7.69483C0.683167 7.64891 0.623706 7.58751 0.580092 7.51525C0.536478 7.44299 0.509851 7.36177 0.502221 7.27771C0.49459 7.19366 0.506156 7.10897 0.536046 7.03004C0.565935 6.95111 0.613367 6.88 0.674759 6.82208C0.736151 6.76416 0.8099 6.72095 0.890436 6.69571C0.970973 6.67046 1.05619 6.66385 1.13966 6.67635C1.22313 6.68886 1.30266 6.72017 1.37226 6.76792C1.44186 6.81567 1.4997 6.8786 1.54141 6.95197L4.86199 10.2503L12.6397 2.49483C12.7444 2.42694 12.8689 2.39617 12.9932 2.40745C13.1174 2.41873 13.2343 2.47141 13.3251 2.55705C13.4159 2.64268 13.4753 2.75632 13.4938 2.87973C13.5123 3.00315 13.4888 3.1292 13.4271 3.23768L5.2557 11.4091C5.20618 11.4652 5.14571 11.5107 5.07801 11.5426C5.01031 11.5745 4.9368 11.5923 4.86199 11.5948Z","fill","currentColor"]],template:function(n,r){n&1&&(Tt(),L(0,"svg",0),X(1,"path",1),q()),n&2&&(xe(r.getClassNames()),re("aria-label",r.ariaLabel)("aria-hidden",r.ariaHidden)("role",r.role))},encapsulation:2})}return i})();var po=(()=>{class i extends xt{pathId;ngOnInit(){this.pathId="url(#"+rt()+")"}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Et(i)))(r||i)}})();static \u0275cmp=_e({type:i,selectors:[["ExclamationTriangleIcon"]],features:[Ct],decls:8,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M13.4018 13.1893H0.598161C0.49329 13.189 0.390283 13.1615 0.299143 13.1097C0.208003 13.0578 0.131826 12.9832 0.0780112 12.8932C0.0268539 12.8015 0 12.6982 0 12.5931C0 12.4881 0.0268539 12.3848 0.0780112 12.293L6.47985 1.08982C6.53679 1.00399 6.61408 0.933574 6.70484 0.884867C6.7956 0.836159 6.897 0.810669 7 0.810669C7.103 0.810669 7.2044 0.836159 7.29516 0.884867C7.38592 0.933574 7.46321 1.00399 7.52015 1.08982L13.922 12.293C13.9731 12.3848 14 12.4881 14 12.5931C14 12.6982 13.9731 12.8015 13.922 12.8932C13.8682 12.9832 13.792 13.0578 13.7009 13.1097C13.6097 13.1615 13.5067 13.189 13.4018 13.1893ZM1.63046 11.989H12.3695L7 2.59425L1.63046 11.989Z","fill","currentColor"],["d","M6.99996 8.78801C6.84143 8.78594 6.68997 8.72204 6.57787 8.60993C6.46576 8.49782 6.40186 8.34637 6.39979 8.18784V5.38703C6.39979 5.22786 6.46302 5.0752 6.57557 4.96265C6.68813 4.85009 6.84078 4.78686 6.99996 4.78686C7.15914 4.78686 7.31179 4.85009 7.42435 4.96265C7.5369 5.0752 7.60013 5.22786 7.60013 5.38703V8.18784C7.59806 8.34637 7.53416 8.49782 7.42205 8.60993C7.30995 8.72204 7.15849 8.78594 6.99996 8.78801Z","fill","currentColor"],["d","M6.99996 11.1887C6.84143 11.1866 6.68997 11.1227 6.57787 11.0106C6.46576 10.8985 6.40186 10.7471 6.39979 10.5885V10.1884C6.39979 10.0292 6.46302 9.87658 6.57557 9.76403C6.68813 9.65147 6.84078 9.58824 6.99996 9.58824C7.15914 9.58824 7.31179 9.65147 7.42435 9.76403C7.5369 9.87658 7.60013 10.0292 7.60013 10.1884V10.5885C7.59806 10.7471 7.53416 10.8985 7.42205 11.0106C7.30995 11.1227 7.15849 11.1866 6.99996 11.1887Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,r){n&1&&(Tt(),L(0,"svg",0)(1,"g"),X(2,"path",1)(3,"path",2)(4,"path",3),q(),L(5,"defs")(6,"clipPath",4),X(7,"rect",5),q()()()),n&2&&(xe(r.getClassNames()),re("aria-label",r.ariaLabel)("aria-hidden",r.ariaHidden)("role",r.role),M(),re("clip-path",r.pathId),M(5),N("id",r.pathId))},encapsulation:2})}return i})();var go=(()=>{class i extends xt{pathId;ngOnInit(){this.pathId="url(#"+rt()+")"}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Et(i)))(r||i)}})();static \u0275cmp=_e({type:i,selectors:[["InfoCircleIcon"]],features:[Ct],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M3.11101 12.8203C4.26215 13.5895 5.61553 14 7 14C8.85652 14 10.637 13.2625 11.9497 11.9497C13.2625 10.637 14 8.85652 14 7C14 5.61553 13.5895 4.26215 12.8203 3.11101C12.0511 1.95987 10.9579 1.06266 9.67879 0.532846C8.3997 0.00303296 6.99224 -0.13559 5.63437 0.134506C4.2765 0.404603 3.02922 1.07129 2.05026 2.05026C1.07129 3.02922 0.404603 4.2765 0.134506 5.63437C-0.13559 6.99224 0.00303296 8.3997 0.532846 9.67879C1.06266 10.9579 1.95987 12.0511 3.11101 12.8203ZM3.75918 2.14976C4.71846 1.50879 5.84628 1.16667 7 1.16667C8.5471 1.16667 10.0308 1.78125 11.1248 2.87521C12.2188 3.96918 12.8333 5.45291 12.8333 7C12.8333 8.15373 12.4912 9.28154 11.8502 10.2408C11.2093 11.2001 10.2982 11.9478 9.23232 12.3893C8.16642 12.8308 6.99353 12.9463 5.86198 12.7212C4.73042 12.4962 3.69102 11.9406 2.87521 11.1248C2.05941 10.309 1.50384 9.26958 1.27876 8.13803C1.05367 7.00647 1.16919 5.83358 1.61071 4.76768C2.05222 3.70178 2.79989 2.79074 3.75918 2.14976ZM7.00002 4.8611C6.84594 4.85908 6.69873 4.79698 6.58977 4.68801C6.48081 4.57905 6.4187 4.43185 6.41669 4.27776V3.88888C6.41669 3.73417 6.47815 3.58579 6.58754 3.4764C6.69694 3.367 6.84531 3.30554 7.00002 3.30554C7.15473 3.30554 7.3031 3.367 7.4125 3.4764C7.52189 3.58579 7.58335 3.73417 7.58335 3.88888V4.27776C7.58134 4.43185 7.51923 4.57905 7.41027 4.68801C7.30131 4.79698 7.1541 4.85908 7.00002 4.8611ZM7.00002 10.6945C6.84594 10.6925 6.69873 10.6304 6.58977 10.5214C6.48081 10.4124 6.4187 10.2652 6.41669 10.1111V6.22225C6.41669 6.06754 6.47815 5.91917 6.58754 5.80977C6.69694 5.70037 6.84531 5.63892 7.00002 5.63892C7.15473 5.63892 7.3031 5.70037 7.4125 5.80977C7.52189 5.91917 7.58335 6.06754 7.58335 6.22225V10.1111C7.58134 10.2652 7.51923 10.4124 7.41027 10.5214C7.30131 10.6304 7.1541 10.6925 7.00002 10.6945Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,r){n&1&&(Tt(),L(0,"svg",0)(1,"g"),X(2,"path",1),q(),L(3,"defs")(4,"clipPath",2),X(5,"rect",3),q()()()),n&2&&(xe(r.getClassNames()),re("aria-label",r.ariaLabel)("aria-hidden",r.ariaHidden)("role",r.role),M(),re("clip-path",r.pathId),M(3),N("id",r.pathId))},encapsulation:2})}return i})();var _o=(()=>{class i extends xt{pathId;ngOnInit(){this.pathId="url(#"+rt()+")"}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Et(i)))(r||i)}})();static \u0275cmp=_e({type:i,selectors:[["TimesCircleIcon"]],features:[Ct],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M7 14C5.61553 14 4.26215 13.5895 3.11101 12.8203C1.95987 12.0511 1.06266 10.9579 0.532846 9.67879C0.00303296 8.3997 -0.13559 6.99224 0.134506 5.63437C0.404603 4.2765 1.07129 3.02922 2.05026 2.05026C3.02922 1.07129 4.2765 0.404603 5.63437 0.134506C6.99224 -0.13559 8.3997 0.00303296 9.67879 0.532846C10.9579 1.06266 12.0511 1.95987 12.8203 3.11101C13.5895 4.26215 14 5.61553 14 7C14 8.85652 13.2625 10.637 11.9497 11.9497C10.637 13.2625 8.85652 14 7 14ZM7 1.16667C5.84628 1.16667 4.71846 1.50879 3.75918 2.14976C2.79989 2.79074 2.05222 3.70178 1.61071 4.76768C1.16919 5.83358 1.05367 7.00647 1.27876 8.13803C1.50384 9.26958 2.05941 10.309 2.87521 11.1248C3.69102 11.9406 4.73042 12.4962 5.86198 12.7212C6.99353 12.9463 8.16642 12.8308 9.23232 12.3893C10.2982 11.9478 11.2093 11.2001 11.8502 10.2408C12.4912 9.28154 12.8333 8.15373 12.8333 7C12.8333 5.45291 12.2188 3.96918 11.1248 2.87521C10.0308 1.78125 8.5471 1.16667 7 1.16667ZM4.66662 9.91668C4.58998 9.91704 4.51404 9.90209 4.44325 9.87271C4.37246 9.84333 4.30826 9.8001 4.2544 9.74557C4.14516 9.6362 4.0838 9.48793 4.0838 9.33335C4.0838 9.17876 4.14516 9.0305 4.2544 8.92113L6.17553 7L4.25443 5.07891C4.15139 4.96832 4.09529 4.82207 4.09796 4.67094C4.10063 4.51982 4.16185 4.37563 4.26872 4.26876C4.3756 4.16188 4.51979 4.10066 4.67091 4.09799C4.82204 4.09532 4.96829 4.15142 5.07887 4.25446L6.99997 6.17556L8.92106 4.25446C9.03164 4.15142 9.1779 4.09532 9.32903 4.09799C9.48015 4.10066 9.62434 4.16188 9.73121 4.26876C9.83809 4.37563 9.89931 4.51982 9.90198 4.67094C9.90464 4.82207 9.84855 4.96832 9.74551 5.07891L7.82441 7L9.74554 8.92113C9.85478 9.0305 9.91614 9.17876 9.91614 9.33335C9.91614 9.48793 9.85478 9.6362 9.74554 9.74557C9.69168 9.8001 9.62748 9.84333 9.55669 9.87271C9.4859 9.90209 9.40996 9.91704 9.33332 9.91668C9.25668 9.91704 9.18073 9.90209 9.10995 9.87271C9.03916 9.84333 8.97495 9.8001 8.9211 9.74557L6.99997 7.82444L5.07884 9.74557C5.02499 9.8001 4.96078 9.84333 4.88999 9.87271C4.81921 9.90209 4.74326 9.91704 4.66662 9.91668Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,r){n&1&&(Tt(),L(0,"svg",0)(1,"g"),X(2,"path",1),q(),L(3,"defs")(4,"clipPath",2),X(5,"rect",3),q()()()),n&2&&(xe(r.getClassNames()),re("aria-label",r.ariaLabel)("aria-hidden",r.ariaHidden)("role",r.role),M(),re("clip-path",r.pathId),M(3),N("id",r.pathId))},encapsulation:2})}return i})();var B0=["container"],Lw=i=>[i,"p-toast-message"],zw=(i,e,t,n)=>({showTransformParams:i,hideTransformParams:e,showTransitionParams:t,hideTransitionParams:n}),Bw=i=>({value:"visible",params:i}),Uw=(i,e)=>({$implicit:i,closeFn:e}),qw=i=>({$implicit:i});function jw(i,e){i&1&&on(0)}function Gw(i,e){if(i&1&&(yt(0),ne(1,jw,1,0,"ng-container",4),vt()),i&2){let t=H();M(),N("ngTemplateOutlet",t.headlessTemplate)("ngTemplateOutletContext",li(2,Uw,t.message,t.onCloseIconClick))}}function $w(i,e){if(i&1&&X(0,"span"),i&2){let t=H(3);xe("p-toast-message-icon pi "+t.message.icon)}}function Kw(i,e){i&1&&X(0,"CheckIcon"),i&2&&re("aria-hidden",!0)("data-pc-section","icon")}function Hw(i,e){i&1&&X(0,"InfoCircleIcon"),i&2&&re("aria-hidden",!0)("data-pc-section","icon")}function Qw(i,e){i&1&&X(0,"TimesCircleIcon"),i&2&&re("aria-hidden",!0)("data-pc-section","icon")}function Ww(i,e){i&1&&X(0,"ExclamationTriangleIcon"),i&2&&re("aria-hidden",!0)("data-pc-section","icon")}function Yw(i,e){if(i&1&&(L(0,"span",13),yt(1),ne(2,Kw,1,2,"CheckIcon",6)(3,Hw,1,2,"InfoCircleIcon",6)(4,Qw,1,2,"TimesCircleIcon",6)(5,Ww,1,2,"ExclamationTriangleIcon",6),vt(),q()),i&2){let t=H(3);re("aria-hidden",!0)("data-pc-section","icon"),M(2),N("ngIf",t.message.severity==="success"),M(),N("ngIf",t.message.severity==="info"),M(),N("ngIf",t.message.severity==="error"),M(),N("ngIf",t.message.severity==="warn")}}function Xw(i,e){if(i&1&&(yt(0),ne(1,$w,1,2,"span",8)(2,Yw,6,6,"span",9),L(3,"div",10)(4,"div",11),ye(5),q(),L(6,"div",12),ye(7),q()(),vt()),i&2){let t=H(2);M(),N("ngIf",t.message.icon),M(),N("ngIf",!t.message.icon),M(),re("data-pc-section","text"),M(),re("data-pc-section","summary"),M(),xn(t.message.summary),M(),re("data-pc-section","detail"),M(),xn(t.message.detail)}}function Jw(i,e){i&1&&on(0)}function Zw(i,e){if(i&1&&X(0,"span"),i&2){let t=H(3);xe("pt-1 text-base p-toast-message-icon pi "+t.message.closeIcon)}}function eI(i,e){i&1&&X(0,"TimesIcon",16),i&2&&(N("styleClass","p-toast-icon-close-icon"),re("aria-hidden",!0)("data-pc-section","closeicon"))}function tI(i,e){if(i&1){let t=qe();L(0,"button",14),Pe("click",function(r){le(t);let s=H(2);return ce(s.onCloseIconClick(r))})("keydown.enter",function(r){le(t);let s=H(2);return ce(s.onCloseIconClick(r))}),ne(1,Zw,1,2,"span",8)(2,eI,1,3,"TimesIcon",15),q()}if(i&2){let t=H(2);re("aria-label",t.closeAriaLabel)("data-pc-section","closebutton"),M(),N("ngIf",t.message.closeIcon),M(),N("ngIf",!t.message.closeIcon)}}function nI(i,e){if(i&1&&(L(0,"div",5),ne(1,Xw,8,7,"ng-container",6)(2,Jw,1,0,"ng-container",4)(3,tI,3,4,"button",7),q()),i&2){let t=H();N("ngClass",t.message==null?null:t.message.contentStyleClass),re("data-pc-section","content"),M(),N("ngIf",!t.template),M(),N("ngTemplateOutlet",t.template)("ngTemplateOutletContext",Ot(6,qw,t.message)),M(),N("ngIf",(t.message==null?null:t.message.closable)!==!1)}}function iI(i,e){if(i&1){let t=qe();L(0,"p-toastItem",3),Pe("onClose",function(r){le(t);let s=H();return ce(s.onMessageClose(r))})("@toastAnimation.start",function(r){le(t);let s=H();return ce(s.onAnimationStart(r))})("@toastAnimation.done",function(r){le(t);let s=H();return ce(s.onAnimationEnd(r))}),q()}if(i&2){let t=e.$implicit,n=e.index,r=H();N("message",t)("index",n)("life",r.life)("template",r.template)("headlessTemplate",r.headlessTemplate)("@toastAnimation",void 0)("showTransformOptions",r.showTransformOptions)("hideTransformOptions",r.hideTransformOptions)("showTransitionOptions",r.showTransitionOptions)("hideTransitionOptions",r.hideTransitionOptions)}}var rI=(()=>{class i{zone;config;message;index;life;template;headlessTemplate;showTransformOptions;hideTransformOptions;showTransitionOptions;hideTransitionOptions;onClose=new ct;containerViewChild;timeout;constructor(t,n){this.zone=t,this.config=n}ngAfterViewInit(){this.initTimeout()}initTimeout(){this.message?.sticky||this.zone.runOutsideAngular(()=>{this.timeout=setTimeout(()=>{this.onClose.emit({index:this.index,message:this.message})},this.message?.life||this.life||3e3)})}clearTimeout(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}onMouseEnter(){this.clearTimeout()}onMouseLeave(){this.initTimeout()}onCloseIconClick=t=>{this.clearTimeout(),this.onClose.emit({index:this.index,message:this.message}),t.preventDefault()};get closeAriaLabel(){return this.config.translation.aria?this.config.translation.aria.close:void 0}ngOnDestroy(){this.clearTimeout()}static \u0275fac=function(n){return new(n||i)(de(ut),de(_s))};static \u0275cmp=_e({type:i,selectors:[["p-toastItem"]],viewQuery:function(n,r){if(n&1&&an(B0,5),n&2){let s;ht(s=dt())&&(r.containerViewChild=s.first)}},hostAttrs:[1,"p-element"],inputs:{message:"message",index:[2,"index","index",ln],life:[2,"life","life",ln],template:"template",headlessTemplate:"headlessTemplate",showTransformOptions:"showTransformOptions",hideTransformOptions:"hideTransformOptions",showTransitionOptions:"showTransitionOptions",hideTransitionOptions:"hideTransitionOptions"},outputs:{onClose:"onClose"},standalone:!1,features:[Sn],decls:5,vars:18,consts:[["container",""],["notHeadless",""],["role","alert","aria-live","assertive","aria-atomic","true",3,"mouseenter","mouseleave","ngClass"],[4,"ngIf","ngIfElse"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"p-toast-message-content",3,"ngClass"],[4,"ngIf"],["type","button","class","p-toast-icon-close p-link","pRipple","",3,"click","keydown.enter",4,"ngIf"],[3,"class",4,"ngIf"],["class","p-toast-message-icon",4,"ngIf"],[1,"p-toast-message-text"],[1,"p-toast-summary"],[1,"p-toast-detail"],[1,"p-toast-message-icon"],["type","button","pRipple","",1,"p-toast-icon-close","p-link",3,"click","keydown.enter"],[3,"styleClass",4,"ngIf"],[3,"styleClass"]],template:function(n,r){if(n&1){let s=qe();L(0,"div",2,0),Pe("mouseenter",function(){return le(s),ce(r.onMouseEnter())})("mouseleave",function(){return le(s),ce(r.onMouseLeave())}),ne(2,Gw,2,5,"ng-container",3)(3,nI,4,8,"ng-template",null,1,ms),q()}if(n&2){let s=ds(4);xe(r.message==null?null:r.message.styleClass),N("ngClass",Ot(9,Lw,"p-toast-message-"+(r.message==null?null:r.message.severity)))("@messageState",Ot(16,Bw,Ho(11,zw,r.showTransformOptions,r.hideTransformOptions,r.showTransitionOptions,r.hideTransitionOptions))),re("id",r.message==null?null:r.message.id)("data-pc-name","toast")("data-pc-section","root"),M(2),N("ngIf",r.headlessTemplate)("ngIfElse",s)}},dependencies:()=>[cn,Qo,Wo,Zo,fo,go,_o,po,Dn],encapsulation:2,data:{animation:[ui("messageState",[gs("visible",Gt({transform:"translateY(0)",opacity:1})),un("void => *",[Gt({transform:"{{showTransformParams}}",opacity:0}),Rn("{{showTransitionParams}}")]),un("* => void",[Rn("{{hideTransitionParams}}",Gt({height:0,opacity:0,transform:"{{hideTransformParams}}"}))])])]},changeDetection:0})}return i})(),U0=(()=>{class i{document;renderer;messageService;cd;config;key;autoZIndex=!0;baseZIndex=0;life=3e3;style;styleClass;get position(){return this._position}set position(t){this._position=t,this.cd.markForCheck()}preventOpenDuplicates=!1;preventDuplicates=!1;showTransformOptions="translateY(100%)";hideTransformOptions="translateY(-100%)";showTransitionOptions="300ms ease-out";hideTransitionOptions="250ms ease-in";breakpoints;onClose=new ct;containerViewChild;templates;messageSubscription;clearSubscription;messages;messagesArchieve;template;headlessTemplate;_position="top-right";constructor(t,n,r,s,o){this.document=t,this.renderer=n,this.messageService=r,this.cd=s,this.config=o}styleElement;id=rt();ngOnInit(){this.messageSubscription=this.messageService.messageObserver.subscribe(t=>{if(t)if(Array.isArray(t)){let n=t.filter(r=>this.canAdd(r));this.add(n)}else this.canAdd(t)&&this.add([t])}),this.clearSubscription=this.messageService.clearObserver.subscribe(t=>{t?this.key===t&&(this.messages=null):this.messages=null,this.cd.markForCheck()})}ngAfterViewInit(){this.breakpoints&&this.createStyle()}add(t){this.messages=this.messages?[...this.messages,...t]:[...t],this.preventDuplicates&&(this.messagesArchieve=this.messagesArchieve?[...this.messagesArchieve,...t]:[...t]),this.cd.markForCheck()}canAdd(t){let n=this.key===t.key;return n&&this.preventOpenDuplicates&&(n=!this.containsMessage(this.messages,t)),n&&this.preventDuplicates&&(n=!this.containsMessage(this.messagesArchieve,t)),n}containsMessage(t,n){return t?t.find(r=>r.summary===n.summary&&r.detail==n.detail&&r.severity===n.severity)!=null:!1}ngAfterContentInit(){this.templates?.forEach(t=>{switch(t.getType()){case"message":this.template=t.template;break;case"headless":this.headlessTemplate=t.template;break;default:this.template=t.template;break}})}onMessageClose(t){this.messages?.splice(t.index,1),this.onClose.emit({message:t.message}),this.cd.detectChanges()}onAnimationStart(t){t.fromState==="void"&&(this.renderer.setAttribute(this.containerViewChild?.nativeElement,this.id,""),this.autoZIndex&&this.containerViewChild?.nativeElement.style.zIndex===""&&hi.set("modal",this.containerViewChild?.nativeElement,this.baseZIndex||this.config.zIndex.modal))}onAnimationEnd(t){t.toState==="void"&&this.autoZIndex&&Ef.isEmpty(this.messages)&&hi.clear(this.containerViewChild?.nativeElement)}createStyle(){if(!this.styleElement){this.styleElement=this.renderer.createElement("style"),this.styleElement.type="text/css",se.setAttribute(this.styleElement,"nonce",this.config?.csp()?.nonce),this.renderer.appendChild(this.document.head,this.styleElement);let t="";for(let n in this.breakpoints){let r="";for(let s in this.breakpoints[n])r+=s+":"+this.breakpoints[n][s]+" !important;";t+=`
                    @media screen and (max-width: ${n}) {
                        .p-toast[${this.id}] {
                           ${r}
                        }
                    }
                `}this.renderer.setProperty(this.styleElement,"innerHTML",t)}}destroyStyle(){this.styleElement&&(this.renderer.removeChild(this.document.head,this.styleElement),this.styleElement=null)}ngOnDestroy(){this.messageSubscription&&this.messageSubscription.unsubscribe(),this.containerViewChild&&this.autoZIndex&&hi.clear(this.containerViewChild.nativeElement),this.clearSubscription&&this.clearSubscription.unsubscribe(),this.destroyStyle()}static \u0275fac=function(n){return new(n||i)(de(jt),de(hs),de(Yi),de(fs),de(_s))};static \u0275cmp=_e({type:i,selectors:[["p-toast"]],contentQueries:function(n,r,s){if(n&1&&ai(s,ys,4),n&2){let o;ht(o=dt())&&(r.templates=o)}},viewQuery:function(n,r){if(n&1&&an(B0,5),n&2){let s;ht(s=dt())&&(r.containerViewChild=s.first)}},hostAttrs:[1,"p-element"],inputs:{key:"key",autoZIndex:[2,"autoZIndex","autoZIndex",De],baseZIndex:[2,"baseZIndex","baseZIndex",ln],life:[2,"life","life",ln],style:"style",styleClass:"styleClass",position:"position",preventOpenDuplicates:[2,"preventOpenDuplicates","preventOpenDuplicates",De],preventDuplicates:[2,"preventDuplicates","preventDuplicates",De],showTransformOptions:"showTransformOptions",hideTransformOptions:"hideTransformOptions",showTransitionOptions:"showTransitionOptions",hideTransitionOptions:"hideTransitionOptions",breakpoints:"breakpoints"},outputs:{onClose:"onClose"},standalone:!1,features:[Sn],decls:3,vars:5,consts:[["container",""],[1,"p-toast","p-component",3,"ngClass","ngStyle"],[3,"message","index","life","template","headlessTemplate","showTransformOptions","hideTransformOptions","showTransitionOptions","hideTransitionOptions","onClose",4,"ngFor","ngForOf"],[3,"onClose","message","index","life","template","headlessTemplate","showTransformOptions","hideTransformOptions","showTransitionOptions","hideTransitionOptions"]],template:function(n,r){n&1&&(L(0,"div",1,0),ne(2,iI,1,10,"p-toastItem",2),q()),n&2&&(xe(r.styleClass),N("ngClass","p-toast-"+r._position)("ngStyle",r.style),M(2),N("ngForOf",r.messages))},dependencies:[cn,mf,Pn,rI],styles:[`@layer primeng{.p-toast{position:fixed;width:25rem}.p-toast-message{overflow:hidden}.p-toast-message-content{display:flex;align-items:flex-start}.p-toast-message-text{flex:1 1 auto}.p-toast-top-right{top:20px;right:20px}.p-toast-top-left{top:20px;left:20px}.p-toast-bottom-left{bottom:20px;left:20px}.p-toast-bottom-right{bottom:20px;right:20px}.p-toast-top-center{top:20px;left:50%;transform:translate(-50%)}.p-toast-bottom-center{bottom:20px;left:50%;transform:translate(-50%)}.p-toast-center{left:50%;top:50%;min-width:20vw;transform:translate(-50%,-50%)}.p-toast-icon-close{display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative;flex:none}.p-toast-icon-close.p-link{cursor:pointer}}
`],encapsulation:2,data:{animation:[ui("toastAnimation",[un(":enter, :leave",[If("@*",wf())])])]},changeDetection:0})}return i})(),q0=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ue({type:i});static \u0275inj=Be({imports:[mt,Xi,fo,go,_o,po,Dn,di]})}return i})();var j0=(()=>{class i{pFocusTrapDisabled=!1;platformId=Hi(bt);host=Hi(Qi);document=Hi(jt);firstHiddenFocusableElement;lastHiddenFocusableElement;ngOnInit(){ci(this.platformId)&&!this.pFocusTrapDisabled&&!this.firstHiddenFocusableElement&&!this.lastHiddenFocusableElement&&this.createHiddenFocusableElements()}ngOnChanges(t){t.pFocusTrapDisabled&&ci(this.platformId)&&(t.pFocusTrapDisabled.currentValue?this.removeHiddenFocusableElements():this.createHiddenFocusableElements())}removeHiddenFocusableElements(){this.firstHiddenFocusableElement&&this.firstHiddenFocusableElement.parentNode&&this.firstHiddenFocusableElement.parentNode.removeChild(this.firstHiddenFocusableElement),this.lastHiddenFocusableElement&&this.lastHiddenFocusableElement.parentNode&&this.lastHiddenFocusableElement.parentNode.removeChild(this.lastHiddenFocusableElement)}getComputedSelector(t){return`:not(.p-hidden-focusable):not([data-p-hidden-focusable="true"])${t??""}`}createHiddenFocusableElements(){let t="0",n=r=>se.createElement("span",{class:"p-hidden-accessible p-hidden-focusable",tabindex:t,role:"presentation","data-p-hidden-accessible":!0,"data-p-hidden-focusable":!0,onFocus:r?.bind(this)});this.firstHiddenFocusableElement=n(this.onFirstHiddenElementFocus),this.lastHiddenFocusableElement=n(this.onLastHiddenElementFocus),this.firstHiddenFocusableElement.setAttribute("data-pc-section","firstfocusableelement"),this.lastHiddenFocusableElement.setAttribute("data-pc-section","lastfocusableelement"),this.host.nativeElement.prepend(this.firstHiddenFocusableElement),this.host.nativeElement.append(this.lastHiddenFocusableElement)}onFirstHiddenElementFocus(t){let{currentTarget:n,relatedTarget:r}=t,s=r===this.lastHiddenFocusableElement||!this.host.nativeElement?.contains(r)?se.getFirstFocusableElement(n.parentElement,":not(.p-hidden-focusable)"):this.lastHiddenFocusableElement;se.focus(s)}onLastHiddenElementFocus(t){let{currentTarget:n,relatedTarget:r}=t,s=r===this.firstHiddenFocusableElement||!this.host.nativeElement?.contains(r)?se.getLastFocusableElement(n.parentElement,":not(.p-hidden-focusable)"):this.firstHiddenFocusableElement;se.focus(s)}static \u0275fac=function(n){return new(n||i)};static \u0275dir=pc({type:i,selectors:[["","pFocusTrap",""]],hostAttrs:[1,"p-element"],inputs:{pFocusTrapDisabled:[2,"pFocusTrapDisabled","pFocusTrapDisabled",De]},standalone:!1,features:[Sn,Zm]})}return i})(),G0=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ue({type:i});static \u0275inj=Be({imports:[mt]})}return i})();var Gd=(()=>{class i extends xt{pathId;ngOnInit(){this.pathId="url(#"+rt()+")"}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Et(i)))(r||i)}})();static \u0275cmp=_e({type:i,selectors:[["WindowMaximizeIcon"]],features:[Ct],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M7 14H11.8C12.3835 14 12.9431 13.7682 13.3556 13.3556C13.7682 12.9431 14 12.3835 14 11.8V2.2C14 1.61652 13.7682 1.05694 13.3556 0.644365C12.9431 0.231785 12.3835 0 11.8 0H2.2C1.61652 0 1.05694 0.231785 0.644365 0.644365C0.231785 1.05694 0 1.61652 0 2.2V7C0 7.15913 0.063214 7.31174 0.175736 7.42426C0.288258 7.53679 0.44087 7.6 0.6 7.6C0.75913 7.6 0.911742 7.53679 1.02426 7.42426C1.13679 7.31174 1.2 7.15913 1.2 7V2.2C1.2 1.93478 1.30536 1.68043 1.49289 1.49289C1.68043 1.30536 1.93478 1.2 2.2 1.2H11.8C12.0652 1.2 12.3196 1.30536 12.5071 1.49289C12.6946 1.68043 12.8 1.93478 12.8 2.2V11.8C12.8 12.0652 12.6946 12.3196 12.5071 12.5071C12.3196 12.6946 12.0652 12.8 11.8 12.8H7C6.84087 12.8 6.68826 12.8632 6.57574 12.9757C6.46321 13.0883 6.4 13.2409 6.4 13.4C6.4 13.5591 6.46321 13.7117 6.57574 13.8243C6.68826 13.9368 6.84087 14 7 14ZM9.77805 7.42192C9.89013 7.534 10.0415 7.59788 10.2 7.59995C10.3585 7.59788 10.5099 7.534 10.622 7.42192C10.7341 7.30985 10.798 7.15844 10.8 6.99995V3.94242C10.8066 3.90505 10.8096 3.86689 10.8089 3.82843C10.8079 3.77159 10.7988 3.7157 10.7824 3.6623C10.756 3.55552 10.701 3.45698 10.622 3.37798C10.5099 3.2659 10.3585 3.20202 10.2 3.19995H7.00002C6.84089 3.19995 6.68828 3.26317 6.57576 3.37569C6.46324 3.48821 6.40002 3.64082 6.40002 3.79995C6.40002 3.95908 6.46324 4.11169 6.57576 4.22422C6.68828 4.33674 6.84089 4.39995 7.00002 4.39995H8.80006L6.19997 7.00005C6.10158 7.11005 6.04718 7.25246 6.04718 7.40005C6.04718 7.54763 6.10158 7.69004 6.19997 7.80005C6.30202 7.91645 6.44561 7.98824 6.59997 8.00005C6.75432 7.98824 6.89791 7.91645 6.99997 7.80005L9.60002 5.26841V6.99995C9.6021 7.15844 9.66598 7.30985 9.77805 7.42192ZM1.4 14H3.8C4.17066 13.9979 4.52553 13.8498 4.78763 13.5877C5.04973 13.3256 5.1979 12.9707 5.2 12.6V10.2C5.1979 9.82939 5.04973 9.47452 4.78763 9.21242C4.52553 8.95032 4.17066 8.80215 3.8 8.80005H1.4C1.02934 8.80215 0.674468 8.95032 0.412371 9.21242C0.150274 9.47452 0.00210008 9.82939 0 10.2V12.6C0.00210008 12.9707 0.150274 13.3256 0.412371 13.5877C0.674468 13.8498 1.02934 13.9979 1.4 14ZM1.25858 10.0586C1.29609 10.0211 1.34696 10 1.4 10H3.8C3.85304 10 3.90391 10.0211 3.94142 10.0586C3.97893 10.0961 4 10.147 4 10.2V12.6C4 12.6531 3.97893 12.704 3.94142 12.7415C3.90391 12.779 3.85304 12.8 3.8 12.8H1.4C1.34696 12.8 1.29609 12.779 1.25858 12.7415C1.22107 12.704 1.2 12.6531 1.2 12.6V10.2C1.2 10.147 1.22107 10.0961 1.25858 10.0586Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,r){n&1&&(Tt(),L(0,"svg",0)(1,"g"),X(2,"path",1),q(),L(3,"defs")(4,"clipPath",2),X(5,"rect",3),q()()()),n&2&&(xe(r.getClassNames()),re("aria-label",r.ariaLabel)("aria-hidden",r.ariaHidden)("role",r.role),M(),re("clip-path",r.pathId),M(3),N("id",r.pathId))},encapsulation:2})}return i})();var $d=(()=>{class i extends xt{pathId;ngOnInit(){this.pathId="url(#"+rt()+")"}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Et(i)))(r||i)}})();static \u0275cmp=_e({type:i,selectors:[["WindowMinimizeIcon"]],features:[Ct],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M11.8 0H2.2C1.61652 0 1.05694 0.231785 0.644365 0.644365C0.231785 1.05694 0 1.61652 0 2.2V7C0 7.15913 0.063214 7.31174 0.175736 7.42426C0.288258 7.53679 0.44087 7.6 0.6 7.6C0.75913 7.6 0.911742 7.53679 1.02426 7.42426C1.13679 7.31174 1.2 7.15913 1.2 7V2.2C1.2 1.93478 1.30536 1.68043 1.49289 1.49289C1.68043 1.30536 1.93478 1.2 2.2 1.2H11.8C12.0652 1.2 12.3196 1.30536 12.5071 1.49289C12.6946 1.68043 12.8 1.93478 12.8 2.2V11.8C12.8 12.0652 12.6946 12.3196 12.5071 12.5071C12.3196 12.6946 12.0652 12.8 11.8 12.8H7C6.84087 12.8 6.68826 12.8632 6.57574 12.9757C6.46321 13.0883 6.4 13.2409 6.4 13.4C6.4 13.5591 6.46321 13.7117 6.57574 13.8243C6.68826 13.9368 6.84087 14 7 14H11.8C12.3835 14 12.9431 13.7682 13.3556 13.3556C13.7682 12.9431 14 12.3835 14 11.8V2.2C14 1.61652 13.7682 1.05694 13.3556 0.644365C12.9431 0.231785 12.3835 0 11.8 0ZM6.368 7.952C6.44137 7.98326 6.52025 7.99958 6.6 8H9.8C9.95913 8 10.1117 7.93678 10.2243 7.82426C10.3368 7.71174 10.4 7.55913 10.4 7.4C10.4 7.24087 10.3368 7.08826 10.2243 6.97574C10.1117 6.86321 9.95913 6.8 9.8 6.8H8.048L10.624 4.224C10.73 4.11026 10.7877 3.95982 10.7849 3.80438C10.7822 3.64894 10.7192 3.50063 10.6093 3.3907C10.4994 3.28077 10.3511 3.2178 10.1956 3.21506C10.0402 3.21232 9.88974 3.27002 9.776 3.376L7.2 5.952V4.2C7.2 4.04087 7.13679 3.88826 7.02426 3.77574C6.91174 3.66321 6.75913 3.6 6.6 3.6C6.44087 3.6 6.28826 3.66321 6.17574 3.77574C6.06321 3.88826 6 4.04087 6 4.2V7.4C6.00042 7.47975 6.01674 7.55862 6.048 7.632C6.07656 7.70442 6.11971 7.7702 6.17475 7.82524C6.2298 7.88029 6.29558 7.92344 6.368 7.952ZM1.4 8.80005H3.8C4.17066 8.80215 4.52553 8.95032 4.78763 9.21242C5.04973 9.47452 5.1979 9.82939 5.2 10.2V12.6C5.1979 12.9707 5.04973 13.3256 4.78763 13.5877C4.52553 13.8498 4.17066 13.9979 3.8 14H1.4C1.02934 13.9979 0.674468 13.8498 0.412371 13.5877C0.150274 13.3256 0.00210008 12.9707 0 12.6V10.2C0.00210008 9.82939 0.150274 9.47452 0.412371 9.21242C0.674468 8.95032 1.02934 8.80215 1.4 8.80005ZM3.94142 12.7415C3.97893 12.704 4 12.6531 4 12.6V10.2C4 10.147 3.97893 10.0961 3.94142 10.0586C3.90391 10.0211 3.85304 10 3.8 10H1.4C1.34696 10 1.29609 10.0211 1.25858 10.0586C1.22107 10.0961 1.2 10.147 1.2 10.2V12.6C1.2 12.6531 1.22107 12.704 1.25858 12.7415C1.29609 12.779 1.34696 12.8 1.4 12.8H3.8C3.85304 12.8 3.90391 12.779 3.94142 12.7415Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,r){n&1&&(Tt(),L(0,"svg",0)(1,"g"),X(2,"path",1),q(),L(3,"defs")(4,"clipPath",2),X(5,"rect",3),q()()()),n&2&&(xe(r.getClassNames()),re("aria-label",r.ariaLabel)("aria-hidden",r.ariaHidden)("role",r.role),M(),re("clip-path",r.pathId),M(3),N("id",r.pathId))},encapsulation:2})}return i})();var aI=["titlebar"],lI=["content"],cI=["footer"],uI=["*",[["p-header"]],[["p-footer"]]],hI=["*","p-header","p-footer"],dI=(i,e,t,n,r,s,o,l,c,h)=>({"p-dialog-mask":!0,"p-component-overlay p-component-overlay-enter":i,"p-dialog-mask-scrollblocker":e,"p-dialog-left":t,"p-dialog-right":n,"p-dialog-top":r,"p-dialog-top-left":s,"p-dialog-top-right":o,"p-dialog-bottom":l,"p-dialog-bottom-left":c,"p-dialog-bottom-right":h}),mI=(i,e,t,n)=>({"p-dialog p-component":!0,"p-dialog-rtl":i,"p-dialog-draggable":e,"p-dialog-resizable":t,"p-dialog-maximized":n}),fI=(i,e)=>({transform:i,transition:e}),pI=i=>({value:"visible",params:i}),gI=()=>({"p-dialog-header-icon p-dialog-header-maximize p-link":!0}),_I=()=>({"p-dialog-header-icon p-dialog-header-close p-link":!0}),yI=()=>({"min-width":0});function vI(i,e){i&1&&on(0)}function wI(i,e){if(i&1&&(yt(0),ne(1,vI,1,0,"ng-container",10),vt()),i&2){let t=H(3);M(),N("ngTemplateOutlet",t.headlessTemplate)}}function II(i,e){if(i&1){let t=qe();L(0,"div",15),Pe("mousedown",function(r){le(t);let s=H(4);return ce(s.initResize(r))}),q()}}function TI(i,e){if(i&1&&(L(0,"span",21),ye(1),q()),i&2){let t=H(5);N("id",t.ariaLabelledBy),M(),xn(t.header)}}function EI(i,e){if(i&1&&(L(0,"span",21),qo(1,1),q()),i&2){let t=H(5);N("id",t.ariaLabelledBy)}}function bI(i,e){i&1&&on(0)}function CI(i,e){if(i&1&&X(0,"span",25),i&2){let t=H(6);N("ngClass",t.maximized?t.minimizeIcon:t.maximizeIcon)}}function AI(i,e){i&1&&X(0,"WindowMaximizeIcon",27),i&2&&N("styleClass","p-dialog-header-maximize-icon")}function SI(i,e){i&1&&X(0,"WindowMinimizeIcon",27),i&2&&N("styleClass","p-dialog-header-maximize-icon")}function xI(i,e){if(i&1&&(yt(0),ne(1,AI,1,1,"WindowMaximizeIcon",26)(2,SI,1,1,"WindowMinimizeIcon",26),vt()),i&2){let t=H(6);M(),N("ngIf",!t.maximized&&!t.maximizeIconTemplate),M(),N("ngIf",t.maximized&&!t.minimizeIconTemplate)}}function PI(i,e){}function RI(i,e){i&1&&ne(0,PI,0,0,"ng-template")}function DI(i,e){if(i&1&&(yt(0),ne(1,RI,1,0,null,10),vt()),i&2){let t=H(6);M(),N("ngTemplateOutlet",t.maximizeIconTemplate)}}function kI(i,e){}function VI(i,e){i&1&&ne(0,kI,0,0,"ng-template")}function OI(i,e){if(i&1&&(yt(0),ne(1,VI,1,0,null,10),vt()),i&2){let t=H(6);M(),N("ngTemplateOutlet",t.minimizeIconTemplate)}}function MI(i,e){if(i&1){let t=qe();L(0,"button",22),Pe("click",function(){le(t);let r=H(5);return ce(r.maximize())})("keydown.enter",function(){le(t);let r=H(5);return ce(r.maximize())}),ne(1,CI,1,1,"span",23)(2,xI,3,2,"ng-container",24)(3,DI,2,1,"ng-container",24)(4,OI,2,1,"ng-container",24),q()}if(i&2){let t=H(5);N("ngClass",Ko(7,gI)),re("tabindex",t.maximizable?"0":"-1")("aria-label",t.maximizeLabel),M(),N("ngIf",t.maximizeIcon&&!t.maximizeIconTemplate&&!t.minimizeIconTemplate),M(),N("ngIf",!t.maximizeIcon),M(),N("ngIf",!t.maximized),M(),N("ngIf",t.maximized)}}function NI(i,e){if(i&1&&X(0,"span",30),i&2){let t=H(7);N("ngClass",t.closeIcon)}}function FI(i,e){i&1&&X(0,"TimesIcon",27),i&2&&N("styleClass","p-dialog-header-close-icon")}function LI(i,e){if(i&1&&(yt(0),ne(1,NI,1,1,"span",29)(2,FI,1,1,"TimesIcon",26),vt()),i&2){let t=H(6);M(),N("ngIf",t.closeIcon),M(),N("ngIf",!t.closeIcon)}}function zI(i,e){}function BI(i,e){i&1&&ne(0,zI,0,0,"ng-template")}function UI(i,e){if(i&1&&(L(0,"span"),ne(1,BI,1,0,null,10),q()),i&2){let t=H(6);M(),N("ngTemplateOutlet",t.closeIconTemplate)}}function qI(i,e){if(i&1){let t=qe();L(0,"button",28),Pe("click",function(r){le(t);let s=H(5);return ce(s.close(r))})("keydown.enter",function(r){le(t);let s=H(5);return ce(s.close(r))}),ne(1,LI,3,2,"ng-container",24)(2,UI,2,1,"span",24),q()}if(i&2){let t=H(5);N("ngClass",Ko(6,_I))("ngStyle",Ko(7,yI)),re("aria-label",t.closeAriaLabel)("tabindex",t.closeTabindex),M(),N("ngIf",!t.closeIconTemplate),M(),N("ngIf",t.closeIconTemplate)}}function jI(i,e){if(i&1){let t=qe();L(0,"div",16,3),Pe("mousedown",function(r){le(t);let s=H(4);return ce(s.initDrag(r))}),ne(2,TI,2,2,"span",17)(3,EI,2,1,"span",17)(4,bI,1,0,"ng-container",10),L(5,"div",18),ne(6,MI,5,8,"button",19)(7,qI,3,8,"button",20),q()()}if(i&2){let t=H(4);M(2),N("ngIf",!t.headerFacet&&!t.headerTemplate),M(),N("ngIf",t.headerFacet),M(),N("ngTemplateOutlet",t.headerTemplate),M(2),N("ngIf",t.maximizable),M(),N("ngIf",t.closable)}}function GI(i,e){i&1&&on(0)}function $I(i,e){i&1&&on(0)}function KI(i,e){if(i&1&&(L(0,"div",31,4),qo(2,2),ne(3,$I,1,0,"ng-container",10),q()),i&2){let t=H(4);M(3),N("ngTemplateOutlet",t.footerTemplate)}}function HI(i,e){if(i&1&&(ne(0,II,1,0,"div",11)(1,jI,8,5,"div",12),L(2,"div",13,2),qo(4),ne(5,GI,1,0,"ng-container",10),q(),ne(6,KI,4,1,"div",14)),i&2){let t=H(3);N("ngIf",t.resizable),M(),N("ngIf",t.showHeader),M(),xe(t.contentStyleClass),N("ngClass","p-dialog-content")("ngStyle",t.contentStyle),M(3),N("ngTemplateOutlet",t.contentTemplate),M(),N("ngIf",t.footerFacet||t.footerTemplate)}}function QI(i,e){if(i&1){let t=qe();L(0,"div",8,0),Pe("@animation.start",function(r){le(t);let s=H(2);return ce(s.onAnimationStart(r))})("@animation.done",function(r){le(t);let s=H(2);return ce(s.onAnimationEnd(r))}),ne(2,wI,2,1,"ng-container",9)(3,HI,7,8,"ng-template",null,1,ms),q()}if(i&2){let t=ds(4),n=H(2);xe(n.styleClass),N("ngClass",Ho(10,mI,n.rtl,n.draggable,n.resizable,n.maximized))("ngStyle",n.style)("pFocusTrapDisabled",n.focusTrap===!1)("@animation",Ot(18,pI,li(15,fI,n.transformOptions,n.transitionOptions))),re("aria-labelledby",n.ariaLabelledBy)("aria-modal",!0),M(2),N("ngIf",n.headlessTemplate)("ngIfElse",t)}}function WI(i,e){if(i&1&&(L(0,"div",6),ne(1,QI,5,20,"div",7),q()),i&2){let t=H();xe(t.maskStyleClass),N("ngStyle",t.maskStyle)("ngClass",lf(5,dI,[t.modal,t.modal||t.blockScroll,t.position==="left",t.position==="right",t.position==="top",t.position==="topleft"||t.position==="top-left",t.position==="topright"||t.position==="top-right",t.position==="bottom",t.position==="bottomleft"||t.position==="bottom-left",t.position==="bottomright"||t.position==="bottom-right"])),M(),N("ngIf",t.visible)}}var YI=_c([Gt({transform:"{{transform}}",opacity:0}),Rn("{{transition}}")]),XI=_c([Rn("{{transition}}",Gt({transform:"{{transform}}",opacity:0}))]),$0=(()=>{class i{document;platformId;el;renderer;zone;cd;config;header;draggable=!0;resizable=!0;get positionLeft(){return 0}set positionLeft(t){console.log("positionLeft property is deprecated.")}get positionTop(){return 0}set positionTop(t){console.log("positionTop property is deprecated.")}contentStyle;contentStyleClass;modal=!1;closeOnEscape=!0;dismissableMask=!1;rtl=!1;closable=!0;get responsive(){return!1}set responsive(t){console.log("Responsive property is deprecated.")}appendTo;breakpoints;styleClass;maskStyleClass;maskStyle;showHeader=!0;get breakpoint(){return 649}set breakpoint(t){console.log("Breakpoint property is not utilized and deprecated, use breakpoints or CSS media queries instead.")}blockScroll=!1;autoZIndex=!0;baseZIndex=0;minX=0;minY=0;focusOnShow=!0;maximizable=!1;keepInViewport=!0;focusTrap=!0;transitionOptions="150ms cubic-bezier(0, 0, 0.2, 1)";closeIcon;closeAriaLabel;closeTabindex="0";minimizeIcon;maximizeIcon;get visible(){return this._visible}set visible(t){this._visible=t,this._visible&&!this.maskVisible&&(this.maskVisible=!0)}get style(){return this._style}set style(t){t&&(this._style=Vt({},t),this.originalStyle=t)}get position(){return this._position}set position(t){switch(this._position=t,t){case"topleft":case"bottomleft":case"left":this.transformOptions="translate3d(-100%, 0px, 0px)";break;case"topright":case"bottomright":case"right":this.transformOptions="translate3d(100%, 0px, 0px)";break;case"bottom":this.transformOptions="translate3d(0px, 100%, 0px)";break;case"top":this.transformOptions="translate3d(0px, -100%, 0px)";break;default:this.transformOptions="scale(0.7)";break}}onShow=new ct;onHide=new ct;visibleChange=new ct;onResizeInit=new ct;onResizeEnd=new ct;onDragEnd=new ct;onMaximize=new ct;headerFacet;footerFacet;templates;headerViewChild;contentViewChild;footerViewChild;headerTemplate;contentTemplate;footerTemplate;maximizeIconTemplate;closeIconTemplate;minimizeIconTemplate;headlessTemplate;_visible=!1;maskVisible;container;wrapper;dragging;ariaLabelledBy=this.getAriaLabelledBy();documentDragListener;documentDragEndListener;resizing;documentResizeListener;documentResizeEndListener;documentEscapeListener;maskClickListener;lastPageX;lastPageY;preventVisibleChangePropagation;maximized;preMaximizeContentHeight;preMaximizeContainerWidth;preMaximizeContainerHeight;preMaximizePageX;preMaximizePageY;id=rt();_style={};_position="center";originalStyle;transformOptions="scale(0.7)";styleElement;window;get maximizeLabel(){return this.config.getTranslation(Af.ARIA).maximizeLabel}constructor(t,n,r,s,o,l,c){this.document=t,this.platformId=n,this.el=r,this.renderer=s,this.zone=o,this.cd=l,this.config=c,this.window=this.document.defaultView}ngAfterContentInit(){this.templates?.forEach(t=>{switch(t.getType()){case"header":this.headerTemplate=t.template;break;case"content":this.contentTemplate=t.template;break;case"footer":this.footerTemplate=t.template;break;case"closeicon":this.closeIconTemplate=t.template;break;case"maximizeicon":this.maximizeIconTemplate=t.template;break;case"minimizeicon":this.minimizeIconTemplate=t.template;break;case"headless":this.headlessTemplate=t.template;break;default:this.contentTemplate=t.template;break}})}ngOnInit(){this.breakpoints&&this.createStyle()}getAriaLabelledBy(){return this.header!==null?rt()+"_header":null}parseDurationToMilliseconds(t){let n=/([\d\.]+)(ms|s)\b/g,r=0,s;for(;(s=n.exec(t))!==null;){let o=parseFloat(s[1]),l=s[2];l==="ms"?r+=o:l==="s"&&(r+=o*1e3)}if(r!==0)return r}focus(t=this.contentViewChild?.nativeElement){let n=this.parseDurationToMilliseconds(this.transitionOptions),r=se.getFocusableElement(t,"[autofocus]");if(r){this.zone.runOutsideAngular(()=>{setTimeout(()=>r.focus(),n||5)});return}let s=se.getFocusableElement(t);s?this.zone.runOutsideAngular(()=>{setTimeout(()=>s.focus(),n||5)}):this.footerViewChild&&t!==this.footerViewChild.nativeElement&&this.focus(this.footerViewChild.nativeElement)}close(t){this.visibleChange.emit(!1),t.preventDefault()}enableModality(){this.closable&&this.dismissableMask&&(this.maskClickListener=this.renderer.listen(this.wrapper,"mousedown",t=>{this.wrapper&&this.wrapper.isSameNode(t.target)&&this.close(t)})),this.modal&&se.blockBodyScroll()}disableModality(){if(this.wrapper){this.dismissableMask&&this.unbindMaskClickListener();let t=document.querySelectorAll(".p-dialog-mask-scrollblocker");this.modal&&t&&t.length==1&&se.unblockBodyScroll(),this.cd.destroyed||this.cd.detectChanges()}}maximize(){this.maximized=!this.maximized,!this.modal&&!this.blockScroll&&(this.maximized?se.blockBodyScroll():se.unblockBodyScroll()),this.onMaximize.emit({maximized:this.maximized})}unbindMaskClickListener(){this.maskClickListener&&(this.maskClickListener(),this.maskClickListener=null)}moveOnTop(){this.autoZIndex&&(hi.set("modal",this.container,this.baseZIndex+this.config.zIndex.modal),this.wrapper.style.zIndex=String(parseInt(this.container.style.zIndex,10)-1))}createStyle(){if(ci(this.platformId)&&!this.styleElement){this.styleElement=this.renderer.createElement("style"),this.styleElement.type="text/css",se.setAttribute(this.styleElement,"nonce",this.config?.csp()?.nonce),this.renderer.appendChild(this.document.head,this.styleElement);let t="";for(let n in this.breakpoints)t+=`
                        @media screen and (max-width: ${n}) {
                            .p-dialog[${this.id}]:not(.p-dialog-maximized) {
                                width: ${this.breakpoints[n]} !important;
                            }
                        }
                    `;this.renderer.setProperty(this.styleElement,"innerHTML",t)}}initDrag(t){se.hasClass(t.target,"p-dialog-header-icon")||se.hasClass(t.target,"p-dialog-header-close-icon")||se.hasClass(t.target.parentElement,"p-dialog-header-icon")||this.draggable&&(this.dragging=!0,this.lastPageX=t.pageX,this.lastPageY=t.pageY,this.container.style.margin="0",se.addClass(this.document.body,"p-unselectable-text"))}onDrag(t){if(this.dragging){let n=se.getOuterWidth(this.container),r=se.getOuterHeight(this.container),s=t.pageX-this.lastPageX,o=t.pageY-this.lastPageY,l=this.container.getBoundingClientRect(),c=getComputedStyle(this.container),h=parseFloat(c.marginLeft),m=parseFloat(c.marginTop),p=l.left+s-h,_=l.top+o-m,b=se.getViewport();this.container.style.position="fixed",this.keepInViewport?(p>=this.minX&&p+n<b.width&&(this._style.left=`${p}px`,this.lastPageX=t.pageX,this.container.style.left=`${p}px`),_>=this.minY&&_+r<b.height&&(this._style.top=`${_}px`,this.lastPageY=t.pageY,this.container.style.top=`${_}px`)):(this.lastPageX=t.pageX,this.container.style.left=`${p}px`,this.lastPageY=t.pageY,this.container.style.top=`${_}px`)}}endDrag(t){this.dragging&&(this.dragging=!1,se.removeClass(this.document.body,"p-unselectable-text"),this.cd.detectChanges(),this.onDragEnd.emit(t))}resetPosition(){this.container.style.position="",this.container.style.left="",this.container.style.top="",this.container.style.margin=""}center(){this.resetPosition()}initResize(t){this.resizable&&(this.resizing=!0,this.lastPageX=t.pageX,this.lastPageY=t.pageY,se.addClass(this.document.body,"p-unselectable-text"),this.onResizeInit.emit(t))}onResize(t){if(this.resizing){let n=t.pageX-this.lastPageX,r=t.pageY-this.lastPageY,s=se.getOuterWidth(this.container),o=se.getOuterHeight(this.container),l=se.getOuterHeight(this.contentViewChild?.nativeElement),c=s+n,h=o+r,m=this.container.style.minWidth,p=this.container.style.minHeight,_=this.container.getBoundingClientRect(),b=se.getViewport();(!parseInt(this.container.style.top)||!parseInt(this.container.style.left))&&(c+=n,h+=r),(!m||c>parseInt(m))&&_.left+c<b.width&&(this._style.width=c+"px",this.container.style.width=this._style.width),(!p||h>parseInt(p))&&_.top+h<b.height&&(this.contentViewChild.nativeElement.style.height=l+h-o+"px",this._style.height&&(this._style.height=h+"px",this.container.style.height=this._style.height)),this.lastPageX=t.pageX,this.lastPageY=t.pageY}}resizeEnd(t){this.resizing&&(this.resizing=!1,se.removeClass(this.document.body,"p-unselectable-text"),this.onResizeEnd.emit(t))}bindGlobalListeners(){this.draggable&&(this.bindDocumentDragListener(),this.bindDocumentDragEndListener()),this.resizable&&this.bindDocumentResizeListeners(),this.closeOnEscape&&this.closable&&this.bindDocumentEscapeListener()}unbindGlobalListeners(){this.unbindDocumentDragListener(),this.unbindDocumentDragEndListener(),this.unbindDocumentResizeListeners(),this.unbindDocumentEscapeListener()}bindDocumentDragListener(){this.documentDragListener||this.zone.runOutsideAngular(()=>{this.documentDragListener=this.renderer.listen(this.window,"mousemove",this.onDrag.bind(this))})}unbindDocumentDragListener(){this.documentDragListener&&(this.documentDragListener(),this.documentDragListener=null)}bindDocumentDragEndListener(){this.documentDragEndListener||this.zone.runOutsideAngular(()=>{this.documentDragEndListener=this.renderer.listen(this.window,"mouseup",this.endDrag.bind(this))})}unbindDocumentDragEndListener(){this.documentDragEndListener&&(this.documentDragEndListener(),this.documentDragEndListener=null)}bindDocumentResizeListeners(){!this.documentResizeListener&&!this.documentResizeEndListener&&this.zone.runOutsideAngular(()=>{this.documentResizeListener=this.renderer.listen(this.window,"mousemove",this.onResize.bind(this)),this.documentResizeEndListener=this.renderer.listen(this.window,"mouseup",this.resizeEnd.bind(this))})}unbindDocumentResizeListeners(){this.documentResizeListener&&this.documentResizeEndListener&&(this.documentResizeListener(),this.documentResizeEndListener(),this.documentResizeListener=null,this.documentResizeEndListener=null)}bindDocumentEscapeListener(){let t=this.el?this.el.nativeElement.ownerDocument:"document";this.documentEscapeListener=this.renderer.listen(t,"keydown",n=>{n.key=="Escape"&&this.close(n)})}unbindDocumentEscapeListener(){this.documentEscapeListener&&(this.documentEscapeListener(),this.documentEscapeListener=null)}appendContainer(){this.appendTo&&(this.appendTo==="body"?this.renderer.appendChild(this.document.body,this.wrapper):se.appendChild(this.wrapper,this.appendTo))}restoreAppend(){this.container&&this.appendTo&&this.renderer.appendChild(this.el.nativeElement,this.wrapper)}onAnimationStart(t){switch(t.toState){case"visible":this.container=t.element,this.wrapper=this.container?.parentElement,this.moveOnTop(),this.appendContainer(),this.bindGlobalListeners(),this.container?.setAttribute(this.id,""),this.modal&&this.enableModality(),!this.modal&&this.blockScroll&&se.addClass(this.document.body,"p-overflow-hidden"),this.focusOnShow&&this.focus();break;case"void":this.wrapper&&this.modal&&se.addClass(this.wrapper,"p-component-overlay-leave");break}}onAnimationEnd(t){switch(t.toState){case"void":this.onContainerDestroy(),this.onHide.emit({}),this.cd.markForCheck();break;case"visible":this.onShow.emit({});break}}onContainerDestroy(){this.unbindGlobalListeners(),this.dragging=!1,this.maskVisible=!1,this.maximized&&(se.removeClass(this.document.body,"p-overflow-hidden"),this.document.body.style.removeProperty("--scrollbar-width"),this.maximized=!1),this.modal&&this.disableModality(),this.blockScroll&&se.removeClass(this.document.body,"p-overflow-hidden"),this.container&&this.autoZIndex&&hi.clear(this.container),this.container=null,this.wrapper=null,this._style=this.originalStyle?Vt({},this.originalStyle):{}}destroyStyle(){this.styleElement&&(this.renderer.removeChild(this.document.head,this.styleElement),this.styleElement=null)}ngOnDestroy(){this.container&&(this.restoreAppend(),this.onContainerDestroy()),this.destroyStyle()}static \u0275fac=function(n){return new(n||i)(de(jt),de(bt),de(Qi),de(hs),de(ut),de(fs),de(_s))};static \u0275cmp=_e({type:i,selectors:[["p-dialog"]],contentQueries:function(n,r,s){if(n&1&&(ai(s,bf,5),ai(s,Cf,5),ai(s,ys,4)),n&2){let o;ht(o=dt())&&(r.headerFacet=o.first),ht(o=dt())&&(r.footerFacet=o.first),ht(o=dt())&&(r.templates=o)}},viewQuery:function(n,r){if(n&1&&(an(aI,5),an(lI,5),an(cI,5)),n&2){let s;ht(s=dt())&&(r.headerViewChild=s.first),ht(s=dt())&&(r.contentViewChild=s.first),ht(s=dt())&&(r.footerViewChild=s.first)}},hostAttrs:[1,"p-element"],inputs:{header:"header",draggable:[2,"draggable","draggable",De],resizable:[2,"resizable","resizable",De],positionLeft:"positionLeft",positionTop:"positionTop",contentStyle:"contentStyle",contentStyleClass:"contentStyleClass",modal:[2,"modal","modal",De],closeOnEscape:[2,"closeOnEscape","closeOnEscape",De],dismissableMask:[2,"dismissableMask","dismissableMask",De],rtl:[2,"rtl","rtl",De],closable:[2,"closable","closable",De],responsive:"responsive",appendTo:"appendTo",breakpoints:"breakpoints",styleClass:"styleClass",maskStyleClass:"maskStyleClass",maskStyle:"maskStyle",showHeader:[2,"showHeader","showHeader",De],breakpoint:"breakpoint",blockScroll:[2,"blockScroll","blockScroll",De],autoZIndex:[2,"autoZIndex","autoZIndex",De],baseZIndex:[2,"baseZIndex","baseZIndex",ln],minX:[2,"minX","minX",ln],minY:[2,"minY","minY",ln],focusOnShow:[2,"focusOnShow","focusOnShow",De],maximizable:[2,"maximizable","maximizable",De],keepInViewport:[2,"keepInViewport","keepInViewport",De],focusTrap:[2,"focusTrap","focusTrap",De],transitionOptions:"transitionOptions",closeIcon:"closeIcon",closeAriaLabel:"closeAriaLabel",closeTabindex:"closeTabindex",minimizeIcon:"minimizeIcon",maximizeIcon:"maximizeIcon",visible:"visible",style:"style",position:"position"},outputs:{onShow:"onShow",onHide:"onHide",visibleChange:"visibleChange",onResizeInit:"onResizeInit",onResizeEnd:"onResizeEnd",onDragEnd:"onDragEnd",onMaximize:"onMaximize"},standalone:!1,features:[Sn],ngContentSelectors:hI,decls:1,vars:1,consts:[["container",""],["notHeadless",""],["content",""],["titlebar",""],["footer",""],[3,"class","ngStyle","ngClass",4,"ngIf"],[3,"ngStyle","ngClass"],["pFocusTrap","","role","dialog",3,"ngClass","ngStyle","class","pFocusTrapDisabled",4,"ngIf"],["pFocusTrap","","role","dialog",3,"ngClass","ngStyle","pFocusTrapDisabled"],[4,"ngIf","ngIfElse"],[4,"ngTemplateOutlet"],["class","p-resizable-handle",3,"mousedown",4,"ngIf"],["class","p-dialog-header",3,"mousedown",4,"ngIf"],[3,"ngClass","ngStyle"],["class","p-dialog-footer",4,"ngIf"],[1,"p-resizable-handle",3,"mousedown"],[1,"p-dialog-header",3,"mousedown"],["class","p-dialog-title",3,"id",4,"ngIf"],[1,"p-dialog-header-icons"],["role","button","type","button","pRipple","","pButton","",3,"ngClass","click","keydown.enter",4,"ngIf"],["type","button","pRipple","","pButton","",3,"ngClass","ngStyle","click","keydown.enter",4,"ngIf"],[1,"p-dialog-title",3,"id"],["role","button","type","button","pRipple","","pButton","",3,"click","keydown.enter","ngClass"],["class","p-dialog-header-maximize-icon",3,"ngClass",4,"ngIf"],[4,"ngIf"],[1,"p-dialog-header-maximize-icon",3,"ngClass"],[3,"styleClass",4,"ngIf"],[3,"styleClass"],["type","button","pRipple","","pButton","",3,"click","keydown.enter","ngClass","ngStyle"],["class","p-dialog-header-close-icon",3,"ngClass",4,"ngIf"],[1,"p-dialog-header-close-icon",3,"ngClass"],[1,"p-dialog-footer"]],template:function(n,r){n&1&&(sf(uI),ne(0,WI,2,16,"div",5)),n&2&&N("ngIf",r.maskVisible)},dependencies:()=>[cn,Qo,Wo,Pn,j0,Sf,Zo,Dn,Gd,$d],styles:[`@layer primeng{.p-dialog-mask{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;pointer-events:none}.p-dialog-mask.p-component-overlay{pointer-events:auto}.p-dialog{display:flex;flex-direction:column;pointer-events:auto;max-height:90%;transform:scale(1);position:relative}.p-dialog-content{overflow-y:auto;flex-grow:1}.p-dialog-header{display:flex;align-items:center;justify-content:space-between;flex-shrink:0}.p-dialog-draggable .p-dialog-header{cursor:move}.p-dialog-footer{flex-shrink:0}.p-dialog .p-dialog-header-icons{display:flex;align-items:center}.p-dialog .p-dialog-header-icon{display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}.p-fluid .p-dialog-footer .p-button{width:auto}.p-dialog-top .p-dialog,.p-dialog-bottom .p-dialog,.p-dialog-left .p-dialog,.p-dialog-right .p-dialog,.p-dialog-top-left .p-dialog,.p-dialog-top-right .p-dialog,.p-dialog-bottom-left .p-dialog,.p-dialog-bottom-right .p-dialog{margin:.75rem;transform:translateZ(0)}.p-dialog-maximized{-webkit-transition:none;transition:none;transform:none;width:100vw!important;height:100vh!important;top:0!important;left:0!important;max-height:100%;height:100%}.p-dialog-maximized .p-dialog-content{flex-grow:1}.p-dialog-left{justify-content:flex-start}.p-dialog-right{justify-content:flex-end}.p-dialog-top{align-items:flex-start}.p-dialog-top-left{justify-content:flex-start;align-items:flex-start}.p-dialog-top-right{justify-content:flex-end;align-items:flex-start}.p-dialog-bottom{align-items:flex-end}.p-dialog-bottom-left{justify-content:flex-start;align-items:flex-end}.p-dialog-bottom-right{justify-content:flex-end;align-items:flex-end}.p-dialog .p-resizable-handle{position:absolute;font-size:.1px;display:block;cursor:se-resize;width:12px;height:12px;right:1px;bottom:1px}.p-confirm-dialog .p-dialog-content{display:flex;align-items:center}}
`],encapsulation:2,data:{animation:[ui("animation",[un("void => visible",[yc(YI)]),un("visible => void",[yc(XI)])])]},changeDetection:0})}return i})(),K0=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ue({type:i});static \u0275inj=Be({imports:[mt,G0,xf,Xi,Dn,Gd,$d,di]})}return i})();var ZI=(i,e)=>({"stage-level-number-unselected":i,"stage-level-number-selected":e});function eT(i,e){if(i&1){let t=qe();L(0,"div",4),Pe("click",function(){le(t);let r=H();return ce(r.stageClick())}),L(1,"span",5),ye(2),q()()}if(i&2){let t=H();M(2),qt(" ",t.stageLevel.value," ")}}function tT(i,e){if(i&1&&(yt(0,2),ye(1),vt()),i&2){let t=H();M(),qt(" ",t.stageLevel.value," ")}}function nT(i,e){i&1&&(L(0,"span",6),X(1,"i",7),q())}function iT(i,e){if(i&1&&(L(0,"div",3),At(1,nT,2,0,"span",6,oi),q()),i&2){let t=H();M(),St(t.stars)}}function rT(i,e){i&1&&(L(0,"span",8),X(1,"i",7),q())}function sT(i,e){if(i&1){let t=qe();L(0,"div",4),Pe("click",function(){le(t);let r=H(2);return ce(r.stageClick())}),At(1,rT,2,0,"span",8,oi),q()}if(i&2){let t=H(2);M(),St(t.stars)}}function oT(i,e){i&1&&(L(0,"span",9),X(1,"i",10),q())}function aT(i,e){if(i&1&&At(0,oT,2,0,"span",9,oi),i&2){let t=H(2);St(t.stars)}}function lT(i,e){if(i&1&&(L(0,"div",3),ne(1,sT,3,0,"div")(2,aT,2,0),q()),i&2){let t=H();M(),Wi(t.stageLevel.completed?1:2)}}var Q0=(()=>{class i{constructor(t){this.stageCommunicationService=t,this.stars=new Array(1,2,3)}stageClick(){this.stageCommunicationService.updatePerformedItem(this.stageLevel),console.log("Stage Clicked")}static{this.\u0275fac=function(n){return new(n||i)(de(zl))}}static{this.\u0275cmp=_e({type:i,selectors:[["app-stage-level"]],inputs:{stageLevel:"stageLevel"},standalone:!1,decls:7,vars:6,consts:[[1,"stage-level-layout"],[2,"text-align","center",3,"ngClass"],[1,"disable-stage-click"],[2,"display","flex","justify-content","center"],[3,"click"],[1,"stage-level-completed-value","enable-stage-click"],[1,"stage-level-asterisk-selected"],[1,"pi","pi-star-fill",2,"font-size","10px"],[1,"stage-level-asterisk-unselected","stage-level-completed","enable-stage-click"],[1,"stage-level-asterisk-unselected","disable-stage-click"],[1,"pi","pi-star",2,"font-size","10px"]],template:function(n,r){n&1&&(L(0,"div",0)(1,"div",1),ne(2,eT,3,1,"div")(3,tT,2,1,"ng-container",2),q(),L(4,"div"),ne(5,iT,3,0,"div",3)(6,lT,3,1,"div",3),q()()),n&2&&(M(),N("ngClass",li(3,ZI,!r.stageLevel.selected,r.stageLevel.selected)),M(),Wi(r.stageLevel.completed?2:3),M(3),Wi(r.stageLevel.selected?5:6))},dependencies:[cn,Xo],styles:[".stage-level-layout[_ngcontent-%COMP%]{padding-top:1px}.stage-level-layout[_ngcontent-%COMP%]   .enable-stage-click[_ngcontent-%COMP%]{cursor:pointer;pointer-events:auto}.stage-level-layout[_ngcontent-%COMP%]   .disable-stage-click[_ngcontent-%COMP%]{cursor:default;pointer-events:none}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-font[_ngcontent-%COMP%], .stage-level-layout[_ngcontent-%COMP%]   .stage-level-number-selected[_ngcontent-%COMP%], .stage-level-layout[_ngcontent-%COMP%]   .stage-level-number-unselected[_ngcontent-%COMP%]{font-size:17px}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-number-unselected[_ngcontent-%COMP%]{font-weight:450}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-number-selected[_ngcontent-%COMP%]{font-weight:600}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-asterisk-unselected[_ngcontent-%COMP%]{color:#00f}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-asterisk-selected[_ngcontent-%COMP%]{color:#ec09eb}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-completed[_ngcontent-%COMP%], .stage-level-layout[_ngcontent-%COMP%]   .stage-level-completed-value[_ngcontent-%COMP%]{color:green;opacity:.5}.stage-level-layout[_ngcontent-%COMP%]   .stage-level-completed-value[_ngcontent-%COMP%]{font-weight:500;color:#000}"]})}}return i})();var uT=(i,e)=>e.index,hT=i=>({"border-bottom":i});function dT(i,e){i&1&&(L(0,"div")(1,"span",2),ye(2,"No stage levels defined!"),q()())}function mT(i,e){if(i&1&&(L(0,"div",3),X(1,"app-stage-level",4),q()),i&2){let t=e.$implicit;N("ngStyle",Ot(2,hT,t.selected?"none":"1px solid #d4d4d4")),M(),N("stageLevel",t)}}function fT(i,e){if(i&1&&(L(0,"div",1),At(1,mT,2,4,"div",3,uT),q()),i&2){let t=H();M(),St(t.stageLevels)}}var W0=(()=>{class i{constructor(){this.MAXSTAGE_LEVELS=5,this.NO_STAGE_LEVELS=!1,this.stageLevels=new Array}ngOnInit(){this.NO_STAGE_LEVELS=!this.stageLevels||this.stageLevels&&this.stageLevels.length!=this.MAXSTAGE_LEVELS}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=_e({type:i,selectors:[["app-game-stage-levels"]],inputs:{stageLevels:"stageLevels"},standalone:!1,decls:3,vars:1,consts:[[1,"game-stage-level-layout"],[1,"stage-levels"],[1,"warning-message"],[1,"stage-level",3,"ngStyle"],[3,"stageLevel"]],template:function(n,r){n&1&&(L(0,"div",0),ne(1,dT,3,0,"div")(2,fT,3,0,"div",1),q()),n&2&&(M(),Wi(r.NO_STAGE_LEVELS?1:2))},dependencies:[Pn,Jo,Q0],styles:[".digit-font-settings[_ngcontent-%COMP%], .game-stage-level-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%]{font-size:17px;font-weight:500;line-height:17px;font-family:Courier New,Courier,monospace;letter-spacing:.03em}.digits-border-horizontal[_ngcontent-%COMP%], .game-stage-level-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%]{border-bottom:1px solid #d4d4d4;padding:12px 0}.game-stage-level-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%]{font-weight:500;font-size:17px;text-align:center;color:orange;padding-left:calc(50% - 115px)}.game-stage-level-layout[_ngcontent-%COMP%]   .stage-levels[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:center;align-items:center}.game-stage-level-layout[_ngcontent-%COMP%]   .stage-levels[_ngcontent-%COMP%]   .stage-level[_ngcontent-%COMP%]{border:1px solid #d4d4d4;padding:0 10px;order:0;flex:1 1 auto;align-self:auto}"]})}}return i})();var vo=class{constructor(e=1/0){this.capacity=e,this.itemStorage=[]}peekBy(e){return this.itemStorage[e]}clear(){this.itemStorage.splice(0,this.itemStorage.length)}push(e){if(this.size()===this.capacity)throw Error("Error: The Stack has reached maximum Capacity!");this.itemStorage.push(e)}pop(){return this.itemStorage.pop()}peek(){return this.itemStorage[this.size()-1]}size(){return this.itemStorage.length}};var wo=class{constructor(e,t,n){this.operands=e,this.operator=t,this.result=n}};var Y0=ui("operandButtonAnimationMove",[gs("buttonFromA",Gt({left:"{{ posALeft }}",top:"{{ posATop }}",width:"90px",height:"90px"}),{params:{posALeft:"1025px",posATop:"219px"}}),gs("buttonToB",Gt({left:"{{ posBLeft }}",top:"{{ posBTop }}",width:"90px",height:"90px"}),{params:{posBLeft:"805px",posBTop:"324px"}}),un("* => buttonToB",Rn("1.5s"))]);var X0=(i,e)=>e.id,gT=i=>({"background-color":i});function _T(i,e){if(i&1){let t=qe();L(0,"button",10),Pe("click",function(){let r=le(t).$implicit,s=H();return ce(s.onOperandButtonClick(r))}),ye(1),q()}if(i&2){let t=e.$implicit;N("disabled",t.disabled)("ngStyle",Ot(4,gT,t.selected?"rgb(190 209 253 / 59%)":""))("ngClass",!t.disabled&&!t.selected?"operator-content-button":"operator-content-button-disabled"),M(),qt("",t.value," ")}}function yT(i,e){if(i&1){let t=qe();L(0,"button",11),Pe("click",function(){let r=le(t).$implicit,s=H();return ce(s.onOperatorButtonClick(r))}),X(1,"mat-icon",12),q()}if(i&2){let t=e.$implicit,n=e.$index;N("ngClass",n===0?"revert-button":"arithmetic-operation-button"),M(),of("svgIcon",t.icon)}}var J0=(()=>{class i{constructor(t,n){this.githubLogoPath="assets/logos/GitHub-Mark-32px.png",this.operators=new Array({id:0,selected:!1,caption:fe.OPERATOR_REV,operator:fe.OPERATOR_REV,icon:"revert"},{id:1,selected:!1,caption:fe.OPERATOR_ADD,operator:fe.OPERATOR_ADD,icon:"addition"},{id:2,selected:!1,caption:fe.OPERATOR_SUB,operator:fe.OPERATOR_SUB,icon:"substraction"},{id:3,selected:!1,caption:fe.OPERATOR_MUL,operator:fe.OPERATOR_MUL,icon:"multiplication"},{id:4,selected:!1,caption:fe.OPERATOR_DIV,operator:fe.OPERATOR_DIV,icon:"division"}),this.expectedResultReached=new ct,this.invalidOperationExecuted=new ct,t.addSvgIcon("revert",n.bypassSecurityTrustResourceUrl("assets/icons/rotate-left-solid.svg")),t.addSvgIcon("addition",n.bypassSecurityTrustResourceUrl("assets/icons/plus-solid.svg")),t.addSvgIcon("substraction",n.bypassSecurityTrustResourceUrl("assets/icons/minus-solid.svg")),t.addSvgIcon("multiplication",n.bypassSecurityTrustResourceUrl("assets/icons/xmark-solid.svg")),t.addSvgIcon("division",n.bypassSecurityTrustResourceUrl("assets/icons/divide-solid.svg"))}getSelectedOperator(){return this.operators.find(t=>t.selected)}clearSelectionOfOperands(){this.gameParameters.operands.forEach(t=>{t.selected=!1})}isTheExpectedResultReached(t){return this.gameParameters.result===t}addStateToHistory(t){this.history.push(t)}clearSelectionOfOperators(){this.operators.forEach(t=>{t.selected=!1})}addGameOperationToOperationHistory(t){this.operationHistory?.push(t)}captureAnimationTriggerStartEvent(t){console.log("Animation trigger start ",t)}captureAnimationTriggerDoneEvent(t){console.log("Animation trigger done ",t)}ngOnInit(){this.history=new vo,this.operationHistory=new vo}revertLastOperation(){this.history.size()>0?this.gameParameters=this.history.pop():console.log("History is empty!"),this.clearSelectionOfOperators(),this.clearSelectionOfOperands(),this.selectedOperandA=null,this.selectedOperandB=null}enableOfAllOperands(){this.gameParameters.operands.forEach(t=>{t.disabled=!1})}clearHistory(){this.history?.clear()}removeLastOperation(){return this.history.pop()}onOperandButtonClick(t){if(t.selected=!t.selected,!t.selected){if(this.selectedOperandB&&this.selectedOperandB.id===t.id){this.selectedOperandB.selected=!1,this.selectedOperandB=null;return}else if(this.selectedOperandA&&this.selectedOperandA.id===t.id){this.selectedOperandA.selected=!1,this.selectedOperandA=null;return}}this.selectedOperandA?this.selectedOperandA.id!==t.id&&(this.selectedOperandB||(this.selectedOperandB=t)):this.selectedOperandA=t;var n=this.getSelectedOperator();if(this.selectedOperandA&&this.selectedOperandB&&!n)this.selectedOperandB.selected=!1,this.selectedOperandB=null;else if(this.selectedOperandA&&this.selectedOperandB&&n){let r=Mt.cloneGameParameters(this.gameParameters),s=Mt.evaluate(this.selectedOperandA.value,this.selectedOperandB.value,n.operator);if(this.addStateToHistory(r),s===Number.MIN_VALUE)this.invalidOperationExecuted.emit(s);else{let o=new Array(this.selectedOperandA.value,this.selectedOperandB.value),l=new wo(o,n.operator,s);this.addGameOperationToOperationHistory(l),this.isTheExpectedResultReached(s)&&this.expectedResultReached.emit(this.operationHistory),t.value=s;let c=this.gameParameters.operands.find(h=>h.id==this.selectedOperandA.id);c.disabled=!0,this.clearSelectionOfOperators(),this.clearSelectionOfOperands(),this.selectedOperandA=null,this.selectedOperandB=null}}console.log(`Value ${t.value} Selected ${t.selected}`)}onOperatorButtonClick(t){if(!this.selectedOperandA&&t.operator!==fe.OPERATOR_REV){t.selected=!1;return}if(t.selected=!t.selected,t.operator===fe.OPERATOR_REV){this.revertLastOperation();let n=Mt.cloneGameParameters(this.gameParameters),r=new Array;n.operands.forEach(o=>{r.push(o.value)});let s=new wo(r,t.operator,this.gameParameters.result);this.addGameOperationToOperationHistory(s)}console.log(`Caption ${t.caption} Selected ${t.selected}`)}ngOnDestroy(){this.history.clear(),this.history=void 0,this.operationHistory.clear(),this.operationHistory=void 0}static{this.\u0275fac=function(n){return new(n||i)(de(_f),de(pf))}}static{this.\u0275cmp=_e({type:i,selectors:[["app-game-arithmetic-operations"]],hostVars:1,hostBindings:function(n,r){n&1&&rf("@operandButtonAnimationMove.start",function(o){return r.captureAnimationTriggerStartEvent(o)})("@operandButtonAnimationMove.done",function(o){return r.captureAnimationTriggerDoneEvent(o)}),n&2&&nf("@operandButtonAnimationMove",r.operandButtonAnimation)},inputs:{gameParameters:"gameParameters"},outputs:{expectedResultReached:"expectedResultReached",invalidOperationExecuted:"invalidOperationExecuted"},standalone:!1,decls:15,vars:2,consts:[[1,"game-arithmetic-operations-layout"],[1,"usage-instruction"],[1,"expected-result"],[1,"operands-container"],[1,"three-operands"],["type","button",1,"operand",3,"disabled","ngStyle","ngClass"],[1,"operators-container"],["type","button",1,"operator-content",3,"ngClass"],["href","https://github.com/lkovari/LKovariHome/tree/master/src/app/digits/digits-game.component.ts"],["width","16","height","16",3,"src"],["type","button",1,"operand",3,"click","disabled","ngStyle","ngClass"],["type","button",1,"operator-content",3,"click","ngClass"],[1,"operator-content-icon",3,"svgIcon"]],template:function(n,r){n&1&&(L(0,"div",0)(1,"div",1),ye(2,"Use the any combination of number to reach the target:"),q(),L(3,"div")(4,"label",2),ye(5),q()(),L(6,"div",3)(7,"div",4),At(8,_T,2,6,"button",5,X0),q()(),L(10,"div",6),At(11,yT,2,2,"button",7,X0),q(),L(13,"a",8),X(14,"img",9),q()()),n&2&&(M(5),xn(r.gameParameters.result),M(3),St(r.gameParameters.operands),M(3),St(r.operators),M(3),N("src",r.githubLogoPath,tf))},dependencies:[cn,Pn,Xo,Jo,yf],styles:[".game-arithmetic-operations-layout[_ngcontent-%COMP%]{text-align:center}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .usage-instruction[_ngcontent-%COMP%]{font-size:13px;font-weight:500;line-height:13px;letter-spacing:.02em;padding-bottom:20px;font-family:Arial,Helvetica,sans-serif}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .expected-result[_ngcontent-%COMP%]{text-align:center;font-size:55px;font-weight:500;padding-bottom:1rem}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operands-container[_ngcontent-%COMP%]{font-size:44px;font-weight:500}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operands-container[_ngcontent-%COMP%]   .three-operands[_ngcontent-%COMP%]{justify-content:center;display:flex;flex-direction:row;flex-wrap:wrap;width:371px;margin:7px auto}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operands-container[_ngcontent-%COMP%]   .three-operands[_ngcontent-%COMP%]   .operand[_ngcontent-%COMP%]{width:90px;height:90px;border:4px dashed blue;border-radius:50%;font-size:26px;font-weight:550;margin:4px 10px;font-family:Courier New,Courier,monospace}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operands-container[_ngcontent-%COMP%]   .three-operands[_ngcontent-%COMP%]   .operand[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]:hover{border:4px solid blue}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operators-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:center;align-content:center;align-items:center}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operator-content[_ngcontent-%COMP%]{order:0;flex:0 1 auto;align-self:auto;width:3.55rem;height:3.55rem;border:4px solid #6b6b6b;border-radius:50%;margin:3px;display:flex;justify-content:center;align-items:center;color:#00f}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operator-content-button[_ngcontent-%COMP%], .game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operator-content-button-disabled[_ngcontent-%COMP%]{background-color:#fff}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operator-content-button[_ngcontent-%COMP%]:hover{background-color:#e6fffa}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .operator-content-icon[_ngcontent-%COMP%]{width:30px;height:30px;font-weight:500;vertical-align:middle}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .revert-button[_ngcontent-%COMP%]{background-color:#dbfbdd}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .revert-button[_ngcontent-%COMP%]:hover{background-color:#aae0ae}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .arithmetic-operation-button[_ngcontent-%COMP%]{background-color:#d9ecff}.game-arithmetic-operations-layout[_ngcontent-%COMP%]   .arithmetic-operation-button[_ngcontent-%COMP%]:hover{background-color:#aed7ff}"],data:{animation:[Y0]}})}}return i})();var wT=["arithmeticOperations"];function IT(i,e){if(i&1&&(L(0,"li",13),ye(1),q()),i&2){let t=e.$implicit;M(),qt(" ",t," ")}}function TT(i,e){if(i&1&&(L(0,"li",13),ye(1),q()),i&2){let t=e.$implicit;M(),qt(" ",t," ")}}var Z0=(()=>{class i{constructor(t,n,r,s,o){this.messageService=t,this.cookieService=n,this.clipboardService=r,this.numbersFirestoreService=s,this.stageCommunicationService=o,this.COOKIE_LK_DIGITS="CookieLKNumbers",this.generateGameParameters=new ia,this.currentDate=new Date,this.stageLevels=[],this.gameParameters=[],this.stageIndex=0,this.todayPuzzleDataItems=[],this.splashVisible=!1,this.gameCompletedModalMessages=[],this.gameCompletedModalVisible=!1,this.allGameCompletedModalMessage=[],this.allGameCompletedModalVisible=!1,this.splashWidth="80vw",this.destroyRef=Hi(ef),this.defaultGameParameters={result:0,operands:[],stageIndex:0},this.updateStageLevel=this.stageCommunicationService.getUpdatedStageLevel().pipe(Tf(this.destroyRef)).subscribe({next:l=>{console.log("StageLevel updated "+l.index)},error:l=>console.error("StageLevel updated "+l),complete:()=>console.info("StageLevel updated Complete")})}initializeStageLevels(){this.stageLevels=new Array({selected:!0,index:0,value:96,completed:!1,summary:""},{selected:!1,index:1,value:161,completed:!1,summary:""},{selected:!1,index:2,value:275,completed:!1,summary:""},{selected:!1,index:3,value:355,completed:!1,summary:""},{selected:!1,index:4,value:404,completed:!1,summary:""})}stageToCompleted(){this.stageLevels[this.stageIndex].completed=!0,this.stageLevels[this.stageIndex].selected=!1}formatOperations(t){let n=`Completed! Executed Operations:
`,r=t.size()-1;for(;r>=0;){let s=t.peekBy(r);n+=r+1+". "+s?.operands[0]+" "+s?.operator+" "+s?.operands[1]+" = "+s?.result+`
`,--r}return n}createSummaryOfTHeOperations(t,n){let r=this.stageLevels[t].value+" -> ";for(this.gameCompletedModalMessages=[];n.size()>0;){let s=n.pop();this.gameCompletedModalMessages.push(s?.operands[0]+" "+s.operator+" "+s?.operands[1]+" = "+s?.result),r+=""+s?.operator}return r+=`
`,r}showSuccessMessage(t){this.messageService.add({severity:"success",summary:"Congratulation!",detail:t})}showErrorMessage(t){this.messageService.add({severity:"error",summary:"Error!",detail:t})}setupStages(){let t=0;this.gameParameters.forEach(n=>{this.stageLevels[t].value=n.result,++t})}storeGameStateToCookie(){let t=new Is;t.storeDate=new Date,t.stageIndex=this.stageIndex,t.stageLevels=this.stageLevels,t.completed=this.allGameCompleted()&&this.stageIndex===this.stageLevels.length-1,t.gameParameters=this.gameParameters;let n=t.cookieData2Text(),r=new Date;r.setHours(23,59,59,999),this.cookieService.set(this.COOKIE_LK_DIGITS,n,r)}restoreGameStateFromCookie(){let t=this.cookieService.get(this.COOKIE_LK_DIGITS),n;return!t||t==""?(console.log("INFO: Unable to retrieve the Game State"),n=null):(n=new Is,n=n.text2CookieData(t)),n}mapPuzzleDataToGameParameters(t){t.stages.forEach(n=>{let r=this.gameParameters.find(s=>s.stageIndex===n.stageIndex);if(r){r.result=n.expectedValue;let s=0;r.operands.forEach(l=>{l.value=n.operands[s],s++}),this.initializeStageLevels();let o=this.stageLevels.find(l=>l.index===n.stageIndex);o&&o.value==n.expectedValue}})}mapGameParametersToPuzzleData(t){let n=new sa;return n.day=new Date,n.day.setHours(23,59,59,999),t.forEach(r=>{let s=new oa;s.stageIndex=r.stageIndex,s.expectedValue=r.result;let o=new Array;r.operands.forEach(l=>{o.push(l.value)}),s.operands=o,n.stages.push(s)}),n}isDateSame(t,n){return t.getFullYear()===n.getFullYear()&&t.getMonth()===n.getMonth()&&t.getDate()===n.getDate()}updatePuzzleDataInDb(t){this.firestorePuzzleData.data=JSON.stringify(t),this.numbersFirestoreService.update(this.firestorePuzzleData.id,{data:this.firestorePuzzleData.data}).then(()=>console.log("INFO: The Game Data was updated successfully in DB!")).catch(n=>console.log(n))}createPuzzleDataInDb(t){this.numbersFirestoreService.create(t).then(()=>{console.log("INFO: The Puzzle Data was created successfully in DB!")})}currentLocaleAlreadyStoredInDb(){let t=navigator.language;return this.firestorePuzzleDataItems.find(r=>r.locale===t)!==void 0}upsertGameDataInDb(t){if(this.currentLocaleAlreadyStoredInDb())this.updatePuzzleDataInDb(t);else{let n=new Ts;n.locale=navigator.language,n.data=JSON.stringify(t),this.createPuzzleDataInDb(n)}}allGameCompleted(){let t=!0;return this.stageLevels.forEach(n=>{t=t&&n.completed}),t}collectAllOperations(){let t=this.allGameCompleted()&&this.stageIndex===this.stageLevels.length-1;if(t){let n=`Genius!
`;this.allGameCompletedModalMessage=[],this.stageLevels.forEach(r=>{n+=r.summary,this.allGameCompletedModalMessage.push(r.summary)}),this.clipboardService.copy(n),this.storeGameStateToCookie(),this.allGameCompletedModalVisible=!0}return t}generateNewGameAndStore(){this.gameParameters=this.generateGameParameters.generateStageNumbers(),this.storeGameStateToCookie(),this.setupStages();let t=this.mapGameParametersToPuzzleData(this.gameParameters);this.upsertGameDataInDb(t)}ngOnInit(){console.log(`Browser locale: ${navigator.language}`),this.initializeStageLevels();let t=this.restoreGameStateFromCookie();if(t){console.log("INFO: Game state restored from cookie");let n=new Date(t.storeDate);if(this.isDateSame(n,new Date))this.stageIndex=t.stageIndex,this.stageLevels=t.stageLevels,this.gameParameters=t.gameParameters,this.setupStages(),t.completed?this.collectAllOperations()&&console.log("INFO: All Games completed show completed modal"):(console.log("INFO: All Games incomplete show splash"),this.splashVisible=!0);else{this.gameParameters=this.generateGameParameters.generateStageNumbers(),this.storeGameStateToCookie(),this.setupStages();let r=this.mapGameParametersToPuzzleData(this.gameParameters);console.log("INFO: Date mismatch which restored from cookie "+r),this.upsertGameDataInDb(r)}}else{console.log("INFO: No game state in cookie, try to get if from DB."),this.gameParameters=this.generateGameParameters.generateStageNumbers();let n=navigator.language;this.numbersFirestoreService.getAll().snapshotChanges().pipe(Ke(r=>r.map(s=>Vt({id:s.payload.doc.id},s.payload.doc.data())))).subscribe(r=>{this.firestorePuzzleDataItems=r;let s=r.find(o=>o.locale===n);if(s){this.firestorePuzzleData=s,this.todayPuzzleData=JSON.parse(this.firestorePuzzleData.data),console.log("INFO: Game Data retrieved from DB.");let o=new Date,l=new Date(this.todayPuzzleData.day);if(this.todayPuzzleData.day&&this.isDateSame(l,o))console.log("INFO: Game Data day date is matched, apply Game data"),this.mapPuzzleDataToGameParameters(this.todayPuzzleData),this.storeGameStateToCookie(),this.setupStages();else{console.log("INFO: Game Data day of date is Not matched, generate new game parameters"),this.gameParameters=this.generateGameParameters.generateStageNumbers(),this.storeGameStateToCookie(),this.setupStages();let c=this.mapGameParametersToPuzzleData(this.gameParameters);this.upsertGameDataInDb(c)}}else{console.log("INFO: Game Data not found in the DB. by locale"),this.gameParameters=this.generateGameParameters.generateStageNumbers(),this.storeGameStateToCookie(),this.setupStages();let o=this.mapGameParametersToPuzzleData(this.gameParameters),l=new Ts;l.locale=navigator.language,l.data=JSON.stringify(o),this.createPuzzleDataInDb(l)}})}}ngOnDestroy(){this.updateStageLevel.unsubscribe()}expectedResultReached(t){let n=this.formatOperations(t),r=this.createSummaryOfTHeOperations(this.stageIndex,t);this.stageLevels[this.stageIndex].summary=r,this.clipboardService.copy(n),this.showSuccessMessage("You are reach the expected result!"),this.stageToCompleted(),this.reachedValue=this.gameParameters[this.stageIndex].result,this.gameCompletedModalVisible=!0}hideGameCompletedDialog(){this.collectAllOperations()||(this.stageIndex++,this.stageLevels[this.stageIndex].selected=!0),this.storeGameStateToCookie(),this.arithmeticComponent.clearHistory()}invalidOperationExecuted(t){this.showErrorMessage("Invalid Operation Executed!"),this.arithmeticComponent.revertLastOperation(),console.log(t)}onDeleteCookie(){this.cookieService.deleteAll()}onUpdatePuzzleData(){this.generateNewGameAndStore()}static{this.\u0275fac=function(n){return new(n||i)(de(Yi),de(ra),de(Ff),de(Ll),de(zl))}}static{this.\u0275cmp=_e({type:i,selectors:[["app-digits-game"]],viewQuery:function(n,r){if(n&1&&an(wT,7),n&2){let s;ht(s=dt())&&(r.arithmeticComponent=s.first)}},standalone:!1,features:[af([Yi,ra])],decls:31,vars:14,consts:[["arithmeticOperations",""],[1,"digits-game-layout"],["position","top-center","closable","true"],[1,"digits-game-title"],["href","https://www.nytimes.com/games/digits",1,"anchor-underline-off"],[1,"title-bar"],[1,"title-bar-name",3,"click"],[1,"title-bar-date",3,"click"],[1,"tool-bar"],[3,"stageLevels"],[3,"expectedResultReached","invalidOperationExecuted","gameParameters"],["id","splashscreen","header","Welcome to the Numbers Puzzle Game",3,"visibleChange","visible","modal"],["id","gameCompleted","header","Game Completed",3,"visibleChange","onHide","visible","modal"],[1,"li-no-bullet"],["id","allGamesCompleted","header","All Game Completed Genius!",3,"visibleChange","visible","modal","closable"]],template:function(n,r){if(n&1){let s=qe();L(0,"div",1),X(1,"p-toast",2),L(2,"div",3),ye(3," This is a daily numbers puzzle, similar to the "),L(4,"a",4),ye(5,"NY Times Digits"),q(),ye(6,", which unfortunately discontinued at August 8, 2023 "),q(),L(7,"div",5)(8,"div",6),Pe("click",function(){return le(s),ce(r.onDeleteCookie())}),ye(9," Numbers "),q(),L(10,"div",7),Pe("click",function(){return le(s),ce(r.onUpdatePuzzleData())}),ye(11),cf(12,"date"),q()(),L(13,"div",8),X(14,"app-game-stage-levels",9),q(),L(15,"div")(16,"app-game-arithmetic-operations",10,0),Pe("expectedResultReached",function(l){return le(s),ce(r.expectedResultReached(l))})("invalidOperationExecuted",function(l){return le(s),ce(r.invalidOperationExecuted(l))}),q()()(),L(18,"p-dialog",11),$o("visibleChange",function(l){return le(s),Go(r.splashVisible,l)||(r.splashVisible=l),ce(l)}),L(19,"p"),ye(20,"It can improves your arithmetic combination ability."),q()(),L(21,"p-dialog",12),$o("visibleChange",function(l){return le(s),Go(r.gameCompletedModalVisible,l)||(r.gameCompletedModalVisible=l),ce(l)}),Pe("onHide",function(){return le(s),ce(r.hideGameCompletedDialog())}),L(22,"div"),ye(23),At(24,IT,2,1,"li",13,oi),q()(),L(26,"p-dialog",14),$o("visibleChange",function(l){return le(s),Go(r.allGameCompletedModalVisible,l)||(r.allGameCompletedModalVisible=l),ce(l)}),L(27,"div"),ye(28," Congratulation! Your Solutions: "),At(29,TT,2,1,"li",13,oi),q()()}if(n&2){let s;M(11),qt(" ",uf(12,11,r.currentDate,"MM/dd/yyyy")," "),M(3),N("stageLevels",r.stageLevels),M(2),N("gameParameters",(s=r.gameParameters[r.stageIndex])!==null&&s!==void 0?s:r.defaultGameParameters),M(2),jo("visible",r.splashVisible),N("modal",!0),M(3),jo("visible",r.gameCompletedModalVisible),N("modal",!0),M(2),qt(" Target ",r.reachedValue,". Your solution: "),M(),St(r.gameCompletedModalMessages),M(2),jo("visible",r.allGameCompletedModalVisible),N("modal",!0)("closable",!1),M(3),St(r.allGameCompletedModalMessage)}},dependencies:[U0,$0,W0,J0,ff],styles:[".digit-font-settings[_ngcontent-%COMP%], .digits-game-layout[_ngcontent-%COMP%]   .tool-bar[_ngcontent-%COMP%], .digits-game-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%]{font-size:17px;font-weight:500;line-height:17px;font-family:Courier New,Courier,monospace;letter-spacing:.03em}.digits-border-horizontal[_ngcontent-%COMP%], .digits-game-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%], .digits-game-layout[_ngcontent-%COMP%]   .digits-game-title[_ngcontent-%COMP%]{border-bottom:1px solid #d4d4d4;padding:12px 0}.digits-game-layout[_ngcontent-%COMP%]{height:98vh;width:50vw;position:absolute;inset:0;margin:auto;background:#ebf9fd40;border:1px solid lightgray}.digits-game-layout[_ngcontent-%COMP%]   .digits-game-title[_ngcontent-%COMP%]{text-align:center}.digits-game-layout[_ngcontent-%COMP%]   .anchor-underline-off[_ngcontent-%COMP%]{text-decoration:none}.digits-game-layout[_ngcontent-%COMP%]   .warning-message[_ngcontent-%COMP%]{font-weight:500;font-size:17px;text-align:center;color:orange}.digits-game-layout[_ngcontent-%COMP%]   .title-bar[_ngcontent-%COMP%]{padding:6px 0;display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-around;align-content:stretch;align-items:center;font-size:28px;font-weight:300;font-family:Arial,Helvetica,sans-serif}.digits-game-layout[_ngcontent-%COMP%]   .title-bar[_ngcontent-%COMP%]   .title-bar-name[_ngcontent-%COMP%], .digits-game-layout[_ngcontent-%COMP%]   .title-bar[_ngcontent-%COMP%]   .title-bar-date[_ngcontent-%COMP%]{order:0;flex:0 1 auto;align-self:auto;cursor:default}.digits-game-layout[_ngcontent-%COMP%]   .tool-bar[_ngcontent-%COMP%]{height:52px}@media only screen and (max-width: 600px){.digits-game-layout[_ngcontent-%COMP%]{height:90vh;width:99vw}.digits-game-layout[_ngcontent-%COMP%]     .p-dialog{width:80vw}}@media only screen and (min-width: 601px){  .p-dialog{width:20vw}.digits-game-layout[_ngcontent-%COMP%]{position:absolute;inset:0;margin:auto}}@media only screen and (max-width: 600px){  .p-dialog{width:80vw}}  .p-dialog{border:2px solid;border-radius:25px;border-color:#00bfff}  .p-dialog .p-dialog-header{background-color:#f0f8ff;background-image:none;border-top-right-radius:25px;border-top-left-radius:25px}  .p-dialog .p-dialog-content:last-of-type{background-color:#f0f8ff;background-image:none;border-bottom-right-radius:25px;border-bottom-left-radius:25px}  li.li-no-bullet{list-style-position:revert;list-style-image:initial;list-style-type:decimal-leading-zero}"]})}}return i})();var ET=[{path:"digits/digits-game",component:Z0}],ey=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=Ue({type:i})}static{this.\u0275inj=Be({imports:[mt,ps.forChild(ET),ps]})}}return i})();var ty=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ue({type:i});static \u0275inj=Be({imports:[mt,Xi,fo,go,_o,po,Dn,di,di]})}return i})();var y2=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=Ue({type:i})}static{this.\u0275inj=Be({providers:[Ll],imports:[mt,ps,q0,ty,ey,gf,vf,Lf,ep.initializeApp(Mf.firebasePuzzleData),F0,K0]})}}return i})();export{y2 as DigitsModule};
